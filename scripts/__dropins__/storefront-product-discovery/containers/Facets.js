/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsxs as _,jsx as i,Fragment as A}from"@dropins/tools/preact-jsx-runtime.js";import*as h from"@dropins/tools/preact-compat.js";import{useState as C,useEffect as D}from"@dropins/tools/preact-compat.js";import{classes as T,VComponent as E,Slot as L}from"@dropins/tools/lib.js";import{Button as $,Icon as N,PriceRange as R,Checkbox as V,RadioButton as W}from"@dropins/tools/components.js";/* empty css                 */import{useText as O}from"@dropins/tools/i18n.js";import{events as Z}from"@dropins/tools/event-bus.js";import{d as H}from"../chunks/search.js";import"../chunks/initialize.js";import"../fragments.js";import"../chunks/acdlEvents.js";import"@dropins/tools/fetch-graphql.js";const Y=r=>h.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...r},h.createElement("g",{id:"Large"},h.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),h.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},h.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),h.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),G=r=>h.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},h.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 5.64001L5.62988 18.37",stroke:"currentColor"}),h.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 18.37L5.62988 5.64001",stroke:"currentColor"})),J=r=>h.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},h.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),K=({numberOfOptionsConfig:r=5,header:e,buckets:s,last:d})=>{const w=O({showMore:"Search.Facet.showMore",showLess:"Search.Facet.showLess"}),g=r,[p,u]=C(s.length<g),S=p?s.length:g;return _("div",{className:T(["product-discovery-facet",["product-discovery-facet--last",d]]),children:[i(E,{className:"product-discovery-facet__header",node:e}),s.slice(0,S).map((F,B)=>i(E,{className:"product-discovery-facet__bucket",node:F},B)),!p&&s.length>g&&i($,{variant:"tertiary",icon:i(N,{source:Y,size:"24"}),onClick:()=>u(!p),children:w.showMore}),p&&s.length>g&&i($,{variant:"tertiary",icon:i(N,{source:J,size:"24"}),onClick:()=>u(!p),children:w.showLess})]})},Q=({selectedFacets:r,facets:e})=>_(A,{children:[i(E,{className:"product-discovery-facet-list__selected-filters",node:r}),i(E,{className:"product-discovery-facet-list__facet-options",node:e})]}),X="no",I="yes",ee=r=>{const e=r.buckets.find(s=>s.selected);return e?{attribute:r.attribute,range:{from:e.from,to:e.to}}:null},te=r=>{const e=r.buckets.reduce((s,d)=>(d.selected&&s.push(d.title),s),[]);return e.length===0?null:{attribute:r.attribute,in:e}},ne=r=>{var e;switch((e=r.buckets[0])==null?void 0:e.__typename){case"RangeBucket":return ee(r);case"ScalarBucket":case"CategoryView":return te(r)}},re=r=>{var s,d,w,g,p,u,S,F,B,x,v;const e=r[0];return(w=(d=(s=e==null?void 0:e.price)==null?void 0:s.regular)==null?void 0:d.amount)!=null&&w.currency?e.price.regular.amount.currency:(S=(u=(p=(g=e==null?void 0:e.priceRange)==null?void 0:g.minimum)==null?void 0:p.regular)==null?void 0:u.amount)!=null&&S.currency?(v=(x=(B=(F=e==null?void 0:e.priceRange)==null?void 0:F.minimum)==null?void 0:B.regular)==null?void 0:x.amount)==null?void 0:v.currency:"USD"},ae=(r,e,s)=>(e==null?void 0:e.attribute)==="price"?r.from===0?_("div",{style:"display:flex",children:[i(R,{amount:r.from,currency:s||"USD"}),i("span",{style:"padding: 0 2px",children:"-"}),i(R,{amount:r.to,currency:s||"USD"})]}):i(R,{minimumAmount:r.from,maximumAmount:r.to,currency:s||"USD",display:"dash"}):r.title,ce=(r,e)=>r.title===X?`Not ${e.title}`:r.title===I?e.title:r.title,M=(r,e,s)=>{switch(r.__typename){case"RangeBucket":return ae(r,e,s);case"ScalarBucket":case"CategoryView":return ce(r,e)}},Fe=({scope:r,slots:e})=>{const s=O({clearAll:"Search.Facet.clearAll"}),[d,w]=C([]),[g,p]=C(null),[u,S]=C(),F=t=>{var o;const c=((o=u==null?void 0:u.filter)==null?void 0:o.filter(a=>a.attribute==="categoryPath"))||[];H({...t,filter:[...c,...t.filter||[]]},{scope:r})},B=t=>{const c=new URLSearchParams(window.location.search);if(!t.length)c.delete("filter");else{const o=t.map(a=>{var n;return a.range?`${a.attribute}:${a.range.from}-${a.range.to}`:(n=a.in)!=null&&n.length?`${a.attribute}:${a.in.join(",")}`:null}).filter(Boolean).join(";");c.set("filter",o)}c.set("page","1"),window.history.replaceState({},"",`${window.location.pathname}?${c.toString()}`)},x=t=>{if(!t||!t.result.facets&&!t.result.items&&!t.request.filter){w([]);return}S(t.request);const{facets:c,items:o}=t.result;p(re(o));const a=t.request.filter;if(c){const n=c.map(l=>{const y=l.buckets.map(f=>{f.selected=!1;const m=a==null?void 0:a.find(k=>k.attribute===l.attribute);if(m){const k=m.range;(k&&f.from===k.from&&f.to===k.to||m.in&&m.in.includes(f.title))&&(f.selected=!0)}return f});return l.buckets=y,l});w(n)}},v=t=>{const c=d.map(a=>{const n=t.find(l=>l.attribute===a.attribute);return n||a}),o=c.reduce((a,n)=>{const l=ne(n);return l&&a.push(l),a},[]);w(c),u&&(B(o),F({...u,filter:o}))},P=(t,c)=>{const o=t.buckets.map(n=>(n.title===c&&(n.selected=!1),n)),a=t;a.buckets=o,v([a])},U=()=>{const t=d.map(c=>{const o=c.buckets.map(a=>(a.selected=!1,a));return c.buckets=o,c});v(t),u&&F({...u,filter:[]})},b=(t,c)=>{const o=c.buckets.map(n=>{var l;return((l=c.buckets[0])==null?void 0:l.__typename)==="RangeBucket"&&(n.selected=!1),n.title===t.target.value&&(n.selected=t.target.checked),n}),a=c;a.buckets=o,v([a])},j=(t,c)=>{const o=i("span",{children:t.title}),a=t.buckets.map(n=>{var f;const l=M(n,t,g),y=m=>_(L,{name:"FacetBucketLabel",slot:e==null?void 0:e.FacetBucketLabel,context:{data:n},children:[l," ",m?`(${m})`:""]});switch((f=t.buckets[0])==null?void 0:f.__typename){case"RangeBucket":return i(L,{name:"FacetBucket",slot:e==null?void 0:e.FacetBucket,context:{data:n},children:i(W,{"data-testid":`${n.title}-radio`,label:y(),name:t.attribute,value:n.title,checked:n.selected,onChange:m=>{b(m,t)}})});case"ScalarBucket":case"CategoryView":return i(L,{name:"FacetBucket",slot:e==null?void 0:e.FacetBucket,context:{data:n},children:i(V,{id:`${t.attribute}-${n.title.replace(/[^a-zA-Z0-9_-]/g,"")}`,"data-testid":`${n.title}-checkbox`,label:y(n.count),name:`${t.attribute}-${n.title.replace(/[^a-zA-Z0-9_-]/g,"")}`,value:n.title,checked:n.selected,onChange:m=>{b(m,t)}})});default:return null}}).filter(n=>n!==null);return i(K,{header:o,buckets:a,last:c===d.length-1})},q=()=>i(L,{name:"Facets",slot:e==null?void 0:e.Facets,context:{data:d},children:d.map((t,c)=>t.buckets.length>0?i(A,{children:i(L,{name:"Facet",slot:e==null?void 0:e.Facet,context:{data:t},children:j(t,c)})}):null)}),z=()=>{const t=d.reduce((a,n)=>(n.buckets.filter(y=>y.selected).length>0&&a.push(n),a),[]),c=t.map(a=>a.buckets.map(n=>{if(n.selected){const l=M(n,a,g);return i($,{"data-testid":`${n.title}-selected-btn`,"aria-label":`Remove ${a.title} filter: ${n.title}`,variant:"secondary",children:_(A,{children:[i("span",{children:l}),i(N,{source:G,size:"16"})]}),onClick:()=>{P(a,n.title)}})}return null})),o=c.length>0?i($,{variant:"secondary",onClick:()=>{U()},children:i("span",{children:s.clearAll})}):null;return _(L,{name:"SelectedFacets",slot:e==null?void 0:e.SelectedFacets,context:{data:t},children:[c,o]})};return D(()=>{const t=Z.on("search/result",x,{eager:!0,scope:r});return()=>{t==null||t.off()}},[]),i(Q,{selectedFacets:z(),facets:q()})};export{Fe as Facets,Fe as default};
//# sourceMappingURL=Facets.js.map
