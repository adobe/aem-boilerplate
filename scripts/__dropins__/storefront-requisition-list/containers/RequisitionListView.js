/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as b,jsx as e,Fragment as pt}from"@dropins/tools/preact-jsx-runtime.js";import*as l from"@dropins/tools/preact-compat.js";import{useState as C,useEffect as it,useCallback as x}from"@dropins/tools/preact-compat.js";import{b as wt,a as qt,d as yt,u as kt,g as nt,i as _t}from"../chunks/addRequisitionListItemsToCart.js";import{Icon as W,Button as A,Price as mt,Field as bt,Input as vt,Image as Ct,Checkbox as Rt,Table as St,ProgressSpinner as Pt,InLineAlert as Et,Pagination as xt}from"@dropins/tools/components.js";import{events as q}from"@dropins/tools/event-bus.js";import{useState as ht,useCallback as ot}from"@dropins/tools/preact-hooks.js";import{classes as gt,VComponent as At}from"@dropins/tools/lib.js";import"../chunks/RequisitionListForm.js";import"../chunks/state.js";import{u as Nt,E as Vt}from"../chunks/RequisitionListView.js";import{D as et,P as Tt}from"../chunks/PageSizePicker.js";import{h as Ht}from"@dropins/tools/preact.js";import{useText as st}from"@dropins/tools/i18n.js";import{R as Mt}from"../chunks/RequisitionListHeader.js";import"../chunks/RequisitionListModal.js";import"../chunks/updateRequisitionList.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/deleteRequisitionList.js";function zt(){const[s,h]=ht(null),[u,a]=ht(new Set),g=ot((L,_)=>{a(p=>{const S=new Set(p);return _?S.add(L):S.delete(L),S})},[]),k=ot(()=>{var _;const L=(_=s==null?void 0:s.items)==null?void 0:_.map(p=>p.uid);a(new Set(L))},[s]),R=ot(()=>{a(new Set)},[]);return{currentRequisitionList:s,setCurrentRequisitionList:h,selectedItems:u,setSelectedItems:a,handleItemSelection:g,handleSelectAll:k,handleSelectNone:R}}const ft=s=>l.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},l.createElement("g",{clipPath:"url(#clip0_102_196)"},l.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3601 18.16H6.5601L4.8801 3H2.3501M19.6701 19.59C19.6701 20.3687 19.0388 21 18.2601 21C17.4814 21 16.8501 20.3687 16.8501 19.59C16.8501 18.8113 17.4814 18.18 18.2601 18.18C19.0388 18.18 19.6701 18.8113 19.6701 19.59ZM7.42986 19.59C7.42986 20.3687 6.79858 21 6.01986 21C5.24114 21 4.60986 20.3687 4.60986 19.59C4.60986 18.8113 5.24114 18.18 6.01986 18.18C6.79858 18.18 7.42986 18.8113 7.42986 19.59Z",stroke:"currentColor",strokeLinejoin:"round"}),l.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M5.25 6.37L20.89 8.06L20.14 14.8H6.19",stroke:"currentColor",strokeLinejoin:"round"})),l.createElement("defs",null,l.createElement("clipPath",{id:"clip0_102_196"},l.createElement("rect",{vectorEffect:"non-scaling-stroke",width:19.29,height:19.5,fill:"white",transform:"translate(2.3501 2.25)"})))),Dt=s=>l.createElement("svg",{id:"Icon_Search_Base","data-name":"Icon \\u2013 Search \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",viewBox:"0 0 24 24",...s},l.createElement("g",{id:"Large"},l.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),l.createElement("g",{id:"Search_icon","data-name":"Search icon",transform:"translate(3.75 3.75)"},l.createElement("circle",{vectorEffect:"non-scaling-stroke",id:"Ellipse_186","data-name":"Ellipse 186",cx:6,cy:6,r:6,fill:"none",stroke:"currentColor"}),l.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_556","data-name":"Line 556",x2:6,y2:6,transform:"translate(10.5 10.5)",fill:"none",stroke:"currentColor"})))),Lt=s=>l.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",...s},l.createElement("path",{d:"M1 5H23",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),l.createElement("path",{d:"M17.3674 22H6.63446C5.67952 22 4.88992 21.2688 4.8379 20.3338L4 5H20L19.1621 20.3338C19.1119 21.2688 18.3223 22 17.3655 22H17.3674Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),l.createElement("path",{d:"M9.87189 2H14.1281C14.6085 2 15 2.39766 15 2.88889V5H9V2.88889C9 2.39912 9.39006 2 9.87189 2Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),l.createElement("path",{d:"M8.87402 8.58057L9.39348 17.682",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),l.createElement("path",{d:"M14.6673 8.58057L14.146 17.682",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10})),Ft=({className:s,title:h="404 - Not Found",message:u="The requisition list you are looking for does not exist.",actionLabel:a,onAction:g,...k})=>b("div",{className:gt(["not-found",s]),"data-testid":"not-found",...k,children:[e(W,{source:Dt,size:"64",stroke:"2"}),e("h2",{children:h}),u&&e("p",{children:u}),a&&g&&e(A,{variant:"primary",onClick:g,children:a})]}),Bt=({className:s,items:h,selectedItems:u,currentPage:a,pageSize:g,canEdit:k=!0,handleItemSelection:R,handleUpdateQuantity:L,onAddToCart:_,onDeleteItem:p,...S})=>{const v=st({productNameHeader:"RequisitionList.RequisitionListView.productListTable.headers.productName",skuHeader:"RequisitionList.RequisitionListView.productListTable.headers.sku",priceHeader:"RequisitionList.RequisitionListView.productListTable.headers.price",quantityHeader:"RequisitionList.RequisitionListView.productListTable.headers.quantity",subtotalHeader:"RequisitionList.RequisitionListView.productListTable.headers.subtotal",actionsHeader:"RequisitionList.RequisitionListView.productListTable.headers.actions",actionAddToCart:"RequisitionList.RequisitionListView.actionAddToCart",actionDelete:"RequisitionList.RequisitionListView.actionDelete",itemQuantity:"RequisitionList.RequisitionListView.productListTable.itemQuantity"}),z=[{label:"#",key:"index"},{label:"item",key:"item"},{label:v.priceHeader,key:"price"},{label:v.quantityHeader,key:"quantity"},{label:v.subtotalHeader,key:"subtotal"}];k&&(z.unshift({label:"",key:"selector"}),z.push({label:v.actionsHeader,key:"actions"}));const Z=(o,V)=>{const T=o.target.checked;R(V.uid,T)},j=h.map((o,V)=>{var T,H,t,c,P,D,Q,J,K,d,M,O,F,m,B,I,X,Y,U,G;return{selector:e(Rt,{className:"requisition-list-view-product-list-table__checkbox",name:"itemSelected","data-testid":`item-checkbox-${o.sku}`,onChange:$=>Z($,o),value:o.sku,checked:u.has(o.uid)}),index:e("div",{className:"requisition-list-view-product-list-table__index-container",children:(a-1)*g+V+1}),item:b("div",{className:"requisition-list-view-product-list-table__item-container",children:[e(Ct,{className:"requisition-list-view-product-list-table__thumbnail",alt:((T=o.product)==null?void 0:T.name)||o.sku,src:(H=o.product)!=null&&H.images?(t=o.product.images[0])==null?void 0:t.url:""}),b("div",{className:"requisition-list-view-product-list-table__item-details",children:[e("div",{className:"requisition-list-view-product-list-table__product-name",children:((c=o.product)==null?void 0:c.name)||o.sku}),e("div",{className:"requisition-list-view-product-list-table__sku",children:o.sku})]})]}),price:e(mt,{className:"requisition-list-view-product-list-table__price",amount:(J=(Q=(D=(P=o.product)==null?void 0:P.price)==null?void 0:D.final)==null?void 0:Q.amount)==null?void 0:J.value,currency:(O=(M=(d=(K=o.product)==null?void 0:K.price)==null?void 0:d.final)==null?void 0:M.amount)==null?void 0:O.currency}),quantity:e("span",{className:"requisition-list-view-product-list-table__quantity",children:e(bt,{disabled:!1,children:e(vt,{id:"requisition-list-item-quantity",name:"quantity",type:"text",value:o.quantity,onBlur:$=>{const tt=Number.parseInt($.target.value,10);L(o.uid,tt)}})})}),subtotal:e(mt,{className:"requisition-list-view-product-list-table__price",amount:((I=(B=(m=(F=o.product)==null?void 0:F.price)==null?void 0:m.final)==null?void 0:B.amount)==null?void 0:I.value)*o.quantity,currency:(G=(U=(Y=(X=o.product)==null?void 0:X.price)==null?void 0:Y.final)==null?void 0:U.amount)==null?void 0:G.currency}),actions:b("div",{className:"requisition-list-view__bulk-actions",children:[e(A,{type:"button",onClick:()=>_([o.uid]),icon:e(W,{source:ft}),"data-testid":"product-list-table-add-to-cart-button"}),e(A,{type:"button",variant:"secondary",icon:e(W,{source:Lt}),onClick:()=>p([o.uid]),"data-testid":"product-list-table-delete-button"})]})}}),N=e(St,{columns:z,rowData:j,"data-testid":"product-list-table",mobileLayout:"stacked"});return e(At,{node:Ht("div",{}),className:gt(["requisition-list-view-product-list-table-container",s]),"data-testid":"product-list-table-container",...S,children:N})},It=({selectedItems:s,deletingItemId:h,addingToCartItemId:u,bulkAddingToCart:a,updatingQuantityItemId:g,onSelectAll:k,onSelectNone:R,onBulkAddToCart:L,onBulkDelete:_})=>{const p=st({statusDeleting:"RequisitionList.RequisitionListView.statusDeleting",actionDeleteSelected:"RequisitionList.RequisitionListView.actionDeleteSelected",actionSelectAll:"RequisitionList.RequisitionListView.actionSelectAll",actionSelectNone:"RequisitionList.RequisitionListView.actionSelectNone",actionAddToCart:"RequisitionList.RequisitionListView.actionAddToCart",actionAddSelectedToCart:"RequisitionList.RequisitionListView.actionAddSelectedToCart",statusBulkAddingToCart:"RequisitionList.RequisitionListView.statusBulkAddingToCart"});return b("div",{class:"requisition-list-view__bulk-actions",children:[e(A,{"data-testid":"bulk-actions-select-all-btn",type:"button",variant:"secondary",onClick:k,disabled:h!==null||u!==null||a||g!==null,children:p.actionSelectAll}),e(A,{"data-testid":"bulk-actions-select-none-btn",type:"button",variant:"secondary",onClick:R,disabled:h!==null||u!==null||a||g!==null||s.size===0,children:p.actionSelectNone}),s.size>0&&e(A,{"data-testid":"bulk-actions-add-to-cart-btn",type:"button",variant:"primary",onClick:L,icon:e(W,{source:ft}),disabled:h!==null||u!==null||a||g!==null,children:a?p.statusBulkAddingToCart:`${p.actionAddSelectedToCart} (${s.size})`}),s.size>0&&e(A,{"data-testid":"bulk-actions-delete-all-btn",type:"button",variant:"secondary",onClick:_,icon:e(W,{source:Lt}),disabled:h!==null||u!==null||a||g!==null,children:h==="bulk"?p.statusDeleting:`${p.actionDeleteSelected} (${s.size})`})]})},ae=({requisitionListUid:s,skipProductLoading:h=!1,pageSize:u=et,routeRequisitionListGrid:a})=>{var tt,at,rt,lt,ct,ut;const[g,k]=C(!1),[R,L]=C(null),[_,p]=C(null),[S,v]=C(!1),[z,Z]=C(null),[j,N]=C(!1),[o,V]=C(u),[T,H]=C(!0),{currentRequisitionList:t,setCurrentRequisitionList:c,selectedItems:P,setSelectedItems:D,handleItemSelection:Q,handleSelectAll:J,handleSelectNone:K}=zt(),d=st({emptyRequisitionList:"RequisitionList.RequisitionListView.emptyRequisitionList",errorLoadingProducts:"RequisitionList.RequisitionListView.errorLoadingProducts",errorLoadPage:"RequisitionList.RequisitionListView.errorLoadPage",notFoundTitle:"RequisitionList.RequisitionListView.notFoundTitle",notFoundMessage:"RequisitionList.RequisitionListView.notFoundMessage",notFoundActionLabel:"RequisitionList.RequisitionListView.notFoundActionLabel",show:"RequisitionList.RequisitionListView.show",itemsCounter:"RequisitionList.RequisitionListView.itemsCounter"}),{alert:M,setAlert:O,handleRequisitionListAlert:F}=Nt();it(()=>{const i=q.on("requisitionList/data",n=>{c(n),D(new Set)});return q.on("requisitionList/alert",F),()=>{i==null||i.off()}},[F,c,D]),it(()=>{V(u)},[u]);const m=x(async i=>{var r,w;const n=((r=i.items)==null?void 0:r.map(y=>y.sku))||[];if(n.length===0)return i;k(!0);try{const y=await wt(n);if(y){const E=new Map;return y.forEach(f=>{E.set(f.sku,f)}),{...i,items:(w=i.items)==null?void 0:w.map(f=>({...f,product:E.get(f.sku)||f.product}))}}return console.warn("No products found"),i}catch(y){return console.warn(y instanceof Error?y.message:d.errorLoadingProducts),i}finally{k(!1)}},[d.errorLoadingProducts]);it(()=>{if(!s){H(!1);return}if(t&&t.uid===s)return;H(!0),(async()=>{try{const n=await nt(s,1,u);if(n)if(h)c(n);else{const r=await m(n);c(r)}}catch(n){console.error("Failed to initialize requisition list from UID:",n)}finally{H(!1)}})()},[s,u,h,m,c,t]);const B=x(async i=>{i&&i.length===1?(v(!1),p(i)):(v(!0),p(null));try{const n=await qt(t.uid,i);n&&n.length>0?q.emit("requisitionList/alert",{action:"move",type:"error",context:"product",message:n.map(r=>r.message)}):q.emit("requisitionList/alert",{action:"move",type:"success",context:"product"})}catch{q.emit("requisitionList/alert",{action:"move",type:"error",context:"product"})}finally{p(null),v(!1)}},[t]),I=x(async i=>{i&&i.length===1?L(i[0]):L("bulk");try{const n=await yt(t.uid,i,o,t.page_info.current_page);if(n){const r=await m(n);c(r),q.emit("requisitionList/alert",{action:"delete",type:"success",context:"product"})}else q.emit("requisitionList/alert",{action:"delete",type:"error",context:"product"})}catch{q.emit("requisitionList/alert",{action:"delete",type:"error",context:"product"})}finally{L(null)}},[t,o,m,c]),X=x(async(i,n)=>{var r;Z(i);try{const w=(r=t.items)==null?void 0:r.find(f=>f.uid===i);if(!w){q.emit("requisitionList/alert",{action:"update",type:"error",context:"product"});return}const y={item_id:w.uid,entered_options:w.entered_options,selected_options:w.selected_options,quantity:n},E=await kt(t.uid,[y],o,t.page_info.current_page);if(E){const f=await m(E);c(f),q.emit("requisitionList/alert",{action:"update",type:"success",context:"product"})}else q.emit("requisitionList/alert",{action:"update",type:"error",context:"product"})}catch{q.emit("requisitionList/alert",{action:"update",type:"error",context:"product"})}finally{Z(null)}},[t,m,c,o]),Y=x(async i=>{N(!0);try{const n=await nt(t.uid,i,o);if(n){const r=await m(n);c(r)}else console.warn(d.errorLoadPage)}catch(n){console.warn(n instanceof Error?n.message:d.errorLoadPage)}finally{N(!1)}},[t==null?void 0:t.uid,m,o,d,c]),U=x(async i=>{V(i),N(!0);try{const n=await nt(t.uid,1,i);if(n){const r=await m(n);c(r)}else console.warn(d.errorLoadPage)}catch{console.warn(d.errorLoadPage)}finally{N(!1)}},[t==null?void 0:t.uid,m,d,c]),G=x(async i=>{const n=await m(i);c(n)},[c,m]),$=()=>{var f,dt;const i=((f=t.page_info)==null?void 0:f.page_size)??et,n=((dt=t.page_info)==null?void 0:dt.current_page)??1,r=i*n,w=(t==null?void 0:t.items_count)??0,y=r-i+1,E=r>w?w:r;return e("span",{className:"requisition-list-view__pagination-items",children:d.itemsCounter.replace("{from}",y.toString()).replace("{to}",E.toString()).replace("{total}",w.toString())})};return e("div",{className:"requisition-list-view__container",children:T?e("div",{className:"requisition-list-view__loading",children:e(Pt,{stroke:"4",size:"large"})}):!t||!_t(t==null?void 0:t.uid)?e(Ft,{title:d.notFoundTitle,message:d.notFoundMessage,actionLabel:a?d.notFoundActionLabel:void 0,onAction:a?()=>{const i=a();i&&typeof i=="string"&&(window.location.href=i)}:void 0}):b(pt,{children:[e(Mt,{requisitionList:t,routeRequisitionListGrid:a,onUpdate:G}),t.items_count===0?e(Vt,{textContent:`${t.name} ${d.emptyRequisitionList}`}):b(pt,{children:[M&&e(Et,{heading:M.description,type:M.type,variant:"primary",onDismiss:()=>O(null)}),e(It,{selectedItems:P,deletingItemId:R,addingToCartItemId:_,bulkAddingToCart:S,updatingQuantityItemId:z,onSelectAll:J,onSelectNone:K,onBulkAddToCart:()=>B(Array.from(P)),onBulkDelete:()=>I(Array.from(P))}),e(Bt,{items:t.items,selectedItems:P,currentPage:((tt=t.page_info)==null?void 0:tt.current_page)||1,pageSize:((at=t.page_info)==null?void 0:at.page_size)||et,handleItemSelection:Q,handleUpdateQuantity:X,onAddToCart:B,onDeleteItem:I}),t.page_info&&b("div",{className:"requisition-list-view__pagination",children:[$(),(((rt=t.page_info)==null?void 0:rt.total_pages)||0)>1&&e(xt,{totalPages:((lt=t.page_info)==null?void 0:lt.total_pages)||1,currentPage:((ct=t.page_info)==null?void 0:ct.current_page)||1,onChange:Y,disabled:j||g}),b("div",{className:"requisition-list-view__pagination-picker",children:[e("span",{children:d.show}),e(Tt,{currentPageSize:((ut=t.page_info)==null?void 0:ut.page_size)||et,onPageSizeChange:U,disabled:j||g})]})]})]})]})})};export{ae as RequisitionListView,ae as default};
//# sourceMappingURL=RequisitionListView.js.map
