/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as L,jsx as a,Fragment as N}from"@dropins/tools/preact-jsx-runtime.js";import*as h from"@dropins/tools/preact-compat.js";import{useState as C,useEffect as U}from"@dropins/tools/preact-compat.js";import{classes as j,VComponent as E,Slot as y}from"@dropins/tools/lib.js";import{Button as A,Icon as $,PriceRange as R,Checkbox as T,RadioButton as V}from"@dropins/tools/components.js";/* empty css                 */import{useText as b}from"@dropins/tools/i18n.js";import{events as W}from"@dropins/tools/event-bus.js";import{d as Z}from"../chunks/search.js";import"../chunks/initialize.js";import"../fragments.js";import"../chunks/acdlEvents.js";import"@dropins/tools/fetch-graphql.js";const H=n=>h.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...n},h.createElement("g",{id:"Large"},h.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),h.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},h.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),h.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),Y=n=>h.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},h.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 5.64001L5.62988 18.37",stroke:"currentColor"}),h.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 18.37L5.62988 5.64001",stroke:"currentColor"})),G=n=>h.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},h.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),J=({numberOfOptionsConfig:n=5,header:e,buckets:s,last:d})=>{const g=b({showMore:"Search.Facet.showMore",showLess:"Search.Facet.showLess"}),p=n,[f,u]=C(s.length<p),v=f?s.length:p;return L("div",{className:j(["product-discovery-facet",["product-discovery-facet--last",d]]),children:[a(E,{className:"product-discovery-facet__header",node:e}),s.slice(0,v).map((w,B)=>a(E,{className:"product-discovery-facet__bucket",node:w},B)),!f&&s.length>p&&a(A,{variant:"tertiary",icon:a($,{source:H,size:"24"}),onClick:()=>u(!f),children:g.showMore}),f&&s.length>p&&a(A,{variant:"tertiary",icon:a($,{source:G,size:"24"}),onClick:()=>u(!f),children:g.showLess})]})},K=({selectedFacets:n,facets:e})=>L(N,{children:[a(E,{className:"product-discovery-facet-list__selected-filters",node:n}),a(E,{className:"product-discovery-facet-list__facet-options",node:e})]}),Q="no",X="yes",I=n=>{const e=n.buckets.find(s=>s.selected);return e?{attribute:n.attribute,range:{from:e.from,to:e.to}}:null},ee=n=>{const e=n.buckets.reduce((s,d)=>(d.selected&&s.push(d.title),s),[]);return e.length===0?null:{attribute:n.attribute,in:e}},te=n=>{var e;switch((e=n.buckets[0])==null?void 0:e.__typename){case"RangeBucket":return I(n);case"ScalarBucket":case"CategoryView":return ee(n)}},re=n=>{var s,d,g,p,f,u,v,w,B,_,x;const e=n[0];return(g=(d=(s=e==null?void 0:e.price)==null?void 0:s.regular)==null?void 0:d.amount)!=null&&g.currency?e.price.regular.amount.currency:(v=(u=(f=(p=e==null?void 0:e.priceRange)==null?void 0:p.minimum)==null?void 0:f.regular)==null?void 0:u.amount)!=null&&v.currency?(x=(_=(B=(w=e==null?void 0:e.priceRange)==null?void 0:w.minimum)==null?void 0:B.regular)==null?void 0:_.amount)==null?void 0:x.currency:"USD"},ne=(n,e,s)=>(e==null?void 0:e.attribute)==="price"?n.from===0?L("div",{style:"display:flex",children:[a(R,{amount:n.from,currency:s||"USD"}),a("span",{style:"padding: 0 2px",children:"-"}),a(R,{amount:n.to,currency:s||"USD"})]}):a(R,{minimumAmount:n.from,maximumAmount:n.to,currency:s||"USD",display:"dash"}):n.title,ce=(n,e)=>n.title===Q?`Not ${e.title}`:n.title===X?e.title:n.title,O=(n,e,s)=>{switch(n.__typename){case"RangeBucket":return ne(n,e,s);case"ScalarBucket":case"CategoryView":return ce(n,e)}},Fe=({scope:n,slots:e})=>{const s=b({clearAll:"Search.Facet.clearAll"}),[d,g]=C([]),[p,f]=C(null),[u,v]=C(),w=t=>{var o;const i=((o=u==null?void 0:u.filter)==null?void 0:o.filter(c=>c.attribute==="categoryPath"))||[];Z({...t,filter:[...i,...t.filter||[]]},{scope:n})},B=t=>{if(!t||!t.result.facets&&!t.result.items&&!t.request.filter){g([]);return}v(t.request);const{facets:i,items:o}=t.result;f(re(o));const c=t.request.filter;if(i){const r=i.map(l=>{const S=l.buckets.map(F=>{F.selected=!1;const m=c==null?void 0:c.find(k=>k.attribute===l.attribute);if(m){const k=m.range;(k&&F.from===k.from&&F.to===k.to||m.in&&m.in.includes(F.title))&&(F.selected=!0)}return F});return l.buckets=S,l});g(r)}},_=t=>{const i=d.map(c=>{const r=t.find(l=>l.attribute===c.attribute);return r||c}),o=i.reduce((c,r)=>{const l=te(r);return l&&c.push(l),c},[]);g(i),u&&w({...u,filter:o})},x=(t,i)=>{const o=t.buckets.map(r=>(r.title===i&&(r.selected=!1),r)),c=t;c.buckets=o,_([c])},q=()=>{const t=d.map(i=>{const o=i.buckets.map(c=>(c.selected=!1,c));return i.buckets=o,i});g(t),u&&w({...u,filter:[]})},M=(t,i)=>{const o=i.buckets.map(r=>{var l;return((l=i.buckets[0])==null?void 0:l.__typename)==="RangeBucket"&&(r.selected=!1),r.title===t.target.value&&(r.selected=t.target.checked),r}),c=i;c.buckets=o,_([c])},z=(t,i)=>{const o=a("span",{children:t.title}),c=t.buckets.map(r=>{var F;const l=O(r,t,p),S=m=>L(y,{name:"FacetBucketLabel",slot:e==null?void 0:e.FacetBucketLabel,context:{data:r},children:[l," ",m?`(${m})`:""]});switch((F=t.buckets[0])==null?void 0:F.__typename){case"RangeBucket":return a(y,{name:"FacetBucket",slot:e==null?void 0:e.FacetBucket,context:{data:r},children:a(V,{"data-testid":`${r.title}-radio`,label:S(),name:t.attribute,value:r.title,checked:r.selected,onChange:m=>{M(m,t)}})});case"ScalarBucket":case"CategoryView":return a(y,{name:"FacetBucket",slot:e==null?void 0:e.FacetBucket,context:{data:r},children:a(T,{id:`${t.attribute}-${r.title.replace(/[^a-zA-Z0-9_-]/g,"")}`,"data-testid":`${r.title}-checkbox`,label:S(r.count),name:`${t.attribute}-${r.title.replace(/[^a-zA-Z0-9_-]/g,"")}`,value:r.title,checked:r.selected,onChange:m=>{M(m,t)}})});default:return null}}).filter(r=>r!==null);return a(J,{header:o,buckets:c,last:i===d.length-1})},P=()=>a(y,{name:"Facets",slot:e==null?void 0:e.Facets,context:{data:d},children:d.map((t,i)=>t.buckets.length>0?a(N,{children:a(y,{name:"Facet",slot:e==null?void 0:e.Facet,context:{data:t},children:z(t,i)})}):null)}),D=()=>{const t=d.reduce((c,r)=>(r.buckets.filter(S=>S.selected).length>0&&c.push(r),c),[]),i=t.map(c=>c.buckets.map(r=>{if(r.selected){const l=O(r,c,p);return a(A,{"data-testid":`${r.title}-selected-btn`,"aria-label":`Remove ${c.title} filter: ${r.title}`,variant:"secondary",children:L(N,{children:[a("span",{children:l}),a($,{source:Y,size:"16"})]}),onClick:()=>{x(c,r.title)}})}return null})),o=i.length>0?a(A,{variant:"secondary",onClick:()=>{q()},children:a("span",{children:s.clearAll})}):null;return L(y,{name:"SelectedFacets",slot:e==null?void 0:e.SelectedFacets,context:{data:t},children:[i,o]})};return U(()=>{const t=W.on("search/result",B,{eager:!0,scope:n});return()=>{t==null||t.off()}},[]),a(K,{selectedFacets:D(),facets:P()})};export{Fe as Facets,Fe as default};
//# sourceMappingURL=Facets.js.map
