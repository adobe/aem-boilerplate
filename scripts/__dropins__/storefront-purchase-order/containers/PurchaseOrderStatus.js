/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as r,jsxs as C,Fragment as B}from"@dropins/tools/preact-jsx-runtime.js";import{classes as k,Slot as N}from"@dropins/tools/lib.js";import{Button as M,Skeleton as _,SkeletonRow as y,InLineAlert as D,Card as w}from"@dropins/tools/components.js";import{useState as v,useCallback as h}from"@dropins/tools/preact-hooks.js";import{events as I}from"@dropins/tools/event-bus.js";import"../chunks/PurchaseOrderHistoryLogContent.js";import{a as J,r as V}from"../chunks/rejectPurchaseOrders.js";import{c as z,p as H}from"../chunks/placeOrderForPurchaseOrder.js";import{u as F}from"../chunks/usePurchaseOrderData.js";import{useText as L,Text as $}from"@dropins/tools/i18n.js";import{P as R}from"../chunks/PurchaseOrdersHeader.js";import"@dropins/tools/preact.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/fetch-error.js";const G=()=>{const{poDataLoading:o,purchaseOrderData:s}=F(),e=L({approvalSuccessMessage:"PurchaseOrders.purchaseOrderStatus.alertMessages.success.approval",rejectSuccessMessage:"PurchaseOrders.purchaseOrderStatus.alertMessages.success.reject",cancelSuccessMessage:"PurchaseOrders.purchaseOrderStatus.alertMessages.success.cancel",placeOrderSuccessMessage:"PurchaseOrders.purchaseOrderStatus.alertMessages.success.placeOrder",approvalErrorMessage:"PurchaseOrders.purchaseOrderStatus.alertMessages.errors.approval",rejectErrorMessage:"PurchaseOrders.purchaseOrderStatus.alertMessages.errors.reject",cancelErrorMessage:"PurchaseOrders.purchaseOrderStatus.alertMessages.errors.cancel",placeOrderErrorMessage:"PurchaseOrders.purchaseOrderStatus.alertMessages.errors.placeOrder"}),u=(s==null?void 0:s.uid)??null,i=(s==null?void 0:s.status)??"PENDING",d=(s==null?void 0:s.availableActions)??[],[l,n]=v("success"),[p,O]=v(""),[a,m]=v(!1),[A,S]=v(!0),f=()=>{S(!0)},P=h((T,E)=>{let c="";if(T){switch(E){case"APPROVE":c=e.approvalSuccessMessage;break;case"REJECT":c=e.rejectSuccessMessage;break;case"CANCEL":c=e.cancelSuccessMessage;break;case"PLACE_ORDER":c=e.placeOrderSuccessMessage;break}n("success")}else{switch(E){case"APPROVE":c=e.approvalErrorMessage;break;case"REJECT":c=e.rejectErrorMessage;break;case"CANCEL":c=e.cancelErrorMessage;break;case"PLACE_ORDER":c=e.placeOrderErrorMessage;break}n("error")}O(c),S(!1)},[e]),t=h(async(T,E)=>{if(u){m(!0);try{await T(u),P(!0,E)}catch{P(!1,E)}finally{m(!1),I.emit("purchase-order/refresh",!0)}}},[u,P]),g=h(()=>t(J,"APPROVE"),[t]),x=h(()=>t(V,"REJECT"),[t]),b=h(()=>t(z,"CANCEL"),[t]),j=h(()=>t(H,"PLACE_ORDER"),[t]);return{poId:u,status:i,availableActions:d,alertType:l,loading:a,poDataLoading:o,isDismissed:A,alertMessage:p,handleOnDismiss:f,handleApprove:g,handleReject:x,handleCancel:b,handlePlaceOrder:j}},W=({slots:o,t:s,loading:e,children:u,availableActions:i=[],handleApprove:d,handleReject:l,handleCancel:n,handlePlaceOrder:p})=>{const O=i.map(a=>{switch(a){case"APPROVE":return r(M,{variant:"secondary",disabled:e,type:"button",onClick:d,children:s.approveButtonText},a);case"PLACE_ORDER":return r(M,{variant:"secondary",disabled:e,type:"button",onClick:p,children:s.placeOrderButtonText},a);case"REJECT":return r(M,{variant:"secondary",disabled:e,type:"button",onClick:l,children:s.rejectButtonText},a);case"CANCEL":return r(M,{variant:"secondary",disabled:e,type:"button",onClick:n,children:s.cancelButtonText},a);default:return null}});return C("div",{className:k(["b2b-purchase-order-status-content"]),children:[r("div",{className:"b2b-purchase-order-status-content__message",children:s.statusMessageText}),u,r("div",{className:"b2b-purchase-order-status-content__actions",children:r(N,{"data-testid":"PurchaseOrderActions",name:"PurchaseOrderActions",slot:o==null?void 0:o.PurchaseOrderActions,context:{loading:e,availableActions:i,handleApprove:d,handleReject:l,handleCancel:n,handlePlaceOrder:p},children:O})})]})},oe=({className:o,withHeader:s=!0,withWrapper:e=!0,slots:u})=>{const{poId:i,status:d,availableActions:l,alertType:n,loading:p,poDataLoading:O,isDismissed:a,alertMessage:m,handleOnDismiss:A,handleApprove:S,handleReject:f,handleCancel:P,handlePlaceOrder:t}=G(),g=L({statusHeadingText:`PurchaseOrders.purchaseOrderStatus.status.${d.toLowerCase()}.title`,statusMessageText:`PurchaseOrders.purchaseOrderStatus.status.${d.toLowerCase()}.message`,approveButtonText:"PurchaseOrders.purchaseOrderStatus.buttons.approve",cancelButtonText:"PurchaseOrders.purchaseOrderStatus.buttons.cancel",rejectButtonText:"PurchaseOrders.purchaseOrderStatus.buttons.reject",placeOrderButtonText:"PurchaseOrders.purchaseOrderStatus.buttons.placeOrder"}),x=l.length>0;if(!i)return null;const b=C(B,{children:[s&&e?r(R,{headerText:g.statusHeadingText,divider:!0}):null,O?C(_,{"data-testid":"status-content-loader-skeleton-test-id",children:[r(y,{size:"small",variant:"row",fullWidth:!0,lines:1,style:{maxWidth:300}}),r(y,{size:"medium",variant:"row",fullWidth:!0,lines:1})]}):x?r(W,{t:g,loading:p,handleApprove:S,handleReject:f,handleCancel:P,handlePlaceOrder:t,availableActions:l,slots:u}):r("div",{className:"purchase-order-status__empty",children:r($,{id:"PurchaseOrders.purchaseOrderStatus.emptyText"})})]});return C("div",{className:k(["purchase-order-status",o]),children:[!a&&m?r(D,{style:{marginBottom:"1rem",textTransform:"capitalize"},heading:n,onDismiss:A,description:m,type:n}):null,s&&!e?r(R,{headerText:g.statusHeadingText}):null,e?r(w,{variant:"secondary",children:b}):b]})};export{oe as PurchaseOrderStatus,oe as default};
//# sourceMappingURL=PurchaseOrderStatus.js.map
