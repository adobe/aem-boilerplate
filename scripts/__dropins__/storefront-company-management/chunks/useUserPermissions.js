/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as r,jsxs as B}from"@dropins/tools/preact-jsx-runtime.js";import{Fragment as T}from"@dropins/tools/preact.js";import{classes as D,VComponent as v}from"@dropins/tools/lib.js";import{Button as x,Icon as A,Skeleton as P,SkeletonRow as R}from"@dropins/tools/components.js";import{useText as $}from"@dropins/tools/i18n.js";import{useState as N,useRef as S,useCallback as E,useEffect as U}from"@dropins/tools/preact-hooks.js";import{b as j}from"./company-permissions.js";import{u as z}from"./useCompanyContextListener.js";import{f as V}from"./fetchUserPermissions.js";const X=({className:y,children:w,columns:i=[],rowData:b=[],mobileLayout:m="none",caption:n,expandedRows:d=new Set,loading:p=!1,skeletonRowCount:o=10,onSortChange:c,...f})=>{const s=$({sortedAscending:"Dropin.Table.sortedAscending",sortedDescending:"Dropin.Table.sortedDescending",sortBy:"Dropin.Table.sortBy"}),u=e=>{if(!c)return;let t;e.sortBy===!0?t="asc":e.sortBy==="asc"?t="desc":t=!0,c(e.key,t)},g=e=>{if(e.sortBy===void 0)return null;const t=e.ariaLabel??e.label;let a,l;return e.sortBy==="asc"?(a="ChevronUp",l=s.sortedAscending.replace("{label}",t)):e.sortBy==="desc"?(a="ChevronDown",l=s.sortedDescending.replace("{label}",t)):(a="ChevronDown",l=s.sortBy.replace("{label}",t)),r(x,{variant:"tertiary",size:"medium",className:"dropin-table__header__sort-button",icon:r(A,{source:a}),"aria-label":l,onClick:()=>u(e)})},C=()=>Array.from({length:o},(e,t)=>r("tr",{className:"dropin-table__body__row",children:i.map(a=>r("td",{className:"dropin-table__body__cell","data-label":a.ariaLabel??a.label,children:r(P,{children:r(R,{variant:"row",size:"small",fullWidth:!0})})},a.key))},`skeleton-${t}`)),F=()=>b.map((e,t)=>{const a=e._rowDetails!==void 0,l=d.has(t);return B(T,{children:[r("tr",{className:D(["dropin-table__body__row",["dropin-table__body__row--expanded",l&&a]]),children:i.map(_=>{const h=e[_.key],k=_.ariaLabel??_.label;return typeof h=="string"||typeof h=="number"?r("td",{className:"dropin-table__body__cell","data-label":k,children:h},_.key):r("td",{className:"dropin-table__body__cell","data-label":k,children:r(v,{node:h})},_.key)})}),a&&l&&r("tr",{className:"dropin-table__row-details dropin-table__row-details--expanded",id:`row-${t}-details`,children:r("td",{className:"dropin-table__row-details__cell",colSpan:i.length,role:"region","aria-labelledby":`row-${t}-details`,children:typeof e._rowDetails=="string"?e._rowDetails:r(v,{node:e._rowDetails})})},`${t}-details`)]},t)}),L=e=>{if(e.sortBy===!0)return"none";if(e.sortBy==="asc")return"ascending";if(e.sortBy==="desc")return"descending"};return r("div",{className:D(["dropin-table",`dropin-table--mobile-layout-${m}`,y]),children:B("table",{...f,className:"dropin-table__table",children:[n&&r("caption",{className:"dropin-table__caption",children:n}),r("thead",{className:"dropin-table__header",children:r("tr",{className:"dropin-table__header__row",children:i.map(e=>B("th",{className:D(["dropin-table__header__cell",["dropin-table__header__cell--sorted",e.sortBy==="asc"||e.sortBy==="desc"],["dropin-table__header__cell--sortable",e.sortBy!==void 0]]),"aria-sort":L(e),children:[e.label,g(e)]},e.key))})}),r("tbody",{className:"dropin-table__body",children:p?C():F()})]})})},Y=()=>{const[y,w]=N(null),[i,b]=N(!0),[m,n]=N(null),d=S(!1),p=S(!1),o=E(async()=>{var c,f;if(!d.current){d.current=!0,b(!0),n(null);try{const{roleResponse:s}=await V(),u=(f=(c=s==null?void 0:s.data)==null?void 0:c.customer)==null?void 0:f.role,g=j(u);w(g)}catch(s){console.error("Failed to fetch user permissions:",s),n(s)}finally{b(!1),d.current=!1}}},[]);return U(()=>{p.current||(p.current=!0,o())},[o]),z(o,{eager:!0}),{permissions:y,loading:i,error:m,refetch:o}};export{X as T,Y as u};
//# sourceMappingURL=useUserPermissions.js.map
