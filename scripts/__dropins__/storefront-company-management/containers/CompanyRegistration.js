/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as C,jsx as p,Fragment as W}from"@dropins/tools/preact-jsx-runtime.js";import{useRef as K,useState as $,useEffect as G,useMemo as k,useCallback as D}from"@dropins/tools/preact-hooks.js";import{Field as B,Picker as ee,Input as ae,Button as re}from"@dropins/tools/components.js";import{classes as w,Slot as ne}from"@dropins/tools/lib.js";import{memo as se}from"@dropins/tools/preact-compat.js";import{useText as J}from"@dropins/tools/i18n.js";import{g as oe,c as te}from"../chunks/getStoreConfig.js";import{g as z,v as ie}from"../chunks/getCountries.js";import{a as le,i as de}from"../chunks/isCompanyUser.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/event-bus.js";var I=(a=>(a.TEXT="TEXT",a.EMAIL="EMAIL",a.TEL="TEL",a.SELECT="SELECT",a.HIDDEN="HIDDEN",a))(I||{});const ce=se(({loading:a,values:e={},fields:m,errors:n={},className:h="",regionOptions:t,countryOptions:g,onChange:s,onBlur:i,onFocus:u,slots:_,fieldIdPrefix:T})=>{const N=`${h}__field`,E=J({selectCountry:"Company.FormText.selectCountry",selectRegion:"Company.FormText.selectRegion",selectCountryFirst:"Company.FormText.selectCountryFirst",country:"Company.shared.fields.country",stateProvince:"Company.shared.fields.stateProvince","Company.Registration.companyInformation":"Company.shared.fields.companyInformation","Company.Registration.legalAddress":"Company.shared.fields.legalAddress","Company.Registration.companyAdmin":"Company.shared.fields.companyAdmin"}),y={CompanyInformationSection:["companyName","legalName","companyEmail","vatTaxId","resellerId"],LegalAddressSection:["street","streetLine2","city","countryCode","region","postcode","addressTelephone"],CompanyAdministratorSection:["adminEmail","adminFirstname","adminLastname","adminJobTitle","adminWorkTelephone","adminGender"]},A=r=>({CompanyInformationSection:"Company.Registration.companyInformation",LegalAddressSection:"Company.Registration.legalAddress",CompanyAdministratorSection:"Company.Registration.companyAdmin"})[r],R=r=>{var f,S,F,V;if((r.code==="region"||r.code==="regionCode")&&r.fieldType===I.SELECT){const x=((f=e.regionCode)==null?void 0:f.toString())||"",b=((S=e.regionId)==null?void 0:S.toString())||"";return x&&b?`${x},${b}`:(F=e[r.code])!=null&&F.toString().includes(",")?(V=e[r.code])==null?void 0:V.toString():""}return null},l=r=>{var f;return r.code==="street"?Array.isArray(e.street)?e.street[0]||"":((f=e.street)==null?void 0:f.toString())||"":r.code==="streetLine2"?Array.isArray(e.street)&&e.street[1]||"":null},o=(r,f)=>{const S=`CompanyFormInput_${r.code}`,F=_==null?void 0:_[S];if(!F)return null;const V={inputName:r.code,handleOnChange:s||(()=>{}),errorMessage:f,errors:Object.values(n),formData:e,fieldConfig:{required:r.required,disabled:r.disabled||a,placeholder:r.placeholder||r.label,label:r.label}};return p(ne,{"data-testid":`companyFormInput_${r.code}`,name:S,slot:F,context:V})},d=(r,f,S)=>{let F=r.options;return r.code==="countryCode"||r.code==="country_code"?F=(g==null?void 0:g.map(V=>({value:V.value,text:V.text,isDefault:!1})))||[]:(r.code==="region"||r.code==="regionCode")&&(F=(t==null?void 0:t.map(V=>({text:V.text,value:V.value,isDefault:!1})))||[]),p(W,{children:o(r,S)??p(B,{error:S,className:w([N,`${N}--${r.id}`,[`${N}--${r.id}-hidden`,r.isHidden],r.className]),"data-testid":`${h}--${r.id}`,disabled:a,children:p(ee,{"aria-label":r.label,"aria-required":r.required?"true":"false",id:T?`${T}_${r.code}`:r.code,required:r==null?void 0:r.required,name:r.customUpperCode||r.code,placeholder:r.label,options:F,onBlur:i,onFocus:u,handleSelect:s,defaultValue:f,value:f})},r.id)})},c=(r,f,S)=>{let F="text";return r.fieldType===I.EMAIL?F="email":r.fieldType===I.TEL&&(F="tel"),p(W,{children:o(r,S)??p(B,{error:S,className:w([N,`${N}--${r.id}`,[`${N}--${r.id}-hidden`,r.isHidden],r.className]),"data-testid":`${h}--${r.id}`,disabled:a,children:p(ae,{"aria-label":r.label,"aria-required":r.required?"true":"false",id:T?`${T}_${r.code}`:r.code,type:F,name:r.customUpperCode,value:f??r.defaultValue,placeholder:r.label,floatingLabel:`${r.label} ${r.required?"*":""}`,maxLength:r.maxlength,onBlur:i,onFocus:u,onChange:s})},r.id)})},v=r=>m==null?void 0:m.filter(f=>r.includes(f.code)&&!f.isHidden).map(f=>{var b,q;let S=((b=e[f.code])==null?void 0:b.toString())||"";const F=l(f);F!==null&&(S=F);const V=R(f);V!==null&&(S=V);const x=n[f.customUpperCode||f.code]||"";return f.code==="region"||f.code==="regionCode"?f.fieldType===I.SELECT?d(f,S,x):c(f,S,x):f.fieldType===I.SELECT||((q=f.options)==null?void 0:q.length)>0?d(f,S,x):c(f,S,x)}),L=r=>{const f=y[r],S=A(r);return(m==null?void 0:m.some(V=>f.includes(V.code)&&!V.isHidden))?C("div",{className:`${h}__section`,children:[p("h3",{className:`${h}__section-title`,children:E[S]}),v(f)]},`section-${r}`):null};return C("div",{className:`${h}__inputs`,children:[L("CompanyInformationSection"),L("LegalAddressSection"),L("CompanyAdministratorSection")]})}),me=({showFormLoader:a,slots:e,name:m="companyForm",loading:n,children:h,className:t="company-form",fieldsConfig:g=[],values:s={},errors:i={},onSubmit:u,onChange:_,onBlur:T,regionOptions:N,countryOptions:E,fieldIdPrefix:y})=>{const A=K(null),R=async o=>{o.preventDefault(),u&&await u(o,!0)};if(a||n)return p("div",{className:w(["dropin-form-loader","company-form-loader"]),children:"Loading..."});const l=o=>{const d=o.target,{name:c,value:v}=d;_&&_({[c]:v})};return C("form",{id:m,ref:A,className:w(["company-form",t]),onSubmit:R,noValidate:!0,children:[p(ce,{className:t,fields:g,values:s,errors:i,onChange:l,onBlur:T,slots:e,regionOptions:N,countryOptions:E,fieldIdPrefix:y}),h]})},ue=(a={})=>{const{defaultCountry:e="US",formName:m="company_registration"}=a,[n,h]=$(null),[t,g]=$(()=>{var c;const d=sessionStorage.getItem(`${m}_formData`);return d?{countryCode:(c=JSON.parse(d))==null?void 0:c.countryCode}:{countryCode:e}}),[s,i]=$(!0),[u,_]=$(!0),[T,N]=$([]);G(()=>{i(!0),_(!0),z().then(({availableCountries:d,countriesWithRequiredRegion:c,optionalZipCountries:v})=>{h({availableCountries:d,countriesWithRequiredRegion:c,optionalZipCountries:v}),i(!1),_(!1)}).catch(d=>{console.error("Failed to load countries:",d),i(!1),_(!1)})},[]),G(()=>{if(t!=null&&t.countryCode&&n){const d=n.availableCountries.find(c=>c.value===t.countryCode);if(d!=null&&d.availableRegions&&d.availableRegions.length>0){const c=d.availableRegions.map(v=>({text:v.name,value:`${v.code},${v.id}`,id:v.id,code:v.code}));N(c)}else N([])}else N([])},[t==null?void 0:t.countryCode,n]);const E=k(()=>(n==null?void 0:n.availableCountries)||[],[n]),y=k(()=>!(t!=null&&t.countryCode)||!n?!1:n.countriesWithRequiredRegion.includes(t.countryCode),[t==null?void 0:t.countryCode,n]),A=k(()=>!(t!=null&&t.countryCode)||!n?!0:!n.optionalZipCountries.includes(t.countryCode),[t==null?void 0:t.countryCode,n]),R=k(()=>T,[T]),l=k(()=>R.length>0,[R.length]),o=D((d,c)=>{g(v=>{const L={...v,[d]:c};return d==="countryCode"&&(L.regionCode="",L.regionId=void 0),L})},[]);return{countryOptions:E,regionOptions:R,isRequiredRegion:y,isRequiredPostCode:A,disableField:s,loadingCountries:u,hasRegions:l,handleInputChange:o,inputChange:t}},pe=a=>{var _;const{formData:e,isRequiredRegion:m=!1,isRequiredPostCode:n=!1,hasRegions:h=!1,disableField:t=!1,translations:g={}}=a,s=T=>(g==null?void 0:g[T])||T,i=T=>{const N=s(T);return T==="countryCode"||T==="region"||T==="adminGender"?`Select ${N.toLowerCase()}`:`Enter ${N.toLowerCase()}`},u={isRequiredRegion:m,isRequiredPostCode:n};return[{code:"companyName",name:"companyName",id:"companyName",label:s("companyName"),placeholder:i("companyName"),required:!0,fieldType:I.TEXT,isHidden:!1,customUpperCode:"companyName",defaultValue:(e==null?void 0:e.companyName)||"",options:[],maxlength:40,...u,validateRules:[]},{code:"legalName",name:"legalName",id:"legalName",label:s("legalName"),placeholder:i("legalName"),required:!1,fieldType:I.TEXT,isHidden:!1,customUpperCode:"legalName",defaultValue:(e==null?void 0:e.legalName)||"",options:[],maxlength:80,validateRules:[],...u},{code:"companyEmail",name:"companyEmail",id:"companyEmail",label:s("companyEmail"),placeholder:i("companyEmail"),required:!0,fieldType:I.EMAIL,isHidden:!1,customUpperCode:"companyEmail",defaultValue:(e==null?void 0:e.companyEmail)||"",options:[],maxlength:254,validateRules:[{INPUT_VALIDATION:"email"},{MIN_TEXT_LENGTH:5},{MAX_TEXT_LENGTH:254}],...u},{code:"vatTaxId",name:"vatTaxId",id:"vatTaxId",label:s("vatTaxId"),placeholder:i("vatTaxId"),required:!1,fieldType:I.TEXT,isHidden:!1,customUpperCode:"vatTaxId",defaultValue:(e==null?void 0:e.vatTaxId)||"",options:[],maxlength:40,validateRules:[],...u},{code:"resellerId",name:"resellerId",id:"resellerId",label:s("resellerId"),placeholder:i("resellerId"),required:!1,fieldType:I.TEXT,isHidden:!1,customUpperCode:"resellerId",defaultValue:(e==null?void 0:e.resellerId)||"",options:[],maxlength:40,validateRules:[],...u},{code:"street",name:"street",id:"street",label:s("street"),placeholder:i("street"),required:!0,fieldType:I.TEXT,isHidden:!1,customUpperCode:"street",defaultValue:Array.isArray(e==null?void 0:e.street)?e.street[0]:(e==null?void 0:e.street)||"",options:[],validateRules:[],...u},{code:"streetLine2",name:"streetLine2",id:"streetLine2",label:s("streetLine2"),placeholder:i("streetLine2"),required:!1,fieldType:I.TEXT,isHidden:!1,customUpperCode:"streetLine2",defaultValue:Array.isArray(e==null?void 0:e.street)?e.street[1]:"",options:[],validateRules:[],...u},{code:"city",name:"city",id:"city",label:s("city"),placeholder:i("city"),required:!0,fieldType:I.TEXT,isHidden:!1,customUpperCode:"city",defaultValue:(e==null?void 0:e.city)||"",options:[],validateRules:[],...u},{code:"countryCode",name:"countryCode",id:"countryCode",label:s("country"),placeholder:i("country"),required:!0,disabled:t,fieldType:I.SELECT,isHidden:!1,customUpperCode:"countryCode",defaultValue:(e==null?void 0:e.countryCode)||"",options:[],validateRules:[]},{code:"region",name:"region",id:"region",label:s("stateProvince"),placeholder:i("stateProvince"),required:m,disabled:!1,fieldType:h?I.SELECT:I.TEXT,isHidden:!1,customUpperCode:"region",defaultValue:(e==null?void 0:e.regionCode)||"",options:[]},{code:"postcode",name:"postcode",id:"postcode",label:s("postalCode"),placeholder:i("postalCode"),required:n,fieldType:I.TEXT,isHidden:!1,customUpperCode:"postcode",defaultValue:(e==null?void 0:e.postcode)||"",options:[],validateRules:[{INPUT_VALIDATION:"postal-code"},{MIN_TEXT_LENGTH:3},{MAX_TEXT_LENGTH:20}],...u},{code:"addressTelephone",name:"addressTelephone",id:"addressTelephone",label:s("telephone"),placeholder:i("telephone"),required:!0,fieldType:I.TEL,isHidden:!1,customUpperCode:"addressTelephone",defaultValue:(e==null?void 0:e.addressTelephone)||"",options:[],validateRules:[{INPUT_VALIDATION:"phone"},{MIN_TEXT_LENGTH:10},{MAX_TEXT_LENGTH:15}],...u},{code:"adminJobTitle",name:"adminJobTitle",id:"adminJobTitle",label:s("adminJobTitle"),placeholder:i("adminJobTitle"),required:!1,fieldType:I.TEXT,isHidden:!1,customUpperCode:"adminJobTitle",defaultValue:(e==null?void 0:e.adminJobTitle)||"",options:[],validateRules:[],...u},{code:"adminWorkTelephone",name:"adminWorkTelephone",id:"adminWorkTelephone",label:s("adminWorkTelephone"),placeholder:i("adminWorkTelephone"),required:!1,fieldType:I.TEL,isHidden:!1,customUpperCode:"adminWorkTelephone",defaultValue:(e==null?void 0:e.adminWorkTelephone)||"",options:[],validateRules:[{INPUT_VALIDATION:"phone"},{MIN_TEXT_LENGTH:10},{MAX_TEXT_LENGTH:15}],...u},{code:"adminEmail",name:"adminEmail",id:"adminEmail",label:s("adminEmail"),placeholder:i("adminEmail"),required:!0,fieldType:I.EMAIL,isHidden:!1,customUpperCode:"adminEmail",defaultValue:(e==null?void 0:e.adminEmail)||"",options:[],validateRules:[{INPUT_VALIDATION:"email"},{MIN_TEXT_LENGTH:5},{MAX_TEXT_LENGTH:254}],...u},{code:"adminFirstname",name:"adminFirstname",id:"adminFirstname",label:s("adminFirstname"),placeholder:i("adminFirstname"),required:!0,fieldType:I.TEXT,isHidden:!1,customUpperCode:"adminFirstname",defaultValue:(e==null?void 0:e.adminFirstname)||"",options:[],validateRules:[]},{code:"adminLastname",name:"adminLastname",id:"adminLastname",label:s("adminLastname"),placeholder:i("adminLastname"),required:!0,fieldType:I.TEXT,isHidden:!1,customUpperCode:"adminLastname",defaultValue:(e==null?void 0:e.adminLastname)||"",options:[],validateRules:[]},{code:"adminGender",name:"adminGender",id:"adminGender",label:s("adminGender"),placeholder:i("adminGender"),required:!1,fieldType:I.SELECT,isHidden:!1,customUpperCode:"adminGender",defaultValue:((_=e==null?void 0:e.adminGender)==null?void 0:_.toString())||"",options:[{value:"0",text:"Not Specified",isDefault:!0},{value:"1",text:"Male",isDefault:!1},{value:"2",text:"Female",isDefault:!1}],validateRules:[],...u}]},he=a=>a.reduce((e,m)=>({...e,...m}),{}),ge=a=>/^[0-9]+$/.test(a),ye=a=>/^[a-zA-Z0-9]+$/.test(a),Ce=a=>/^[a-zA-Z0-9\s]+$/.test(a),fe=a=>/^[a-zA-Z]+$/.test(a),Te=a=>/^[a-z0-9,!#$%&'*+/=?^_`{|}~-]+(\.[a-z0-9,!#$%&'*+/=?^_`{|}~-]+)*@([a-z0-9-]+\.)+[a-z]{2,}$/i.test(a),Ee=a=>/^[+]?[1-9][\d]{0,15}$/.test(a.replace(/[\s\-()]/g,"")),_e=a=>/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/i.test(a),Ne=a=>/^[A-Z0-9\s-]{3,10}$/i.test(a),ve=(a,e,m)=>{const n=a.length;return n>=e&&n<=m},Z=(a,e,m,n)=>{var v,L;const{requiredFieldError:h,lengthTextError:t,numericError:g,alphaNumWithSpacesError:s,alphaNumericError:i,alphaError:u,emailError:_,phoneError:T,postalCodeError:N,urlError:E}=m,y=e==null?void 0:e.customUpperCode,A={[y]:""};if(n[y]&&delete n[y],e!=null&&e.required&&(!a||a==="false"))return{[y]:h};if(!(e!=null&&e.required)&&!a||!((v=e==null?void 0:e.validateRules)!=null&&v.length))return A;const R=he(e==null?void 0:e.validateRules),l=Number(R.MIN_TEXT_LENGTH)??1,o=Number(R.MAX_TEXT_LENGTH)??255;if(!ve(a,l,o))return{[y]:t.replace("{min}",l.toString()).replace("{max}",o.toString())};const c={numeric:{validate:ge,error:g},"alphanum-with-spaces":{validate:Ce,error:s},alphanumeric:{validate:ye,error:i},alpha:{validate:fe,error:u},email:{validate:Te,error:_},phone:{validate:Ee,error:T},"postal-code":{validate:r=>Ne(r),error:N},url:{validate:_e,error:E}}[R.INPUT_VALIDATION];return c&&!c.validate(a)&&!((L=n[y])!=null&&L.length)?{[y]:c.error}:A},be=a=>({requiredFieldError:a.requiredFieldError,lengthTextError:a.lengthTextError,numericError:a.numericError,alphaNumWithSpacesError:a.alphaNumWithSpacesError,alphaNumericError:a.alphaNumericError,alphaError:a.alphaError,emailError:a.emailError,phoneError:a.phoneError,postalCodeError:a.postalCodeError,urlError:a.urlError}),Q=(a,e)=>({fieldsConfig:a,translations:be(e)}),Ie=(a,e,m)=>{const{fieldsConfig:n,translations:h}=m,t=n.find(u=>u.code===a);if(!t)return"";const g=Array.isArray(e)?e.join(""):e.toString(),s={validateRules:t.validateRules||[],customUpperCode:t.customUpperCode,required:t.required};return Z(g,s,h,{})[t.customUpperCode]||""},Ae=(a,e)=>{const{fieldsConfig:m,translations:n}=e,h=m[0],t=(h==null?void 0:h.isRequiredRegion)||!1,g=(h==null?void 0:h.isRequiredPostCode)||!1;let s=!1;const i={};Object.entries(a).forEach(([N,E])=>{const y=m.find(o=>o.code===N);if(!y)return;const A=Array.isArray(E)?E.join(""):E.toString(),R={validateRules:y.validateRules,customUpperCode:y.customUpperCode,required:y.required},l=Z(A,R,n,{});l[y.customUpperCode]&&(i[y.customUpperCode]=l[y.customUpperCode],s=!0)});const u=typeof a.regionId=="number"&&a.regionId>0,_=a.regionCode&&a.regionCode.toString().trim(),T=a.region&&a.region.toString().trim();return t&&!u&&!_&&!T&&(i.region=n.requiredFieldError,s=!0),g&&!a.postcode.toString().trim()&&(i.postcode=n.requiredFieldError,s=!0),{isValid:!s,fieldErrors:i}},Y=(a,e,m,n)=>{const h=Q(m,n);return Ie(a,e,h)},Re=(a,e,m)=>{const n=Q(e,m);return Ae(a,n)},Se=a=>{const{setFormData:e,hasRegions:m,regionOptions:n,fieldsConfig:h,formTranslations:t,setFieldErrors:g}=a,s=(l,o)=>{const d=Y(l,o,h,t);g&&d?g(c=>({...c,[l]:d})):g&&g(c=>{const v={...c};return delete v[l],v})},i=l=>{e(o=>{const d=Array.isArray(o.street)?o.street:[o.street||"",""],c=Array.isArray(l)?l:[l,d[1]||""];return{...o,street:c}}),s("street",l)},u=l=>{e(o=>{const c=[(Array.isArray(o.street)?o.street:[o.street||"",""])[0]||"",l];return{...o,street:c}}),s("streetLine2",l)},_=l=>{e(o=>({...o,region:l,regionCode:"",regionId:void 0})),s("region",l)},T=l=>{e(o=>({...o,regionCode:l,...m?{}:{regionId:void 0}})),s("regionCode",l)},N=l=>{const o=typeof l=="string"?parseInt(l,10)||void 0:l;e(d=>{const c={...d,regionId:o};if(o&&n.length>0){const v=n.find(L=>L.id===o||L.value===(o==null?void 0:o.toString()));v&&v.code&&(c.regionCode=v.code)}return c}),s("regionId",l)},E=l=>{e(o=>({...o,countryCode:l,regionCode:"",regionId:void 0,region:""})),s("countryCode",l)},y=(l,o)=>{e(d=>({...d,[l]:o})),s(l,o)};return{handleInputChange:l=>{const o=l.target;if(!o)return;const{name:d,value:c}=o;switch(d){case"street":i(c);break;case"streetLine2":u(c);break;case"region":m?N(c):_(c);break;case"regionCode":T(c);break;case"countryCode":E(c);break;default:y(d,c);break}},handleInputChangeFromValues:l=>{Object.entries(l).forEach(([o,d])=>{switch(o){case"street":i(d);break;case"streetLine2":u(d);break;case"region":_(d);break;case"regionCode":T(d);break;case"regionId":N(d);break;case"countryCode":E(d);break;default:y(o,d);break}})},handleStreetChange:i,handleStreetLine2Change:u,handleRegionTextChange:_,handleRegionCodeChange:T,handleRegionDropdownChange:N,handleCountryChange:E,handleGenericFieldChange:y}},Le=({onSuccess:a,onError:e})=>{const[m,n]=$(!1),[h,t]=$({}),[g,s]=$("US"),[i,u]=$(!0),{countryOptions:_,regionOptions:T,isRequiredRegion:N,isRequiredPostCode:E,hasRegions:y,loadingCountries:A,disableField:R,handleInputChange:l}=ue({defaultCountry:g,formName:"companyRegistration"}),[o,d]=$({countryCode:g,region:"",regionCode:"",regionId:"",street:["",""]});G(()=>{(async()=>{try{u(!0);const q=(await oe()).defaultCountry||"US";s(q),d(M=>({...M,countryCode:q}))}catch(b){console.error("Failed to load store config:",b)}finally{u(!1)}})()},[]),G(()=>{g&&!i&&l("countryCode",g)},[g,l,i]);const c=J({requiredFieldError:"Company.shared.validation.required",lengthTextError:"Company.FormText.lengthTextError",numericError:"Company.FormText.numericError",alphaNumWithSpacesError:"Company.FormText.alphaNumWithSpacesError",alphaNumericError:"Company.FormText.alphaNumericError",alphaError:"Company.FormText.alphaError",emailError:"Company.shared.validation.invalidEmail",phoneError:"Company.shared.validation.phoneInvalid",postalCodeError:"Company.shared.validation.postalCodeInvalid",urlError:"Company.FormText.urlError"}),v=J({title:"Company.shared.fields.title",submitButton:"Company.shared.fields.submit",submittingButton:"Company.shared.fields.submitting",cancelButton:"Company.shared.buttons.cancel",createCompanyError:"Company.shared.fields.createCompanyError",unexpectedError:"Company.shared.fields.unexpectedError",emailNotAvailable:"Company.shared.validation.emailNotAvailable",companyName:"Company.shared.fields.companyName",legalName:"Company.shared.fields.legalName",companyEmail:"Company.shared.fields.companyEmail",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId",street:"Company.shared.fields.street",streetLine2:"Company.shared.fields.streetLine2",city:"Company.shared.fields.city",country:"Company.shared.fields.country",stateProvince:"Company.shared.fields.stateProvince",postalCode:"Company.shared.fields.postalCode",telephone:"Company.shared.fields.telephone",adminJobTitle:"Company.shared.fields.adminJobTitle",adminWorkTelephone:"Company.shared.fields.adminWorkTelephone",adminEmail:"Company.shared.fields.adminEmail",adminFirstname:"Company.shared.fields.adminFirstname",adminLastname:"Company.shared.fields.adminLastname",adminGender:"Company.shared.fields.adminGender"}),L=k(()=>pe({formData:{countryCode:o.countryCode,regionCode:o.regionCode,regionId:o.regionId},isRequiredRegion:N,isRequiredPostCode:E,hasRegions:y,disableField:R,translations:v}).map(b=>b.code==="region"?{...b,required:N,disabled:A,fieldType:y?"SELECT":"TEXT",options:y?T.map(q=>({text:q.text,value:q.value,isDefault:!1})):[]}:b.code==="postcode"?{...b,required:E}:b.code==="countryCode"?{...b,disabled:R||A,options:_.map(q=>({text:q.text,value:q.value,isDefault:!1}))}:b),[N,E,y,A,R,_,T,o.countryCode,o.regionCode,o.regionId,v]),r=x=>{const b=Re(x,L,c);return t(b.fieldErrors),b.isValid},f=k(()=>Se({setFormData:d,hasRegions:y,regionOptions:T,fieldsConfig:L,formTranslations:c,setFieldErrors:t}),[y,T,L,c]);return{formValues:o,fieldErrors:h,isSubmitting:m,loadingStoreConfig:i,fieldsConfig:L,countryOptions:_,regionOptions:T,loadingCountries:A,handleInputChange:x=>{f.handleInputChangeFromValues(x),Object.entries(x).forEach(([b,q])=>{b==="countryCode"&&l("countryCode",q)})},handleBlur:x=>{const b=x.target,{name:q,value:M}=b,P=L.find(H=>H.customUpperCode===q);if(P){const H=Y(P.code,M,L,c);t(O=>({...O,[q]:H||""}))}},handleFormSubmit:async(x,b)=>{const q=x.target,M=new FormData(q),P={};for(const[X,U]of M.entries())P[X]=U;const H={...P,...o},O=r(H);if(!(!b||!O)){n(!0);try{const X=await ie(H.companyEmail);if(!X.isValid){t(j=>({...j,companyEmail:X.error||v.emailNotAvailable})),n(!1);return}const U=await te(H);if(U.success&&U.company)a==null||a(U.company);else{const j=U.errors||[v.createCompanyError];e==null||e(j)}}catch(X){const U=X instanceof Error?X.message:v.unexpectedError;e==null||e([U])}finally{n(!1)}}},translations:v,formTranslations:c}},Fe=({onSuccess:a,onError:e,className:m="",slots:n,hideActionFormButtons:h=!1})=>{const{formValues:t,fieldErrors:g,isSubmitting:s,loadingStoreConfig:i,fieldsConfig:u,countryOptions:_,regionOptions:T,loadingCountries:N,handleInputChange:E,handleBlur:y,handleFormSubmit:A,translations:R}=Le({onSuccess:a,onError:e});return C("div",{className:w(["company-form-wrapper",m]),children:[p("h2",{children:R.title}),p(me,{regionOptions:T,countryOptions:_,slots:n,className:"company-registration-form",name:"companyRegistrationForm",fieldsConfig:u,values:t,errors:g,onChange:E,onBlur:y,onSubmit:A,loading:s,showFormLoader:!1,children:!h&&p("div",{className:w(["company-form-wrapper__buttons"]),children:p(re,{type:"submit",disabled:s||i||N,className:"company-form-wrapper__submit",children:s?R.submittingButton:R.submitButton})})})]})},xe=({company:a})=>{var h;const[e,m]=$(""),n=J({pendingApproval:"Company.CompanyRegistration.success.pendingApproval",companyDetails:"Company.CompanyRegistration.success.companyDetails",companyName:"Company.shared.fields.companyName",companyEmail:"Company.shared.fields.companyEmail",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId",address:"Company.shared.fields.legalAddress",street:"Company.shared.fields.street",city:"Company.shared.fields.city",stateProvince:"Company.shared.fields.stateProvince",postcode:"Company.shared.fields.postcode",country:"Company.shared.fields.country",telephone:"Company.shared.fields.telephone",companyAdmin:"Company.shared.fields.companyAdmin",adminFirstname:"Company.shared.fields.adminFirstname",adminLastname:"Company.shared.fields.adminLastname",adminEmail:"Company.shared.fields.adminEmail",adminJobTitle:"Company.shared.fields.adminJobTitle",adminWorkTelephone:"Company.shared.fields.adminWorkTelephone"});return G(()=>{(async()=>{var g;if((g=a.legalAddress)!=null&&g.countryCode)try{const{availableCountries:s}=await z(),i=s.find(u=>{var _;return u.value===((_=a.legalAddress)==null?void 0:_.countryCode)});i&&m(i.text)}catch(s){console.error("Failed to fetch countries:",s),m(a.legalAddress.countryCode)}})()},[(h=a.legalAddress)==null?void 0:h.countryCode]),C("div",{className:"company-registration-success",children:[p("div",{className:"company-registration-success__header",children:p("p",{className:"company-registration-success__pending",children:n.pendingApproval})}),C("div",{className:"company-registration-success__details",children:[p("h2",{className:"company-registration-success__details-title",children:n.companyDetails}),C("div",{className:"company-registration-success__grid",children:[C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.companyName,":"]}),p("span",{className:"company-registration-success__value",children:a.name})]}),a.legalName&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.legalName,":"]}),p("span",{className:"company-registration-success__value",children:a.legalName})]}),C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.companyEmail,":"]}),p("span",{className:"company-registration-success__value",children:a.email})]}),a.vatTaxId&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.vatTaxId,":"]}),p("span",{className:"company-registration-success__value",children:a.vatTaxId})]}),a.resellerId&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.resellerId,":"]}),p("span",{className:"company-registration-success__value",children:a.resellerId})]}),a.legalAddress&&C(W,{children:[p("div",{className:"company-registration-success__section-header",children:p("h3",{children:n.address})}),a.legalAddress.street&&a.legalAddress.street[0]&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.street,":"]}),p("span",{className:"company-registration-success__value",children:a.legalAddress.street.map((t,g)=>p("div",{children:t},g))})]}),a.legalAddress.city&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.city,":"]}),p("span",{className:"company-registration-success__value",children:a.legalAddress.city})]}),a.legalAddress.countryCode&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.country,":"]}),p("span",{className:"company-registration-success__value",children:e||a.legalAddress.countryCode})]}),a.legalAddress.region&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.stateProvince,":"]}),p("span",{className:"company-registration-success__value",children:a.legalAddress.region.region||a.legalAddress.region.regionCode})]}),a.legalAddress.postcode&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.postcode,":"]}),p("span",{className:"company-registration-success__value",children:a.legalAddress.postcode})]}),a.legalAddress.telephone&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.telephone,":"]}),p("span",{className:"company-registration-success__value",children:a.legalAddress.telephone})]})]}),a.companyAdmin&&C(W,{children:[p("div",{className:"company-registration-success__section-header",children:p("h3",{children:n.companyAdmin})}),a.companyAdmin.jobTitle&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.adminJobTitle,":"]}),p("span",{className:"company-registration-success__value",children:a.companyAdmin.jobTitle})]}),a.companyAdmin.telephone&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.adminWorkTelephone,":"]}),p("span",{className:"company-registration-success__value",children:a.companyAdmin.telephone})]}),C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.adminEmail,":"]}),p("span",{className:"company-registration-success__value",children:a.companyAdmin.email})]})]})]})]})]})},Je=({isAuthenticated:a=!1,onRedirectLogin:e,onRedirectAccount:m,onSuccess:n,onError:h,className:t,slots:g})=>{const[s,i]=$("loading"),[u,_]=$(null);G(()=>{let E=!0;return(async()=>{try{if(!await le()){if(E){const A=a?"redirect-account":"redirect-login";console.log(`Company registration disabled - redirecting to ${a?"account dashboard":"login page"}`),i(A)}return}if(a)try{if(await de()){E&&(console.log("User already belongs to a company - redirecting to account dashboard"),i("redirect-account"));return}}catch(A){console.error("Error checking company membership - redirecting to account dashboard:",A),E&&i("redirect-account");return}E&&i("show-form")}catch(y){console.error("Error checking B2B status:",y),E&&i(a?"redirect-account":"redirect-login")}})(),()=>{E=!1}},[a]),G(()=>{s==="redirect-login"&&e&&e(),s==="redirect-account"&&m&&m()},[s,e,m]);const T=E=>{i("success"),_(E),n==null||n(E)},N=E=>{h==null||h(E)};return s==="loading"||s==="redirect-login"||s==="redirect-account"?null:s==="success"&&u?p("div",{className:`company-registration-container ${t||""}`,children:p(xe,{company:u})}):p("div",{className:`company-registration-container ${t||""}`,children:p(Fe,{onSuccess:T,onError:N,slots:g})})};export{Je as CompanyRegistration,Je as default};
//# sourceMappingURL=CompanyRegistration.js.map
