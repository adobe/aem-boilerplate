/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as D,jsx as t,Fragment as de}from"@dropins/tools/preact-jsx-runtime.js";import{useState as I,useEffect as Z,useRef as oe,useCallback as O}from"@dropins/tools/preact-hooks.js";import{Slot as ve,classes as he}from"@dropins/tools/lib.js";import{Card as ae,InLineAlert as re,ProgressSpinner as le,Field as me,Input as pe,Button as A,Modal as ye,Header as be}from"@dropins/tools/components.js";import{f as fe}from"../chunks/fetchUserPermissions.js";import{b as Ce}from"../chunks/company-permissions.js";import{useText as j}from"@dropins/tools/i18n.js";import{u as Ie}from"../chunks/useCompanyContextListener.js";import{a as Te,i as we}from"../chunks/isCompanyUser.js";import*as ge from"@dropins/tools/preact-compat.js";import{memo as Se}from"@dropins/tools/preact-compat.js";import{T as Ee}from"../chunks/Tree.js";import{C as Ne}from"../chunks/CompanyUserForm.js";import{events as te}from"@dropins/tools/event-bus.js";import{p as ce,E as ie}from"../chunks/acdl.js";import{g as Ue,c as Me,u as xe,a as _e,b as ke,d as De}from"../chunks/updateCompanyTeam.js";import{d as Ae}from"../chunks/updateCompanyUser.js";import{u as Pe}from"../chunks/useInLineAlert.js";import{a as Le,b as Fe}from"../chunks/CompanyLoaders.js";import"../chunks/fetch-error.js";import"../chunks/network-error.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/useCompanyRoles.js";import"../chunks/isCompanyRoleNameAvailable.js";const Ve=u=>ge.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...u},ge.createElement("path",{vectorEffect:"non-scaling-stroke",fillRule:"evenodd",clipRule:"evenodd",d:"M1 20.8953L12.1922 1.5L23.395 20.8953H1ZM13.0278 13.9638L13.25 10.0377V9H11.25V10.0377L11.4722 13.9638H13.0278ZM11.2994 16V17.7509H13.2253V16H11.2994Z",fill:"currentColor"}));function Re(u){const{mode:E,entityId:m,parentStructureId:d,onSaved:e,onError:g,onSuccess:i}=u,n=j({teamTitleRequired:"Company.CompanyStructure.shared.validation.teamTitleRequired",createTeamError:"Company.CompanyStructure.messages.createTeamError",saveTeamError:"Company.CompanyStructure.messages.saveTeamError",createTeamSuccess:"Company.CompanyStructure.messages.createTeamSuccess",updateTeamSuccess:"Company.CompanyStructure.messages.updateTeamSuccess"}),[p,o]=I({id:"",name:"",description:""}),[h,S]=I({}),[y,k]=I({}),[w,N]=I(!1),[F,P]=I(null);Z(()=>{E!=="edit"||!m||(N(!0),Ue(m).then(f=>{f&&o({id:f.id,name:f.name||"",description:f.description||""})}).finally(()=>N(!1)))},[E,m]);const H=(f,T)=>f==="name"?T.trim()?null:n.teamTitleRequired:null,x=(f,T)=>{o(U=>({...U,[f]:T})),F&&P(null)};return{values:p,errors:h,touched:y,loading:w,setValue:x,onBlur:(f,T)=>{T!==void 0&&x(f,T),k(L=>({...L,[f]:!0}));const U=T!==void 0?T:p[f]||"",v=H(f,U);S(v?L=>({...L,[f]:v}):L=>{const V={...L};return delete V[f],V})},submit:async()=>{const f=H("name",p.name);if(f){S({name:f}),k({name:!0});return}const T=p.name;try{if(E==="add"){const U=await Me({name:p.name,description:p.description||null,targetId:d??null});if(!U){const v=n.createTeamError;g?g(v):P(v);return}e({label:T,structureId:U.structureId,entityId:U.id,type:"team",description:p.description||void 0}),i&&i(n.createTeamSuccess)}else m&&(await xe({id:m,name:p.name,description:p.description||null}),e({label:T,entityId:m,type:"team",description:p.description||void 0}),i&&i(n.updateTeamSuccess))}catch(U){const v=U instanceof Error?U.message:n.saveTeamError;g?g(v):P(v)}},generalError:F}}const ze=Se(({mode:u,entityId:E,parentStructureId:m,permissions:d,onSaved:e,onCancel:g,onError:i,onSuccess:n})=>{const p=(d==null?void 0:d.canEditUsers)??!1,{values:o,errors:h,touched:S,loading:y,onBlur:k,submit:w,generalError:N}=Re({mode:u,entityId:E,parentStructureId:m,onSaved:e,onError:i?x=>{i(x),g()}:void 0,onSuccess:n}),[F,P]=I(!1),H=j({addTeam:"Company.CompanyStructure.shared.titles.addTeam",editTeam:"Company.CompanyStructure.shared.titles.editTeam",teamTitle:"Company.CompanyStructure.shared.fields.teamTitle",description:"Company.CompanyStructure.shared.fields.description"});return D("div",{children:[t("h3",{className:"acm-structure-panel__title",children:u==="add"?H.addTeam:H.editTeam}),D(ae,{variant:"secondary",className:`company-team-form__card ${F?"is-working":""}`,children:[!i&&N?t(re,{className:"company-team-form__notification",type:"error",variant:"secondary",heading:N}):null,F?t("div",{className:"company-team-form__overlay","aria-live":"polite",children:t(le,{size:"small"})}):null,y?t(Le,{}):D("div",{className:"company-team-form__content",children:[t(me,{label:H.teamTitle,required:!0,className:"acm-structure-panel__field",error:S.name&&h.name?h.name:void 0,children:t(pe,{name:"team_title",type:"text",value:o.name,onBlur:x=>{const Y=x.target;k("name",Y.value)},variant:"primary",size:"medium",disabled:!p})}),t(me,{label:H.description,className:"acm-structure-panel__field",children:t(pe,{name:"team_description",type:"textarea",value:o.description||"",onBlur:x=>{const Y=x.target;k("description",Y.value)},variant:"primary",size:"medium",disabled:!p})})]})]}),y?null:D("div",{className:"acm-structure-modal__actions",children:[t(A,{type:"button",variant:"primary",onClick:async()=>{if(!F){P(!0);try{await w()}finally{P(!1)}}},disabled:F||!p,children:"Save"}),t(A,{type:"button",variant:"secondary",disabled:F,onClick:g,children:"Cancel"})]})]})});function Be({handleSetInLineAlert:u,permissions:E}={permissions:null}){const m=(E==null?void 0:E.canViewUsers)??!1,d=j({loadError:"Company.CompanyStructure.messages.loadError",updateError:"Company.CompanyStructure.messages.updateError",failedToMoveItem:"Company.CompanyStructure.messages.failedToMoveItem",removeUserSuccess:"Company.CompanyStructure.messages.removeUserSuccess",deleteTeamSuccess:"Company.CompanyStructure.messages.deleteTeamSuccess",removeMultipleSuccess:"Company.CompanyStructure.messages.removeMultipleSuccess",moveUserSuccess:"Company.CompanyStructure.messages.moveUserSuccess",moveTeamSuccess:"Company.CompanyStructure.messages.moveTeamSuccess"}),{loadError:e,updateError:g}=d,[i,n]=I(null),[p,o]=I(!0),[h,S]=I(!1),[y,k]=I(!1),[w,N]=I(new Set),[F,P]=I(null),[H,x]=I(new Set),[Y,G]=I({}),f=oe(u),T=oe(!1),U=oe(!1);Z(()=>{f.current=u},[u]);const v=O((a,l)=>{u&&(a==="success"?u({type:"success",text:l}):a==="error"?u({type:"error",text:l}):u(),S(!1))},[u]),L=O(async()=>{if(T.current)return null;if(T.current=!0,!m)return o(!1),n(null),N(new Set),P(null),x(new Set),T.current=!1,null;o(!0);try{const l=await _e();return n(l),N(new Set(l.map(_=>_.id))),o(!1),l}catch{return o(!1),f.current&&f.current({type:"error",text:e}),null}finally{T.current=!1}},[m,e]);Z(()=>{m&&!U.current&&(U.current=!0,L())},[m,L]),Z(()=>{const a=()=>{o(!0),N(new Set),P(null),x(new Set),L()},l=te.on("companyContext/changed",a,{eager:!0});return()=>{l==null||l.off()}},[L]);const V=O(async(a,l)=>{try{if(S(!0),!await ke({id:a,parentId:l}))return v("error",d.failedToMoveItem),!1;const b=new Map(i==null?void 0:i.map(c=>[c.id,c])).get(a),r=(b==null?void 0:b.type)==="team"?d.moveTeamSuccess:d.moveUserSuccess;return n(c=>c?c.map(C=>C.id===a?{...C,parentId:l}:C):null),N(c=>new Set([...c,l])),ce(ie.EDIT_COMPANY_STRUCTURE_EVENT,{action:"move",nodeId:a,newParentId:l}),te.emit("companyStructure/updated",{message:"Structure updated",action:"move",nodeId:a,newParentId:l,nodes:i||[]}),v("success",r),!0}catch(_){const R=_ instanceof Error?_.message:g;return v("error",R),!1}finally{S(!1)}},[i,v,g,d.failedToMoveItem,d.moveUserSuccess,d.moveTeamSuccess]),ne=O(()=>{i&&N(new Set(i.map(a=>a.id)))},[i]),q=O(()=>{if(i){const a=i.filter(l=>l.parentId===null).map(l=>l.id);N(new Set(a))}},[i]),$=O(a=>{n(l=>{const _=l?[...l,{id:a.id,parentId:a.parentId,label:a.label,type:a.type,entityId:a.entityId,description:a.description}]:[{id:a.id,parentId:a.parentId,label:a.label,type:a.type,entityId:a.entityId,description:a.description}];return te.emit("companyStructure/updated",{message:"Structure updated",action:"add",nodeId:a.id,newParentId:a.parentId||void 0,nodes:_}),ce(ie.EDIT_COMPANY_STRUCTURE_EVENT,{action:"add",nodeId:a.id,newParentId:a.parentId||void 0,nodeType:a.type}),_}),a.parentId&&N(l=>new Set([...l,a.parentId]))},[]),K=O((a,l,_)=>{l&&n(R=>R?R.map(b=>a.includes(b.id)?{...b,label:l,description:_}:b):null)},[]),Q=O(async a=>{if(a.length)try{S(!0);const l=new Map((i||[]).map(b=>[b.id,b])),_=a.map(b=>l.get(b)).filter(Boolean);for(const b of a){const r=l.get(b);!r||!r.entityId||(r.type==="team"?await De(r.entityId):await Ae({id:r.entityId}))}n(b=>{if(!b)return null;const r=new Set(a);return b.filter(c=>!r.has(c.id))}),P(null),x(new Set),ce(ie.EDIT_COMPANY_STRUCTURE_EVENT,{action:"remove",nodeIds:a}),te.emit("companyStructure/updated",{message:"Structure updated",action:"remove",nodeIds:a,nodes:i||[]});let R;if(a.length===1){const b=_[0];R=(b==null?void 0:b.type)==="team"?d.deleteTeamSuccess:d.removeUserSuccess}else R=d.removeMultipleSuccess.replace("{count}",a.length.toString());v("success",R)}catch(l){const _=l instanceof Error?l.message:g;v("error",_)}finally{S(!1)}},[i,v,g,d.removeUserSuccess,d.deleteTeamSuccess,d.removeMultipleSuccess]),X=O(a=>{G(a)},[]),W=O(()=>{k(!0),v("success",""),G({})},[v]),ee=O(a=>{a==null||a(),k(!1),G({})},[]);return{nodes:i,loading:p,submitLoading:h,showEditForm:y,inputChange:Y,expanded:w,setExpanded:N,selected:F,setSelected:P,selectedMany:H,setSelectedMany:x,move:V,expandAll:ne,collapseAll:q,insertNode:$,renameNodes:K,removeNodes:Q,handleInputChange:X,handleShowEditForm:W,handleHideEditForm:ee,renderAlertMessage:v,working:h}}const Oe=Se(({permissions:u,slots:E})=>{var b;const m=(u==null?void 0:u.canEditUsers)??!1,d=(u==null?void 0:u.canViewUsers)??!1,e=j({expandAll:"Company.CompanyStructure.shared.buttons.expandAll",collapseAll:"Company.CompanyStructure.shared.buttons.collapseAll",addUser:"Company.CompanyStructure.shared.buttons.addUser",addTeam:"Company.CompanyStructure.shared.buttons.addTeam",editSelected:"Company.CompanyStructure.shared.buttons.editSelected",remove:"Company.CompanyStructure.shared.buttons.remove",ok:"Company.CompanyStructure.shared.buttons.ok",cancel:"Company.CompanyStructure.shared.buttons.cancel",close:"Company.CompanyStructure.shared.buttons.close",deleting:"Company.CompanyStructure.shared.buttons.deleting",removing:"Company.CompanyStructure.shared.buttons.removing",noStructureData:"Company.CompanyStructure.messages.noStructureData",processing:"Company.CompanyStructure.shared.messages.processing",cannotDeleteUser:"Company.CompanyStructure.messages.cannotDeleteUser",cannotDeleteTeam:"Company.CompanyStructure.messages.cannotDeleteTeam",removeUserConfirm:"Company.CompanyStructure.messages.removeUserConfirm",deleteTeamConfirm:"Company.CompanyStructure.messages.deleteTeamConfirm",removeItemsConfirm:"Company.CompanyStructure.messages.removeItemsConfirm",teamDescription:"Company.CompanyStructure.shared.messages.teamDescription",removeUserMessage:"Company.CompanyStructure.messages.removeUserMessage",cannotDeleteUserMessage:"Company.CompanyStructure.messages.cannotDeleteUserMessage",cannotDeleteTeamMessage:"Company.CompanyStructure.messages.cannotDeleteTeamMessage",removeItemsMessage:"Company.CompanyStructure.messages.removeItemsMessage",companyStructureActions:"Company.CompanyStructure.shared.ariaLabels.companyStructureActions",expandAllNodes:"Company.CompanyStructure.shared.ariaLabels.expandAllNodes",collapseAllNodes:"Company.CompanyStructure.shared.ariaLabels.collapseAllNodes",addUserAria:"Company.CompanyStructure.shared.ariaLabels.addUser",addTeamAria:"Company.CompanyStructure.shared.ariaLabels.addTeam",editSelectedAria:"Company.CompanyStructure.shared.ariaLabels.editSelected",removeSelectedAria:"Company.CompanyStructure.shared.ariaLabels.removeSelected",showDescription:"Company.CompanyStructure.shared.ariaLabels.showDescription",delete:"Company.CompanyStructure.shared.options.delete",expand:"Company.CompanyStructure.shared.options.expand",collapse:"Company.CompanyStructure.shared.options.collapse",deleteTeamMessage:"Company.CompanyStructure.messages.deleteTeamMessage"}),{inLineAlertProps:g,handleSetInLineAlert:i}=Pe(),{nodes:n,loading:p,submitLoading:o,expanded:h,setExpanded:S,selected:y,setSelected:k,selectedMany:w,setSelectedMany:N,move:F,expandAll:P,collapseAll:H,insertNode:x,renameNodes:Y,removeNodes:G}=Be({handleSetInLineAlert:i,permissions:u}),[f,T]=I(null),[U,v]=I("add"),[L,V]=I(!1),[ne,q]=I([]),[$,K]=I({title:"",body:"",confirmLabel:e.remove,blocked:!1}),[Q,X]=I(null),W=()=>T(null),ee=((b=n==null?void 0:n.find(r=>r.parentId===null))==null?void 0:b.id)??null,a=(n||[]).map(r=>({id:r.id,parentId:r.parentId,label:r.label})),l=(r,c)=>{let C=r;const s=new Map(a.map(z=>[z.id,z])),M=new Set;for(;C&&!M.has(C);){M.add(C);const z=s.get(C);if(!z)break;if(z.parentId===c)return!0;C=z.parentId??null}return!1},_=(n||[]).map(r=>({id:r.id,parentId:r.parentId,label:r.label,type:r.type,description:r.description,entityId:r.entityId})),R=D(de,{children:[(()=>{const r=w!=null&&w.size?Array.from(w):y?[y]:[],c=m&&r.length===1,C=m&&r.length>=1;return t(ae,{variant:"secondary",className:"acm-structure-toolbar-card acm-structure-toolbar-card--spaced",children:D("div",{className:"acm-structure-toolbar",role:"toolbar","aria-label":e.companyStructureActions,children:[t(A,{type:"button",variant:"secondary",onClick:P,"aria-label":e.expandAllNodes,disabled:!d,"aria-disabled":!d,children:e.expandAll}),t(A,{type:"button",variant:"secondary",onClick:H,"aria-label":e.collapseAllNodes,disabled:!d,"aria-disabled":!d,children:e.collapseAll}),t(A,{type:"button",variant:"primary",onClick:()=>{v("add"),T("user")},"aria-label":e.addUserAria,disabled:!m,"aria-disabled":!m,children:e.addUser}),t(A,{type:"button",variant:"primary",onClick:()=>{v("add"),T("team")},"aria-label":e.addTeamAria,disabled:!m,"aria-disabled":!m,children:e.addTeam}),t(A,{type:"button",variant:"primary",disabled:!c,"aria-disabled":!c,"aria-label":e.editSelectedAria,onClick:()=>{if(!c)return;const s=r,M=n==null?void 0:n.find(z=>z.id===s[0]);(M==null?void 0:M.type)==="user"?(v("edit"),T("user")):(v("edit"),T("team"))},children:e.editSelected}),t(A,{type:"button",variant:"secondary",disabled:!C||o,"aria-disabled":!C||o,"aria-label":e.removeSelectedAria,onClick:()=>{if(!C||o)return;const s=r;if(s.length===1){const M=n==null?void 0:n.find(J=>J.id===s[0]);if(!M)return;(n==null?void 0:n.some(J=>J.parentId===M.id))?(K({title:M.type==="user"?e.cannotDeleteUser:e.cannotDeleteTeam,body:M.type==="user"?e.cannotDeleteUserMessage:e.cannotDeleteTeamMessage,confirmLabel:void 0,blocked:!0}),q([]),V(!0)):(K({title:M.type==="user"?e.removeUserConfirm:e.deleteTeamConfirm,body:M.type==="user"?e.removeUserMessage:e.deleteTeamMessage,confirmLabel:M.type==="user"?e.remove:e.delete,blocked:!1}),q(s),V(!0))}else K({title:e.removeItemsConfirm.replace("{count}",s.length.toString()),body:e.removeItemsMessage,confirmLabel:e.remove,blocked:!1}),q(s),V(!0)},children:e.remove})]})})})(),f?D("div",{className:"acm-structure-panel",children:[o?D("div",{className:"acm-structure-working","aria-live":"polite",children:[t(le,{size:"small"})," ",e.processing]}):null,f==="user"?(()=>{const r=w!=null&&w.size?Array.from(w):y?[y]:[],c=r.length?n==null?void 0:n.find(s=>s.id===r[0]):void 0,C=(c==null?void 0:c.id)??ee;return t(Ne,{mode:U,entityId:c==null?void 0:c.entityId,parentStructureId:C,permissions:u,onSaved:s=>{U==="add"?s.structureId&&(x({id:s.structureId,parentId:C,label:s.label,type:s.type,entityId:s.entityId}),s.structureId&&(k(s.structureId),N(new Set([s.structureId])))):r.length&&Y(r,s.label),W()},onCancel:W,onError:s=>{i({text:s,type:"error"})},onSuccess:s=>{i({text:s,type:"success"})}})})():null,f==="team"?(()=>{const r=w!=null&&w.size?Array.from(w):y?[y]:[],c=r.length?n==null?void 0:n.find(s=>s.id===r[0]):void 0,C=(c==null?void 0:c.id)??ee;return t(ze,{mode:U,entityId:c==null?void 0:c.entityId,parentStructureId:C,permissions:u,onSaved:s=>{U==="add"?s.structureId&&(x({id:s.structureId,parentId:C,label:s.label,type:s.type,entityId:s.entityId,description:s.description}),s.structureId&&(k(s.structureId),N(new Set([s.structureId])))):r.length&&Y(r,s.label,s.description),W()},onCancel:W,onError:s=>{i({text:s,type:"error"})},onSuccess:s=>{i({text:s,type:"success"})}})})():null]}):null,D(ae,{variant:"secondary",className:`acm-structure-tree-card ${o?"is-working":""}`,children:[g&&g.text?t(re,{className:"acm-structure-panel__notification",type:g.type||"success",variant:"secondary",heading:g.text}):null,!p&&!o&&n&&n.length===0?t(re,{className:"acm-structure-panel__notification",type:"warning",variant:"secondary",heading:e.noStructureData}):null,!p&&o?t("div",{className:"acm-structure-tree-overlay","aria-live":"polite",children:t(le,{size:"medium"})}):null,p?t("div",{className:"acm-structure-tree-content",children:t(Fe,{rows:8})}):t("div",{className:"acm-structure-tree-content",children:t(Ee,{rootId:null,items:a,expandedIds:h,selectedId:y,selectedIds:w,onExpandedChange:S,onSelectedChange:k,onSelectedIdsChange:N,renderExpander:({expanded:r,toggle:c})=>t("button",{type:"button",className:`acm-structure-expander acm-structure-expander-button ${r?"is-open":""}`,"aria-label":r?e.collapse:e.expand,onClick:C=>{C.stopPropagation(),c()},children:r?"âˆ’":"+"}),renderNode:({item:r,hasChildren:c,select:C,expander:s,checkbox:M,icon:z})=>{var J;return D("div",{className:"acm-structure-row",onClick:C,children:[c?s?t("span",{onClick:B=>B.stopPropagation(),children:s()}):t("span",{className:"acm-structure-expander acm-structure-expander--placeholder"}):t("span",{className:"acm-structure-expander acm-structure-expander--placeholder"}),t("span",{className:"acm-structure-handle","aria-hidden":!0}),z?t("span",{onClick:B=>B.stopPropagation(),children:z()}):t("span",{className:`acm-structure-icon ${((J=n==null?void 0:n.find(B=>B.id===r.id))==null?void 0:J.type)==="team"?"is-team":"is-user"}`,"aria-hidden":!0}),M?t("span",{onClick:B=>B.stopPropagation(),children:M()}):null,t("span",{className:"acm-structure-label",children:r.label}),(()=>{const B=n==null?void 0:n.find(se=>se.id===r.id),ue=(B==null?void 0:B.type)==="team"&&B.description||"";return ue?t(A,{type:"button",variant:"secondary",onClick:se=>{se.stopPropagation(),X({id:r.id,text:ue})},"aria-label":e.showDescription,className:"acm-structure-description-button",children:"?"}):null})()]})},draggable:()=>!o&&m,canDrop:(r,c)=>{if(!m||r===c)return!1;const C=n==null?void 0:n.find(s=>s.id===r);return C&&C.parentId===c?!1:!l(c,r)},onMove:async({id:r,newParentId:c})=>{m&&await F(r,c)}})})]}),L?t(ye,{open:L,onClose:()=>{o||(V(!1),q([]))},children:D("div",{className:"acm-structure-modal-content",children:[t("h3",{className:"acm-structure-modal-title",children:$.title}),t("div",{children:$.body}),t("div",{className:"acm-structure-modal-actions",children:$.blocked?t(A,{type:"button",variant:"secondary",disabled:o,onClick:()=>{o||(V(!1),q([]))},children:e.ok}):D(de,{children:[t(A,{type:"button",variant:"secondary",disabled:o,onClick:()=>{o||(V(!1),q([]))},children:e.cancel}),t(A,{type:"button",variant:"primary",disabled:o,onClick:async()=>{await G(ne),V(!1),q([])},children:o?$.confirmLabel===e.delete?e.deleting:e.removing:$.confirmLabel||e.remove})]})})]})}):null,Q?t(ye,{open:!!Q,onClose:()=>X(null),children:D("div",{className:"acm-structure-modal-content",children:[t("h3",{className:"acm-structure-modal-title",children:e.teamDescription}),t("div",{children:Q.text}),t("div",{className:"acm-structure-modal-actions",children:t(A,{type:"button",variant:"secondary",onClick:()=>X(null),children:e.close})})]})}):null]});return E!=null&&E.StructureData?t(ve,{name:"StructureData",slot:E.StructureData,context:{structureData:_,Default:R}}):R}),He=()=>{const u=j({fetchPermissionsError:"Company.CompanyStructure.messages.fetchPermissionsError"}),[E,m]=I(null),[d,e]=I(!0),[g,i]=I(null),n=O(async()=>{var p,o;try{e(!0),i(null);const{roleResponse:h}=await fe(),S=(o=(p=h==null?void 0:h.data)==null?void 0:p.customer)==null?void 0:o.role,y=Ce(S);m(y)}catch(h){i(h instanceof Error?h:new Error(u.fetchPermissionsError))}finally{e(!1)}},[u.fetchPermissionsError]);return Z(()=>{let p=!0;return(async()=>{var h,S;try{e(!0),i(null);const{roleResponse:y}=await fe();if(!p)return;const k=(S=(h=y==null?void 0:y.data)==null?void 0:h.customer)==null?void 0:S.role,w=Ce(k);m(w)}catch(y){if(!p)return;i(y instanceof Error?y:new Error(u.fetchPermissionsError))}finally{p&&e(!1)}})(),()=>{p=!1}},[]),{permissions:E,loading:d,error:g,refreshPermissions:n}},Ye="/customer/company/create",qe=({className:u,children:E,createCompanyAccountUrl:m=Ye,...d})=>{const e=j({individualUserMessage:"Company.CustomerCompanyInfo.individualUserMessage",createAccountCta:"Company.CustomerCompanyInfo.createAccountCta"}),g=e.individualUserMessage||"You don't have a company account yet.";return t(ae,{variant:"secondary",className:he(["company-management-company-structure-card",u]),...d,children:D("div",{children:[t(re,{type:"warning",variant:"secondary",heading:g,icon:t(Ve,{}),className:"company-management-company-structure-card__alert","data-testid":"company-structure-inline-alert"}),t("div",{className:"company-management-company-structure-card__cta",children:t(A,{as:"a",href:m,variant:"primary","data-testid":"company-structure-create-company-button",children:e.createAccountCta||"Create a Company Account"})})]})})},yt=({className:u,withHeader:E=!1,slots:m,isAuthenticated:d=!1,onRedirectLogin:e,onRedirectAccount:g})=>{const i=j({containerTitle:"Company.CompanyStructure.containerTitle"}),{permissions:n,refreshPermissions:p}=He(),[o,h]=I("loading");return Ie(p),Z(()=>{let S=!0;return(async()=>{try{if(!d){S&&h("redirect-login");return}if(!await Te()){S&&(console.log("Company registration disabled - redirecting to account dashboard"),h("redirect-account"));return}await we()?S&&h("show-structure"):S&&h("show-empty")}catch(y){console.error("Error in CompanyStructure - redirecting to login page:",y),S&&h("redirect-login")}})(),()=>{S=!1}},[d]),Z(()=>{o==="redirect-login"&&e&&e(),o==="redirect-account"&&g&&g()},[o,e,g]),o==="loading"||o==="redirect-login"||o==="redirect-account"?null:o==="show-empty"?t(qe,{className:u}):o==="show-structure"?D("div",{className:he(["account-company-structure",u]),children:[E?t(be,{title:i.containerTitle,divider:!1,className:"company-structure__title"}):null,t(Oe,{slots:m,permissions:n})]}):null};export{yt as CompanyStructure,yt as default};
//# sourceMappingURL=CompanyStructure.js.map
