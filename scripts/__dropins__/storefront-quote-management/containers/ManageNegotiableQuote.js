/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as t,jsxs as l}from"@dropins/tools/preact-jsx-runtime.js";import{useState as x,useEffect as M,useMemo as b,useCallback as F}from"@dropins/tools/preact-compat.js";import{classes as d,VComponent as s,Slot as h,getGlobalLocale as Y}from"@dropins/tools/lib.js";/* empty css                     */import{Picker as Z,Skeleton as R,SkeletonRow as y,InLineAlert as D,Button as P,TextArea as O}from"@dropins/tools/components.js";import{events as S}from"@dropins/tools/event-bus.js";/* empty css                          */import"@dropins/tools/preact.js";import{useText as W}from"@dropins/tools/i18n.js";/* empty css                                  */import"../chunks/transform-quote.js";import"@dropins/tools/fetch-graphql.js";import{s as B}from"../chunks/sendForReview.js";import{S as k}from"../chunks/WarningFilled.js";import"../chunks/NegotiableQuoteFragment.js";const A=({className:p,dropdownPlaceholder:e,dropdownOptions:i,handleDropdownChange:q,buttons:u,...a})=>{const _=i&&i.length>0,c=u&&u.length>0,f=(i==null?void 0:i.map(o=>({text:o.label,value:o.value})))||[];return f.unshift({text:e||"",value:""}),t("div",{className:"quote-management-actions-bar__container","data-testid":"actions-bar-container",children:l("div",{className:d(["quote-management-actions-bar",p]),"data-testid":"actions-bar",...a,children:[_&&t(Z,{name:"dropdown",id:"dropdown",onInput:q,className:"quote-management-actions-bar__dropdown","data-testid":"dropdown",options:f}),c&&t("div",{className:"quote-management-actions-bar__buttons","data-testid":"buttons-container",children:u==null?void 0:u.map((o,v)=>t(s,{node:o,className:d(["quote-management-actions-bar__button"])},v))})]})})},ee=({className:p,loading:e,quoteName:i,quoteStatus:q,banner:u,details:a,actionBar:_,quoteContent:c,shippingInformationTitle:f,shippingInformation:o,quoteCommentsTitle:v,quoteComments:N,footer:Q,...n})=>e?t(ae,{}):l("div",{...n,className:d(["quote-management-manage-negotiable-quote",p]),children:[l("div",{className:d(["quote-management-manage-negotiable-quote__header"]),children:[i&&t(s,{node:i,className:d(["quote-management-manage-negotiable-quote__quote-name"])}),q&&t(s,{node:q,className:d(["quote-management-manage-negotiable-quote__quote-status"])})]}),u&&t(s,{node:u,className:d(["quote-management-manage-negotiable-quote__banner"])}),a&&t(s,{node:a,className:d(["quote-management-manage-negotiable-quote__details"])}),_&&t(s,{node:_,className:d(["quote-management-manage-negotiable-quote__action-bar"])}),c&&t(s,{node:c,className:d(["quote-management-manage-negotiable-quote__quote-content"])}),l("div",{"data-testid":"quote-shipping-information-container",className:d(["quote-management-manage-negotiable-quote__shipping-information-container"]),children:[f&&t(s,{node:f,className:d(["quote-management-manage-negotiable-quote__shipping-information-title"])}),o&&t(s,{node:o,className:d(["quote-management-manage-negotiable-quote__shipping-information"])})]}),l("div",{"data-testid":"quote-comments-container",className:d(["quote-management-manage-negotiable-quote__quote-comments-container"]),children:[v&&t(s,{node:v,className:d(["quote-management-manage-negotiable-quote__quote-comments-title"])}),N&&t(s,{node:N,className:d(["quote-management-manage-negotiable-quote__quote-comments"])})]}),t(s,{node:Q,className:d(["quote-management-manage-negotiable-quote__footer"])})]}),ae=()=>l(R,{"data-testid":"manage-negotiable-quote-skeleton",children:[t(y,{variant:"heading",fullWidth:!0,size:"large"}),t(y,{variant:"row",fullWidth:!1,size:"small"}),t(y,{variant:"row",fullWidth:!1,size:"small"}),t(y,{variant:"row",fullWidth:!0}),t(y,{variant:"row",fullWidth:!0,size:"xlarge",lines:2}),t(y,{variant:"row",fullWidth:!1,size:"small"})]}),te=({className:p,shippingAddress:e,loading:i,noAddressMessage:q,...u})=>{const a=W({noAddress:"NegotiableQuote.Manage.shippingAddress.noAddress"});return i?t(ne,{}):e?l("div",{className:d(["quote-management-shipping-address-display",p]),"data-testid":"shipping-address-display",...u,children:[t("div",{className:"quote-management-shipping-address-display__field","data-testid":"address-name",children:l("span",{className:"quote-management-shipping-address-display__name",children:[e.firstname," ",e.lastname]})}),e.company&&t("div",{className:"quote-management-shipping-address-display__field","data-testid":"address-company",children:e.company}),e.street.map((_,c)=>t("div",{className:"quote-management-shipping-address-display__field","data-testid":`address-street-${c}`,children:_},c)),l("div",{className:"quote-management-shipping-address-display__field","data-testid":"address-city-region",children:[e.city,e.region&&`, ${e.region.label}`," ",e.postcode]}),t("div",{className:"quote-management-shipping-address-display__field","data-testid":"address-country",children:e.country.label}),t("div",{className:"quote-management-shipping-address-display__field","data-testid":"address-telephone",children:e.telephone})]}):t("div",{className:d(["quote-management-shipping-address-display","quote-management-shipping-address-display--empty",p]),"data-testid":"shipping-address-display-empty",...u,children:t("p",{className:"quote-management-shipping-address-display__no-address",children:q||a.noAddress})})},ne=()=>t(R,{"data-testid":"shipping-address-display-skeleton",children:t(y,{variant:"row",fullWidth:!0,size:"small",lines:5,multilineGap:"xsmall"})}),ve=({onActionsDropdownChange:p,slots:e,onActionsButtonClick:i,onSendForReview:q,...u})=>{const[a,_]=x(void 0),[c,f]=x(!0),[o,v]=x(""),[N,Q]=x(!1),n=W({createdLabel:"NegotiableQuote.Manage.createdLabel",salesRepLabel:"NegotiableQuote.Manage.salesRepLabel",expiresLabel:"NegotiableQuote.Manage.expiresLabel",actionsLabel:"NegotiableQuote.Manage.actionsLabel",remove:"NegotiableQuote.Manage.actions.remove",close:"NegotiableQuote.Manage.actionButtons.close",delete:"NegotiableQuote.Manage.actionButtons.delete",print:"NegotiableQuote.Manage.actionButtons.print",createTemplate:"NegotiableQuote.Manage.actionButtons.createTemplate",createCopy:"NegotiableQuote.Manage.actionButtons.createCopy",shippingInformationTitle:"NegotiableQuote.Manage.shippingInformation.title",quoteCommentsTitle:"NegotiableQuote.Manage.quoteComments.title",quoteCommentsPlaceholder:"NegotiableQuote.Manage.quoteComments.placeholder",sendForReview:"NegotiableQuote.Manage.actionButtons.sendForReview",bannerTitle:"NegotiableQuote.Manage.bannerTitle",statusSubmitted:"NegotiableQuote.Manage.bannerStatusMessages.submitted",statusPending:"NegotiableQuote.Manage.bannerStatusMessages.pending",statusExpired:"NegotiableQuote.Manage.bannerStatusMessages.expired"});M(()=>{const m=S.on("quote-management/quote-data",g=>{const{quote:r}=g;r&&(_(r),f(!1))},{eager:!0});return()=>m==null?void 0:m.off()},[]),M(()=>{const m=S.on("quote-management/shipping-address-set",g=>{const{quote:r}=g;r&&_(r)},{eager:!0});return()=>m==null?void 0:m.off()},[]),M(()=>{const m=S.on("quote-management/quote-sent-for-review",g=>{const{quote:r}=g;_(r),v(""),Q(!1)},{eager:!0});return()=>m==null?void 0:m.off()},[]);const z=b(()=>t(h,{name:"QuoteName",slot:e==null?void 0:e.QuoteName,context:{quoteName:a==null?void 0:a.name,quoteData:a},children:t("h1",{"data-testid":"quote-name",children:a==null?void 0:a.name})}),[e==null?void 0:e.QuoteName,a]),E=b(()=>t(h,{name:"QuoteStatus",slot:e==null?void 0:e.QuoteStatus,context:{quoteStatus:a==null?void 0:a.status,quoteData:a},children:t("div",{"data-testid":"quote-status",children:a==null?void 0:a.status})}),[e==null?void 0:e.QuoteStatus,a]),T=F(m=>{switch(m){case"SUBMITTED":return n.statusSubmitted;case"PENDING":return n.statusPending;case"EXPIRED":return n.statusExpired;default:return null}},[n])(a==null?void 0:a.status),w=T&&t(D,{type:"warning",variant:"secondary",icon:t(k,{}),heading:n.bannerTitle,description:T}),$=w&&t(h,{name:"Banner","data-testid":"banner",slot:e==null?void 0:e.Banner,context:{quoteData:a},children:w}),G=b(()=>{if(!a)return null;const m=Y()||"en-US",g=new Intl.DateTimeFormat(m,{year:"numeric",month:"long",day:"numeric"});let r;try{r=g.format(new Date(a.expirationDate))}catch{r=a.expirationDate}return l(h,{name:"Details",slot:e==null?void 0:e.Details,context:{quoteData:a},children:[l("div",{className:"quote-management-manage-negotiable-quote__detail",children:[t("span",{className:"quote-management-manage-negotiable-quote__detail-title","data-testid":"created-label",children:n.createdLabel}),l("span",{className:"quote-management-manage-negotiable-quote__detail-content","data-testid":"created-value",children:[g.format(new Date(a.createdAt))," (",a.buyer.firstname," ",a.buyer.lastname,")"]})]}),l("div",{className:"quote-management-manage-negotiable-quote__detail",children:[t("span",{className:"quote-management-manage-negotiable-quote__detail-title","data-testid":"sales-rep-label",children:n.salesRepLabel}),t("span",{className:"quote-management-manage-negotiable-quote__detail-content","data-testid":"sales-rep-value",children:a.salesRepName})]}),l("div",{className:"quote-management-manage-negotiable-quote__detail",children:[t("span",{className:"quote-management-manage-negotiable-quote__detail-title","data-testid":"expires-label",children:n.expiresLabel}),t("span",{className:"quote-management-manage-negotiable-quote__detail-content","data-testid":"expires-value",children:r})]})]})},[e==null?void 0:e.Details,n,a]),I=b(()=>[{label:n.close,value:"close"},{label:n.delete,value:"delete"},{label:n.print,value:"print"},{label:n.createTemplate,value:"createTemplate"},{label:n.createCopy,value:"createCopy"}],[n]),U=b(()=>{const m=r=>{p==null||p(r)},g=r=>{switch(r){case"close":i==null||i(r);break;case"delete":i==null||i(r);break;case"print":i==null||i(r);break;case"createTemplate":i==null||i(r);break;case"createCopy":i==null||i(r);break}};return t(h,{name:"ActionBar",slot:e==null?void 0:e.ActionBar,context:{quoteData:a},children:t(A,{dropdownPlaceholder:n.actionsLabel,dropdownOptions:[{label:n.remove,value:"remove"}],handleDropdownChange:m,buttons:I.map(r=>t(P,{variant:"tertiary",onClick:()=>g(r.value),"data-testid":`actions-bar-${r.value}-button`,"data-action":r.value,disabled:r.disabled,children:r.label},r.value))})})},[I,n,e==null?void 0:e.ActionBar,a,p,i]),j=b(()=>t(h,{name:"QuoteContent",slot:e==null?void 0:e.QuoteContent,context:{quoteData:a}}),[e==null?void 0:e.QuoteContent,a]),V=b(()=>t(h,{name:"ShippingInformationTitle",slot:e==null?void 0:e.ShippingInformationTitle,context:{quoteData:a},children:t("h2",{children:n.shippingInformationTitle})}),[e==null?void 0:e.ShippingInformationTitle,a,n]),X=b(()=>{var g;const m=(g=a==null?void 0:a.shippingAddresses)==null?void 0:g[0];return t(h,{name:"ShippingInformation",slot:e==null?void 0:e.ShippingInformation,context:{quoteData:a,primaryShippingAddress:m,loading:c,setLoading:f},children:t(te,{shippingAddress:m,loading:c,"data-testid":"manage-quote-shipping-address"})})},[e==null?void 0:e.ShippingInformation,a,c,f]),C=b(()=>t(h,{name:"QuoteCommentsTitle",slot:e==null?void 0:e.QuoteCommentsTitle,context:{quoteData:a},children:t("h2",{children:n.quoteCommentsTitle})}),[e==null?void 0:e.QuoteCommentsTitle,n,a]),H=b(()=>t(h,{name:"QuoteComments",slot:e==null?void 0:e.QuoteComments,context:{quoteData:a},children:t(O,{name:"quoteComments",placeholder:n.quoteCommentsPlaceholder,rows:3,value:o,onInput:m=>{v(m.target.value)},disabled:N})}),[e==null?void 0:e.QuoteComments,n,a,o,N]),L=F(async()=>{if(q){q({quoteData:a,comment:o.trim()||void 0});return}Q(!0);try{await B({quoteUid:a.uid,comment:o.trim()||void 0})}catch(m){console.error("Failed to send quote for review:",m),Q(!1)}},[a,q,o]),J=b(()=>t(h,{name:"Footer",slot:e==null?void 0:e.Footer,context:{quoteData:a,comment:o,isSubmitting:N},children:t(P,{variant:"primary",onClick:L,"data-testid":"send-for-review-button",disabled:!(a!=null&&a.canSendForReview)||N,children:n.sendForReview})}),[e==null?void 0:e.Footer,n,a,o,N,L]),K={...u,loading:c,quoteName:z,quoteStatus:E,banner:$||void 0,details:G,actionBar:U,quoteContent:j,shippingInformationTitle:V,shippingInformation:X,quoteCommentsTitle:C,quoteComments:H,footer:J};return t(ee,{...K})};export{ve as ManageNegotiableQuote,ve as default};
//# sourceMappingURL=ManageNegotiableQuote.js.map
