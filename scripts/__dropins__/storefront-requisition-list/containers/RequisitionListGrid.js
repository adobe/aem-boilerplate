/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as C,jsx as s,Fragment as F}from"@dropins/tools/preact-jsx-runtime.js";import{useState as M,useCallback as L,useMemo as x,useEffect as T}from"@dropins/tools/preact-compat.js";import{Button as N,Header as G,InLineAlert as U,Table as V,Pagination as B,Card as j}from"@dropins/tools/components.js";import{Slot as J,classes as v,VComponent as Z}from"@dropins/tools/lib.js";import{D as W,R as $}from"../chunks/RequisitionListForm.js";import"@dropins/tools/preact-hooks.js";import{R as K}from"../chunks/RequisitionListForm2.js";import"../chunks/state.js";import{events as w}from"@dropins/tools/event-bus.js";import{u as Q,E as X}from"../chunks/RequisitionListView.js";import"@dropins/tools/preact.js";import{R as Y}from"../chunks/RequisitionListActions.js";import{R as b}from"../chunks/RequisitionListModal.js";import{P as I}from"../chunks/PageSizePicker.js";import{useText as D}from"@dropins/tools/i18n.js";import{u as ii}from"../chunks/updateRequisitionList.js";import{d as ei}from"../chunks/deleteRequisitionList.js";import{g as z}from"../chunks/getRequisitionLists.js";import"@dropins/tools/fetch-graphql.js";function ti(c,l,t){const d=D({actionRename:"RequisitionList.RequisitionListView.actionRename",actionDeleteList:"RequisitionList.RequisitionListView.actionDeleteList"}),[e,a]=M(null),[f,g]=M(!1),[A,R]=M(!1),q=L(()=>{t&&t(),g(!0)},[t]),y=L(()=>g(!1),[]),u=x(()=>{if(c)return{handleOpenRenameModal:i=>{g(n=>n&&!1),c.handleOpenRenameModal(i)},handleOpenDeleteModal:i=>{g(n=>n&&!1),c.handleOpenDeleteModal(i)}}},[c]),r=L(async(i,n)=>{var o,p,h;R(!0);try{const m=await z(i,n),S=((o=m==null?void 0:m.page_info)==null?void 0:o.current_page)??1,E=((p=m==null?void 0:m.page_info)==null?void 0:p.total_pages)??0;if(!((((h=m==null?void 0:m.items)==null?void 0:h.length)??0)>0)&&S>1&&E>=S-1){const H=S-1,k=await z(H,n);a(k)}else a(m)}finally{R(!1)}},[]);T(()=>{const i=w.on("requisitionLists/data",n=>{n&&n.items&&a(n)},{eager:!0});return()=>{i==null||i.off()}},[]),T(()=>{e||r(1,W)},[e,r]);const O=L(i=>{var p,h;const n=i??((p=e==null?void 0:e.page_info)==null?void 0:p.current_page)??1,o=((h=e==null?void 0:e.page_info)==null?void 0:h.page_size)??W;return r(n,o)},[r,e]),P=L(async i=>{await r(1,i)},[r]);return{rows:x(()=>((e==null?void 0:e.items)??[]).map(i=>({name:C("div",{className:"requisition-list-grid-wrapper__name",children:[s("div",{className:"requisition-list-grid-wrapper__name__title",children:s("a",{href:"#",onClick:n=>{if(n.preventDefault(),l){const o=l(i.uid);typeof o=="string"&&(window.location.href=o)}},children:i.name})}),i.description&&s("div",{className:"requisition-list-grid-wrapper__name__description",children:i.description})]}),items_count:i.items_count,last_updated:new Date(i.updated_at).toLocaleString(),actions:C("div",{className:"requisition-list-grid-wrapper__actions",children:[s(N,{variant:"tertiary",type:"button","data-testid":"rename-button",onClick:()=>u==null?void 0:u.handleOpenRenameModal(i),children:d.actionRename}),s(N,{variant:"tertiary",type:"button","data-testid":"delete-button",onClick:()=>u==null?void 0:u.handleOpenDeleteModal(i),children:d.actionDeleteList})]})})),[e==null?void 0:e.items,d.actionRename,d.actionDeleteList,u,l]),isLoading:A||!e,pageInfo:e==null?void 0:e.page_info,handlePageChange:O,handlePageSizeChange:P,isAdding:f,handleAddNew:q,handleCancelCreate:y}}const Ai=({routeRequisitionListDetails:c,slots:l})=>{const[t,d]=M({type:null,isOpen:!1,isLoading:!1,requisitionList:null}),e=L(()=>{d({type:null,isOpen:!1,isLoading:!1,requisitionList:null})},[]),a=L(o=>{d({type:"rename",isOpen:!0,isLoading:!1,requisitionList:o})},[]),f=L(o=>{d({type:"delete",isOpen:!0,isLoading:!1,requisitionList:o})},[]),{rows:g,isLoading:A,pageInfo:R,handlePageChange:q,handlePageSizeChange:y,isAdding:u,handleAddNew:r,handleCancelCreate:O}=ti({handleOpenRenameModal:a,handleOpenDeleteModal:f},c,e),P=L(async o=>{if(t.requisitionList)try{await ii(t.requisitionList.uid,o.name,o.description),w.emit("requisitionList/alert",{action:"update",type:"success",context:"requisitionList"}),await q(),e()}catch{w.emit("requisitionList/alert",{action:"update",type:"error",context:"requisitionList"})}},[t.requisitionList,q,e]),_=async()=>{t.requisitionList&&(d({...t,isLoading:!0}),await ei(t.requisitionList.uid).then(async()=>{w.emit("requisitionList/alert",{type:"success",action:"delete",context:"requisitionList"})}).catch(()=>{w.emit("requisitionList/alert",{type:"error",action:"delete",context:"requisitionList"})}).finally(async()=>{await q(),e()}))},i=D({containerTitle:"RequisitionList.containerTitle",updateTitle:"RequisitionList.RequisitionListForm.updateTitle",deleteRequisitionListTitle:"RequisitionList.RequisitionListWrapper.deleteRequisitionListTitle",deleteRequisitionListMessage:"RequisitionList.RequisitionListWrapper.deleteRequisitionListMessage",cancelAction:"RequisitionList.RequisitionListWrapper.cancelAction",confirmAction:"RequisitionList.RequisitionListWrapper.confirmAction"}),n=L(()=>l!=null&&l.Header?s(J,{name:"Header","aria-label":i.containerTitle,title:i.containerTitle,slot:l.Header}):s(G,{"aria-label":i.containerTitle,role:"region",title:i.containerTitle}),[l,i.containerTitle]);return C(F,{children:[s(ni,{header:n(),rows:g,skeletonRowCount:10,isLoading:A,pageInfo:R,handlePageChange:q,handlePageSizeChange:y,defaultPageSize:10,isAdding:u,handleAddNew:r,handleCancelCreate:O}),t.type==="rename"&&t.isOpen&&t.requisitionList&&s(b,{isOpen:t.isOpen,isLoading:t.isLoading,title:i.updateTitle,modalContent:s($,{mode:"update",defaultValues:{name:t.requisitionList.name,description:t.requisitionList.description||""},onSubmit:P,onCancel:e}),handleModalOnClose:e}),t.type==="delete"&&t.isOpen&&s(b,{isOpen:t.isOpen,isLoading:t.isLoading,title:i.deleteRequisitionListTitle,modalContent:i.deleteRequisitionListMessage,confirmBtnCaption:i.confirmAction,closeBtnCaption:i.cancelAction,handleModalOnClose:e,handleModalOnConfirm:_})]})},ni=({className:c,isLoading:l=!1,header:t,rows:d=[],skeletonRowCount:e=10,pageInfo:a,handlePageChange:f,handlePageSizeChange:g,defaultPageSize:A=10,isAdding:R,handleAddNew:q,handleCancelCreate:y,...u})=>{const r=D({name:"RequisitionList.RequisitionListWrapper.name",itemsCount:"RequisitionList.RequisitionListWrapper.itemsCount",lastUpdated:"RequisitionList.RequisitionListWrapper.lastUpdated",actions:"RequisitionList.RequisitionListWrapper.actions",emptyList:"RequisitionList.RequisitionListWrapper.emptyList"}),O=((a==null?void 0:a.total_pages)??0)>0,P=!l&&d.length===0&&!O,{alert:_,setAlert:i,handleRequisitionListAlert:n}=Q();return T(()=>{const o=w.on("requisitionList/alert",n);try{const p=localStorage.getItem("requisitionListPendingAlert");if(p){const h=JSON.parse(p);n(h),localStorage.removeItem("requisitionListPendingAlert")}}catch{}return()=>{o==null||o.off()}},[n]),C("div",{...u,className:v(["requisition-list-grid-wrapper",c]),"data-testid":"requisition-list-grid-wrapper",children:[t&&s("div",{className:v(["requisition-list-grid-wrapper__header",c]),"data-testid":"requisition-list-grid-wrapper-header",children:s(Z,{node:t})}),_&&s("div",{className:"requisition-list__alert-wrapper",children:s(U,{heading:_.description,type:_.type,variant:"primary",onDismiss:()=>i(null)})}),P?s(X,{textContent:r.emptyList}):C(F,{children:[s(V,{columns:[{key:"name",label:r.name},{key:"items_count",label:r.itemsCount},{key:"last_updated",label:r.lastUpdated},{key:"actions",label:r.actions}],rowData:d,loading:l,skeletonRowCount:e}),s("div",{className:v(["requisition-list-grid-wrapper__pagination",c]),children:C("div",{className:"requisition-list-grid-wrapper__pagination-controls",children:[s(I,{currentPageSize:(a==null?void 0:a.page_size)||A,onPageSizeChange:g||(()=>Promise.resolve()),disabled:l}),a&&a.total_pages>1&&s(B,{totalPages:a.total_pages,currentPage:a.current_page,onChange:f})]})})]}),s("div",{className:v(["requisition-list-grid-wrapper__add-new",c]),children:R?s(j,{variant:"secondary",children:s(K,{mode:"create",onSuccess:async()=>{await f(),y(),n({type:"success",action:"create",context:"requisitionList"})},onError:()=>{n({type:"error",action:"create",context:"requisitionList"})},onCancel:y})}):s(Y,{onAddNew:q})})]})};export{Ai as RequisitionListGrid,Ai as default};
//# sourceMappingURL=RequisitionListGrid.js.map
