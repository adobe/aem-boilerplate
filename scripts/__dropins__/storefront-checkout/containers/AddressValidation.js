/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as h,jsx as o}from"@dropins/tools/preact-jsx-runtime.js";import{useState as p,useMemo as N,useCallback as k,useEffect as _}from"@dropins/tools/preact-hooks.js";import"../chunks/TermsAndConditions.js";import{classes as A}from"@dropins/tools/lib.js";import{Header as $,ToggleButton as b}from"@dropins/tools/components.js";import{useText as V}from"@dropins/tools/i18n.js";/* empty css                             *//* empty css                      */import"../chunks/fetch-graphql.js";import{t as x}from"../chunks/transform-shipping-methods.js";import{events as y}from"@dropins/tools/event-bus.js";import{g as B}from"../chunks/events.js";import"@dropins/tools/preact-compat.js";/* empty css                  *//* empty css                       */import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";function T(t){var f;if(!t)return[];const a=`${t.firstName} ${t.lastName}`.trim(),m=((f=t.street)==null?void 0:f[0])??"",r=t.city??"",s=t.region||"",n=t.postcode??"",c=t.countryCode??"";let e="";r&&s?e=`${r}, ${s}`:r?e=r:s&&(e=s);let d=e;n&&(d=e?`${e} ${n}`:n);let u=d;return c&&(u=d?`${d}, ${c}`:c),[a,m,u]}const C=({title:t,address:a,selected:m,busy:r,onChange:s})=>{const[n,c,e]=T(a);return o("div",{className:"checkout-address-validation__option",children:o(b,{busy:r,className:"checkout-address-validation__radio",label:h("div",{children:[o("div",{className:"checkout-address-validation__option-title",children:o("strong",{children:t})}),n&&o("div",{children:n}),c&&o("div",{children:c}),e&&o("div",{children:e})]}),name:"address-validation-choice",selected:m,value:t,onChange:s})})},j=({busy:t=!1,className:a,currentAddress:m,onSelectionChange:r,selection:s,suggestedAddress:n})=>{const c=!!n,e=V({title:"Checkout.AddressValidation.title",subtitle:"Checkout.AddressValidation.subtitle",suggestedAddress:"Checkout.AddressValidation.suggestedAddress",originalAddress:"Checkout.AddressValidation.originalAddress"});return h("div",{className:A(["checkout-address-validation",a]),children:[o($,{className:"checkout-address-validation__title",divider:!1,title:e.title}),o("div",{className:"checkout-address-validation__subtitle",children:e.subtitle}),h("div",{className:A(["checkout-address-validation__options",t&&"checkout-address-validation__options--busy"]),children:[c&&o(C,{address:n,busy:t,selected:s==="suggested",title:e.suggestedAddress,onChange:()=>r("suggested")}),o(C,{address:m,busy:t,selected:s==="original",title:e.originalAddress,onChange:()=>r("original")})]})]})},Q=({suggestedAddress:t,handleSelectedAddress:a})=>{const[m,r]=p(null),[s,n]=p(void 0),[c,e]=p(!1),d=N(()=>!t||!s?null:{...s,regionId:void 0,...t},[s,t]),u=k(i=>{var v;const l=(v=i==null?void 0:i.shippingAddresses)==null?void 0:v[0],g=x(l);n(g)},[]);_(()=>{const i=y.on("checkout/initialized",l=>{u(l)},{eager:!0});return()=>{i==null||i.off()}},[u]),_(()=>{const i=B();i&&u(i);const l=y.on("checkout/updated",g=>{u(g)},{eager:!1});return()=>{l==null||l.off()}},[u]);const f=k(async i=>{r(i);const l=i==="suggested"?d:s;e(!0);try{await(a==null?void 0:a({selection:i,address:l}))}finally{e(!1)}},[d,s,a]);return o(j,{busy:c,currentAddress:s,selection:m,suggestedAddress:d,onSelectionChange:f})};export{Q as AddressValidation,Q as default};
//# sourceMappingURL=AddressValidation.js.map
