/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as r,jsxs as S,Fragment as z}from"@dropins/tools/preact-jsx-runtime.js";import*as X from"@dropins/tools/preact-compat.js";import{forwardRef as ne,useState as B,useEffect as D,useCallback as Et,useImperativeHandle as re}from"@dropins/tools/preact-compat.js";import{classes as O,VComponent as J,Slot as m}from"@dropins/tools/lib.js";import{E as ie}from"./EmptyCart2.js";/* empty css                */import{Divider as Bt,Skeleton as ae,SkeletonRow as ce,InLineAlert as $t,CartList as K,Icon as Y,Button as Z,Accordion as oe,AccordionSection as se,CartItem as ue,Price as q,Incrementer as de,Image as le}from"@dropins/tools/components.js";import"@dropins/tools/preact-hooks.js";import{g as Xt}from"./persisted-data.js";import{events as Gt}from"@dropins/tools/event-bus.js";import{s as me}from"./resetCart.js";import{a as ge}from"./createGuestCart.js";import{u as Rt}from"./updateProductsFromCart.js";import{S as Tt,a as fe,b as he}from"./Trash.js";import{S as ve}from"./ChevronDown.js";import{useText as ye}from"@dropins/tools/i18n.js";const pe=N=>X.createElement("svg",{id:"Icon_Chevron_right_Base","data-name":"Icon \\u2013 Chevron right \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...N},X.createElement("g",{id:"Large"},X.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),X.createElement("g",{id:"Chevron_right_icon","data-name":"Chevron right icon"},X.createElement("path",{vectorEffect:"non-scaling-stroke",id:"chevron",d:"M199.75,367.5l4.255,-4.255-4.255,-4.255",transform:"translate(-189.25 -351.0)",fill:"none",stroke:"currentColor"})))),Ut=({className:N,children:tt,heading:P,footer:_,emptyCart:$,products:h,outOfStockMessage:y,variant:G="primary",loading:g=!0,...i})=>r("div",{...i,className:O(["cart-cart-summary-list",N,`cart-cart-summary-list__background--${G}`]),children:g?r(Ce,{}):S(z,{children:[(P||y)&&S("div",{"data-testid":"cart-summary-list-heading-wrapper",className:O(["cart-cart-summary-list__heading",["cart-cart-summary-list__heading--full-width",!h]]),children:[P&&S(z,{children:[r(J,{node:P,className:"cart-cart-summary-list__heading-text"}),r(Bt,{variant:"primary",className:O(["cart-cart-summary-list__heading-divider"])})]}),y&&r(J,{node:y,className:"cart-cart-summary-list__out-of-stock-message"})]}),r("div",{className:O(["cart-cart-summary-list__content",["cart-cart-summary-list__content--empty",!h]]),children:h||r(J,{node:$,className:"cart-cart-summary-list__empty-cart"})}),_&&S(z,{children:[r(Bt,{variant:"primary",className:O(["cart-cart-summary-list__footer-divider"])}),r(J,{node:_,className:"cart-cart-summary-list__footer-text"})]})]})}),Ce=()=>r(ae,{"data-testid":"cart-summary-list-skeleton",className:"cart-cart-summary-list__skeleton",rowGap:"medium",children:r(ce,{variant:"row",size:"xlarge",fullWidth:!0,lines:3,multilineGap:"small"})}),Ie=ne(({initialData:N=null,hideHeading:tt,hideFooter:P,routeProduct:_,routeEmptyCartCTA:$,routeCart:h,onItemUpdate:y,onItemRemove:G,maxItems:g,slots:i,attributesToHide:d=[],enableRemoveItem:L,enableUpdateItemQuantity:R,onItemsErrorsChange:M,accordion:qt=!1,variant:H="primary",isLoading:zt,showMaxItems:et,showDiscount:nt,showSavings:rt,quantityType:it,dropdownOptions:at,undo:Q=!1,__testRecentlyRemovedItems:ct,...ot},Ft)=>{var Lt;const[T,Wt]=B(!N),[a,jt]=B(N),[f,Vt]=B(new Set),[F,st]=B(new Map),[w,A]=B(ct||[]);D(()=>{},[ct,w]);const l=(Lt=me.config)==null?void 0:Lt.shoppingCartDisplaySetting,[b,Dt]=B(et?!0:!g&&!et),c=ye({file:"Cart.CartItem.file",files:"Cart.CartItem.files",heading:"Cart.Cart.heading",message:"Cart.CartItem.message",recipient:"Cart.CartItem.recipient",regularPrice:"Cart.CartItem.regularPrice",discountedPrice:"Cart.CartItem.discountedPrice",sender:"Cart.CartItem.sender",lowInventory:"Cart.CartItem.lowInventory",insufficientQuantity:"Cart.CartItem.insufficientQuantity",insufficientQuantityGeneral:"Cart.CartItem.insufficientQuantityGeneral",outOfStockHeading:"Cart.OutOfStockMessage.heading",outOfStockDescription:"Cart.OutOfStockMessage.message",outOfStockAlert:"Cart.OutOfStockMessage.alert",removeAction:"Cart.OutOfStockMessage.action",notAvailableMessage:"Cart.CartItem.notAvailableMessage",viewMore:"Cart.Cart.viewMore",viewAll:"Cart.Cart.viewAll",discountPercent:"Cart.CartItem.discountPercentage",savingsAmount:"Cart.CartItem.savingsAmount",itemBeingRemoved:"Cart.CartItem.itemBeingRemoved",itemRemoved:"Cart.CartItem.itemRemoved",itemRemovedDescription:"Cart.CartItem.itemRemovedDescription",undoAction:"Cart.CartItem.undoAction",dismissAction:"Cart.CartItem.dismissAction",remove:"Dropin.CartItem.remove.label",removeDefault:"Dropin.CartItem.removeDefault.label"}),E=(t,e)=>{Vt(n=>(e?n.add(t):n.delete(t),new Set(n)))},W=(t,e)=>{st(n=>(e?n.set(t,e):n.delete(t),new Map(n)))};function Jt(t){const e=Xt(),n=e==null?void 0:e.items.find(o=>o.uid===t);n&&A(o=>{const s=e.items.findIndex(u=>u.uid===t);return s!==-1&&!o.some(u=>u.item.uid===t)?(Gt.emit("cart/product/removed",{item:n,index:s}),[...o,{item:n,index:s,error:void 0,beingRemoved:!0}]):o})}const x=(t,e)=>{E(t.uid,!0),st(new Map),L&&e===0?(Jt(t.uid),Rt([{uid:t.uid,quantity:e}]).then(()=>{G==null||G({item:t})}).finally(()=>{E(t.uid,!1),A(n=>n.map(o=>o.item.uid===t.uid?{...o,beingRemoved:!1}:o))}).catch(n=>{console.warn(n)})):R&&Rt([{uid:t.uid,quantity:e}]).then(()=>{y==null||y({item:t})}).finally(()=>{E(t.uid,!1)}).catch(n=>{W(t.uid,n.message)})},ut=t=>{A(e=>e.filter(n=>n.item.uid!==t))},Kt=Et(()=>{Dt(t=>!t)},[]);D(()=>{const t=Gt.on("cart/data",e=>{jt(e),Wt(!!zt)},{eager:!0});return()=>{t==null||t.off()}},[]),D(()=>{Q||A([])},[Q]),D(()=>{M&&M(F)},[F,M]);const dt=(t,e)=>{if(d.includes("image"))return;const n={loading:e<4?"eager":"lazy",src:t.image.src,alt:t.image.alt,width:"300",height:"300",params:{width:300}},o=r(le,{"data-testid":"cart-list-item-image",...n});return r(m,{name:"Thumbnail",slot:i==null?void 0:i.Thumbnail,context:{item:t,defaultImageProps:n},children:_?r("a",{href:_(t),children:o}):o})},lt=t=>{if(!d.includes("name"))return r("span",{"data-testid":"cart-list-item-title",children:_?r("a",{href:_(t),children:t.name}):t.name})},mt=t=>{if(d.includes("configurations"))return;const e={...t.bundleOptions,...t.selectedOptions,...t.customizableOptions,...t.recipient?{[c.recipient]:t.recipient}:null,...t.recipientEmail&&t.recipient?{[c.recipient]:`${t.recipient} (${t.recipientEmail})`}:null,...t.sender?{[c.sender]:t.sender}:null,...t.senderEmail&&t.sender?{[c.sender]:`${t.sender} (${t.senderEmail})`}:{},...t.message?{[c.message]:t.message}:null,...t.links&&t.links.count?t.links.count>1?{[c.files.replace("{count}",t.links.count.toString())]:t.links.result}:{[c.file.replace("{count}",t.links.count.toString())]:t.links.result}:null};if(Object.keys(e).length!==0)return e},gt=t=>{var e,n,o,s;return(l==null?void 0:l.price)==="INCLUDING_TAX"?t.discounted?{amount:t.regularPrice.value,currency:t.regularPrice.currency,style:{font:"inherit"},"data-testid":"including-tax-item-price"}:{amount:(e=t.taxedPrice)==null?void 0:e.value,currency:(n=t.taxedPrice)==null?void 0:n.currency,style:{font:"inherit"},"data-testid":"including-tax-item-price"}:{amount:(o=t.regularPrice)==null?void 0:o.value,currency:(s=t.regularPrice)==null?void 0:s.currency,style:{font:"inherit"},"data-testid":"regular-item-price"}},ft=t=>{var e,n;return{amount:(e=t.savingsAmount)==null?void 0:e.value,currency:(n=t.savingsAmount)==null?void 0:n.currency,style:{font:"inherit"},"data-testid":"item-savings-amount"}},ht=t=>(l==null?void 0:l.price)==="INCLUDING_EXCLUDING_TAX"?r(q,{amount:t.rowTotal.value,currency:t.rowTotal.currency,"data-testid":"excluding-tax-total","aria-label":c.regularPrice}):void 0,vt=t=>{var o,s,u,v,C,I,k,U,Qt,bt;const e={"aria-label":c.regularPrice},n=t.discounted?{}:null;return["INCLUDING_TAX","INCLUDING_EXCLUDING_TAX"].includes(l==null?void 0:l.price)?(e.amount=(o=t.rowTotalIncludingTax)==null?void 0:o.value,e.currency=(s=t.rowTotalIncludingTax)==null?void 0:s.currency,e.variant=t.discounted?"strikethrough":"default",e["data-testid"]="including-tax-item-total",n&&(e.amount=(u=t.total)==null?void 0:u.value,e.currency=(v=t.total)==null?void 0:v.currency,n.amount=(C=t.rowTotalIncludingTax)==null?void 0:C.value,n.currency=(I=t.rowTotalIncludingTax)==null?void 0:I.currency,n.sale=!0,n["aria-label"]=c.discountedPrice,n["data-testid"]="discount-total")):(e.amount=(k=t.total)==null?void 0:k.value,e.currency=(U=t.total)==null?void 0:U.currency,e.variant=t.discounted?"strikethrough":"default",e["data-testid"]="regular-item-total",n&&(n.amount=(Qt=t.discountedTotal)==null?void 0:Qt.value,n.currency=(bt=t.discountedTotal)==null?void 0:bt.currency,n.sale=!0,n["aria-label"]=c.regularPrice,n["data-testid"]="discount-total")),{totalProps:e,discountProps:n}},yt=t=>{var C,I,k;if(d.includes("warning"))return;const e=F.get(t.uid),n=(C=F.get(t.uid))==null?void 0:C.includes("The requested qty is not available"),o=f.has(t.uid),s=t.insufficientQuantity&&t.stockLevel?t.stockLevel==="noNumber"?c.insufficientQuantityGeneral:c.insufficientQuantity.replace("{inventory}",(I=t.stockLevel)==null?void 0:I.toString()).replace("{count}",t.quantity.toString()):"",u=t.lowInventory&&t.onlyXLeftInStock&&c.lowInventory.replace("{count}",(k=t.onlyXLeftInStock)==null?void 0:k.toString()),v=!t.outOfStock&&e&&n?c.notAvailableMessage:e;return!o&&(e||t.insufficientQuantity||t.lowInventory)?S("span",{"data-testid":"item-warning",children:[r(Y,{source:fe,size:"16"}),v||s||u]}):void 0},pt=t=>d!=null&&d.includes("alert")?void 0:!f.has(t.uid)&&t.outOfStock?S("span",{"data-testid":"item-alert",children:[r(Y,{source:Tt,size:"16"}),c.outOfStockAlert]}):void 0,Ct=t=>r(m,{name:"ProductAttributes",slot:i==null?void 0:i.ProductAttributes,context:{item:t}}),It=t=>{if(!d.includes("sku"))return r("span",{"data-testid":"cart-list-item-sku",children:t.sku})},kt=t=>r(m,{name:"Footer",slot:i==null?void 0:i.Footer,context:{item:t,handleItemsLoading:E,handleItemsError:W,onItemUpdate:y}}),Yt=t=>{var e;if(L)return r(m,{name:"ItemRemoveAction",slot:i==null?void 0:i.ItemRemoveAction,context:{item:t,enableRemoveItem:L,handleItemQuantityUpdate:x,handleItemsError:W,handleItemsLoading:E,onItemUpdate:y,itemsLoading:f},children:r(Z,{"data-testid":"cart-item-remove-button",className:O(["dropin-cart-item__remove"]),variant:"tertiary",onClick:()=>x(t,0),disabled:f.has(t.uid),icon:r(Y,{"data-testid":"cart-item-remove-icon",source:he,size:"24",stroke:"2",viewBox:"0 0 24 24","aria-label":((e=c.remove)==null?void 0:e.replace("{product}",t.name))||c.removeDefault})})})},Zt=t=>{if(!d.includes("quantity")&&R)return r(m,{name:"ItemQuantity",slot:i==null?void 0:i.ItemQuantity,context:{item:t,enableUpdateItemQuantity:R,handleItemQuantityUpdate:x,itemsLoading:f,handleItemsError:W,handleItemsLoading:E,onItemUpdate:y},children:r(de,{value:t.quantity,min:1,onValue:e=>x(t,Number(e)),name:"quantity",disabled:f.has(t.uid)})})},St=t=>a!=null&&a.totalQuantity?a.items.filter(t).map((e,n)=>{var v;const{totalProps:o,discountProps:s}=vt(e),u=r(ue,{updating:f==null?void 0:f.has(e.uid),loading:T,"data-testid":`cart-list-item-entry-${e.uid}`,image:dt(e,n),title:r(m,{name:"ItemTitle",slot:i==null?void 0:i.ItemTitle,context:{item:e},children:lt(e)}),sku:d.includes("sku")?void 0:r(m,{name:"ItemSku",slot:i==null?void 0:i.ItemSku,context:{item:e},children:It(e)}),price:d.includes("price")?void 0:r(m,{name:"ItemPrice",slot:i==null?void 0:i.ItemPrice,context:{item:e},slotTag:"span",children:r(q,{...gt(e)})}),quantity:d.includes("quantity")?void 0:e.quantity,quantityContent:Zt(e),total:S(z,{children:[d.includes("total")?void 0:r(m,{name:"ItemTotal",slot:i==null?void 0:i.ItemTotal,context:{item:e},children:r(q,{...o})}),d.includes("totalDiscount")?void 0:s&&r(m,{name:"ItemTotal",slot:i==null?void 0:i.ItemTotal,context:{item:e},children:r(q,{...s})})]}),attributes:Ct(e),configurations:mt(e),totalExcludingTax:d.includes("totalExcludingTax")?void 0:ht(e),taxIncluded:(l==null?void 0:l.price)==="INCLUDING_TAX",taxExcluded:!d.includes("totalExcludingTax")&&(l==null?void 0:l.price)==="INCLUDING_EXCLUDING_TAX",warning:yt(e),alert:pt(e),quantityType:it,dropdownOptions:at,onQuantity:R&&!f.has(e.uid)?C=>{x(e,C)}:void 0,onRemove:L&&!f.has(e.uid)?()=>x(e,0):void 0,discount:nt&&e.discounted&&e.discountPercentage?r("div",{"data-testid":"item-discount-percent",children:c.discountPercent.replace("{discount}",((v=e.discountPercentage)==null?void 0:v.toString())??"")}):void 0,savings:rt&&e.discounted&&e.savingsAmount?S("div",{children:[r("span",{children:r(q,{...ft(e)})})," ",c.savingsAmount]}):void 0,footer:kt(e),removeContent:Yt(e)},e.uid);return r(m,{name:"CartItem",slot:i==null?void 0:i.CartItem,context:{item:e,index:n,enableUpdateItemQuantity:R,enableRemoveItem:L,itemsLoading:f,loading:T,attributesToHide:d,cartTaxesConfig:l,quantityType:it,dropdownOptions:at,showDiscount:nt,showSavings:rt,dictionary:c,getImage:dt,getTitle:lt,getSku:It,getPriceProps:gt,getTotalPriceProps:vt,getProductAttributes:Ct,getConfiguration:mt,getTotalExcludingTax:ht,getWarning:yt,getAlert:pt,getFooter:kt,getSavingsAmount:ft},children:u},e.uid)}):null,_t=r(m,{name:"Heading",slot:i==null?void 0:i.Heading,context:{count:a==null?void 0:a.totalQuantity},children:r("div",{"data-testid":"default-cart-heading",children:c.heading.replace("({count})",a!=null&&a.totalQuantity?`(${a==null?void 0:a.totalQuantity.toString()})`:"")})}),Mt=_t.props.children.props.children,Ht=()=>{const t=a==null?void 0:a.items.filter(e=>e.outOfStock);t==null||t.forEach(e=>{x(e,0)})},te=St(t=>t.outOfStock||t.insufficientQuantity||!1),wt=a!=null&&a.hasOutOfStockItems?r($t,{"data-testid":"cart-out-of-stock-message",icon:r(Y,{source:Tt,size:"16"}),itemList:r(K,{"data-testid":"out-of-stock-cart-items",children:te}),type:"warning",heading:c.outOfStockHeading,description:c.outOfStockDescription,variant:"primary",actionButtonPosition:"bottom",additionalActions:a!=null&&a.hasFullyOutOfStockItems&&L?[{label:c.removeAction,onClick:Ht}]:void 0}):void 0,p=St(t=>!t.outOfStock&&!t.insufficientQuantity),At=b?Math.max(g||5,5):Math.min((a==null?void 0:a.totalQuantity)||5,5),xt=(a==null?void 0:a.totalQuantity)>At,ee=xt&&!b&&At!=g,j=a!=null&&a.totalQuantity&&p?r(m,{name:"Footer",slot:i==null?void 0:i.CartSummaryFooter,context:{displayMaxItems:b,routeCart:h},"data-testid":"cart-cart-summary-footer-slot",className:"cart-cart-summary-footer",children:xt?ee?r(Z,{className:"cart-cart-summary-list-footer__action",onClick:Kt,"data-testid":"view-more-items-button",variant:"tertiary",children:c.viewMore}):h&&r(Z,{className:"cart-cart-summary-list-footer__action",href:h(),variant:"tertiary","data-testid":"view-cart-or-less-items-button",children:c.viewAll}):h&&r(Z,{className:"cart-cart-summary-list-footer__action",href:h(),variant:"tertiary","data-testid":"view-cart-button",children:c.viewAll})}):null,Ot=()=>{if(!(a!=null&&a.items))return null;const t=[],e=a.items,n=i==null?void 0:i.UndoBanner,o=b?Math.max(g||(a==null?void 0:a.totalQuantity),5):Math.min(g??5,5);for(let s=0;s<=o;s++)Q&&w.filter(u=>u.index===s).forEach(({item:u,error:v,beingRemoved:C})=>{var k,U;const I=r($t,{type:v?"error":"info",heading:C?(k=c.itemBeingRemoved)==null?void 0:k.replace("{product}",u.name):(U=c.itemRemoved)==null?void 0:U.replace("{product}",u.name),description:v||c.itemRemovedDescription,variant:"primary",actionButtonPosition:"bottom",additionalActions:C?[]:[{label:c.undoAction,onClick:()=>V(u.uid),"aria-label":`${c.undoAction} remove ${u.name}`},{label:c.dismissAction,onClick:()=>ut(u.uid),"aria-label":`${c.dismissAction} undo for ${u.name}`}]},`undo-banner-${u.uid}`);t.push(n?r(m,{name:"UndoBanner",slot:n,context:{item:u,loading:T,error:v,onUndo:()=>V(u.uid),onDismiss:()=>ut(u.uid)},children:I},`undo-banner-${u.uid}`):I)}),s<o&&s<e.length&&t.push((p==null?void 0:p[s])||null);return r(K,{"data-testid":"cart-list",children:t})},V=Et(async t=>{A(n=>n.map(o=>o.item.uid===t?{...o,loading:!0,error:void 0}:o));const e=w.find(n=>n.item.uid===t);if(e)try{await ge([{sku:e.item.sku,parentSku:e.item.topLevelSku,quantity:e.item.quantity,optionsUIDs:e.item.bundleOptionsUIDs||(e.item.selectedOptionsUIDs?Object.values(e.item.selectedOptionsUIDs):void 0),enteredOptions:e.item.customizableOptions?Object.entries(e.item.customizableOptions).map(([n,o])=>({uid:n,value:o})):void 0}]),A(n=>n.filter(o=>o.item.uid!==t))}catch(n){A(o=>o.map(s=>s.item.uid===t?{...s,error:(n==null?void 0:n.message)||"Failed to restore item."}:s))}},[w]);re(Ft,()=>({handleUndo:V}),[V]);const Nt=r(z,{children:Q&&w.length>0?Ot():r(m,{name:"EmptyCart",slot:i==null?void 0:i.EmptyCart,context:{},children:r(ie,{"data-testid":"empty-cart",ctaLinkURL:$==null?void 0:$()})})}),Pt=a!=null&&a.totalQuantity||Q&&w.length>0?Q?w.length>0?Ot():r(K,{"data-testid":"cart-list",children:p==null?void 0:p.slice(0,b?Math.max(g||(a==null?void 0:a.totalQuantity),5):Math.min(g??5,5))}):r(K,{"data-testid":"cart-list",children:p==null?void 0:p.slice(0,b?Math.max(g||(a==null?void 0:a.totalQuantity),5):Math.min(g??5,5))}):null;return qt?r(oe,{"data-testid":"cart-summary-list-accordion",className:O(["cart-cart-summary-list-accordion",`cart-cart-summary-list__background--${H}`]),iconOpen:pe,iconClose:ve,children:r(se,{title:Mt,"data-testid":"cart-summary-list-accordion__section",open:!0,renderContentWhenClosed:!0,children:r(Ut,{...ot,"aria-expanded":!0,"aria-label":"TEST",className:"cart-cart-summary-list-accordion__list",loading:T,footer:P?void 0:j||(h?j:void 0),emptyCart:Nt,products:Pt,outOfStockMessage:wt,variant:H})})}):r(Ut,{...ot,heading:tt?void 0:_t,footer:P?void 0:j||(h?j:void 0),loading:T,emptyCart:Nt,products:Pt,outOfStockMessage:wt,variant:H})});Ie.getInitialData=async function(){return Xt()};export{Ie as C};
//# sourceMappingURL=CartSummaryList.js.map
