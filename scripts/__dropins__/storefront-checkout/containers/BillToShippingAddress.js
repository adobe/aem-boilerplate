/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as n,jsxs as z}from"@dropins/tools/preact-jsx-runtime.js";import{h as j}from"../chunks/fetch-graphql.js";import"@dropins/tools/lib.js";import{h as w,g as C}from"../chunks/events.js";import{n as L,g as R}from"../chunks/values.js";import{events as _}from"@dropins/tools/event-bus.js";import{c as U}from"../chunks/synchronizeCheckout.js";import{s as W}from"../chunks/setBillingAddress.js";/* empty css                             */import{Skeleton as y,SkeletonRow as P,Checkbox as $,InLineAlert as q}from"@dropins/tools/components.js";import{W as F}from"../chunks/ConditionalWrapper.js";import{c as G}from"../chunks/classes.js";import{useText as D}from"@dropins/tools/i18n.js";import{useState as k,useRef as H,useCallback as b,useEffect as A}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";import"../fragments.js";import"../chunks/transform-shipping-methods.js";import"../chunks/guards.js";const J=()=>n(y,{className:"bill-to-shipping-address__skeleton","data-testid":"bill-to-shipping-skeleton",children:n(P,{size:"small",variant:"row"})}),K=({className:i,checked:u,disabled:e,error:t=null,onChange:c=()=>{},onDismissError:p=()=>{}})=>{const m=D({title:"Checkout.BillToShippingAddress.title"}),f=t!==null,r=l=>{const a=l.target;c==null||c(a.checked)};return z("div",{className:"checkout-bill-to-shipping-address",children:[n($,{checked:u,className:G(["checkout-bill-to-shipping-address__checkbox",i]),"data-testid":"bill-to-shipping-checkbox",disabled:e,label:m.title,name:"checkout-bill-to-shipping-address__checkbox",onChange:r}),f&&n("div",{className:"checkout-bill-to-shipping-address__error","data-testid":"checkout-bill-to-shipping-address-alert",children:n(q,{heading:t,type:"error",variant:"primary",onDismiss:p})})]})},M=F(K,J),ms=({active:i=!0,autoSync:u=!0,onCartSyncError:e,onChange:t})=>{const[c,p]=k(null),[m,f]=k(!1),[r,l]=k(),a=H(!1),V=j.value,{cartSyncError:B}=D({cartSyncError:"Checkout.BillToShippingAddress.cartSyncError"}),E=b(()=>{p(null)},[]),I=b(s=>{p(null),l(s),t==null||t(s),!(!u||!s||!w())&&W({sameAsShipping:!0}).catch(o=>{l(!1),e==null||e({error:o}),e||p(B)})},[u,B,e,t]),d=b(s=>{var T;const o=!s||s.isEmpty,h=!!(s!=null&&s.isVirtual);if(o||h){f(h),l(!1),a.current=!1;return}if(a.current)return;const S=s,x=(T=S.shippingAddresses)==null?void 0:T[0],N=!!S.billingAddress;let g;if(x)g=x.sameAsBilling??!N;else{const{defaults:v}=U.getConfig();g=v.isBillToShipping}l(g),a.current=!0},[]);return A(()=>{!i||r===void 0||L({isBillToShipping:r})},[i,r]),A(()=>{if(!i)return;const s=C();if(s){const h=R("isBillToShipping");h!=null&&l(h),d(s);return}const o=_.on("checkout/initialized",d,{eager:!0});return()=>{o==null||o.off()}},[i,d]),A(()=>{if(!i)return;const s=_.on("checkout/updated",d,{eager:!1});return()=>{s==null||s.off()}},[i,d]),n(M,{checked:r,disabled:V,error:c,initialized:r!==void 0,visible:i&&!m,onChange:I,onDismissError:E})};export{ms as BillToShippingAddress,ms as default};
//# sourceMappingURL=BillToShippingAddress.js.map
