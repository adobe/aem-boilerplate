/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as v}from"@dropins/tools/preact-jsx-runtime.js";import{useState as S,useCallback as f,useEffect as k,useMemo as H}from"@dropins/tools/preact-hooks.js";import{Picker as w}from"@dropins/tools/components.js";import{events as d}from"@dropins/tools/event-bus.js";import{C as I,e as K,c as x,u as G,h as M}from"../chunks/customerCompanyContext.js";import"@dropins/tools/lib.js";import"@dropins/tools/fetch-graphql.js";const D=({onCompanyChange:c}={})=>{const[l,s]=S([]),[g,r]=S({text:"",value:""}),C=f(async()=>{var e,n;try{const o=await I.getInstance().getCustomerCompanyInfo();s(o.customerCompanies),(e=o.currentCompany)!=null&&e.name&&((n=o.currentCompany)!=null&&n.id)&&r({text:o.currentCompany.name,value:o.currentCompany.id})}catch(t){console.error("Failed to load company data:",t)}},[]),h=f(async e=>{const t=e.target.value,o=l.find(p=>p.value===t);o&&r(o),K().setCompanyHeaders(t),t?sessionStorage.setItem(x.getConfig().companySessionStorageKey,t):sessionStorage.removeItem(x.getConfig().companySessionStorageKey);const a=await G();M().setGroupHeaders(a),a?sessionStorage.setItem(x.getConfig().groupSessionStorageKey,a):sessionStorage.removeItem(x.getConfig().groupSessionStorageKey),c==null||c({id:t,name:(o==null?void 0:o.text)||""}),d.emit("companyContext/changed",t)},[l,c]),m=f(()=>{I.getInstance().resetCache(),s([]),r({text:"",value:""})},[]),u=f(e=>{e?C():m()},[C,m]),y=f(e=>{if(!e){m();return}s(n=>{const t=n.find(o=>o.value===e);return t&&r(t),n})},[m,s,r]),i=f(e=>{const{company:n}=e;s(t=>{const o=t.findIndex(a=>a.value===n.id);return o===-1?t:t.map((a,p)=>p===o?{...a,text:n.name}:a)}),r({text:n.name,value:n.id})},[]);return k(()=>{const e=d.on("authenticated",u,{eager:!0}),n=d.on("companyContext/changed",y,{eager:!0}),t=d.on("company/updated",i);return()=>{var o,a,p;(o=e==null?void 0:e.off)==null||o.call(e),(a=n==null?void 0:n.off)==null||a.call(n),(p=t==null?void 0:t.off)==null||p.call(t)}},[u,y,i]),{companies:l,currentCompany:g,handleCompanyChange:h}},B=({ariaLabel:c,onCompanyChange:l,...s})=>{const{companies:g,currentCompany:r,handleCompanyChange:C}=D({onCompanyChange:l}),[h,m]=S(!0),u=H(()=>g,[g]);return k(()=>{const y=()=>{m(!1)},i=d.on("checkout/initialized",y),e=d.on("checkout/updated",y);return()=>{i==null||i.off(),e==null||e.off()}},[]),g.length<2||!h?null:v("div",{...s,children:v(w,{options:u,value:r.value,onChange:C,"aria-label":c||"Select company","aria-describedby":"company-switcher-description"})})};export{B as CompanySwitcher,B as default};
//# sourceMappingURL=CompanySwitcher.js.map
