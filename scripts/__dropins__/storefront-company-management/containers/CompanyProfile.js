/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as r,jsxs as y,Fragment as K}from"@dropins/tools/preact-jsx-runtime.js";import{classes as ee,Slot as ve}from"@dropins/tools/lib.js";import{Card as J,Button as X,Field as S,Input as F,Picker as pe,Header as he,InLineAlert as Ce,ProgressSpinner as Ae,Skeleton as Ne,SkeletonRow as Q}from"@dropins/tools/components.js";import{useState as M,useEffect as B,useMemo as U,useRef as G,useCallback as R}from"@dropins/tools/preact-hooks.js";import{events as ge}from"@dropins/tools/event-bus.js";import{g as Ee,u as _e}from"../chunks/updateCompany.js";import{useText as Z}from"@dropins/tools/i18n.js";import{g as fe,v as be}from"../chunks/getCountries.js";import*as L from"@dropins/tools/preact-compat.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";const Ie=t=>L.createElement("svg",{id:"Icon_Warning_Base",width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},L.createElement("g",{clipPath:"url(#clip0_841_1324)"},L.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.9949 2.30237L0.802734 21.6977H23.1977L11.9949 2.30237Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),L.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M12.4336 10.5504L12.3373 14.4766H11.6632L11.5669 10.5504V9.51273H12.4336V10.5504ZM11.5883 18.2636V17.2687H12.4229V18.2636H11.5883Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})),L.createElement("defs",null,L.createElement("clipPath",{id:"clip0_841_1324"},L.createElement("rect",{width:24,height:21,fill:"white",transform:"translate(0 1.5)"})))),we=t=>L.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},L.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),L.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.75 12.762L10.2385 15.75L17.25 9",stroke:"currentColor"})),xe=t=>L.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},L.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),L.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.75 5.88423V4.75H12.25V5.88423L12.0485 13.0713H11.9515L11.75 5.88423ZM11.7994 18.25V16.9868H12.2253V18.25H11.7994Z",stroke:"currentColor"})),Te=({company:t,slots:e,showEditForm:n,handleShowEditForm:u})=>{const d=Z({editButton:"Company.shared.buttons.edit",noDataMessage:"Company.CompanyProfile.companyProfileCard.noDataMessage",companyName:"Company.shared.fields.companyName",email:"Company.shared.fields.email",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId",legalAddress:"Company.shared.fields.legalAddress",contacts:"Company.CompanyProfile.companyProfileCard.contacts",companyAdministrator:"Company.CompanyProfile.companyProfileCard.companyAdministrator",salesRepresentative:"Company.CompanyProfile.companyProfileCard.salesRepresentative",paymentInformation:"Company.CompanyProfile.companyProfileCard.paymentInformation",shippingInformation:"Company.CompanyProfile.companyProfileCard.shippingInformation",availablePaymentMethods:"Company.CompanyProfile.companyProfileCard.availablePaymentMethods",availableShippingMethods:"Company.CompanyProfile.companyProfileCard.availableShippingMethods",noPaymentMethods:"Company.CompanyProfile.companyProfileCard.noPaymentMethods",noShippingMethods:"Company.CompanyProfile.companyProfileCard.noShippingMethods"});if(!t)return r(J,{variant:"secondary",className:"account-company-profile-card",children:r("div",{className:"account-company-profile-card__wrapper",children:r("div",{className:"account-company-profile-card__content",children:r("div",{className:"account-company-profile-card__no-data",children:r("p",{children:d.noDataMessage})})})})});const i=t.permissionsFlags||{canViewAccount:!0,canViewAddress:!0,canViewContacts:!0,canViewPaymentInformation:!0,canViewShippingInformation:!0},a=[i.canViewAccount?{name:"name",label:d.companyName,value:t.name||"",legalName:t.legalName||""}:null,i.canViewAccount?{name:"email",label:d.email,value:t.email||""}:null,i.canViewAccount?{name:"vatTaxId",label:d.vatTaxId,value:t.vatTaxId||""}:null,i.canViewAccount?{name:"resellerId",label:d.resellerId,value:t.resellerId||""}:null].filter(Boolean);return r(J,{variant:"secondary",className:ee(["account-company-profile-card",["account-company-profile-card-short",n]]),children:y("div",{className:"account-company-profile-card__wrapper",children:[r("div",{className:"account-company-profile-card__actions",children:(t.canEditAccount||t.canEditAddress)&&r(X,{type:"button",variant:"tertiary",onClick:u,children:d.editButton})}),r("div",{className:"account-company-profile-card__content",children:(()=>{var A,l;const v=y(K,{children:[a.map((s,c)=>{if(!s.value)return null;let C;return s.name==="name"&&s.legalName?C=`${s.label}: ${s.value} (${s.legalName})`:C=s.label?`${s.label}: ${s.value}`:s.value,r("p",{"data-testid":`${s.name}_${c}`,children:C},`${s.name}_${c}`)}),i.canViewAddress&&t.legalAddress&&y("div",{className:"company-legal-address",children:[r("p",{children:y("strong",{children:[d.legalAddress,":"]})}),(A=t.legalAddress.street)==null?void 0:A.map((s,c)=>r("p",{children:s},c)),y("p",{children:[t.legalAddress.city,", ",(l=t.legalAddress.region)==null?void 0:l.region," ",t.legalAddress.postcode]}),r("p",{children:t.legalAddress.countryCode}),t.legalAddress.telephone&&y("p",{children:["Phone: ",t.legalAddress.telephone]})]}),i.canViewContacts&&(t.companyAdmin||t.salesRepresentative)&&y("div",{className:"company-contacts",children:[r("p",{children:y("strong",{children:[d.contacts,":"]})}),t.companyAdmin&&y("div",{className:"company-contact",children:[r("p",{children:y("strong",{children:[d.companyAdministrator,":"]})}),y("p",{children:[t.companyAdmin.firstname," ",t.companyAdmin.lastname]}),t.companyAdmin.jobTitle&&r("p",{children:t.companyAdmin.jobTitle}),r("p",{children:t.companyAdmin.email})]}),t.salesRepresentative&&y("div",{className:"company-contact",children:[r("p",{children:y("strong",{children:[d.salesRepresentative,":"]})}),y("p",{children:[t.salesRepresentative.firstname," ",t.salesRepresentative.lastname]}),r("p",{children:t.salesRepresentative.email})]})]}),i.canViewPaymentInformation&&y("div",{className:"company-payment-methods",children:[r("p",{children:y("strong",{children:[d.paymentInformation,":"]})}),t.availablePaymentMethods&&t.availablePaymentMethods.length>0?y(K,{children:[r("p",{children:y("strong",{children:[d.availablePaymentMethods,":"]})}),r("ul",{className:"payment-methods-list",children:t.availablePaymentMethods.map((s,c)=>r("li",{children:s.title},`payment_${c}`))})]}):r("div",{className:"message message-notice notice",children:r("div",{children:d.noPaymentMethods})})]}),i.canViewShippingInformation&&y("div",{className:"company-shipping-methods",children:[r("p",{children:y("strong",{children:[d.shippingInformation,":"]})}),t.availableShippingMethods&&t.availableShippingMethods.length>0?y(K,{children:[r("p",{children:y("strong",{children:[d.availableShippingMethods,":"]})}),r("ul",{className:"shipping-methods-list",children:t.availableShippingMethods.map((s,c)=>r("li",{children:s.title},`shipping_${c}`))})]}):r("div",{className:"message message-notice notice",children:r("div",{children:d.noShippingMethods})})]})]});return e!=null&&e.CompanyData?r(ve,{name:"CompanyData",slot:e.CompanyData,context:{companyData:a,Default:v}}):v})()})]})})},$e=t=>{const[e,n]=M(null),[u,d]=M(!0);B(()=>{let l=!0;return fe().then(({availableCountries:s,countriesWithRequiredRegion:c,optionalZipCountries:C})=>{l&&(n({availableCountries:s,countriesWithRequiredRegion:c,optionalZipCountries:C}),d(!1))}).catch(()=>{l&&d(!1)}),()=>{l=!1}},[]);const i=U(()=>(e==null?void 0:e.availableCountries)||[],[e]),a=U(()=>{if(!t||!e)return[];const l=e.availableCountries.find(s=>s.value===t);return!(l!=null&&l.availableRegions)||l.availableRegions.length===0?[]:l.availableRegions.map(s=>({text:s.name,value:`${s.code},${s.id}`}))},[t,e]),v=U(()=>!t||!e?!1:e.countriesWithRequiredRegion.includes(t),[t,e]),A=U(()=>a.length>0,[a]);return{countryOptions:i,regionOptions:a,isRegionRequired:v,hasRegionOptions:A,loadingCountries:u}},Le=({loading:t,value:e,errors:n,touched:u,onBlur:d,namePrefix:i="",fieldPathPrefix:a=""})=>{const v=Z({companyName:"Company.shared.fields.companyName",email:"Company.shared.fields.email",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId"}),A=i?`${i}_`:"",l=s=>a?`${a}.${s}`:s;return y("div",{className:"account-edit-company-profile-form__group",children:[r(S,{label:v.companyName,required:!0,className:"account-edit-company-profile-form__field",error:u.name&&n.name?n.name:void 0,children:r(F,{name:`${A}name`,type:"text",value:e.name,onBlur:s=>{const c=s.target;d(l("name"),c.value)},disabled:!!t,variant:"primary",size:"medium",maxLength:40})}),r(S,{label:v.legalName,className:"account-edit-company-profile-form__field",children:r(F,{name:`${A}legalName`,type:"text",value:e.legalName,onBlur:s=>{const c=s.target;d(l("legalName"),c.value)},disabled:!!t,variant:"primary",size:"medium",maxLength:80})}),r(S,{label:v.email,required:!0,className:"account-edit-company-profile-form__field",error:u.email&&n.email?n.email:void 0,children:r(F,{name:`${A}email`,type:"email",value:e.email,onBlur:s=>{const c=s.target;d(l("email"),c.value)},disabled:!!t,variant:"primary",size:"medium"})}),r(S,{label:v.vatTaxId,className:"account-edit-company-profile-form__field",children:r(F,{name:`${A}vatTaxId`,type:"text",value:e.vatTaxId,onBlur:s=>{const c=s.target;d(l("vatTaxId"),c.value)},disabled:!!t,variant:"primary",size:"medium",maxLength:40})}),r(S,{label:v.resellerId,className:"account-edit-company-profile-form__field",children:r(F,{name:`${A}resellerId`,type:"text",value:e.resellerId,onBlur:s=>{const c=s.target;d(l("resellerId"),c.value)},disabled:!!t,variant:"primary",size:"medium",maxLength:40})})]})},Me=({loading:t,loadingCountries:e,value:n,errors:u,touched:d,onChange:i,onBlur:a,countryOptions:v,regionOptions:A,isRegionRequired:l,hasRegionOptions:s,namePrefix:c="legalAddress",fieldPathPrefix:C="legalAddress",requiredConfig:N})=>{var D;const b=Z({legalAddress:"Company.shared.fields.legalAddress",streetAddress:"Company.shared.fields.streetAddress",city:"Company.shared.fields.city",country:"Company.shared.fields.country",stateProvince:"Company.shared.fields.stateProvince",zipPostalCode:"Company.shared.fields.zipPostalCode",phoneNumber:"Company.shared.fields.phoneNumber"}),k={street:`${c}_street`,street2:`${c}_street2`,city:`${c}_city`,countryCode:`${c}_countryCode`,region:`${c}_region`,postcode:`${c}_postcode`,telephone:`${c}_telephone`},h={street:`${C}.street`,street2:`${C}.street2`,city:`${C}.city`,countryCode:`${C}.countryCode`,region:`${C}.region`,regionCode:`${C}.regionCode`,postcode:`${C}.postcode`,telephone:`${C}.telephone`},z={street:(N==null?void 0:N.street)??!0,city:(N==null?void 0:N.city)??!0,postcode:(N==null?void 0:N.postcode)??!0,telephone:(N==null?void 0:N.telephone)??!0};return y("div",{className:"account-edit-company-profile-form__section",children:[r("h3",{className:"account-edit-company-profile-form__section-title",children:b.legalAddress}),r(S,{label:b.streetAddress,required:z.street,className:"account-edit-company-profile-form__field",error:d[h.street]&&u[h.street]?u[h.street]:void 0,children:r(F,{name:k.street,type:"text",value:n.street,onBlur:p=>{const E=p.target;a(h.street,E.value)},disabled:!!t,variant:"primary",size:"medium"})}),r(S,{label:`${b.streetAddress} 2`,className:"account-edit-company-profile-form__field",children:r(F,{name:k.street2,type:"text",value:n.street2,onBlur:p=>{const E=p.target;a(h.street2,E.value)},disabled:!!t,variant:"primary",size:"medium"})}),r(S,{label:b.city,required:z.city,className:"account-edit-company-profile-form__field",error:d[h.city]&&u[h.city]?u[h.city]:void 0,children:r(F,{name:k.city,type:"text",value:n.city,onBlur:p=>{const E=p.target;a(h.city,E.value)},disabled:!!t,variant:"primary",size:"medium"})}),r(S,{label:b.country,required:!0,className:"account-edit-company-profile-form__field",error:d[h.countryCode]&&u[h.countryCode]?u[h.countryCode]:void 0,children:r(pe,{name:k.countryCode,floatingLabel:`${b.country} *`,placeholder:b.country,options:v,value:n.countryCode,handleSelect:p=>{const E=p.target;i(h.countryCode)(E.value)},onBlur:()=>a(h.countryCode),disabled:!!t||e})}),r(S,{label:b.stateProvince,required:l,className:"account-edit-company-profile-form__field",error:d["legalAddress.region"]&&u["legalAddress.region"]?u["legalAddress.region"]:void 0,children:s?r(pe,{name:"legalAddress_region",floatingLabel:`${b.stateProvince} ${l?"*":""}`,placeholder:b.stateProvince,options:A,value:n.regionCode&&((D=A.find(p=>p.value.split(",")[0]===n.regionCode))==null?void 0:D.value)||"",handleSelect:p=>{var P;const E=p.target,[W]=E.value.split(","),O=((P=A.find(H=>H.value===E.value))==null?void 0:P.text)||"";i(h.region)(O),i(h.regionCode)(W)},onBlur:()=>a(h.region),disabled:!!t||e},`region_picker_${n.countryCode}`):r(F,{name:k.region,type:"text",value:n.region,onBlur:p=>{const E=p.target;a(h.region,E.value)},disabled:!!t||e,variant:"primary",size:"medium"},`region_input_${n.countryCode}`)}),r(S,{label:b.zipPostalCode,required:z.postcode,className:"account-edit-company-profile-form__field",error:d[h.postcode]&&u[h.postcode]?u[h.postcode]:void 0,children:r(F,{name:k.postcode,type:"text",value:n.postcode,onBlur:p=>{const E=p.target;a(h.postcode,E.value)},disabled:!!t,variant:"primary",size:"medium"})}),r(S,{label:b.phoneNumber,required:z.telephone,className:"account-edit-company-profile-form__field",error:d[h.telephone]&&u[h.telephone]?u[h.telephone]:void 0,children:r(F,{name:k.telephone,type:"tel",value:n.telephone,onBlur:p=>{const E=p.target;a(h.telephone,E.value)},disabled:!!t,variant:"primary",size:"medium"})})]})},Pe=({inLineAlertProps:t,company:e,loading:n=!1,onSubmit:u,onCancel:d})=>{var j,Y,q,f,T,te,re,ae,se,le,ne,oe,ie,de;const i=Z({title:"Company.EditCompanyProfile.title",cancel:"Company.shared.buttons.cancel",save:"Company.shared.buttons.save",saving:"Company.shared.buttons.saving",required:"Company.shared.validation.required",invalidEmail:"Company.shared.validation.invalidEmail",companyNameRequired:"Company.shared.validation.companyNameRequired",emailRequired:"Company.shared.validation.emailRequired",emailNotAvailable:"Company.shared.validation.emailNotAvailable",companyNameLengthError:"Company.shared.validation.companyNameLengthError",legalNameLengthError:"Company.shared.validation.legalNameLengthError",vatTaxIdLengthError:"Company.shared.validation.vatTaxIdLengthError",resellerIdLengthError:"Company.shared.validation.resellerIdLengthError"}),[a,v]=M({name:(e==null?void 0:e.name)||"",email:(e==null?void 0:e.email)||"",legalName:(e==null?void 0:e.legalName)||"",vatTaxId:(e==null?void 0:e.vatTaxId)||"",resellerId:(e==null?void 0:e.resellerId)||"",legalAddress:{street:((Y=(j=e==null?void 0:e.legalAddress)==null?void 0:j.street)==null?void 0:Y[0])||"",street2:((f=(q=e==null?void 0:e.legalAddress)==null?void 0:q.street)==null?void 0:f[1])||"",city:((T=e==null?void 0:e.legalAddress)==null?void 0:T.city)||"",region:((re=(te=e==null?void 0:e.legalAddress)==null?void 0:te.region)==null?void 0:re.region)||"",regionCode:((se=(ae=e==null?void 0:e.legalAddress)==null?void 0:ae.region)==null?void 0:se.regionCode)||"",countryCode:((le=e==null?void 0:e.legalAddress)==null?void 0:le.countryCode)||"",postcode:((ne=e==null?void 0:e.legalAddress)==null?void 0:ne.postcode)||"",telephone:((oe=e==null?void 0:e.legalAddress)==null?void 0:oe.telephone)||""}}),[A,l]=M({}),[s,c]=M({}),C=((ie=e==null?void 0:e.permissionsFlags)==null?void 0:ie.canEditAccount)===!0,N=((de=e==null?void 0:e.permissionsFlags)==null?void 0:de.canEditAddress)===!0,{countryOptions:b,regionOptions:k,isRegionRequired:h,hasRegionOptions:z,loadingCountries:D}=$e(a.legalAddress.countryCode),p=(o,m)=>o==="name"?m.trim()?m.length>40?i.companyNameLengthError:null:i.companyNameRequired:o==="email"?m.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m)?null:i.invalidEmail:i.emailRequired:o==="legalName"?m.length>80?i.legalNameLengthError:null:o==="vatTaxId"?m.length>40?i.vatTaxIdLengthError:null:o==="resellerId"?m.length>40?i.resellerIdLengthError:null:o==="legalAddress.street"||o==="legalAddress.city"||o==="legalAddress.postcode"||o==="legalAddress.telephone"||o==="legalAddress.countryCode"?m.trim()?null:i.required:o==="legalAddress.region"&&h&&!m.trim()?i.required:null,E=()=>{var $,V;const o={};let m=!0;const x=(($=e==null?void 0:e.permissionsFlags)==null?void 0:$.canEditAccount)===!0,g=((V=e==null?void 0:e.permissionsFlags)==null?void 0:V.canEditAddress)===!0;if(x){const _=p("name",a.name);_&&(o.name=_,m=!1);const I=p("email",a.email);if(I&&(o.email=I,m=!1),a.legalName){const w=p("legalName",a.legalName);w&&(o.legalName=w,m=!1)}if(a.vatTaxId){const w=p("vatTaxId",a.vatTaxId);w&&(o.vatTaxId=w,m=!1)}if(a.resellerId){const w=p("resellerId",a.resellerId);w&&(o.resellerId=w,m=!1)}}if(g){const _=p("legalAddress.street",a.legalAddress.street);_&&(o["legalAddress.street"]=_,m=!1);const I=p("legalAddress.city",a.legalAddress.city);I&&(o["legalAddress.city"]=I,m=!1);const w=p("legalAddress.postcode",a.legalAddress.postcode);w&&(o["legalAddress.postcode"]=w,m=!1);const ce=p("legalAddress.telephone",a.legalAddress.telephone);ce&&(o["legalAddress.telephone"]=ce,m=!1);const me=p("legalAddress.countryCode",a.legalAddress.countryCode);me&&(o["legalAddress.countryCode"]=me,m=!1);const ue=p("legalAddress.region",a.legalAddress.region);ue&&(o["legalAddress.region"]=ue,m=!1)}return l(o),m},W=async o=>{var $,V;o.preventDefault();const m=(($=e==null?void 0:e.permissionsFlags)==null?void 0:$.canEditAccount)===!0,x=((V=e==null?void 0:e.permissionsFlags)==null?void 0:V.canEditAddress)===!0,g={};if(m&&(g.name=!0,g.email=!0,g.legalName=!0,g.vatTaxId=!0,g.resellerId=!0),x&&(g["legalAddress.street"]=!0,g["legalAddress.street2"]=!0,g["legalAddress.city"]=!0,g["legalAddress.region"]=!0,g["legalAddress.regionCode"]=!0,g["legalAddress.countryCode"]=!0,g["legalAddress.postcode"]=!0,g["legalAddress.telephone"]=!0),c(g),!!E()){if(m&&a.email!==(e==null?void 0:e.email)){const _=await be(a.email);if(!_.isValid){l(I=>({...I,email:_.error||i.emailNotAvailable}));return}}if(u){const _={};m&&(_.name=a.name,_.email=a.email,_.legalName=a.legalName,_.vatTaxId=a.vatTaxId,_.resellerId=a.resellerId),x&&(_.legalAddress={street:[a.legalAddress.street,a.legalAddress.street2].filter(Boolean),city:a.legalAddress.city,region:{region:a.legalAddress.region,regionCode:a.legalAddress.regionCode},countryCode:a.legalAddress.countryCode,postcode:a.legalAddress.postcode,telephone:a.legalAddress.telephone}),await u(_)}}},O=(o,m)=>{if(o.startsWith("legalAddress.")){const x=o.split(".")[1];x==="countryCode"?(v(g=>({...g,legalAddress:{...g.legalAddress,[x]:m,region:"",regionCode:""}})),l(g=>{const $={...g};return delete $["legalAddress.region"],delete $["legalAddress.regionCode"],$}),c(g=>{const $={...g};return delete $["legalAddress.region"],delete $["legalAddress.regionCode"],$})):v(x==="region"?g=>({...g,legalAddress:{...g.legalAddress,region:m,regionCode:z?g.legalAddress.regionCode:m}}):g=>({...g,legalAddress:{...g.legalAddress,[x]:m}}))}else v(x=>({...x,[o]:m}))},P=o=>m=>{const x=new Set(["name","email","legalName","vatTaxId","resellerId"]),g=o.startsWith("legalAddress.");x.has(o)&&!C||g&&!N||(O(o,m),A[o]&&l(V=>{const _={...V};return delete _[o],_}))},H=(o,m)=>{const x=new Set(["name","email","legalName","vatTaxId","resellerId"]),g=o.startsWith("legalAddress.");if(x.has(o)&&!C||g&&!N)return;m!==void 0&&O(o,m),c(I=>({...I,[o]:!0}));let V=m;if(V===void 0)if(o.startsWith("legalAddress.")){const I=o.split(".")[1],w=a.legalAddress[I];V=typeof w=="string"?w:""}else{const I=a[o];V=typeof I=="string"?I:""}const _=p(o,V);l(_?I=>({...I,[o]:_}):I=>{const w={...I};return delete w[o],w})};return y(J,{variant:"secondary",className:"account-edit-company-profile",children:[r(he,{title:i.title,divider:!1,className:"account-edit-company-profile__title"}),t!=null&&t.text?r(Ce,{className:"account-edit-company-profile__notification",type:t.type,variant:"secondary",heading:t.text,icon:t.icon,"data-testid":"editCompanyInLineAlert"}):null,y("form",{className:"account-edit-company-profile-form",onSubmit:W,children:[C&&r(Le,{loading:n,value:{name:a.name,email:a.email,legalName:a.legalName,vatTaxId:a.vatTaxId,resellerId:a.resellerId},errors:A,touched:s,onBlur:H}),N&&r(Me,{loading:n,loadingCountries:D,value:a.legalAddress,errors:A,touched:s,onChange:P,onBlur:H,countryOptions:b,regionOptions:k,isRegionRequired:h,hasRegionOptions:z}),y("div",{className:"account-edit-company-profile__actions",children:[r(X,{disabled:n,type:"button",variant:"secondary",onClick:()=>d==null?void 0:d(),children:i.cancel}),r(X,{disabled:n||!C&&!N,type:"submit",variant:"primary",children:i.save})]})]}),n&&y("div",{className:"account-edit-company-profile__loading-overlay","data-testid":"editCompanyLoadingOverlay",children:[r(Ae,{size:"large"}),r("div",{className:"account-edit-company-profile__loading-text",children:i.saving})]})]})},Ve=({testId:t,withCard:e=!0})=>{const n=y(Ne,{"data-testid":t||"companySkeletonLoader",children:[r(Q,{variant:"heading",size:"xlarge",fullWidth:!1,lines:1}),r(Q,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1}),r(Q,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1})]});return e?n:r(J,{variant:"secondary",className:ee(["company-company-loaders","company-company-loaders--card-loader"]),children:n})};var ye=(t=>(t.EDIT_COMPANY_EVENT="edit-company",t))(ye||{});const Se={EDIT_COMPANY_EVENT:"edit-company"},ke=()=>(window.adobeDataLayer||(window.adobeDataLayer=[]),window.adobeDataLayer),Fe=t=>{ke().push(n=>{const u=n.getState?n.getState():{};n.push({event:t,context:u})})},Re=(t,e)=>{if(!Se[t])return null;switch(t){case"edit-company":Fe({type:"company",eventType:"edit",companyData:e});break;default:return null}},De=({handleSetInLineAlert:t,editFormRef:e})=>{const n=Z({companySuccess:"Company.CompanyProfile.editCompanyProfile.companySuccess",companyError:"Company.CompanyProfile.editCompanyProfile.companyError",loadError:"Company.CompanyProfile.messages.loadError",updateError:"Company.CompanyProfile.messages.updateError"}),{companySuccess:u,companyError:d,loadError:i,updateError:a}=n,[v,A]=M(null),[l,s]=M(!0),[c,C]=M(!1),[N,b]=M(!1),[k,h]=M([]),[z,D]=M({}),p=G(t),E=G(!1),W=G(!1);B(()=>{p.current=t},[t]);const O=R(f=>{D(f)},[]),P=R((f,T)=>{t&&(f==="success"?t({type:"success",text:T??u}):f==="error"?t({type:"error",text:T??d}):t(),C(!1))},[t,u,d]),H=R(async()=>{if(E.current)return null;E.current=!0,s(!0);try{const f=await Ee();return f&&A(f),s(!1),f}catch(f){return console.error("Failed to load company:",f),s(!1),p.current&&p.current({type:"error",text:i}),null}finally{E.current=!1}},[i]);B(()=>{W.current||(W.current=!0,H())},[H]),B(()=>{const f=()=>{s(!0),b(!1),D({}),H()},T=ge.on("companyContext/changed",f,{eager:!0});return()=>{T==null||T.off()}},[H]),B(()=>{fe().then(f=>{h(f.availableCountries)}).catch(f=>{console.error("Failed to load countries:",f)})},[]);const j=R(()=>{b(!0),P("success",""),D({})},[P]);B(()=>{N&&(e!=null&&e.current)&&setTimeout(()=>{var f;(f=e.current)==null||f.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)},[N,e]);const Y=R(f=>{f==null||f(),b(!1),D({})},[]),q=R(async f=>{try{if(C(!0),!f){P("error","No data to update");return}const T=await _e(f);A(T),b(!1),D({}),P("success"),Re(ye.EDIT_COMPANY_EVENT,{...f,companyId:v==null?void 0:v.id}),ge.emit("company/updated",{company:T})}catch(T){console.error("Failed to update company:",T),P("error",T.message||a)}finally{C(!1)}},[v,P,a]);return{company:v,countries:k,loading:l,submitLoading:c,showEditForm:N,inputChange:z,handleShowEditForm:j,handleHideEditForm:Y,handleUpdateCompany:q,handleInputChange:O,renderAlertMessage:P,saving:c}},ze={success:r(we,{}),warning:r(Ie,{}),error:r(xe,{})},He=()=>{const[t,e]=M({}),[n,u]=M(null),d=R(()=>{e({}),n&&(clearTimeout(n),u(null))},[n]),i=R(l=>{if(n&&(clearTimeout(n),u(null)),!(l!=null&&l.type)){e({});return}const s=ze[l.type];if(e({type:l.type,text:l.text,icon:s}),l.autoHide!==!1){const c=l.autoHideDelay||(l.type==="success"?3e3:5e3),C=setTimeout(()=>{e({}),u(null)},c);u(C)}},[n]),a=R((l,s=!0)=>{i({type:"success",text:l,autoHide:s})},[i]),v=R((l,s=!1)=>{i({type:"warning",text:l,autoHide:s})},[i]),A=R((l,s=!1)=>{i({type:"error",text:l,autoHide:s})},[i]);return B(()=>()=>{n&&clearTimeout(n)},[n]),{inLineAlertProps:t,handleSetInLineAlert:i,clearAlert:d,showSuccess:a,showWarning:v,showError:A}},Ke=({className:t,withHeader:e=!0,slots:n})=>{const u=Z({containerTitle:"Company.CompanyProfile.containerTitle"}),{inLineAlertProps:d,handleSetInLineAlert:i}=He(),a=G(null),{company:v,loading:A,saving:l,showEditForm:s,handleShowEditForm:c,handleHideEditForm:C,handleUpdateCompany:N}=De({handleSetInLineAlert:i,editFormRef:a});return A?r("div",{"data-testid":"companyProfileLoader",children:r(Ve,{withCard:!0})}):y("div",{className:ee(["account-company-profile",t]),children:[e?r(he,{title:u.containerTitle,divider:!1,className:"company-profile__title"}):null,r(Te,{company:v,slots:n,showEditForm:s,handleShowEditForm:c}),s?r("div",{ref:a,children:r(Pe,{inLineAlertProps:d,company:v,loading:l,onSubmit:N,onCancel:C})}):null]})};export{Ke as CompanyProfile,Ke as default};
//# sourceMappingURL=CompanyProfile.js.map
