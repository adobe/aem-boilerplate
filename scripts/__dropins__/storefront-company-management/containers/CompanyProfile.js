/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as t,jsxs as f,Fragment as K}from"@dropins/tools/preact-jsx-runtime.js";import{classes as ue,Slot as he}from"@dropins/tools/lib.js";import{Card as Q,Button as X,Field as R,Input as V,Picker as ce,Header as pe,InLineAlert as fe,ProgressSpinner as ve}from"@dropins/tools/components.js";import{useState as D,useEffect as W,useMemo as G,useRef as J,useCallback as U}from"@dropins/tools/preact-hooks.js";import{events as me}from"@dropins/tools/event-bus.js";import{p as ye,E as Ce,u as Ae,c as Ne}from"../chunks/useInLineAlert.js";import{g as ge,v as be,a as Ie,u as _e}from"../chunks/getCountries.js";import{useText as j}from"@dropins/tools/i18n.js";import"@dropins/tools/preact-compat.js";import"../chunks/fetchUserPermissions.js";import"@dropins/tools/fetch-graphql.js";const Ee=({company:a,slots:e,showEditForm:g,handleShowEditForm:v})=>{const n=j({editButton:"Company.shared.buttons.edit",noDataMessage:"Company.CompanyProfile.companyProfileCard.noDataMessage",companyName:"Company.shared.fields.companyName",email:"Company.shared.fields.email",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId",legalAddress:"Company.shared.fields.legalAddress",contacts:"Company.CompanyProfile.companyProfileCard.contacts",companyAdministrator:"Company.CompanyProfile.companyProfileCard.companyAdministrator",salesRepresentative:"Company.CompanyProfile.companyProfileCard.salesRepresentative",paymentInformation:"Company.CompanyProfile.companyProfileCard.paymentInformation",shippingInformation:"Company.CompanyProfile.companyProfileCard.shippingInformation",availablePaymentMethods:"Company.CompanyProfile.companyProfileCard.availablePaymentMethods",availableShippingMethods:"Company.CompanyProfile.companyProfileCard.availableShippingMethods",noPaymentMethods:"Company.CompanyProfile.companyProfileCard.noPaymentMethods",noShippingMethods:"Company.CompanyProfile.companyProfileCard.noShippingMethods"});if(!a)return t(Q,{variant:"secondary",className:"account-company-profile-card",children:t("div",{className:"account-company-profile-card__wrapper",children:t("div",{className:"account-company-profile-card__content",children:t("div",{className:"account-company-profile-card__no-data",children:t("p",{children:n.noDataMessage})})})})});const d=a.permissionsFlags||{canViewAccount:!0,canViewAddress:!0,canViewContacts:!0,canViewPaymentInformation:!0,canViewShippingInformation:!0},r=[d.canViewAccount?{name:"name",label:n.companyName,value:a.name||"",legalName:a.legalName||""}:null,d.canViewAccount?{name:"email",label:n.email,value:a.email||""}:null,d.canViewAccount?{name:"vatTaxId",label:n.vatTaxId,value:a.vatTaxId||""}:null,d.canViewAccount?{name:"resellerId",label:n.resellerId,value:a.resellerId||""}:null].filter(Boolean);return t(Q,{variant:"secondary",className:ue(["account-company-profile-card",["account-company-profile-card-short",g]]),children:f("div",{className:"account-company-profile-card__wrapper",children:[t("div",{className:"account-company-profile-card__actions",children:(a.canEditAccount||a.canEditAddress)&&t(X,{type:"button",variant:"tertiary",onClick:v,children:n.editButton})}),t("div",{className:"account-company-profile-card__content",children:(()=>{var y,u;const A=f(K,{children:[r.map((s,i)=>{if(!s.value)return null;let C;return s.name==="name"&&s.legalName?C=`${s.label}: ${s.value} (${s.legalName})`:C=s.label?`${s.label}: ${s.value}`:s.value,t("p",{"data-testid":`${s.name}_${i}`,children:C},`${s.name}_${i}`)}),d.canViewAddress&&a.legalAddress&&f("div",{className:"company-legal-address",children:[t("p",{children:f("strong",{children:[n.legalAddress,":"]})}),(y=a.legalAddress.street)==null?void 0:y.map((s,i)=>t("p",{children:s},i)),f("p",{children:[a.legalAddress.city,", ",(u=a.legalAddress.region)==null?void 0:u.region," ",a.legalAddress.postcode]}),t("p",{children:a.legalAddress.countryCode}),a.legalAddress.telephone&&f("p",{children:["Phone: ",a.legalAddress.telephone]})]}),d.canViewContacts&&(a.companyAdmin||a.salesRepresentative)&&f("div",{className:"company-contacts",children:[t("p",{children:f("strong",{children:[n.contacts,":"]})}),a.companyAdmin&&f("div",{className:"company-contact",children:[t("p",{children:f("strong",{children:[n.companyAdministrator,":"]})}),f("p",{children:[a.companyAdmin.firstname," ",a.companyAdmin.lastname]}),a.companyAdmin.jobTitle&&t("p",{children:a.companyAdmin.jobTitle}),t("p",{children:a.companyAdmin.email})]}),a.salesRepresentative&&f("div",{className:"company-contact",children:[t("p",{children:f("strong",{children:[n.salesRepresentative,":"]})}),f("p",{children:[a.salesRepresentative.firstname," ",a.salesRepresentative.lastname]}),t("p",{children:a.salesRepresentative.email})]})]}),d.canViewPaymentInformation&&f("div",{className:"company-payment-methods",children:[t("p",{children:f("strong",{children:[n.paymentInformation,":"]})}),a.availablePaymentMethods&&a.availablePaymentMethods.length>0?f(K,{children:[t("p",{children:f("strong",{children:[n.availablePaymentMethods,":"]})}),t("ul",{className:"payment-methods-list",children:a.availablePaymentMethods.map((s,i)=>t("li",{children:s.title},`payment_${i}`))})]}):t("div",{className:"message message-notice notice",children:t("div",{children:n.noPaymentMethods})})]}),d.canViewShippingInformation&&f("div",{className:"company-shipping-methods",children:[t("p",{children:f("strong",{children:[n.shippingInformation,":"]})}),a.availableShippingMethods&&a.availableShippingMethods.length>0?f(K,{children:[t("p",{children:f("strong",{children:[n.availableShippingMethods,":"]})}),t("ul",{className:"shipping-methods-list",children:a.availableShippingMethods.map((s,i)=>t("li",{children:s.title},`shipping_${i}`))})]}):t("div",{className:"message message-notice notice",children:t("div",{children:n.noShippingMethods})})]})]});return e!=null&&e.CompanyData?t(he,{name:"CompanyData",slot:e.CompanyData,context:{companyData:r,Default:A}}):A})()})]})})},xe=a=>{const[e,g]=D(null),[v,n]=D(!0);W(()=>{let u=!0;return ge().then(({availableCountries:s,countriesWithRequiredRegion:i,optionalZipCountries:C})=>{u&&(g({availableCountries:s,countriesWithRequiredRegion:i,optionalZipCountries:C}),n(!1))}).catch(()=>{u&&n(!1)}),()=>{u=!1}},[]);const d=G(()=>(e==null?void 0:e.availableCountries)||[],[e]),r=G(()=>{if(!a||!e)return[];const u=e.availableCountries.find(s=>s.value===a);return!(u!=null&&u.availableRegions)||u.availableRegions.length===0?[]:u.availableRegions.map(s=>({text:s.name,value:`${s.code},${s.id}`}))},[a,e]),A=G(()=>!a||!e?!1:e.countriesWithRequiredRegion.includes(a),[a,e]),y=G(()=>r.length>0,[r]);return{countryOptions:d,regionOptions:r,isRegionRequired:A,hasRegionOptions:y,loadingCountries:v}},Te=({loading:a,value:e,errors:g,touched:v,onBlur:n,namePrefix:d="",fieldPathPrefix:r=""})=>{const A=j({companyName:"Company.shared.fields.companyName",email:"Company.shared.fields.email",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId"}),y=d?`${d}_`:"",u=s=>r?`${r}.${s}`:s;return f("div",{className:"account-edit-company-profile-form__group",children:[t(R,{label:A.companyName,required:!0,className:"account-edit-company-profile-form__field",error:v.name&&g.name?g.name:void 0,children:t(V,{name:`${y}name`,type:"text",value:e.name,onBlur:s=>{const i=s.target;n(u("name"),i.value)},disabled:!!a,variant:"primary",size:"medium",maxLength:40})}),t(R,{label:A.legalName,className:"account-edit-company-profile-form__field",children:t(V,{name:`${y}legalName`,type:"text",value:e.legalName,onBlur:s=>{const i=s.target;n(u("legalName"),i.value)},disabled:!!a,variant:"primary",size:"medium",maxLength:80})}),t(R,{label:A.email,required:!0,className:"account-edit-company-profile-form__field",error:v.email&&g.email?g.email:void 0,children:t(V,{name:`${y}email`,type:"email",value:e.email,onBlur:s=>{const i=s.target;n(u("email"),i.value)},disabled:!!a,variant:"primary",size:"medium"})}),t(R,{label:A.vatTaxId,className:"account-edit-company-profile-form__field",children:t(V,{name:`${y}vatTaxId`,type:"text",value:e.vatTaxId,onBlur:s=>{const i=s.target;n(u("vatTaxId"),i.value)},disabled:!!a,variant:"primary",size:"medium",maxLength:40})}),t(R,{label:A.resellerId,className:"account-edit-company-profile-form__field",children:t(V,{name:`${y}resellerId`,type:"text",value:e.resellerId,onBlur:s=>{const i=s.target;n(u("resellerId"),i.value)},disabled:!!a,variant:"primary",size:"medium",maxLength:40})})]})},$e=({loading:a,loadingCountries:e,value:g,errors:v,touched:n,onChange:d,onBlur:r,countryOptions:A,regionOptions:y,isRegionRequired:u,hasRegionOptions:s,namePrefix:i="legalAddress",fieldPathPrefix:C="legalAddress",requiredConfig:N})=>{var k;const _=j({legalAddress:"Company.shared.fields.legalAddress",streetAddress:"Company.shared.fields.streetAddress",city:"Company.shared.fields.city",country:"Company.shared.fields.country",stateProvince:"Company.shared.fields.stateProvince",zipPostalCode:"Company.shared.fields.zipPostalCode",phoneNumber:"Company.shared.fields.phoneNumber"}),F={street:`${i}_street`,street2:`${i}_street2`,city:`${i}_city`,countryCode:`${i}_countryCode`,region:`${i}_region`,postcode:`${i}_postcode`,telephone:`${i}_telephone`},p={street:`${C}.street`,street2:`${C}.street2`,city:`${C}.city`,countryCode:`${C}.countryCode`,region:`${C}.region`,regionCode:`${C}.regionCode`,postcode:`${C}.postcode`,telephone:`${C}.telephone`},L={street:(N==null?void 0:N.street)??!0,city:(N==null?void 0:N.city)??!0,postcode:(N==null?void 0:N.postcode)??!0,telephone:(N==null?void 0:N.telephone)??!0};return f("div",{className:"account-edit-company-profile-form__section",children:[t("h3",{className:"account-edit-company-profile-form__section-title",children:_.legalAddress}),t(R,{label:_.streetAddress,required:L.street,className:"account-edit-company-profile-form__field",error:n[p.street]&&v[p.street]?v[p.street]:void 0,children:t(V,{name:F.street,type:"text",value:g.street,onBlur:c=>{const b=c.target;r(p.street,b.value)},disabled:!!a,variant:"primary",size:"medium"})}),t(R,{label:`${_.streetAddress} 2`,className:"account-edit-company-profile-form__field",children:t(V,{name:F.street2,type:"text",value:g.street2,onBlur:c=>{const b=c.target;r(p.street2,b.value)},disabled:!!a,variant:"primary",size:"medium"})}),t(R,{label:_.city,required:L.city,className:"account-edit-company-profile-form__field",error:n[p.city]&&v[p.city]?v[p.city]:void 0,children:t(V,{name:F.city,type:"text",value:g.city,onBlur:c=>{const b=c.target;r(p.city,b.value)},disabled:!!a,variant:"primary",size:"medium"})}),t(R,{label:_.country,required:!0,className:"account-edit-company-profile-form__field",error:n[p.countryCode]&&v[p.countryCode]?v[p.countryCode]:void 0,children:t(ce,{name:F.countryCode,floatingLabel:`${_.country} *`,placeholder:_.country,options:A,value:g.countryCode,handleSelect:c=>{const b=c.target;d(p.countryCode)(b.value)},onBlur:()=>r(p.countryCode),disabled:!!a||e})}),t(R,{label:_.stateProvince,required:u,className:"account-edit-company-profile-form__field",error:n["legalAddress.region"]&&v["legalAddress.region"]?v["legalAddress.region"]:void 0,children:s?t(ce,{name:"legalAddress_region",floatingLabel:`${_.stateProvince} ${u?"*":""}`,placeholder:_.stateProvince,options:y,value:g.regionCode&&((k=y.find(c=>c.value.split(",")[0]===g.regionCode))==null?void 0:k.value)||"",handleSelect:c=>{var O;const b=c.target,[S]=b.value.split(","),z=((O=y.find(P=>P.value===b.value))==null?void 0:O.text)||"";d(p.region)(z),d(p.regionCode)(S)},onBlur:()=>r(p.region),disabled:!!a||e},`region_picker_${g.countryCode}`):t(V,{name:F.region,type:"text",value:g.region,onBlur:c=>{const b=c.target;r(p.region,b.value)},disabled:!!a||e,variant:"primary",size:"medium"},`region_input_${g.countryCode}`)}),t(R,{label:_.zipPostalCode,required:L.postcode,className:"account-edit-company-profile-form__field",error:n[p.postcode]&&v[p.postcode]?v[p.postcode]:void 0,children:t(V,{name:F.postcode,type:"text",value:g.postcode,onBlur:c=>{const b=c.target;r(p.postcode,b.value)},disabled:!!a,variant:"primary",size:"medium"})}),t(R,{label:_.phoneNumber,required:L.telephone,className:"account-edit-company-profile-form__field",error:n[p.telephone]&&v[p.telephone]?v[p.telephone]:void 0,children:t(V,{name:F.telephone,type:"tel",value:g.telephone,onBlur:c=>{const b=c.target;r(p.telephone,b.value)},disabled:!!a,variant:"primary",size:"medium"})})]})},we=({inLineAlertProps:a,company:e,loading:g=!1,onSubmit:v,onCancel:n})=>{var B,H,q,Y,h,$,Z,ee,ae,te,re,se,le,ne;const d=j({title:"Company.EditCompanyProfile.title",cancel:"Company.shared.buttons.cancel",save:"Company.shared.buttons.save",saving:"Company.shared.buttons.saving",required:"Company.shared.validation.required",invalidEmail:"Company.shared.validation.invalidEmail",companyNameRequired:"Company.shared.validation.companyNameRequired",emailRequired:"Company.shared.validation.emailRequired",emailNotAvailable:"Company.shared.validation.emailNotAvailable",companyNameLengthError:"Company.shared.validation.companyNameLengthError",legalNameLengthError:"Company.shared.validation.legalNameLengthError",vatTaxIdLengthError:"Company.shared.validation.vatTaxIdLengthError",resellerIdLengthError:"Company.shared.validation.resellerIdLengthError"}),[r,A]=D({name:(e==null?void 0:e.name)||"",email:(e==null?void 0:e.email)||"",legalName:(e==null?void 0:e.legalName)||"",vatTaxId:(e==null?void 0:e.vatTaxId)||"",resellerId:(e==null?void 0:e.resellerId)||"",legalAddress:{street:((H=(B=e==null?void 0:e.legalAddress)==null?void 0:B.street)==null?void 0:H[0])||"",street2:((Y=(q=e==null?void 0:e.legalAddress)==null?void 0:q.street)==null?void 0:Y[1])||"",city:((h=e==null?void 0:e.legalAddress)==null?void 0:h.city)||"",region:((Z=($=e==null?void 0:e.legalAddress)==null?void 0:$.region)==null?void 0:Z.region)||"",regionCode:((ae=(ee=e==null?void 0:e.legalAddress)==null?void 0:ee.region)==null?void 0:ae.regionCode)||"",countryCode:((te=e==null?void 0:e.legalAddress)==null?void 0:te.countryCode)||"",postcode:((re=e==null?void 0:e.legalAddress)==null?void 0:re.postcode)||"",telephone:((se=e==null?void 0:e.legalAddress)==null?void 0:se.telephone)||""}}),[y,u]=D({}),[s,i]=D({}),C=((le=e==null?void 0:e.permissionsFlags)==null?void 0:le.canEditAccount)===!0,N=((ne=e==null?void 0:e.permissionsFlags)==null?void 0:ne.canEditAddress)===!0,{countryOptions:_,regionOptions:F,isRegionRequired:p,hasRegionOptions:L,loadingCountries:k}=xe(r.legalAddress.countryCode),c=(l,o)=>l==="name"?o.trim()?o.length>40?d.companyNameLengthError:null:d.companyNameRequired:l==="email"?o.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)?null:d.invalidEmail:d.emailRequired:l==="legalName"?o.length>80?d.legalNameLengthError:null:l==="vatTaxId"?o.length>40?d.vatTaxIdLengthError:null:l==="resellerId"?o.length>40?d.resellerIdLengthError:null:l==="legalAddress.street"||l==="legalAddress.city"||l==="legalAddress.postcode"||l==="legalAddress.telephone"||l==="legalAddress.countryCode"?o.trim()?null:d.required:l==="legalAddress.region"&&p&&!o.trim()?d.required:null,b=()=>{var w,M;const l={};let o=!0;const T=((w=e==null?void 0:e.permissionsFlags)==null?void 0:w.canEditAccount)===!0,m=((M=e==null?void 0:e.permissionsFlags)==null?void 0:M.canEditAddress)===!0;if(T){const I=c("name",r.name);I&&(l.name=I,o=!1);const E=c("email",r.email);if(E&&(l.email=E,o=!1),r.legalName){const x=c("legalName",r.legalName);x&&(l.legalName=x,o=!1)}if(r.vatTaxId){const x=c("vatTaxId",r.vatTaxId);x&&(l.vatTaxId=x,o=!1)}if(r.resellerId){const x=c("resellerId",r.resellerId);x&&(l.resellerId=x,o=!1)}}if(m){const I=c("legalAddress.street",r.legalAddress.street);I&&(l["legalAddress.street"]=I,o=!1);const E=c("legalAddress.city",r.legalAddress.city);E&&(l["legalAddress.city"]=E,o=!1);const x=c("legalAddress.postcode",r.legalAddress.postcode);x&&(l["legalAddress.postcode"]=x,o=!1);const ie=c("legalAddress.telephone",r.legalAddress.telephone);ie&&(l["legalAddress.telephone"]=ie,o=!1);const oe=c("legalAddress.countryCode",r.legalAddress.countryCode);oe&&(l["legalAddress.countryCode"]=oe,o=!1);const de=c("legalAddress.region",r.legalAddress.region);de&&(l["legalAddress.region"]=de,o=!1)}return u(l),o},S=async l=>{var w,M;l.preventDefault();const o=((w=e==null?void 0:e.permissionsFlags)==null?void 0:w.canEditAccount)===!0,T=((M=e==null?void 0:e.permissionsFlags)==null?void 0:M.canEditAddress)===!0,m={};if(o&&(m.name=!0,m.email=!0,m.legalName=!0,m.vatTaxId=!0,m.resellerId=!0),T&&(m["legalAddress.street"]=!0,m["legalAddress.street2"]=!0,m["legalAddress.city"]=!0,m["legalAddress.region"]=!0,m["legalAddress.regionCode"]=!0,m["legalAddress.countryCode"]=!0,m["legalAddress.postcode"]=!0,m["legalAddress.telephone"]=!0),i(m),!!b()){if(o&&r.email!==(e==null?void 0:e.email)){const I=await be(r.email);if(!I.isValid){u(E=>({...E,email:I.error||d.emailNotAvailable}));return}}if(v){const I={};o&&(I.name=r.name,I.email=r.email,I.legalName=r.legalName,I.vatTaxId=r.vatTaxId,I.resellerId=r.resellerId),T&&(I.legalAddress={street:[r.legalAddress.street,r.legalAddress.street2].filter(Boolean),city:r.legalAddress.city,region:{region:r.legalAddress.region,regionCode:r.legalAddress.regionCode},countryCode:r.legalAddress.countryCode,postcode:r.legalAddress.postcode,telephone:r.legalAddress.telephone}),await v(I)}}},z=(l,o)=>{if(l.startsWith("legalAddress.")){const T=l.split(".")[1];T==="countryCode"?(A(m=>({...m,legalAddress:{...m.legalAddress,[T]:o,region:"",regionCode:""}})),u(m=>{const w={...m};return delete w["legalAddress.region"],delete w["legalAddress.regionCode"],w}),i(m=>{const w={...m};return delete w["legalAddress.region"],delete w["legalAddress.regionCode"],w})):A(T==="region"?m=>({...m,legalAddress:{...m.legalAddress,region:o,regionCode:L?m.legalAddress.regionCode:o}}):m=>({...m,legalAddress:{...m.legalAddress,[T]:o}}))}else A(T=>({...T,[l]:o}))},O=l=>o=>{const T=new Set(["name","email","legalName","vatTaxId","resellerId"]),m=l.startsWith("legalAddress.");T.has(l)&&!C||m&&!N||(z(l,o),y[l]&&u(M=>{const I={...M};return delete I[l],I}))},P=(l,o)=>{const T=new Set(["name","email","legalName","vatTaxId","resellerId"]),m=l.startsWith("legalAddress.");if(T.has(l)&&!C||m&&!N)return;o!==void 0&&z(l,o),i(E=>({...E,[l]:!0}));let M=o;if(M===void 0)if(l.startsWith("legalAddress.")){const E=l.split(".")[1],x=r.legalAddress[E];M=typeof x=="string"?x:""}else{const E=r[l];M=typeof E=="string"?E:""}const I=c(l,M);u(I?E=>({...E,[l]:I}):E=>{const x={...E};return delete x[l],x})};return f(Q,{variant:"secondary",className:"account-edit-company-profile",children:[t(pe,{title:d.title,divider:!1,className:"account-edit-company-profile__title"}),a!=null&&a.text?t(fe,{className:"account-edit-company-profile__notification",type:a.type,variant:"secondary",heading:a.text,icon:a.icon,"data-testid":"editCompanyInLineAlert"}):null,f("form",{className:"account-edit-company-profile-form",onSubmit:S,children:[C&&t(Te,{loading:g,value:{name:r.name,email:r.email,legalName:r.legalName,vatTaxId:r.vatTaxId,resellerId:r.resellerId},errors:y,touched:s,onBlur:P}),N&&t($e,{loading:g,loadingCountries:k,value:r.legalAddress,errors:y,touched:s,onChange:O,onBlur:P,countryOptions:_,regionOptions:F,isRegionRequired:p,hasRegionOptions:L}),f("div",{className:"account-edit-company-profile__actions",children:[t(X,{disabled:g,type:"button",variant:"secondary",onClick:()=>n==null?void 0:n(),children:d.cancel}),t(X,{disabled:g||!C&&!N,type:"submit",variant:"primary",children:d.save})]})]}),g&&f("div",{className:"account-edit-company-profile__loading-overlay","data-testid":"editCompanyLoadingOverlay",children:[t(ve,{size:"large"}),t("div",{className:"account-edit-company-profile__loading-text",children:d.saving})]})]})},Fe=({handleSetInLineAlert:a,editFormRef:e})=>{const g=j({companySuccess:"Company.CompanyProfile.editCompanyProfile.companySuccess",companyError:"Company.CompanyProfile.editCompanyProfile.companyError",loadError:"Company.CompanyProfile.messages.loadError",updateError:"Company.CompanyProfile.messages.updateError",noDataToUpdate:"Company.CompanyProfile.messages.noDataToUpdate"}),{companySuccess:v,companyError:n,loadError:d,updateError:r,noDataToUpdate:A}=g,[y,u]=D(null),[s,i]=D(!0),[C,N]=D(!1),[_,F]=D(!1),[p,L]=D([]),[k,c]=D({}),b=J(a),S=J(!1),z=J(!1);W(()=>{b.current=a},[a]);const O=U(h=>{c(h)},[]),P=U((h,$)=>{a&&(h==="success"?a({type:"success",text:$??v}):h==="error"?a({type:"error",text:$??n}):a(),N(!1))},[a,v,n]),B=U(async()=>{if(S.current)return null;S.current=!0,i(!0);try{const h=await Ie();return h&&u(h),i(!1),h}catch(h){return console.error("Failed to load company:",h),i(!1),b.current&&b.current({type:"error",text:d}),null}finally{S.current=!1}},[d]);W(()=>{z.current||(z.current=!0,B())},[B]),W(()=>{const h=()=>{i(!0),F(!1),c({}),B()},$=me.on("companyContext/changed",h,{eager:!0});return()=>{$==null||$.off()}},[B]),W(()=>{ge().then(h=>{L(h.availableCountries)}).catch(h=>{console.error("Failed to load countries:",h)})},[]);const H=U(()=>{F(!0),P("success",""),c({})},[P]);W(()=>{_&&(e!=null&&e.current)&&setTimeout(()=>{var h;(h=e.current)==null||h.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)},[_,e]);const q=U(h=>{h==null||h(),F(!1),c({})},[]),Y=U(async h=>{try{if(N(!0),!h){P("error",A);return}const $=await _e(h);u($),F(!1),c({}),P("success"),ye(Ce.EDIT_COMPANY_EVENT,{...h,companyId:y==null?void 0:y.id}),me.emit("company/updated",{company:$})}catch($){console.error("Failed to update company:",$),P("error",$.message||r)}finally{N(!1)}},[y,P,r,A]);return{company:y,countries:p,loading:s,submitLoading:C,showEditForm:_,inputChange:k,handleShowEditForm:H,handleHideEditForm:q,handleUpdateCompany:Y,handleInputChange:O,renderAlertMessage:P,saving:C}},Ue=({className:a,withHeader:e=!0,slots:g})=>{const v=j({containerTitle:"Company.CompanyProfile.containerTitle"}),{inLineAlertProps:n,handleSetInLineAlert:d}=Ae(),r=J(null),{company:A,loading:y,saving:u,showEditForm:s,handleShowEditForm:i,handleHideEditForm:C,handleUpdateCompany:N}=Fe({handleSetInLineAlert:d,editFormRef:r});return y?t("div",{"data-testid":"companyProfileLoader",children:t(Ne,{withCard:!0})}):f("div",{className:ue(["account-company-profile",a]),children:[e?t(pe,{title:v.containerTitle,divider:!1,className:"company-profile__title"}):null,t(Ee,{company:A,slots:g,showEditForm:s,handleShowEditForm:i}),s?t("div",{ref:r,children:t(we,{inLineAlertProps:n,company:A,loading:u,onSubmit:N,onCancel:C})}):null]})};export{Ue as CompanyProfile,Ue as default};
//# sourceMappingURL=CompanyProfile.js.map
