/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsxs as x,jsx as a,Fragment as N}from"@dropins/tools/preact-jsx-runtime.js";import*as F from"@dropins/tools/preact-compat.js";import{useState as C,useRef as J,useEffect as T}from"@dropins/tools/preact-compat.js";import{classes as K,VComponent as $,Slot as k}from"@dropins/tools/lib.js";import{Button as A,Icon as M,PriceRange as b,Checkbox as Q,RadioButton as X}from"@dropins/tools/components.js";/* empty css                 */import{useText as q}from"@dropins/tools/i18n.js";import{events as I}from"@dropins/tools/event-bus.js";import{d as ee}from"../chunks/search.js";import"../chunks/initialize.js";import"../fragments.js";import"../chunks/acdlEvents.js";import"@dropins/tools/fetch-graphql.js";const te=n=>F.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...n},F.createElement("g",{id:"Large"},F.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),F.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},F.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),F.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),re=n=>F.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},F.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 5.64001L5.62988 18.37",stroke:"currentColor"}),F.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 18.37L5.62988 5.64001",stroke:"currentColor"})),ne=n=>F.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},F.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),ce=({numberOfOptionsConfig:n=5,header:e,buckets:s,last:m})=>{const p=q({showMore:"Search.Facet.showMore",showLess:"Search.Facet.showLess"}),w=n,[S,g]=C(s.length<w),_=S?s.length:w;return x("div",{className:K(["product-discovery-facet",["product-discovery-facet--last",m]]),children:[a($,{className:"product-discovery-facet__header",node:e}),s.slice(0,_).map((B,v)=>a($,{className:"product-discovery-facet__bucket",node:B},v)),!S&&s.length>w&&a(A,{variant:"tertiary",icon:a(M,{source:te,size:"24"}),onClick:()=>g(!S),children:p.showMore}),S&&s.length>w&&a(A,{variant:"tertiary",icon:a(M,{source:ne,size:"24"}),onClick:()=>g(!S),children:p.showLess})]})},ae=({selectedFacets:n,facets:e})=>x(N,{children:[a($,{className:"product-discovery-facet-list__selected-filters",node:n}),a($,{className:"product-discovery-facet-list__facet-options",node:e})]}),ie="no",se="yes",le=n=>{const e=n.buckets.find(s=>s.selected);return e?{attribute:n.attribute,range:{from:e.from,to:e.to}}:null},oe=n=>{const e=n.buckets.reduce((s,m)=>(m.selected&&s.push(m.title),s),[]);return e.length===0?null:{attribute:n.attribute,in:e}},U=n=>{var e;switch((e=n.buckets[0])==null?void 0:e.__typename){case"RangeBucket":return le(n);case"ScalarBucket":case"CategoryView":return oe(n)}},ue=n=>{var s,m,p,w,S,g,_,B,v,y,E;const e=n[0];return(p=(m=(s=e==null?void 0:e.price)==null?void 0:s.regular)==null?void 0:m.amount)!=null&&p.currency?e.price.regular.amount.currency:(_=(g=(S=(w=e==null?void 0:e.priceRange)==null?void 0:w.minimum)==null?void 0:S.regular)==null?void 0:g.amount)!=null&&_.currency?(E=(y=(v=(B=e==null?void 0:e.priceRange)==null?void 0:B.minimum)==null?void 0:v.regular)==null?void 0:y.amount)==null?void 0:E.currency:"USD"},de=(n,e,s)=>(e==null?void 0:e.attribute)==="price"?n.from===0?x("div",{style:"display:flex",children:[a(b,{amount:n.from,currency:s||"USD"}),a("span",{style:"padding: 0 2px",children:"-"}),a(b,{amount:n.to,currency:s||"USD"})]}):a(b,{minimumAmount:n.from,maximumAmount:n.to,currency:s||"USD",display:"dash"}):n.title,me=(n,e)=>n.title===ie?`Not ${e.title}`:n.title===se?e.title:n.title,j=(n,e,s)=>{switch(n.__typename){case"RangeBucket":return de(n,e,s);case"ScalarBucket":case"CategoryView":return me(n,e)}},ke=({scope:n,slots:e})=>{const s=q({clearAll:"Search.Facet.clearAll"}),[m,p]=C([]),[w,S]=C(null),[g,_]=C(),[B,v]=C(null),y=J(null),E=t=>{var l;const i=((l=g==null?void 0:g.filter)==null?void 0:l.filter(c=>c.attribute==="categoryPath"))||[];ee({...t,filter:[...i,...t.filter||[]]},{scope:n})},z=t=>{const i=new URLSearchParams(window.location.search);if(!t.length)i.delete("filter");else{const l=t.map(c=>{var r;return c.range?`${c.attribute}:${c.range.from}-${c.range.to}`:(r=c.in)!=null&&r.length?`${c.attribute}:${c.in.join(",")}`:null}).filter(Boolean).join(";");i.set("filter",l)}i.set("page","1"),window.history.replaceState({},"",`${window.location.pathname}?${i.toString()}`)},D=t=>{if(!t||!t.result.facets&&!t.result.items&&!t.request.filter){p([]);return}_(t.request);const{facets:i,items:l}=t.result;S(ue(l));const c=t.request.filter;if(i){const r=i.map(o=>{const h=o.buckets.map(f=>{const u=c==null?void 0:c.find(L=>L.attribute===o.attribute);if(u){const L=u.range;if(L&&f.from===L.from&&f.to===L.to)return{...f,selected:!0};if(u.in&&u.in.includes(f.title))return{...f,selected:!0}}return{...f,selected:!1}});return{...o,buckets:h}});p(r)}},V=t=>{p(i=>{const l=i.map(r=>{const o=t.find(h=>h.attribute===r.attribute);return o||r}),c=l.reduce((r,o)=>{const h=U(o);return h&&r.push(h),r},[]);return v(c),l})},W=(t,i)=>{const l=t.buckets.map(r=>r.title===i?{...r,selected:!1}:r),c={...t,buckets:l};V([c])},Z=()=>{const t=m.map(i=>{const l=i.buckets.map(c=>({...c,selected:!1}));return{...i,buckets:l}});p(t),v([])},O=(t,i)=>{const l=t.target.value,c=t.target.checked;p(r=>{const o=r.find(d=>d.attribute===i);if(!o)return r;const h=o.buckets.map(d=>{var R;return((R=o.buckets[0])==null?void 0:R.__typename)==="RangeBucket"?d.title===l?{...d,selected:c}:{...d,selected:!1}:d.title===l?{...d,selected:c}:{...d}}),f={...o,buckets:h},u=r.map(d=>d.attribute===i?f:d),L=u.reduce((d,R)=>{const P=U(R);return P&&d.push(P),d},[]);return v(L),u})},H=(t,i)=>{const l=a("span",{children:t.title}),c=t.buckets.map(r=>{var f;const o=j(r,t,w),h=u=>x(k,{name:"FacetBucketLabel",slot:e==null?void 0:e.FacetBucketLabel,context:{data:r},children:[o," ",u?`(${u})`:""]});switch((f=t.buckets[0])==null?void 0:f.__typename){case"RangeBucket":return a(k,{name:"FacetBucket",slot:e==null?void 0:e.FacetBucket,context:{data:r},children:a(X,{"data-testid":`${r.title}-radio`,label:h(),name:t.attribute,value:r.title,checked:r.selected,onChange:u=>{O(u,t.attribute)}})});case"ScalarBucket":case"CategoryView":return a(k,{name:"FacetBucket",slot:e==null?void 0:e.FacetBucket,context:{data:r},children:a(Q,{id:`${t.attribute}-${r.title.replace(/[^a-zA-Z0-9_-]/g,"")}`,"data-testid":`${r.title}-checkbox`,label:h(r.count),name:`${t.attribute}-${r.title.replace(/[^a-zA-Z0-9_-]/g,"")}`,value:r.title,checked:r.selected,onChange:u=>{O(u,t.attribute)}})});default:return null}}).filter(r=>r!==null);return a(ce,{header:l,buckets:c,last:i===m.length-1})},Y=()=>a(k,{name:"Facets",slot:e==null?void 0:e.Facets,context:{data:m},children:m.map((t,i)=>t.buckets.length>0?a(N,{children:a(k,{name:"Facet",slot:e==null?void 0:e.Facet,context:{data:t},children:H(t,i)})}):null)}),G=()=>{const t=m.reduce((c,r)=>(r.buckets.filter(h=>h.selected).length>0&&c.push(r),c),[]),i=t.map(c=>c.buckets.map(r=>{if(r.selected){const o=j(r,c,w);return a(A,{"data-testid":`${r.title}-selected-btn`,"aria-label":`Remove ${c.title} filter: ${r.title}`,variant:"secondary",children:x(N,{children:[a("span",{children:o}),a(M,{source:re,size:"16"})]}),onClick:()=>{W(c,r.title)}})}return null})),l=i.length>0?a(A,{variant:"secondary",onClick:()=>{Z()},children:a("span",{children:s.clearAll})}):null;return x(k,{name:"SelectedFacets",slot:e==null?void 0:e.SelectedFacets,context:{data:t},children:[i,l]})};return T(()=>{const t=I.on("search/result",D,{eager:!0,scope:n});return()=>{t==null||t.off()}},[]),T(()=>{if(B!==null)return y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{g&&(z(B),E({...g,filter:B})),v(null)},150),()=>{y.current&&clearTimeout(y.current)}},[B,g]),a(ae,{selectedFacets:G(),facets:Y()})};export{ke as Facets,ke as default};
//# sourceMappingURL=Facets.js.map
