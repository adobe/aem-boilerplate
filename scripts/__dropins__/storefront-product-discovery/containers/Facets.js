/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as L,jsx as a,Fragment as N}from"@dropins/tools/preact-jsx-runtime.js";import*as h from"@dropins/tools/preact-compat.js";import{useState as C,useEffect as j}from"@dropins/tools/preact-compat.js";import{classes as z,VComponent as E,Slot as y}from"@dropins/tools/lib.js";import{Button as R,Icon as b,PriceRange as A,Checkbox as T,RadioButton as V}from"@dropins/tools/components.js";/* empty css                 */import{useText as $}from"@dropins/tools/i18n.js";import{events as W}from"@dropins/tools/event-bus.js";import{c as H}from"../chunks/search.js";import"../chunks/initialize.js";import"../fragments.js";import"../chunks/acdlEvents.js";import"@dropins/tools/fetch-graphql.js";const Y=n=>h.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...n},h.createElement("g",{id:"Large"},h.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),h.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},h.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),h.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),G=n=>h.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},h.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 5.64001L5.62988 18.37",stroke:"currentColor"}),h.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 18.37L5.62988 5.64001",stroke:"currentColor"})),J=n=>h.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},h.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),K=({numberOfOptionsConfig:n=5,header:e,buckets:s,last:u})=>{const g=$({showMore:"Search.Facet.showMore",showLess:"Search.Facet.showLess"}),f=n,[p,d]=C(s.length<f),v=p?s.length:f;return L("div",{className:z(["product-discovery-facet",["product-discovery-facet--last",u]]),children:[a(E,{className:"product-discovery-facet__header",node:e}),s.slice(0,v).map((w,B)=>a(E,{className:"product-discovery-facet__bucket",node:w},B)),!p&&s.length>f&&a(R,{variant:"tertiary",icon:a(b,{source:Y,size:"24"}),onClick:()=>d(!p),children:g.showMore}),p&&s.length>f&&a(R,{variant:"tertiary",icon:a(b,{source:J,size:"24"}),onClick:()=>d(!p),children:g.showLess})]})},Q=({selectedFacets:n,facets:e})=>L(N,{children:[a(E,{className:"product-discovery-facet-list__selected-filters",node:n}),a(E,{className:"product-discovery-facet-list__facet-options",node:e})]}),X="no",Z="yes",I=n=>{const e=n.buckets.find(s=>s.selected);return e?{attribute:n.attribute,range:{from:e.from,to:e.to}}:null},ee=n=>{const e=n.buckets.reduce((s,u)=>(u.selected&&s.push(u.title),s),[]);return e.length===0?null:{attribute:n.attribute,in:e}},te=n=>{var e;switch((e=n.buckets[0])==null?void 0:e.__typename){case"RangeBucket":return I(n);case"ScalarBucket":case"CategoryView":return ee(n)}},ne=n=>{var s,u,g,f,p,d,v,w,B,k,x;const e=n[0];return(g=(u=(s=e==null?void 0:e.price)==null?void 0:s.regular)==null?void 0:u.amount)!=null&&g.currency?e.price.regular.amount.currency:(v=(d=(p=(f=e==null?void 0:e.priceRange)==null?void 0:f.minimum)==null?void 0:p.regular)==null?void 0:d.amount)!=null&&v.currency?(x=(k=(B=(w=e==null?void 0:e.priceRange)==null?void 0:w.minimum)==null?void 0:B.regular)==null?void 0:k.amount)==null?void 0:x.currency:"USD"},re=(n,e,s)=>(e==null?void 0:e.attribute)==="price"?n.from===0?L("div",{style:"display:flex",children:[a(A,{amount:n.from,currency:s||"USD"}),a("span",{style:"padding: 0 2px",children:"-"}),a(A,{amount:n.to,currency:s||"USD"})]}):a(A,{minimumAmount:n.from,maximumAmount:n.to,currency:s||"USD",display:"dash"}):n.title,ce=(n,e)=>n.title===X?`Not ${e.title}`:n.title===Z?e.title:n.title,O=(n,e,s)=>{switch(n.__typename){case"RangeBucket":return re(n,e,s);case"ScalarBucket":case"CategoryView":return ce(n,e)}},Fe=({scope:n,slots:e})=>{const s=$({clearAll:"Search.Facet.clearAll"}),[u,g]=C([]),[f,p]=C(null),[d,v]=C(),w=t=>{var o;const i=((o=d==null?void 0:d.filter)==null?void 0:o.filter(c=>c.attribute==="categoryPath"))||[];H({...t,filter:[...i,...t.filter||[]]},{scope:n})},B=t=>{if(!t||!t.result.facets&&!t.result.items&&!t.request.filter){g([]);return}v(t.request);const{facets:i,items:o}=t.result;p(ne(o));const c=t.request.filter;if(i){const r=i.map(l=>{const S=l.buckets.map(F=>{F.selected=!1;const m=c==null?void 0:c.find(_=>_.attribute===l.attribute);if(m){const _=m.range;(_&&F.from===_.from&&F.to===_.to||m.in&&m.in.includes(F.title))&&(F.selected=!0)}return F});return l.buckets=S,l});g(r)}},k=t=>{const i=u.map(c=>{const r=t.find(l=>l.attribute===c.attribute);return r||c}),o=i.reduce((c,r)=>{const l=te(r);return l&&c.push(l),c},[]);g(i),d&&w({...d,filter:o})},x=(t,i)=>{const o=t.buckets.map(r=>(r.title===i&&(r.selected=!1),r)),c=t;c.buckets=o,k([c])},q=()=>{const t=u.map(i=>{const o=i.buckets.map(c=>(c.selected=!1,c));return i.buckets=o,i});g(t),d&&w({...d,filter:[]})},M=(t,i)=>{const o=i.buckets.map(r=>{var l;return((l=i.buckets[0])==null?void 0:l.__typename)==="RangeBucket"&&(r.selected=!1),r.title===t.target.value&&(r.selected=t.target.checked),r}),c=i;c.buckets=o,k([c])},P=(t,i)=>{const o=a("span",{children:t.title}),c=t.buckets.map(r=>{var F;const l=O(r,t,f),S=m=>L(y,{name:"FacetBucketLabel",slot:e==null?void 0:e.FacetBucketLabel,context:{data:r},children:[l," ",m?`(${m})`:""]});switch((F=t.buckets[0])==null?void 0:F.__typename){case"RangeBucket":return a(y,{name:"FacetBucket",slot:e==null?void 0:e.FacetBucket,context:{data:r},children:a(V,{"data-testid":`${r.title}-radio`,label:S(),name:t.attribute,value:r.title,checked:r.selected,onChange:m=>{M(m,t)}})});case"ScalarBucket":case"CategoryView":return a(y,{name:"FacetBucket",slot:e==null?void 0:e.FacetBucket,context:{data:r},children:a(T,{"data-testid":`${r.title}-checkbox`,label:S(r.count),name:t.attribute,value:r.title,checked:r.selected,onChange:m=>{M(m,t)}})});default:return null}}).filter(r=>r!==null);return a(K,{header:o,buckets:c,last:i===u.length-1})},D=()=>a(y,{name:"Facets",slot:e==null?void 0:e.Facets,context:{data:u},children:u.map((t,i)=>t.buckets.length>0?a(N,{children:a(y,{name:"Facet",slot:e==null?void 0:e.Facet,context:{data:t},children:P(t,i)})}):null)}),U=()=>{const t=u.reduce((c,r)=>(r.buckets.filter(S=>S.selected).length>0&&c.push(r),c),[]),i=t.map(c=>c.buckets.map(r=>{if(r.selected){const l=O(r,c,f);return a(R,{"data-testid":`${r.title}-selected-btn`,"aria-label":`Remove ${c.title} filter: ${r.title}`,variant:"secondary",children:L(N,{children:[a("span",{children:l}),a(b,{source:G,size:"16"})]}),onClick:()=>{x(c,r.title)}})}return null})),o=i.length>0?a(R,{variant:"secondary",onClick:()=>{q()},children:a("span",{children:s.clearAll})}):null;return L(y,{name:"SelectedFacets",slot:e==null?void 0:e.SelectedFacets,context:{data:t},children:[i,o]})};return j(()=>{const t=W.on("search/result",B,{eager:!0,scope:n});return()=>{t==null||t.off()}},[]),a(Q,{selectedFacets:U(),facets:D()})};export{Fe as Facets,Fe as default};
//# sourceMappingURL=Facets.js.map
