/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsxs as R,jsx as s}from"@dropins/tools/preact-jsx-runtime.js";import{W as U}from"../chunks/ConditionalWrapper.js";/* empty css                  */import{Skeleton as W,SkeletonRow as E,Button as _}from"@dropins/tools/components.js";import{classes as q,Slot as B}from"@dropins/tools/lib.js";import{h as j,s as y,i as v}from"../chunks/fetch-graphql.js";import{c as w,E as P}from"../chunks/classifiers.js";import{events as u}from"@dropins/tools/event-bus.js";import{a as K}from"../chunks/events2.js";import{g}from"../chunks/values.js";import{useState as S,useCallback as m,useEffect as f}from"@dropins/tools/preact-hooks.js";import{useText as M}from"@dropins/tools/i18n.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";function Q(n){const r=w.find(o=>o.matches(n));return r?r.code:P.UNKNOWN_ERROR}const T=()=>R(W,{"data-testid":"place-order-skeleton",children:[s(E,{size:"small",variant:"empty"}),s(E,{size:"small"})]}),A=({children:n,className:r,disabled:o=!1,onClick:a})=>s("div",{className:q(["checkout-place-order",r]),children:s(_,{className:"checkout-place-order__button","data-testid":"place-order-button",disabled:o,size:"medium",type:"button",variant:"primary",onClick:a,children:n},"placeOrder")}),H=U(A,T),se=({disabled:n=!1,active:r=!0,handleValidation:o,handlePlaceOrder:a,slots:d,...b})=>{var O;const[x,p]=S(!1),[z,h]=S(!1),I=j.value,l=M({CheckoutUnexpectedError:"Checkout.ServerError.unexpected",placeOrderButton:"Checkout.PlaceOrder.button"}),k=m(e=>{const t=Q(e),i=t===P.UNKNOWN_ERROR?l.CheckoutUnexpectedError:e.message;u.emit("checkout/error",{message:i,code:t})},[l]),N=m(async()=>{var e;try{if(o&&!o())return;await a({cartId:y.cartId,quoteId:y.quoteId,code:((e=g("selectedPaymentMethod"))==null?void 0:e.code)??""})}catch(t){k(t)}},[o,a,k]),c=m(e=>{(!e||"isEmpty"in e&&e.isEmpty)&&h(!1)},[]);return f(()=>{if(r===!1)return;const e=u.on("cart/initialized",t=>{const i=(t==null?void 0:t.items)||[];h(i.some(C=>C.outOfStock||C.insufficientQuantity))},{eager:!0});return()=>{e==null||e.off()}},[r]),f(()=>{if(!r)return;const e=K();if(e){p(!0),c(e);return}const t=u.on("checkout/initialized",i=>{p(!0),c(i)},{eager:!0});return()=>{t==null||t.off()}},[r,c]),f(()=>{if(!r)return;const e=u.on("checkout/updated",t=>{c(t)},{eager:!1});return()=>{e==null||e.off()}},[r,c]),s(H,{...b,disabled:n||z||I||v.value,initialized:x,visible:r,onClick:N,children:s(B,{context:{code:((O=g("selectedPaymentMethod"))==null?void 0:O.code)??""},name:"Content",slot:d==null?void 0:d.Content,children:l.placeOrderButton})})};export{se as PlaceOrder,se as default};
//# sourceMappingURL=PlaceOrder.js.map
