/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as p,jsx as t,Fragment as V}from"@dropins/tools/preact-jsx-runtime.js";import{useState as s,useEffect as ee,createPortal as te}from"@dropins/tools/preact-compat.js";import{classes as ae,Slot as c}from"@dropins/tools/lib.js";import{Table as ne,IllustratedMessage as oe,Picker as ie,Pagination as re,Button as G,Price as le}from"@dropins/tools/components.js";import{events as ce}from"@dropins/tools/event-bus.js";/* empty css                              */import"@dropins/tools/preact.js";import"@dropins/tools/preact-hooks.js";import{f as R}from"../chunks/dateUtils.js";import{useText as A}from"@dropins/tools/i18n.js";import{C as de}from"../chunks/ConfirmationModal.js";/* empty css                        *//* empty css                          */import{g as E}from"../chunks/transform-quote.js";import"../chunks/state.js";import{g as se}from"../chunks/getQuoteTemplates.js";import{g as ue}from"../chunks/generateQuoteFromTemplate.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/transform-quote-template.js";const me=({rowData:h=[],loading:f=!1,className:N,emptyStateMessage:M,showItemRange:L=!0,itemRangeMessage:u,showPageSizePicker:Q=!0,pageSizePickerMessage:m,showPagination:r=!0,paginationMessage:P,...d})=>{const o=A({name:"QuoteManagement.QuoteTemplatesListTable.name",state:"QuoteManagement.QuoteTemplatesListTable.state",status:"QuoteManagement.QuoteTemplatesListTable.status",validUntil:"QuoteManagement.QuoteTemplatesListTable.validUntil",minQuoteTotal:"QuoteManagement.QuoteTemplatesListTable.minQuoteTotal",ordersPlaced:"QuoteManagement.QuoteTemplatesListTable.ordersPlaced",lastOrdered:"QuoteManagement.QuoteTemplatesListTable.lastOrdered",actions:"QuoteManagement.QuoteTemplatesListTable.actions"}),v=[{key:"name",label:o.name},{key:"state",label:o.state},{key:"status",label:o.status},{key:"validUntil",label:o.validUntil},{key:"minQuoteTotal",label:o.minQuoteTotal},{key:"ordersPlaced",label:o.ordersPlaced},{key:"lastOrdered",label:o.lastOrdered},{key:"actions",label:o.actions}],x=f||h.length>0,T=!f&&h.length===0&&M,b=L&&u,g=Q&&m,S=r&&P,y=b||g||S;return p("div",{...d,className:ae(["quote-management-quote-templates-list-table",N]),children:[x&&t(ne,{columns:v,rowData:h,loading:f,mobileLayout:"none",className:"quote-management-quote-templates-list-table__table"}),T&&t("div",{className:"quote-templates-list-table__empty-state",children:M}),y&&p("div",{className:"quote-templates-list-table__footer",children:[t("div",{className:"quote-templates-list-table__item-range",children:b&&u}),t("div",{className:"quote-templates-list-table__pagination",children:S&&P}),t("div",{className:"quote-templates-list-table__page-size-picker",children:g&&m})]})]})},Ce=({pageSize:h,showItemRange:f=!0,showPageSizePicker:N=!0,showPagination:M=!0,onViewQuoteTemplate:L,onGenerateQuoteFromTemplate:u,onPageSizeChange:Q,onPageChange:m,slots:r,...P})=>{const d=A({view:"QuoteManagement.QuoteTemplatesListTable.view",generateQuote:"NegotiableQuoteTemplate.Manage.actionButtons.generateQuote",generateQuoteModalMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.message",generateQuoteModalCancel:"NegotiableQuoteTemplate.Manage.confirmationModal.cancel",generateQuoteModalConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.confirm",generateQuoteModalConfirmLoading:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.confirmLoading"}),[o,v]=s(null),[x,T]=s(!0),[b,g]=s(!1),[S,y]=s(!1),[q,z]=s(null),B=E()[0],[O,F]=s(h||B),[C,_]=s(1);ee(()=>{const n=async()=>{try{T(!0);const l=await se({pageSize:O,currentPage:C});v(l)}catch(l){console.error("Failed to fetch quote templates:",l)}finally{T(!1)}},e=ce.on("authenticated",l=>{l?n():(v(null),T(!1))},{eager:!0});return()=>{e==null||e.off()}},[O,C]);const I=n=>{F(n),_(1),Q==null||Q(n)},w=n=>{_(n),m==null||m(n)},j=n=>{const e=n.target,l=e==null?void 0:e.value;l&&I(Number(l))},$=(n,e)=>{z({id:n,name:e}),g(!0)},D=async n=>{y(!0);try{const e=await ue({templateId:n.id});u==null||u(n.id,n.name,e.quoteId),g(!1),z(null)}catch(e){console.error("Failed to generate quote from template:",e)}finally{y(!1)}},H=()=>{g(!1),z(null)},J=(n,e,l)=>n.filter(a=>a==null?void 0:a.uid).map(a=>{var U;return{id:a.id,name:t(c,{name:"Name",slot:e==null?void 0:e.Name,context:{template:a},children:t("span",{children:a.name})}),state:t(c,{name:"State",slot:e==null?void 0:e.State,context:{template:a},children:t("span",{style:{textTransform:"capitalize"},children:((U=a.state)==null?void 0:U.replace(/_/g," "))||"-"})}),status:t(c,{name:"Status",slot:e==null?void 0:e.Status,context:{template:a},children:t("span",{children:a.status})}),validUntil:t(c,{name:"ValidUntil",slot:e==null?void 0:e.ValidUntil,context:{template:a},children:t("span",{children:R(a.expirationDate,"short")})}),minQuoteTotal:t(c,{name:"MinQuoteTotal",slot:e==null?void 0:e.MinQuoteTotal,context:{template:a},children:t(le,{amount:a.prices.minNegotiatedGrandTotal.value,currency:a.prices.minNegotiatedGrandTotal.currency})}),ordersPlaced:t(c,{name:"OrdersPlaced",slot:e==null?void 0:e.OrdersPlaced,context:{template:a},children:t("span",{children:a.ordersPlaced})}),lastOrdered:t(c,{name:"LastOrdered",slot:e==null?void 0:e.LastOrdered,context:{template:a},children:t("span",{children:R(a.lastOrderedAt,"short")})}),actions:p(c,{name:"Actions",slot:e==null?void 0:e.Actions,context:{template:a,onViewQuoteTemplate:l},className:"quote-management-quote-templates-list-table__actions-cell",children:[t(G,{variant:"tertiary",size:"medium",onClick:()=>l==null?void 0:l(a.id,a.name,a.status),children:d.view}),a.canGenerateQuoteFromTemplate&&t(G,{variant:"primary",size:"medium",onClick:()=>$(a.id,a.name),"data-testid":`generate-quote-button-${a.id}`,children:d.generateQuote})]})}}),K=o!=null&&o.items?J(o.items,r,L):[],i=o!=null&&o.paginationInfo?{...o.paginationInfo,pageSizeOptions:E()}:void 0,k=!!i,W=t(c,{name:"EmptyTemplates",slot:r==null?void 0:r.EmptyTemplates,context:{templatesData:o},children:t(oe,{heading:"No Quote Templates Found"})}),X=i?t(c,{name:"ItemRange",slot:r==null?void 0:r.ItemRange,context:i,children:p("span",{children:["Items ",i.startItem," to ",i.endItem," of"," ",i.totalCount," total"]})}):void 0,Y=i&&i.pageSizeOptions?p(c,{name:"PageSizePicker",slot:r==null?void 0:r.PageSizePicker,context:{pageSize:i.pageSize,pageSizeOptions:i.pageSizeOptions,onPageSizeChange:I},children:[t("span",{children:"Show "}),t(ie,{variant:"primary",size:"medium",value:String(i.pageSize),options:i.pageSizeOptions.map(n=>({value:String(n),text:String(n)})),handleSelect:j}),t("span",{children:" per page"})]}):void 0,Z=i?t(c,{name:"Pagination",slot:r==null?void 0:r.Pagination,context:{currentPage:i.currentPage,totalPages:i.totalPages,onChange:w},children:t(re,{currentPage:i.currentPage,totalPages:i.totalPages,onChange:w})}):void 0;return p(V,{children:[t(me,{rowData:K,loading:x,className:P.className,emptyStateMessage:W,showItemRange:f&&k,itemRangeMessage:X,showPageSizePicker:N&&k,pageSizePickerMessage:Y,showPagination:M&&k,paginationMessage:Z}),b&&te(t(de,{open:b,title:d.generateQuote,message:d.generateQuoteModalMessage,cancelLabel:d.generateQuoteModalCancel,confirmLabel:S?d.generateQuoteModalConfirmLoading:d.generateQuoteModalConfirm,onCancel:H,onConfirm:S||!q?void 0:()=>D(q),showCloseButton:!0,"data-testid":"generate-quote-confirmation-modal"}),document.body)]})};export{Ce as QuoteTemplatesListTable,Ce as default};
//# sourceMappingURL=QuoteTemplatesListTable.js.map
