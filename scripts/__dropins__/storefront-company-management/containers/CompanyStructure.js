/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as P,jsx as e,Fragment as pe}from"@dropins/tools/preact-jsx-runtime.js";import{useState as T,useEffect as X,useRef as ie,useCallback as B}from"@dropins/tools/preact-hooks.js";import{Slot as Te,classes as ve}from"@dropins/tools/lib.js";import{Card as Q,InLineAlert as oe,ProgressSpinner as de,Field as ye,Input as fe,Button as F,Modal as Ce,Header as Ee}from"@dropins/tools/components.js";import{f as he}from"../chunks/fetchUserPermissions.js";import{b as ge}from"../chunks/company-permissions.js";import{useText as J}from"@dropins/tools/i18n.js";import{u as we}from"../chunks/useCompanyContextListener.js";import{a as Ne,i as Me}from"../chunks/isCompanyUser.js";import*as Se from"@dropins/tools/preact-compat.js";import{memo as be}from"@dropins/tools/preact-compat.js";import{T as xe}from"../chunks/Tree.js";import{C as Ue}from"../chunks/CompanyUserForm.js";import{events as se}from"@dropins/tools/event-bus.js";import{p as le,E as ue}from"../chunks/acdl.js";import{g as _e,c as De,u as Ae,a as ke,b as Le,d as Pe}from"../chunks/updateCompanyTeam.js";import{u as Fe}from"../chunks/updateCompanyUserStatus.js";import{u as Ve}from"../chunks/useInLineAlert.js";import{C as Re,a as Oe}from"../chunks/CompanyLoaders.js";import"../chunks/fetch-error.js";import"../chunks/network-error.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/useCompanyRoles.js";import"../chunks/isCompanyRoleNameAvailable.js";const ze=u=>Se.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...u},Se.createElement("path",{vectorEffect:"non-scaling-stroke",fillRule:"evenodd",clipRule:"evenodd",d:"M1 20.8953L12.1922 1.5L23.395 20.8953H1ZM13.0278 13.9638L13.25 10.0377V9H11.25V10.0377L11.4722 13.9638H13.0278ZM11.2994 16V17.7509H13.2253V16H11.2994Z",fill:"currentColor"})),ce={name:40,description:1e3};function Be(u){const{mode:M,entityId:p,parentStructureId:m,onSaved:t,onError:S,onSuccess:i}=u,a=J({teamTitleRequired:"Company.CompanyStructure.shared.validation.teamTitleRequired",teamNameMaxLength:"Company.CompanyStructure.shared.validation.teamNameMaxLength",teamDescriptionMaxLength:"Company.CompanyStructure.shared.validation.teamDescriptionMaxLength",createTeamError:"Company.CompanyStructure.messages.createTeamError",saveTeamError:"Company.CompanyStructure.messages.saveTeamError",createTeamSuccess:"Company.CompanyStructure.messages.createTeamSuccess",updateTeamSuccess:"Company.CompanyStructure.messages.updateTeamSuccess"}),[d,o]=T({id:"",name:"",description:""}),[f,h]=T({}),[g,L]=T({}),[E,U]=T(!1),[R,V]=T(null);X(()=>{M!=="edit"||!p||(U(!0),_e(p).then(C=>{C&&o({id:C.id,name:C.name||"",description:C.description||""})}).finally(()=>U(!1)))},[M,p]);const O=(C,v)=>C==="name"?v.trim()?v.length>ce.name?a.teamNameMaxLength:null:a.teamTitleRequired:C==="description"&&v&&v.length>ce.description?a.teamDescriptionMaxLength:null,_=(C,v)=>{o(D=>({...D,[C]:v})),R&&V(null)};return{values:d,errors:f,touched:g,loading:E,setValue:_,onBlur:(C,v)=>{v!==void 0&&_(C,v),L(A=>({...A,[C]:!0}));const D=v!==void 0?v:d[C]||"",N=O(C,D);h(N?A=>({...A,[C]:N}):A=>{const x={...A};return delete x[C],x})},submit:async()=>{const C=O("name",d.name),v=O("description",d.description||""),D={},N={name:!0,description:!0};if(C&&(D.name=C),v&&(D.description=v),L(N),Object.keys(D).length>0){h(D);return}const A=d.name;try{if(M==="add"){const x=await De({name:d.name,description:d.description||null,targetId:m??null});if(!x){const Y=a.createTeamError;S?S(Y):V(Y);return}t({label:A,structureId:x.structureId,entityId:x.id,type:"team",description:d.description||void 0}),i&&i(a.createTeamSuccess)}else p&&(await Ae({id:p,name:d.name,description:d.description||null}),t({label:A,entityId:p,type:"team",description:d.description||void 0}),i&&i(a.updateTeamSuccess))}catch(x){const Y=x instanceof Error?x.message:a.saveTeamError;S?S(Y):V(Y)}},generalError:R}}const He=be(({mode:u,entityId:M,parentStructureId:p,permissions:m,onSaved:t,onCancel:S,onError:i,onSuccess:a})=>{const d=(m==null?void 0:m.canEditUsers)??!1,{values:o,errors:f,touched:h,loading:g,onBlur:L,submit:E,generalError:U}=Be({mode:u,entityId:M,parentStructureId:p,onSaved:t,onError:i?_=>{i(_),S()}:void 0,onSuccess:a}),[R,V]=T(!1),O=J({addTeam:"Company.CompanyStructure.shared.titles.addTeam",editTeam:"Company.CompanyStructure.shared.titles.editTeam",teamTitle:"Company.CompanyStructure.shared.fields.teamTitle",description:"Company.CompanyStructure.shared.fields.description"});return P("div",{children:[e("h3",{className:"acm-structure-panel__title",children:u==="add"?O.addTeam:O.editTeam}),P(Q,{variant:"secondary",className:`company-team-form__card ${R?"is-working":""}`,children:[!i&&U?e(oe,{className:"company-team-form__notification",type:"error",variant:"secondary",heading:U}):null,R?e("div",{className:"company-team-form__overlay","aria-live":"polite",children:e(de,{size:"small"})}):null,g?e(Re,{}):P("div",{className:"company-team-form__content",children:[e(ye,{label:O.teamTitle,required:!0,className:"acm-structure-panel__field",error:h.name&&f.name?f.name:void 0,children:e(fe,{name:"team_title",type:"text",value:o.name,onBlur:_=>{const j=_.target;L("name",j.value)},variant:"primary",size:"medium",disabled:!d,maxLength:ce.name})}),e(ye,{label:O.description,className:"acm-structure-panel__field",error:h.description&&f.description?f.description:void 0,children:e(fe,{name:"team_description",type:"textarea",value:o.description||"",onBlur:_=>{const j=_.target;L("description",j.value)},variant:"primary",size:"medium",disabled:!d,maxLength:ce.description})})]})]}),g?null:P("div",{className:"acm-structure-modal__actions",children:[e(F,{type:"button",variant:"primary",onClick:async()=>{if(!R){V(!0);try{await E()}finally{V(!1)}}},disabled:R||!d,children:"Save"}),e(F,{type:"button",variant:"secondary",disabled:R,onClick:S,children:"Cancel"})]})]})});function $e({handleSetInLineAlert:u,permissions:M}={permissions:null}){const p=(M==null?void 0:M.canViewUsers)??!1,m=J({loadError:"Company.CompanyStructure.messages.loadError",updateError:"Company.CompanyStructure.messages.updateError",failedToMoveItem:"Company.CompanyStructure.messages.failedToMoveItem",removeUserSuccess:"Company.CompanyStructure.messages.removeUserSuccess",deleteTeamSuccess:"Company.CompanyStructure.messages.deleteTeamSuccess",removeMultipleSuccess:"Company.CompanyStructure.messages.removeMultipleSuccess",moveUserSuccess:"Company.CompanyStructure.messages.moveUserSuccess",moveTeamSuccess:"Company.CompanyStructure.messages.moveTeamSuccess"}),{loadError:t,updateError:S}=m,[i,a]=T(null),[d,o]=T(!0),[f,h]=T(!1),[g,L]=T(!1),[E,U]=T(new Set),[R,V]=T(null),[O,_]=T(new Set),[j,Z]=T({}),C=ie(u),v=ie(!1),D=ie(!1);X(()=>{C.current=u},[u]);const N=B((s,l)=>{u&&(s==="success"?u({type:"success",text:l}):s==="error"?u({type:"error",text:l}):u(),h(!1))},[u]),A=B(async()=>{if(v.current)return null;if(v.current=!0,!p)return o(!1),a(null),U(new Set),V(null),_(new Set),v.current=!1,null;o(!0);try{const l=await ke();return a(l),U(new Set(l.map(k=>k.id))),o(!1),l}catch{return o(!1),C.current&&C.current({type:"error",text:t}),null}finally{v.current=!1}},[p,t]);X(()=>{p&&!D.current&&(D.current=!0,A())},[p,A]),X(()=>{const s=()=>{o(!0),U(new Set),V(null),_(new Set),A()},l=se.on("companyContext/changed",s,{eager:!0});return()=>{l==null||l.off()}},[A]);const x=B(async(s,l)=>{try{if(h(!0),!await Le({id:s,parentId:l}))return N("error",m.failedToMoveItem),!1;const I=new Map(i==null?void 0:i.map(r=>[r.id,r])).get(s),z=(I==null?void 0:I.type)==="team"?m.moveTeamSuccess:m.moveUserSuccess;return a(r=>r?r.map(c=>c.id===s?{...c,parentId:l}:c):null),U(r=>new Set([...r,l])),le(ue.EDIT_COMPANY_STRUCTURE_EVENT,{action:"move",nodeId:s,newParentId:l}),se.emit("companyStructure/updated",{message:"Structure updated",action:"move",nodeId:s,newParentId:l,nodes:i||[]}),N("success",z),!0}catch(k){const H=k instanceof Error?k.message:S;return N("error",H),!1}finally{h(!1)}},[i,N,S,m.failedToMoveItem,m.moveUserSuccess,m.moveTeamSuccess]),Y=B(()=>{i&&U(new Set(i.map(s=>s.id)))},[i]),q=B(()=>{if(i){const s=i.filter(l=>l.parentId===null).map(l=>l.id);U(new Set(s))}},[i]),G=B(s=>{a(l=>{const k=l?[...l,{id:s.id,parentId:s.parentId,label:s.label,type:s.type,entityId:s.entityId,description:s.description}]:[{id:s.id,parentId:s.parentId,label:s.label,type:s.type,entityId:s.entityId,description:s.description}];return se.emit("companyStructure/updated",{message:"Structure updated",action:"add",nodeId:s.id,newParentId:s.parentId||void 0,nodes:k}),le(ue.EDIT_COMPANY_STRUCTURE_EVENT,{action:"add",nodeId:s.id,newParentId:s.parentId||void 0,nodeType:s.type}),k}),s.parentId&&U(l=>new Set([...l,s.parentId]))},[]),ee=B((s,l,k)=>{l&&a(H=>H?H.map(I=>s.includes(I.id)?{...I,label:l,description:k}:I):null)},[]),te=B(async s=>{if(s.length)try{h(!0);const l=new Map((i||[]).map(I=>[I.id,I])),k=s.map(I=>l.get(I)).filter(Boolean);for(const I of s){const z=l.get(I);!z||!z.entityId||(z.type==="team"?await Pe(z.entityId):await Fe({id:z.entityId,status:"INACTIVE"}))}a(I=>{if(!I)return null;const z=new Set(s);return I.filter(r=>!z.has(r.id))}),V(null),_(new Set),le(ue.EDIT_COMPANY_STRUCTURE_EVENT,{action:"remove",nodeIds:s}),se.emit("companyStructure/updated",{message:"Structure updated",action:"remove",nodeIds:s,nodes:i||[]});let H;if(s.length===1){const I=k[0];H=(I==null?void 0:I.type)==="team"?m.deleteTeamSuccess:m.removeUserSuccess}else H=m.removeMultipleSuccess.replace("{count}",s.length.toString());N("success",H)}catch(l){const k=l instanceof Error?l.message:S;N("error",k)}finally{h(!1)}},[i,N,S,m.removeUserSuccess,m.deleteTeamSuccess,m.removeMultipleSuccess]),re=B(s=>{Z(s)},[]),K=B(()=>{L(!0),N("success",""),Z({})},[N]),ae=B(s=>{s==null||s(),L(!1),Z({})},[]);return{nodes:i,loading:d,submitLoading:f,showEditForm:g,inputChange:j,expanded:E,setExpanded:U,selected:R,setSelected:V,selectedMany:O,setSelectedMany:_,move:x,expandAll:Y,collapseAll:q,insertNode:G,renameNodes:ee,removeNodes:te,handleInputChange:re,handleShowEditForm:K,handleHideEditForm:ae,renderAlertMessage:N,working:f}}const je=be(({permissions:u,slots:M})=>{var z;const p=(u==null?void 0:u.canEditUsers)??!1,m=(u==null?void 0:u.canViewUsers)??!1,t=J({expandAll:"Company.CompanyStructure.shared.buttons.expandAll",collapseAll:"Company.CompanyStructure.shared.buttons.collapseAll",addUser:"Company.CompanyStructure.shared.buttons.addUser",addTeam:"Company.CompanyStructure.shared.buttons.addTeam",editSelected:"Company.CompanyStructure.shared.buttons.editSelected",remove:"Company.CompanyStructure.shared.buttons.remove",ok:"Company.CompanyStructure.shared.buttons.ok",cancel:"Company.CompanyStructure.shared.buttons.cancel",close:"Company.CompanyStructure.shared.buttons.close",deleting:"Company.CompanyStructure.shared.buttons.deleting",removing:"Company.CompanyStructure.shared.buttons.removing",noStructureData:"Company.CompanyStructure.messages.noStructureData",processing:"Company.CompanyStructure.shared.messages.processing",cannotDeleteUser:"Company.CompanyStructure.messages.cannotDeleteUser",cannotDeleteTeam:"Company.CompanyStructure.messages.cannotDeleteTeam",removeUserConfirm:"Company.CompanyStructure.messages.removeUserConfirm",deleteTeamConfirm:"Company.CompanyStructure.messages.deleteTeamConfirm",removeItemsConfirm:"Company.CompanyStructure.messages.removeItemsConfirm",teamDescription:"Company.CompanyStructure.shared.messages.teamDescription",removeUserMessage:"Company.CompanyStructure.messages.removeUserMessage",cannotDeleteUserMessage:"Company.CompanyStructure.messages.cannotDeleteUserMessage",cannotDeleteTeamMessage:"Company.CompanyStructure.messages.cannotDeleteTeamMessage",removeItemsMessage:"Company.CompanyStructure.messages.removeItemsMessage",companyStructureActions:"Company.CompanyStructure.shared.ariaLabels.companyStructureActions",expandAllNodes:"Company.CompanyStructure.shared.ariaLabels.expandAllNodes",collapseAllNodes:"Company.CompanyStructure.shared.ariaLabels.collapseAllNodes",addUserAria:"Company.CompanyStructure.shared.ariaLabels.addUser",addTeamAria:"Company.CompanyStructure.shared.ariaLabels.addTeam",editSelectedAria:"Company.CompanyStructure.shared.ariaLabels.editSelected",removeSelectedAria:"Company.CompanyStructure.shared.ariaLabels.removeSelected",showDescription:"Company.CompanyStructure.shared.ariaLabels.showDescription",delete:"Company.CompanyStructure.shared.options.delete",expand:"Company.CompanyStructure.shared.options.expand",collapse:"Company.CompanyStructure.shared.options.collapse",deleteTeamMessage:"Company.CompanyStructure.messages.deleteTeamMessage"}),{inLineAlertProps:S,handleSetInLineAlert:i}=Ve(),{nodes:a,loading:d,submitLoading:o,expanded:f,setExpanded:h,selected:g,setSelected:L,selectedMany:E,setSelectedMany:U,move:R,expandAll:V,collapseAll:O,insertNode:_,renameNodes:j,removeNodes:Z}=$e({handleSetInLineAlert:i,permissions:u}),[C,v]=T(null),[D,N]=T("add"),[A,x]=T(!1),[Y,q]=T([]),[G,ee]=T({title:"",body:"",confirmLabel:t.remove,blocked:!1}),[te,re]=T(null),K=()=>v(null),ae=((z=a==null?void 0:a.find(r=>r.parentId===null))==null?void 0:z.id)??null,s=(a||[]).map(r=>({id:r.id,parentId:r.parentId,label:r.label})),l=r=>{if(!a)return 0;let c=0;const y=[r],n=new Set;for(;y.length>0;){const w=y.pop();if(!w||n.has(w))continue;n.add(w);const b=a.filter($=>$.parentId===w);c+=b.length,b.forEach($=>y.push($.id))}return c},k=(r,c)=>{let y=r;const n=new Map(s.map(b=>[b.id,b])),w=new Set;for(;y&&!w.has(y);){w.add(y);const b=n.get(y);if(!b)break;if(b.parentId===c)return!0;y=b.parentId??null}return!1},H=(a||[]).map(r=>({id:r.id,parentId:r.parentId,label:r.label,type:r.type,description:r.description,entityId:r.entityId})),I=P(pe,{children:[(()=>{const r=E!=null&&E.size?Array.from(E):g?[g]:[],c=p&&r.length===1,y=p&&r.length>=1;return e(Q,{variant:"secondary",className:"acm-structure-toolbar-card acm-structure-toolbar-card--spaced",children:P("div",{className:"acm-structure-toolbar",role:"toolbar","aria-label":t.companyStructureActions,children:[e(F,{type:"button",variant:"secondary",onClick:V,"aria-label":t.expandAllNodes,disabled:!m,"aria-disabled":!m,children:t.expandAll}),e(F,{type:"button",variant:"secondary",onClick:O,"aria-label":t.collapseAllNodes,disabled:!m,"aria-disabled":!m,children:t.collapseAll}),e(F,{type:"button",variant:"primary",onClick:()=>{N("add"),v("user")},"aria-label":t.addUserAria,disabled:!p,"aria-disabled":!p,children:t.addUser}),e(F,{type:"button",variant:"primary",onClick:()=>{N("add"),v("team")},"aria-label":t.addTeamAria,disabled:!p,"aria-disabled":!p,children:t.addTeam}),e(F,{type:"button",variant:"primary",disabled:!c,"aria-disabled":!c,"aria-label":t.editSelectedAria,onClick:()=>{if(!c)return;const n=r,w=a==null?void 0:a.find(b=>b.id===n[0]);(w==null?void 0:w.type)==="user"?(N("edit"),v("user")):(N("edit"),v("team"))},children:t.editSelected}),e(F,{type:"button",variant:"secondary",disabled:!y||o,"aria-disabled":!y||o,"aria-label":t.removeSelectedAria,onClick:()=>{if(!y||o)return;const n=r;if(n.length===1){const w=a==null?void 0:a.find($=>$.id===n[0]);if(!w)return;(a==null?void 0:a.some($=>$.parentId===w.id))?(ee({title:w.type==="user"?t.cannotDeleteUser:t.cannotDeleteTeam,body:w.type==="user"?t.cannotDeleteUserMessage:t.cannotDeleteTeamMessage,confirmLabel:void 0,blocked:!0}),q([]),x(!0)):(ee({title:w.type==="user"?t.removeUserConfirm:t.deleteTeamConfirm,body:w.type==="user"?t.removeUserMessage:t.deleteTeamMessage,confirmLabel:w.type==="user"?t.remove:t.delete,blocked:!1}),q(n),x(!0))}else ee({title:t.removeItemsConfirm.replace("{count}",n.length.toString()),body:t.removeItemsMessage,confirmLabel:t.remove,blocked:!1}),q(n),x(!0)},children:t.remove})]})})})(),C?P("div",{className:"acm-structure-panel",children:[o?P("div",{className:"acm-structure-working","aria-live":"polite",children:[e(de,{size:"small"})," ",t.processing]}):null,C==="user"?(()=>{const r=E!=null&&E.size?Array.from(E):g?[g]:[],c=r.length?a==null?void 0:a.find(n=>n.id===r[0]):void 0,y=(c==null?void 0:c.id)??ae;return e(Ue,{mode:D,entityId:c==null?void 0:c.entityId,parentStructureId:y,permissions:u,onSaved:n=>{D==="add"?n.structureId&&(_({id:n.structureId,parentId:y,label:n.label,type:n.type,entityId:n.entityId,description:n.jobTitle??void 0}),n.structureId&&(L(n.structureId),U(new Set([n.structureId])))):r.length&&(n.status==="INACTIVE"?Z(r):j(r,n.label,n.jobTitle??void 0)),K()},onCancel:K,onError:n=>{i({text:n,type:"error"})},onSuccess:n=>{i({text:n,type:"success"})}})})():null,C==="team"?(()=>{const r=E!=null&&E.size?Array.from(E):g?[g]:[],c=r.length?a==null?void 0:a.find(n=>n.id===r[0]):void 0,y=(c==null?void 0:c.id)??ae;return e(He,{mode:D,entityId:c==null?void 0:c.entityId,parentStructureId:y,permissions:u,onSaved:n=>{D==="add"?n.structureId&&(_({id:n.structureId,parentId:y,label:n.label,type:n.type,entityId:n.entityId,description:n.description}),n.structureId&&(L(n.structureId),U(new Set([n.structureId])))):r.length&&j(r,n.label,n.description),K()},onCancel:K,onError:n=>{i({text:n,type:"error"})},onSuccess:n=>{i({text:n,type:"success"})}})})():null]}):null,S&&S.text?e(Q,{variant:"secondary",className:"acm-structure-message-card",children:e(oe,{className:"acm-structure-panel__notification",type:S.type||"success",variant:"secondary",heading:S.text})}):null,!d&&!o&&a&&a.length===0?e(Q,{variant:"secondary",className:"acm-structure-message-card",children:e(oe,{className:"acm-structure-panel__notification",type:"warning",variant:"secondary",heading:t.noStructureData})}):null,!d&&o?e("div",{className:"acm-structure-tree-overlay","aria-live":"polite",children:e(de,{size:"medium"})}):null,d?e(Q,{variant:"secondary",className:"acm-structure-message-card",children:e("div",{className:"acm-structure-tree-content",children:e(Oe,{rows:8})})}):null,!d&&a&&a.length>0?e("div",{className:`acm-structure-tree-card ${o?"is-working":""}`,children:e(xe,{rootId:null,items:s,expandedIds:f,selectedId:g,selectedIds:E,onExpandedChange:h,onSelectedChange:L,onSelectedIdsChange:U,renderExpander:({expanded:r,toggle:c})=>e("button",{type:"button",className:`acm-structure-expander acm-structure-expander-button ${r?"is-open":""}`,"aria-label":r?t.collapse:t.expand,onClick:y=>{y.stopPropagation(),c()},children:e("span",{className:`acm-structure-chevron ${r?"is-expanded":""}`})}),renderNode:({item:r,hasChildren:c,expander:y,icon:n,select:w})=>{const b=a==null?void 0:a.find(W=>W.id===r.id),$=l(r.id),ne=(b==null?void 0:b.description)||"",Ie=(b==null?void 0:b.type)==="team"&&ne,me=(b==null?void 0:b.parentId)===null;return P("div",{className:"acm-structure-row",onClick:w,children:[!me&&e("span",{className:"acm-structure-handle","aria-hidden":!0}),n?e("span",{onClick:W=>W.stopPropagation(),children:n()}):e("span",{className:`acm-structure-icon ${(b==null?void 0:b.type)==="team"?"is-team":"is-user"} ${me?"is-root":""}`,"aria-hidden":!0}),P("div",{className:"acm-structure-info",children:[e("span",{className:"acm-structure-label",children:r.label}),ne?e("span",{className:"acm-structure-description",children:ne}):null]}),Ie?e(F,{type:"button",variant:"secondary",onClick:W=>{W.stopPropagation(),re({id:r.id,text:ne})},"aria-label":t.showDescription,className:"acm-structure-description-button",children:"?"}):null,$>0?e("span",{className:"acm-structure-count",children:$}):null,c&&y?e("span",{className:"acm-structure-expander-wrapper",onClick:W=>W.stopPropagation(),children:y()}):null]})},draggable:r=>{const c=a==null?void 0:a.find(n=>n.id===r.id),y=c?c.parentId===null:!1;return!o&&p&&!y},canDrop:(r,c)=>{if(!p||r===c)return!1;const y=a==null?void 0:a.find(n=>n.id===r);return y&&y.parentId===c?!1:!k(c,r)},onMove:async({id:r,newParentId:c})=>{p&&await R(r,c)}})}):null,A?e(Ce,{open:A,onClose:()=>{o||(x(!1),q([]))},children:P("div",{className:"acm-structure-modal-content",children:[e("h3",{className:"acm-structure-modal-title",children:G.title}),e("div",{children:G.body}),e("div",{className:"acm-structure-modal-actions",children:G.blocked?e(F,{type:"button",variant:"secondary",disabled:o,onClick:()=>{o||(x(!1),q([]))},children:t.ok}):P(pe,{children:[e(F,{type:"button",variant:"secondary",disabled:o,onClick:()=>{o||(x(!1),q([]))},children:t.cancel}),e(F,{type:"button",variant:"primary",disabled:o,onClick:async()=>{await Z(Y),x(!1),q([])},children:o?G.confirmLabel===t.delete?t.deleting:t.removing:G.confirmLabel||t.remove})]})})]})}):null,te?e(Ce,{open:!!te,onClose:()=>re(null),children:P("div",{className:"acm-structure-modal-content",children:[e("h3",{className:"acm-structure-modal-title",children:t.teamDescription}),e("div",{children:te.text}),e("div",{className:"acm-structure-modal-actions",children:e(F,{type:"button",variant:"secondary",onClick:()=>re(null),children:t.close})})]})}):null]});return M!=null&&M.StructureData?e(Te,{name:"StructureData",slot:M.StructureData,context:{structureData:H,Default:I}}):I}),Ye=()=>{const u=J({fetchPermissionsError:"Company.CompanyStructure.messages.fetchPermissionsError"}),[M,p]=T(null),[m,t]=T(!0),[S,i]=T(null),a=B(async()=>{var d,o;try{t(!0),i(null);const{roleResponse:f}=await he(),h=(o=(d=f==null?void 0:f.data)==null?void 0:d.customer)==null?void 0:o.role,g=ge(h);p(g)}catch(f){i(f instanceof Error?f:new Error(u.fetchPermissionsError))}finally{t(!1)}},[u.fetchPermissionsError]);return X(()=>{let d=!0;return(async()=>{var f,h;try{t(!0),i(null);const{roleResponse:g}=await he();if(!d)return;const L=(h=(f=g==null?void 0:g.data)==null?void 0:f.customer)==null?void 0:h.role,E=ge(L);p(E)}catch(g){if(!d)return;i(g instanceof Error?g:new Error(u.fetchPermissionsError))}finally{d&&t(!1)}})(),()=>{d=!1}},[]),{permissions:M,loading:m,error:S,refreshPermissions:a}},qe="/customer/company/create",Ze=({className:u,children:M,createCompanyAccountUrl:p=qe,...m})=>{const t=J({individualUserMessage:"Company.CustomerCompanyInfo.individualUserMessage",createAccountCta:"Company.CustomerCompanyInfo.createAccountCta"}),S=t.individualUserMessage||"You don't have a company account yet.";return e(Q,{variant:"secondary",className:ve(["company-management-company-structure-card",u]),...m,children:P("div",{children:[e(oe,{type:"warning",variant:"secondary",heading:S,icon:e(ze,{}),className:"company-management-company-structure-card__alert","data-testid":"company-structure-inline-alert"}),e("div",{className:"company-management-company-structure-card__cta",children:e(F,{as:"a",href:p,variant:"primary","data-testid":"company-structure-create-company-button",children:t.createAccountCta||"Create a Company Account"})})]})})},ht=({className:u,withHeader:M=!1,slots:p,isAuthenticated:m=!1,onRedirectLogin:t,onRedirectAccount:S})=>{const i=J({containerTitle:"Company.CompanyStructure.containerTitle"}),{permissions:a,refreshPermissions:d}=Ye(),[o,f]=T("loading");return we(d),X(()=>{let h=!0;return(async()=>{try{if(!m){h&&f("redirect-login");return}if(!await Ne()){h&&(console.log("Company registration disabled - redirecting to account dashboard"),f("redirect-account"));return}await Me()?h&&f("show-structure"):h&&f("show-empty")}catch(g){console.error("Error in CompanyStructure - redirecting to login page:",g),h&&f("redirect-login")}})(),()=>{h=!1}},[m]),X(()=>{o==="redirect-login"&&t&&t(),o==="redirect-account"&&S&&S()},[o,t,S]),o==="loading"||o==="redirect-login"||o==="redirect-account"?null:o==="show-empty"?e(Ze,{className:u}):o==="show-structure"?P("div",{className:ve(["account-company-structure",u]),children:[M?e(Ee,{title:i.containerTitle,divider:!1,className:"company-structure__title"}):null,e(je,{slots:p,permissions:a})]}):null};export{ht as CompanyStructure,ht as default};
//# sourceMappingURL=CompanyStructure.js.map
