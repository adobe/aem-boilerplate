/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as u,Fragment as x}from"@dropins/tools/preact-jsx-runtime.js";import{useMemo as R,useState as v,useCallback as S,useEffect as T}from"@dropins/tools/preact-hooks.js";import{Input as b,Icon as B}from"@dropins/tools/components.js";import{classes as F,VComponent as k,Slot as _,debounce as L}from"@dropins/tools/lib.js";import{events as E}from"@dropins/tools/event-bus.js";/* empty css                      */import{useText as A}from"@dropins/tools/i18n.js";import{p as N}from"../chunks/productSearch.js";import{t as y,u as D,S as I,s as U,a as j,b as z,c as K}from"../chunks/acdlEvents.js";import*as m from"@dropins/tools/preact-compat.js";import"@dropins/tools/fetch-graphql.js";const M=r=>m.createElement("svg",{id:"Icon_Search_Base","data-name":"Icon \\u2013 Search \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",viewBox:"0 0 24 24",...r},m.createElement("g",{id:"Large"},m.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),m.createElement("g",{id:"Search_icon","data-name":"Search icon",transform:"translate(3.75 3.75)"},m.createElement("circle",{vectorEffect:"non-scaling-stroke",id:"Ellipse_186","data-name":"Ellipse 186",cx:6,cy:6,r:6,fill:"none",stroke:"currentColor"}),m.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_556","data-name":"Line 556",x2:6,y2:6,transform:"translate(10.5 10.5)",fill:"none",stroke:"currentColor"})))),C={ENTER:"Enter",ESCAPE:"Escape"},O=({searchQuery:r="",defaultQueryPlaceholder:e,searchIcon:a,onQueryInput:o,onExecuteSearch:n,onClose:t})=>{const h=A({placeholder:"Search.SearchInput.placeholder"}),p=s=>{var f,c;const{key:i}=s,d=((c=(f=s.currentTarget)==null?void 0:f.value)==null?void 0:c.trim())||"";i===C.ENTER&&d?n==null||n(d):i===C.ESCAPE&&(t==null||t())},l=s=>{var i;o==null||o(((i=s.currentTarget)==null?void 0:i.value)||"")};return u("div",{className:F(["product-discovery--search-bar-input__container"]),children:u(b,{id:"search-bar-input-form",role:"searchbox","aria-label":"Search Input",value:r,placeholder:e||h.placeholder,icon:a?u(k,{className:"product-discovery--search-bar-input__form",node:a}):void 0,onKeyDown:p,onChange:l})})},V={attribute:"visibility",in:["Search","Catalog, Search"]},w=(r,e)=>{console.error(`Error collecting ${e}:`,r)},Y=r=>({currentPage:1,pageSize:r,totalPages:1,totalItems:r}),$=r=>{let e="";try{e=self.crypto.randomUUID(),D(I,e,r.phrase||"",r.filter||[],r.pageSize||0,r.currentPage||0,r.sort||[]),U(I)}catch(a){w(a,"search input context")}return e},H=(r,e,a)=>{try{j(I,r,{items:Array.isArray(e)?e:[],facets:[],pageInfo:Y((e==null?void 0:e.length)||0),totalCount:(e==null?void 0:e.length)||0}),z(I),a&&K(I)}catch(o){w(o,"search input data")}},G=r=>{const e=structuredClone(r);return e.filter||(e.filter=[]),e.filter.push(V),e},J=r=>{if(!(r!=null&&r.trim()))return Promise.resolve([]);const e={phrase:r.trim()},a=$(e),o=G(e);return N(o).then(n=>{const t=(y(n)||[]).slice(0,8);return H(a,t,!!e.phrase),t}).catch(n=>{throw console.error("SearchInput query failed:",n),new Error("Error fetching search input data.")})},W=(r,e,a)=>{const[o,n]=v(!1),[t,h]=v(null),p=S(async c=>{n(!0),h(null);try{E.emit("search-input/request",{phrase:c});const g=await J(c);E.emit("search-input/result",{result:g,request:{phrase:c}})}catch(g){const P=g instanceof Error?g.message:"Search Input failed";h(P)}finally{n(!1)}},[]),l=R(()=>L(p,e),[p,e]);T(()=>()=>{l.cancel&&l.cancel()},[l]);const s=S(()=>{E.emit("search-input/result",{result:[],request:{phrase:""}})},[]),i=S(c=>{if(t&&h(null),c.length<1){s();return}c.length>=r&&l(c)},[r,l,t,s]),d=S(c=>{a&&a(c),E.emit("search/request",{phrase:c})},[a]),f=S(()=>{h(null),n(!1),s()},[s]);return{isLoading:o,error:t,handleQueryInput:i,handleExecuteSearch:d,handleClose:f}},oe=({searchQuery:r,minimumQueryLength:e=3,debounceDelay:a=300,defaultQueryPlaceholder:o,routeSearch:n=()=>{},slots:t})=>{const{isLoading:h,error:p,handleQueryInput:l,handleExecuteSearch:s,handleClose:i}=W(e,a,n),d=R(()=>u(_,{name:"InputFormSearchIcon",slot:t==null?void 0:t.SearchIcon,children:u(B,{source:M,size:"24"})}),[t==null?void 0:t.SearchIcon]),f=R(()=>u(_,{name:"InputForm",slot:t==null?void 0:t.InputForm,children:u(O,{searchQuery:r,defaultQueryPlaceholder:o,searchIcon:d,onQueryInput:l,onExecuteSearch:s,onClose:i,isLoading:h,error:p})}),[r,o,d,l,s,i,h,p,t==null?void 0:t.InputForm]);return u(x,{children:f})};export{oe as SearchBarInput,oe as default};
//# sourceMappingURL=SearchBarInput.js.map
