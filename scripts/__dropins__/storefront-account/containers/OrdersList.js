/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as t,jsxs as l,Fragment as x}from"@dropins/tools/preact-jsx-runtime.js";import{classes as k,Slot as m}from"@dropins/tools/lib.js";import{S as B,c as j,E as Q,C as R}from"../chunks/AddressValidation.js";import"@dropins/tools/preact-compat.js";import{Card as G,Icon as F,Image as J,Price as X,ContentGrid as Z,Header as rr,Picker as tr,Pagination as er}from"@dropins/tools/components.js";import{useText as H}from"@dropins/tools/i18n.js";import{useState as y,useEffect as E,useMemo as U,useCallback as K}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import{g as ar}from"../chunks/getOrderHistoryList.js";import{g as sr}from"../chunks/getStoreConfig.js";import"../chunks/removeCustomerAddress.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/preact.js";import"../fragments.js";const V={size:"32",stroke:"2"},W=({minifiedView:n,orderNumber:c,orderToken:r,routeOrdersList:a,routeOrderDetails:u})=>{const s=n?"minifiedView":"fullSizeView",i=H({viewAllOrdersButton:`Account.${s}.OrdersList.viewAllOrdersButton`,ariaLabelLink:`Account.${s}.OrdersList.ariaLabelLink`});return a?t("a",{className:k(["account-orders-list-action",["account-orders-list-action--minifiedView",n]]),"data-testid":"ordersListActionButtonMinifiedView",href:a(),children:t(G,{"data-testid":"ordersListActionMinifiedView",variant:"secondary",children:l("div",{className:"account-orders-list-action__card-wrapper",children:[t("p",{children:i.viewAllOrdersButton}),t(F,{source:B,...V})]})})}):t("a",{"aria-label":`${i.ariaLabelLink} ${c??r}`,href:j(u)?u(c,r):"#",className:"account-orders-list-action","data-testid":"ordersListActionButton",children:t(F,{source:B,...V})})},nr=()=>{const[n,c]=y(window.innerWidth<768);return E(()=>{const r=()=>{c(window.innerWidth<768)};return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}},[]),n},cr=({placeholderImage:n,minifiedView:c,item:r,withThumbnails:a,children:u,slots:s,routeTracking:i,routeOrderProduct:g,routeReturnDetails:f,...b})=>{var M,w,P,N,z,T,O,Y,_,D,v,C;const o=c?"minifiedView":"fullSizeView",h=H({orderNumber:`Account.${o}.OrdersList.OrdersListCard.orderNumber`,itemsAmount:`Account.${o}.OrdersList.OrdersListCard.itemsAmount`,carrier:`Account.${o}.OrdersList.OrdersListCard.carrier`,returnsText:`Account.${o}.OrdersList.OrdersListCard.returns`,deliveryDateText:`Account.${o}.OrdersList.OrdersListCard.orderDate`}),d=nr(),S=j(g),L=U(()=>((r==null?void 0:r.items)??[]).map((e,p)=>{var $,q;const A={title:(e==null?void 0:e.productName)??"",src:((q=($=e==null?void 0:e.product)==null?void 0:$.smallImage)==null?void 0:q.url)||n,alt:(e==null?void 0:e.productName)??"",width:65,height:65,loading:"eager"};return t(m,{name:"OrderItemImage",slot:s==null?void 0:s.OrderItemImage,context:{data:e,defaultImageProps:A},children:S?t("a",{href:(g==null?void 0:g(e))??"",target:"_blank",rel:"noreferrer",children:t(J,{...A})}):t(J,{...A})},`${p}_${e.id}`)}),[S,r.items,n,g,s==null?void 0:s.OrderItemImage]);return l(G,{variant:"secondary",...b,className:k(["account-orders-list-card",["account-orders-list-card--full",((M=r==null?void 0:r.items)==null?void 0:M.length)>6]]),children:[t("div",{className:"account-orders-list-card__content",children:s!=null&&s.OrdersListCard?t(m,{"data-testid":`ordersListCard${r.id}`,name:"OrdersListCard",slot:s==null?void 0:s.OrdersListCard,context:{orderHistoryListItem:r}}):l(x,{children:[t("div",{children:r==null?void 0:r.status}),l("p",{children:[h.deliveryDateText," ",r==null?void 0:r.orderDate]}),l("p",{children:[h.orderNumber," ",r.number]}),(w=r==null?void 0:r.shipments)==null?void 0:w.map(e=>{var p;return(p=e==null?void 0:e.tracking)==null?void 0:p.map(A=>{const $=i==null?void 0:i(A);return l("p",{"data-testid":A.number,children:[t("span",{children:`${h.carrier} ${A.carrier.toLocaleUpperCase()} `}),$?t("a",{href:$,target:"_blank",className:"account-orders-list-card__content--track_number",rel:"noreferrer",children:A.number}):t("span",{className:"account-orders-list-card__content--track_number",children:A.number})]},e.id)})}),r!=null&&r.returns&&((P=r.returns)!=null&&P.length)?l("p",{"data-testid":r.number,children:[l("span",{children:[h.returnsText," "]}),(N=r==null?void 0:r.returns)==null?void 0:N.map(e=>t("span",{"data-testid":e.number,children:l("a",{href:(f==null?void 0:f({orderNumber:r.number,orderToken:r.token,returnNumber:e.number}))??"#",className:"account-orders-list-card__content--return_number",children:[e.number," "]})},e.uid))]},r.id):null,t("p",{children:t(X,{amount:((T=(z=r==null?void 0:r.total)==null?void 0:z.grandTotal)==null?void 0:T.value)??0,currency:(Y=(O=r==null?void 0:r.total)==null?void 0:O.grandTotal)==null?void 0:Y.currency,weight:"normal",size:"medium"})}),l("p",{"data-testid":"itemsAmount",children:[(_=r==null?void 0:r.items)!=null&&_.length?(D=r==null?void 0:r.items)==null?void 0:D.reduce((e,p)=>{const A=(p==null?void 0:p.quantityOrdered)||0;return e+A},0):0," ",h.itemsAmount]}),(v=r==null?void 0:r.items)==null?void 0:v.map((e,p)=>{if(p>=0&&p<10)return l("p",{className:"account-orders-list-card__content--product-name",children:[l("span",{className:"account-orders-list-card__content--quantity",children:[(e==null?void 0:e.quantityOrdered)>1?e==null?void 0:e.quantityOrdered:null," "]}),e==null?void 0:e.productName.replaceAll("-"," ")]},`${p}_${e.id}`);if(p===11)return t("p",{children:"..."},"ellipsis")})]})}),a&&((C=r==null?void 0:r.items)!=null&&C.length)?t(Z,{maxColumns:d?3:9,emptyGridContent:t(x,{}),className:k(["account-orders-list-card__images",["account-orders-list-card__images-3",d]]),"data-testid":"ordersListCardImages",children:L}):null,t("div",{className:"account-orders-list-card__actions",children:u})]})},or=({ordersInMinifiedView:n,minifiedView:c,pageSize:r,selectedDate:a,selectedPage:u,handleSetFirstOrderDate:s})=>{const[i,g]=y([]),[f,b]=y({totalPages:1,currentPage:1,pageSize:1}),[o,h]=y(!1),[d,S]=y("");return E(()=>{sr().then(L=>{S(L.baseMediaUrl)})},[]),E(()=>{h(!0),ar(c?n:r,a,u).then(L=>{!L||!L.items||(b(L.pageInfo),g(L.items),s==null||s(L.dateOfFirstOrder))}).finally(()=>{h(!1)})},[s,c,n,r,a,u]),{loading:o,orderHistoryListItems:i,pageInfo:f,placeholderImage:d}},I=(n,c=1)=>{const r=new Date,a=new Date(r);switch(n){case"sixMonthsAgo":{a.setMonth(a.getMonth()-c);break}case"oneYearAgo":{a.setFullYear(a.getFullYear()-c);break}default:return""}return{from:a==null?void 0:a.toISOString().split("T")[0],to:`${r==null?void 0:r.toISOString().split("T")[0]} 23:59:59`}},dr=n=>{const c=[],r=new Date().getFullYear();for(let a=n;a<=r-1;a++)c.push({value:`{"from":"${a}-01-01","to":"${a+1}-01-01 23:59:59"}`,text:a.toString()});return c},ir=()=>{const n=H({pastSixMonths:"Account.fullSizeView.OrdersList.OrdersListSelectDate.pastSixMonths",currentYear:"Account.fullSizeView.OrdersList.OrdersListSelectDate.currentYear",viewAll:"Account.fullSizeView.OrdersList.OrdersListSelectDate.viewAll"}),[c,r]=y(),[a,u]=y(JSON.stringify(I("sixMonthsAgo",6))),[s,i]=y(1);E(()=>{window==null||window.scrollTo({top:100,behavior:"smooth"})},[s]);const g=U(()=>{const o=[{value:JSON.stringify(I("sixMonthsAgo",6)),text:n.pastSixMonths},{value:JSON.stringify(I("oneYearAgo",1)),text:n.currentYear},{value:"viewAll",text:n.viewAll}];if(c){const d=new Date(c).getFullYear();o==null||o.splice(2,0,...dr(d))}return o},[n,c]),f=K(o=>{r(o)},[]),b=K(o=>{const d=o.target.value;u(d),i(1)},[]);return{selectableDateList:g,selectedDate:a,selectedPage:s,handleSelectDate:b,setSelectedPage:i,handleSetFirstOrderDate:f}},lr=({className:n,withHeader:c=!0,minifiedView:r=!1,withThumbnails:a=!0,withFilter:u=!0,ordersInMinifiedView:s=1,pageSize:i=10,routeOrdersList:g,routeOrderDetails:f,routeReturnDetails:b,routeTracking:o,routeOrderProduct:h,slots:d})=>{const S=r?"minifiedView":"fullSizeView",L=H({containerTitle:`Account.${S}.OrdersList.containerTitle`,dateOrderPlaced:`Account.${S}.OrdersList.dateOrderPlaced`}),{selectableDateList:M,selectedDate:w,handleSelectDate:P,selectedPage:N,setSelectedPage:z,handleSetFirstOrderDate:T}=ir(),{pageInfo:O,loading:Y,orderHistoryListItems:_,placeholderImage:D}=or({minifiedView:r,pageSize:i,ordersInMinifiedView:s,selectedDate:w,selectedPage:N,handleSetFirstOrderDate:T});return l("div",{children:[c?t(rr,{"aria-label":L.containerTitle,role:"region",title:L.containerTitle,divider:!r,className:r?"account-orders-list-header":""}):null,l("div",{className:k(["account-orders-list",n]),children:[!r&&u?l("div",{className:"account-orders-list__date-select",children:[t("span",{children:L.dateOrderPlaced}),t(tr,{value:w,name:"orderDatePicker",options:M,handleSelect:P})]}):null,Y?t(x,{children:Array.from(Array(O==null?void 0:O.pageSize).keys()).map(v=>t(R,{testId:"orderSkeletonLoader",withCard:!1},v))}):t(x,{children:_.length?t(x,{children:_.map((v,C)=>t(cr,{placeholderImage:D,routeTracking:o,routeOrderProduct:h,routeReturnDetails:b,minifiedView:r,item:v,withThumbnails:a,slots:d,children:d!=null&&d.OrdersListAction?t(m,{"data-testid":`ordersListActionSlot_${C}`,name:"OrdersListAction",slot:d==null?void 0:d.OrdersListAction,context:{orderHistoryListItem:v}}):t(W,{minifiedView:r,orderNumber:v.number,orderToken:v.token,routeOrderDetails:f})},C))}):t(Q,{isEmpty:!_.length,typeList:"orders",minifiedView:r})}),!r&&(O==null?void 0:O.totalPages)>1?t(er,{totalPages:O==null?void 0:O.totalPages,currentPage:N,onChange:z}):null,r?t(W,{minifiedView:r,routeOrdersList:g}):null]})]})},Nr=({className:n,withHeader:c,minifiedView:r,withThumbnails:a,withFilter:u,ordersInMinifiedView:s,pageSize:i,routeOrdersList:g,routeOrderDetails:f,routeReturnDetails:b,routeTracking:o,routeOrderProduct:h,slots:d})=>t("div",{className:k(["account-orders-list",n]),"data-testid":"ordersListId",children:t(lr,{className:n,withHeader:c,minifiedView:r,withThumbnails:a,withFilter:u,ordersInMinifiedView:s,pageSize:i,routeOrdersList:g,routeOrderDetails:f,routeReturnDetails:b,routeTracking:o,routeOrderProduct:h,slots:d})});export{Nr as OrdersList,Nr as default};
//# sourceMappingURL=OrdersList.js.map
