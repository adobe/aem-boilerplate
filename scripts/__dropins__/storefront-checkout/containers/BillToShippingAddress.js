/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as c,jsxs as E}from"@dropins/tools/preact-jsx-runtime.js";import{h as N}from"../chunks/errors.js";import"@dropins/tools/lib.js";import{events as T}from"@dropins/tools/event-bus.js";import{W as U,h as j,g as v}from"../chunks/ConditionalWrapper.js";import{n as w,g as L}from"../chunks/values.js";import{s as P}from"../chunks/setBillingAddress.js";/* empty css                             */import{Skeleton as R,SkeletonRow as W,Checkbox as y,InLineAlert as C}from"@dropins/tools/components.js";import{c as $}from"../chunks/classes.js";import{useText as _}from"@dropins/tools/i18n.js";import{useState as u,useRef as q,useCallback as m,useEffect as x}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";import"../fragments.js";import"../chunks/synchronizeCheckout.js";const F=()=>c(R,{className:"bill-to-shipping-address__skeleton","data-testid":"bill-to-shipping-skeleton",children:c(W,{size:"small",variant:"row"})}),G=({className:i,checked:r,disabled:e,error:o=null,onChange:n=()=>{},onDismissError:a=()=>{}})=>{const f=_({title:"Checkout.BillToShippingAddress.title"}),h=o!==null,g=k=>{const b=k.target;n==null||n(b.checked)};return E("div",{className:"checkout-bill-to-shipping-address",children:[c(y,{checked:r,className:$(["checkout-bill-to-shipping-address__checkbox",i]),"data-testid":"bill-to-shipping-checkbox",disabled:e,label:f.title,name:"checkout-bill-to-shipping-address__checkbox",onChange:g}),h&&c("div",{className:"checkout-bill-to-shipping-address__error","data-testid":"checkout-bill-to-shipping-address-alert",children:c(C,{heading:o,type:"error",variant:"primary",onDismiss:a})})]})},H=U(G,F);function J(i){var n;const r=(n=i.shippingAddresses)==null?void 0:n[0],e=!!i.billingAddress;return(r==null?void 0:r.sameAsBilling)??!e}const cs=({active:i=!0,autoSync:r=!0,onCartSyncError:e,onChange:o})=>{const[n,a]=u(null),[f,h]=u(!1),[g,k]=u(!1),[b,A]=u(!0),B=q(!1),V=N.value,{cartSyncError:S}=_({cartSyncError:"Checkout.BillToShippingAddress.cartSyncError"}),I=m(()=>{a(null)},[]),p=m(s=>{a(null),A(s),w({isBillToShipping:s})},[]),z=m(s=>{const t=s;p(t),o==null||o(t),!(!r||!t||!j())&&P({sameAsShipping:!0}).catch(l=>{p(!1),e==null||e({error:l}),e||a(S)})},[r,S,e,o,p]),d=m(s=>{const t=!s||(s==null?void 0:s.isEmpty),l=!!(s!=null&&s.isVirtual);if(t||l){k(l),p(!1),B.current=!1;return}if(!B.current){const D=J(s);p(D),B.current=!0}},[p]);return x(()=>{if(!i)return;const s=v();if(s){h(!0);const l=L("isBillToShipping");l!=null&&A(l),d(s);return}const t=T.on("checkout/initialized",l=>{h(!0),d(l)},{eager:!0});return()=>{t==null||t.off()}},[i,d]),x(()=>{if(!i)return;const s=T.on("checkout/updated",d,{eager:!1});return()=>{s==null||s.off()}},[i,d]),c(H,{checked:b,disabled:V,error:n,initialized:f,visible:i&&!g,onChange:z,onDismissError:I})};export{cs as BillToShippingAddress,cs as default};
//# sourceMappingURL=BillToShippingAddress.js.map
