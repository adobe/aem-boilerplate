/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as k,jsx as n,Fragment as de}from"@dropins/tools/preact-jsx-runtime.js";import*as l from"@dropins/tools/preact-compat.js";import{useState as P,useEffect as Y,useCallback as T}from"@dropins/tools/preact-compat.js";import{b as ke,a as ye,d as ve,u as Ce,g as G,i as Re}from"../chunks/addRequisitionListItemsToCart.js";import{Icon as j,Button as K,Price as me,Field as Se,Input as Ie,Image as Pe,Checkbox as Ae,Table as Ne,ProgressSpinner as Ee,InLineAlert as Te,Pagination as xe}from"@dropins/tools/components.js";import{events as b}from"@dropins/tools/event-bus.js";import{useState as pe,useCallback as U}from"@dropins/tools/preact-hooks.js";import{classes as ge,VComponent as Ve}from"@dropins/tools/lib.js";import{D as J}from"../chunks/RequisitionListForm.js";import"../chunks/state.js";import{u as Me,E as De}from"../chunks/RequisitionListView.js";import{h as He}from"@dropins/tools/preact.js";import{useText as ee}from"@dropins/tools/i18n.js";import{R as Be}from"../chunks/RequisitionListHeader.js";import{R as ze}from"../chunks/RequisitionListModal.js";import{P as Fe}from"../chunks/PageSizePicker.js";import"../chunks/updateRequisitionList.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/deleteRequisitionList.js";function We(){const[a,R]=pe(null),[p,d]=pe(new Set),y=U((f,S)=>{d(m=>{const w=new Set(m);return S?w.add(f):w.delete(f),w})},[]),v=U(()=>{var S;const f=(S=a==null?void 0:a.items)==null?void 0:S.map(m=>m.uid);d(new Set(f))},[a]),A=U(()=>{d(new Set)},[]);return{currentRequisitionList:a,setCurrentRequisitionList:R,selectedItems:p,setSelectedItems:d,handleItemSelection:y,handleSelectAll:v,handleSelectNone:A}}const $e=a=>l.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...a},l.createElement("g",{clipPath:"url(#clip0_102_196)"},l.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3601 18.16H6.5601L4.8801 3H2.3501M19.6701 19.59C19.6701 20.3687 19.0388 21 18.2601 21C17.4814 21 16.8501 20.3687 16.8501 19.59C16.8501 18.8113 17.4814 18.18 18.2601 18.18C19.0388 18.18 19.6701 18.8113 19.6701 19.59ZM7.42986 19.59C7.42986 20.3687 6.79858 21 6.01986 21C5.24114 21 4.60986 20.3687 4.60986 19.59C4.60986 18.8113 5.24114 18.18 6.01986 18.18C6.79858 18.18 7.42986 18.8113 7.42986 19.59Z",stroke:"currentColor",strokeLinejoin:"round"}),l.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M5.25 6.37L20.89 8.06L20.14 14.8H6.19",stroke:"currentColor",strokeLinejoin:"round"})),l.createElement("defs",null,l.createElement("clipPath",{id:"clip0_102_196"},l.createElement("rect",{vectorEffect:"non-scaling-stroke",width:19.29,height:19.5,fill:"white",transform:"translate(2.3501 2.25)"})))),je=a=>l.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...a},l.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),Qe=a=>l.createElement("svg",{id:"Icon_Search_Base","data-name":"Icon \\u2013 Search \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",viewBox:"0 0 24 24",...a},l.createElement("g",{id:"Large"},l.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),l.createElement("g",{id:"Search_icon","data-name":"Search icon",transform:"translate(3.75 3.75)"},l.createElement("circle",{vectorEffect:"non-scaling-stroke",id:"Ellipse_186","data-name":"Ellipse 186",cx:6,cy:6,r:6,fill:"none",stroke:"currentColor"}),l.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_556","data-name":"Line 556",x2:6,y2:6,transform:"translate(10.5 10.5)",fill:"none",stroke:"currentColor"})))),he=a=>l.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",...a},l.createElement("path",{d:"M1 5H23",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),l.createElement("path",{d:"M17.3674 22H6.63446C5.67952 22 4.88992 21.2688 4.8379 20.3338L4 5H20L19.1621 20.3338C19.1119 21.2688 18.3223 22 17.3655 22H17.3674Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),l.createElement("path",{d:"M9.87189 2H14.1281C14.6085 2 15 2.39766 15 2.88889V5H9V2.88889C9 2.39912 9.39006 2 9.87189 2Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),l.createElement("path",{d:"M8.87402 8.58057L9.39348 17.682",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),l.createElement("path",{d:"M14.6673 8.58057L14.146 17.682",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10})),Ze=({className:a,title:R="404 - Not Found",message:p="The requisition list you are looking for does not exist.",actionLabel:d,onAction:y,...v})=>k("div",{className:ge(["not-found",a]),"data-testid":"not-found",...v,children:[n(j,{source:Qe,size:"64",stroke:"2"}),n("h2",{children:R}),p&&n("p",{children:p}),d&&y&&n(K,{variant:"primary",onClick:y,children:d})]}),Oe=({className:a,items:R,selectedItems:p,currentPage:d,pageSize:y,canEdit:v=!0,handleItemSelection:A,handleUpdateQuantity:f,onAddToCart:S,onDeleteItem:m,...w})=>{const g=ee({productNameHeader:"RequisitionList.RequisitionListView.productListTable.headers.productName",skuHeader:"RequisitionList.RequisitionListView.productListTable.headers.sku",priceHeader:"RequisitionList.RequisitionListView.productListTable.headers.price",quantityHeader:"RequisitionList.RequisitionListView.productListTable.headers.quantity",subtotalHeader:"RequisitionList.RequisitionListView.productListTable.headers.subtotal",actionsHeader:"RequisitionList.RequisitionListView.productListTable.headers.actions",actionAddToCart:"RequisitionList.RequisitionListView.actionAddToCart",actionDelete:"RequisitionList.RequisitionListView.actionDelete",itemQuantity:"RequisitionList.RequisitionListView.productListTable.itemQuantity"}),z=[{label:"#",key:"index"},{label:"item",key:"item"},{label:g.priceHeader,key:"price"},{label:g.quantityHeader,key:"quantity"},{label:g.subtotalHeader,key:"subtotal"}];v&&(z.unshift({label:"",key:"selector"}),z.push({label:g.actionsHeader,key:"actions"}));const Q=(e,s)=>{const u=e.target.checked;A(s.uid,u)},Z=e=>(d-1)*y+e+1,D=e=>{var s,u;return((s=e.configured_product)==null?void 0:s.name)||((u=e.product)==null?void 0:u.name)||e.sku},E=e=>{var s,u,L,I;return(s=e.configured_product)!=null&&s.images?(u=e.configured_product.images[0])==null?void 0:u.url:(L=e.product)!=null&&L.images?(I=e.product.images[0])==null?void 0:I.url:""},O=e=>{var s;return((s=e.product)==null?void 0:s.name)||e.sku},X=e=>{var s;return(s=e.configured_product)==null?void 0:s.name},F=e=>{var s;return((s=e.configured_product)==null?void 0:s.sku)||e.sku},W=e=>{var s,u,L,I,x,r,N,V;return((I=(L=(u=(s=e.configured_product)==null?void 0:s.price)==null?void 0:u.final)==null?void 0:L.amount)==null?void 0:I.value)||((V=(N=(r=(x=e.product)==null?void 0:x.price)==null?void 0:r.final)==null?void 0:N.amount)==null?void 0:V.value)||0},H=e=>{var s,u,L,I,x,r,N,V;return((I=(L=(u=(s=e.configured_product)==null?void 0:s.price)==null?void 0:u.final)==null?void 0:L.amount)==null?void 0:I.currency)||((V=(N=(r=(x=e.product)==null?void 0:x.price)==null?void 0:r.final)==null?void 0:N.amount)==null?void 0:V.currency)},B=e=>W(e)*e.quantity,$=R.map((e,s)=>({selector:n(Ae,{className:"requisition-list-view-product-list-table__checkbox",name:"itemSelected","data-testid":`item-checkbox-${e.sku}`,onChange:u=>Q(u,e),value:e.sku,checked:p.has(e.uid)}),index:n("div",{className:"requisition-list-view-product-list-table__index-container",children:Z(s)}),item:k("div",{className:"requisition-list-view-product-list-table__item-container",children:[n(Pe,{className:"requisition-list-view-product-list-table__thumbnail",alt:D(e),src:E(e)}),k("div",{className:"requisition-list-view-product-list-table__item-details",children:[n("div",{className:"requisition-list-view-product-list-table__product-name",children:O(e)}),n("span",{className:"requisition-list-view-product-list-table__product-configurable-name",children:X(e)}),n("div",{className:"requisition-list-view-product-list-table__sku",children:F(e)})]})]}),price:n(me,{className:"requisition-list-view-product-list-table__price",amount:W(e),currency:H(e)}),quantity:n("span",{className:"requisition-list-view-product-list-table__quantity",children:n(Se,{disabled:!1,children:n(Ie,{id:"requisition-list-item-quantity",name:"quantity",type:"text",value:e.quantity,onBlur:u=>{const L=Number.parseInt(u.target.value,10);f(e.uid,L)}})})}),subtotal:n(me,{className:"requisition-list-view-product-list-table__price",amount:B(e),currency:H(e)}),actions:k("div",{className:"requisition-list-view__bulk-actions",children:[n(K,{type:"button",onClick:()=>S([e.uid]),icon:n(j,{source:$e}),"data-testid":"product-list-table-add-to-cart-button"}),n(K,{type:"button",variant:"secondary",icon:n(j,{source:he}),onClick:()=>m([e.uid]),"data-testid":"product-list-table-delete-button"})]})})),t=n(Ne,{columns:z,rowData:$,"data-testid":"product-list-table",mobileLayout:"stacked"});return n(Ve,{node:He("div",{}),className:ge(["requisition-list-view-product-list-table-container",a]),"data-testid":"product-list-table-container",...w,children:t})},Je=({selectedItems:a,deletingItemId:R,addingToCartItemId:p,bulkAddingToCart:d,updatingQuantityItemId:y,onSelectAll:v,onSelectNone:A,onBulkAddToCart:f,onBulkDelete:S})=>{const m=ee({statusDeleting:"RequisitionList.RequisitionListView.statusDeleting",actionSelectAll:"RequisitionList.RequisitionListView.actionSelectAll",actionSelectNone:"RequisitionList.RequisitionListView.actionSelectNone",actionAddToCart:"RequisitionList.RequisitionListView.actionAddToCart",actionDeleteSelectedItems:"RequisitionList.RequisitionListView.actionDeleteSelectedItems",statusBulkAddingToCart:"RequisitionList.RequisitionListView.statusBulkAddingToCart"}),w=R!==null||p!==null||d||y!==null,g=a.size>0;return k("div",{className:"requisition-list-view__batch-actions",children:[k("div",{className:"requisition-list-view__batch-actions-left",children:[n("button",{"data-testid":"bulk-actions-select-toggle-btn",type:"button",className:`requisition-list-view__batch-actions-select-toggle ${g?"requisition-list-view__batch-actions-select-toggle--active":""}`,onClick:g?A:v,disabled:w,"aria-label":g?m.actionSelectNone:m.actionSelectAll,children:n(j,{source:je})}),n("button",{type:"button",className:"requisition-list-view__batch-actions-select-label",onClick:g?A:v,disabled:w,children:m.actionSelectAll})]}),g&&k("div",{className:"requisition-list-view__batch-actions-buttons",children:[n("span",{className:"requisition-list-view__batch-actions-count-badge","aria-label":`${a.size} items selected`,children:a.size}),n(K,{"data-testid":"bulk-actions-add-to-cart-btn",type:"button",variant:"secondary",onClick:f,disabled:w,children:d?m.statusBulkAddingToCart:m.actionAddToCart}),n("button",{"data-testid":"bulk-actions-delete-btn",type:"button",className:"requisition-list-view__batch-actions-delete-icon",onClick:S,disabled:w,"aria-label":m.actionDeleteSelectedItems,children:n(j,{source:he})})]})]})},pt=({requisitionListUid:a,skipProductLoading:R=!1,pageSize:p=J,routeRequisitionListGrid:d})=>{var oe,se,ae,re,ce,le;const[y,v]=P(!1),[A,f]=P(null),[S,m]=P(null),[w,g]=P(!1),[z,Q]=P(null),[Z,D]=P(!1),[E,O]=P(p),[X,F]=P(!0),[W,H]=P(!1),[B,$]=P([]),{currentRequisitionList:t,setCurrentRequisitionList:e,selectedItems:s,setSelectedItems:u,handleItemSelection:L,handleSelectAll:I,handleSelectNone:x}=We(),r=ee({emptyRequisitionList:"RequisitionList.RequisitionListView.emptyRequisitionList",errorLoadingProducts:"RequisitionList.RequisitionListView.errorLoadingProducts",errorLoadPage:"RequisitionList.RequisitionListView.errorLoadPage",notFoundTitle:"RequisitionList.RequisitionListView.notFoundTitle",notFoundMessage:"RequisitionList.RequisitionListView.notFoundMessage",notFoundActionLabel:"RequisitionList.RequisitionListView.notFoundActionLabel",show:"RequisitionList.RequisitionListView.show",itemsCounter:"RequisitionList.RequisitionListView.itemsCounter",deleteItemsTitle:"RequisitionList.RequisitionListView.deleteItemsTitle",deleteItemsMessage:"RequisitionList.RequisitionListView.deleteItemsMessage",confirmAction:"RequisitionList.RequisitionListView.confirmAction",cancelAction:"RequisitionList.RequisitionListView.cancelAction"}),{alert:N,setAlert:V,handleRequisitionListAlert:te}=Me();Y(()=>{const i=b.on("requisitionList/data",c=>{(c==null?void 0:c.uid)===a&&(e(c),u(new Set))}),o=b.on("requisitionList/alert",te);return()=>{i==null||i.off(),o==null||o.off()}},[te,a,e,u]),Y(()=>{O(p)},[p]);const q=T(async i=>{var c,_;const o=((c=i.items)==null?void 0:c.map(C=>C.sku))||[];if(o.length===0)return i;v(!0);try{const C=await ke(o);if(C){const M=new Map;return C.forEach(h=>{M.set(h.sku,h)}),{...i,items:(_=i.items)==null?void 0:_.map(h=>({...h,product:M.get(h.sku)||h.product}))}}return console.warn("No products found"),i}catch(C){return console.warn(C instanceof Error?C.message:r.errorLoadingProducts),i}finally{v(!1)}},[r.errorLoadingProducts]);Y(()=>{if(!a){F(!1);return}if(t&&t.uid===a)return;F(!0),(async()=>{try{const o=await G(a,1,p);if(o)if(R)e(o);else{const c=await q(o);e(c)}}catch(o){console.error("Failed to initialize requisition list from UID:",o)}finally{F(!1)}})()},[a,p,R,q,e,t]);const ie=T(async i=>{i&&i.length===1?(g(!1),m(i)):(g(!0),m(null));try{const o=await ye(t.uid,i);o&&o.length>0?b.emit("requisitionList/alert",{action:"move",type:"error",context:"product",message:o.map(c=>c.message)}):b.emit("requisitionList/alert",{action:"move",type:"success",context:"product"})}catch{b.emit("requisitionList/alert",{action:"move",type:"error",context:"product"})}finally{m(null),g(!1)}},[t]),ne=T(i=>{i&&i.length>0&&($(i),H(!0))},[]),fe=T(async()=>{B.length===1?f(B[0]):f("bulk");try{const i=await ve(t.uid,B,E,t.page_info.current_page);if(i){const o=await q(i);e(o),b.emit("requisitionList/alert",{action:"delete",type:"success",context:"product"})}else b.emit("requisitionList/alert",{action:"delete",type:"error",context:"product"})}catch{b.emit("requisitionList/alert",{action:"delete",type:"error",context:"product"})}finally{f(null),H(!1),$([])}},[B,t,E,q,e]),we=T(async(i,o)=>{var c;Q(i);try{const _=(c=t.items)==null?void 0:c.find(h=>h.uid===i);if(!_){b.emit("requisitionList/alert",{action:"update",type:"error",context:"product"});return}const C={item_id:_.uid,entered_options:_.entered_options,selected_options:_.selected_options,quantity:o},M=await Ce(t.uid,[C],E,t.page_info.current_page);if(M){const h=await q(M);e(h),b.emit("requisitionList/alert",{action:"update",type:"success",context:"product"})}else b.emit("requisitionList/alert",{action:"update",type:"error",context:"product"})}catch{b.emit("requisitionList/alert",{action:"update",type:"error",context:"product"})}finally{Q(null)}},[t,q,e,E]),Le=T(async i=>{D(!0);try{const o=await G(t.uid,i,E);if(o){const c=await q(o);e(c)}else console.warn(r.errorLoadPage)}catch(o){console.warn(o instanceof Error?o.message:r.errorLoadPage)}finally{D(!1)}},[t==null?void 0:t.uid,q,E,r,e]),qe=T(async i=>{O(i),D(!0);try{const o=await G(t.uid,1,i);if(o){const c=await q(o);e(c)}else console.warn(r.errorLoadPage)}catch{console.warn(r.errorLoadPage)}finally{D(!1)}},[t==null?void 0:t.uid,q,r,e]),_e=T(async i=>{const o=await q(i);e(o)},[e,q]),be=()=>{var h,ue;const i=((h=t.page_info)==null?void 0:h.page_size)??J,o=((ue=t.page_info)==null?void 0:ue.current_page)??1,c=i*o,_=(t==null?void 0:t.items_count)??0,C=c-i+1,M=c>_?_:c;return n("span",{className:"requisition-list-view__pagination-items",children:r.itemsCounter.replace("{from}",C.toString()).replace("{to}",M.toString()).replace("{total}",_.toString())})};return k("div",{className:"requisition-list-view__container",children:[X?n("div",{className:"requisition-list-view__loading",children:n(Ee,{stroke:"4",size:"large"})}):!t||!Re(t==null?void 0:t.uid)?n(Ze,{title:r.notFoundTitle,message:r.notFoundMessage,actionLabel:d?r.notFoundActionLabel:void 0,onAction:d?()=>{const i=d();i&&typeof i=="string"&&(window.location.href=i)}:void 0}):k(de,{children:[n(Be,{requisitionList:t,routeRequisitionListGrid:d,onUpdate:_e}),t.items_count===0?n(De,{textContent:`${t.name} ${r.emptyRequisitionList}`}):k(de,{children:[N&&n(Te,{heading:N.description,type:N.type,variant:"primary",onDismiss:()=>V(null)}),n(Je,{selectedItems:s,deletingItemId:A,addingToCartItemId:S,bulkAddingToCart:w,updatingQuantityItemId:z,onSelectAll:I,onSelectNone:x,onBulkAddToCart:()=>ie(Array.from(s)),onBulkDelete:()=>ne(Array.from(s))}),n(Oe,{items:t.items,selectedItems:s,currentPage:((oe=t.page_info)==null?void 0:oe.current_page)||1,pageSize:((se=t.page_info)==null?void 0:se.page_size)||J,handleItemSelection:L,handleUpdateQuantity:we,onAddToCart:ie,onDeleteItem:ne}),t.page_info&&k("div",{className:"requisition-list-view__pagination",children:[be(),(((ae=t.page_info)==null?void 0:ae.total_pages)||0)>1&&n(xe,{totalPages:((re=t.page_info)==null?void 0:re.total_pages)||1,currentPage:((ce=t.page_info)==null?void 0:ce.current_page)||1,onChange:Le,disabled:Z||y}),k("div",{className:"requisition-list-view__pagination-picker",children:[n("span",{children:r.show}),n(Fe,{currentPageSize:((le=t.page_info)==null?void 0:le.page_size)||J,onPageSizeChange:qe,disabled:Z||y})]})]})]})]}),W&&n(ze,{isOpen:W,isLoading:A!==null,title:r.deleteItemsTitle,modalContent:r.deleteItemsMessage,confirmBtnCaption:r.confirmAction,closeBtnCaption:r.cancelAction,handleModalOnClose:()=>{H(!1),$([])},handleModalOnConfirm:fe})]})};export{pt as RequisitionListView,pt as default};
//# sourceMappingURL=RequisitionListView.js.map
