/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as b,jsx as r}from"@dropins/tools/preact-jsx-runtime.js";import{h as re,s as oe}from"../chunks/fetch-graphql.js";import{classes as U,VComponent as ne,deepmerge as ce,Slot as A}from"@dropins/tools/lib.js";import{i as ae}from"../chunks/events.js";import{h as se,a as ie}from"../chunks/events2.js";import{g as v,n as B}from"../chunks/values.js";import{events as D}from"@dropins/tools/event-bus.js";import{s as Z}from"../chunks/setPaymentMethod.js";import{W as me}from"../chunks/ConditionalWrapper.js";import"../chunks/TermsAndConditions.js";import{Skeleton as de,SkeletonRow as T,IllustratedMessage as ue,Icon as q,InLineAlert as le,ToggleButton as pe,RadioButton as he}from"@dropins/tools/components.js";import{s as fe}from"../chunks/dom.js";import*as _ from"@dropins/tools/preact-compat.js";import{useRef as ye,useEffect as ke}from"@dropins/tools/preact-compat.js";import{useText as F}from"@dropins/tools/i18n.js";import{useState as w,useMemo as H,useCallback as P,useEffect as j}from"@dropins/tools/preact-hooks.js";/* empty css                             *//* empty css                        *//* empty css                  *//* empty css                       *//* empty css                        */import{P as ge}from"../chunks/PurchaseOrder.js";import{P as Me}from"../chunks/PaymentOnAccount2.js";import{r as Pe}from"../chunks/render.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";import"../fragments.js";import"../chunks/guards.js";import"../chunks/synchronizeCheckout.js";import"../chunks/transform-shipping-methods.js";import"../chunks/classifiers.js";import"../chunks/getCompanyCredit.js";const Se=t=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},_.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.93 14.8V18.75H5.97C4.75 18.75 3.75 17.97 3.75 17V6.5M3.75 6.5C3.75 5.53 4.74 4.75 5.97 4.75H15.94V8.25H5.97C4.75 8.25 3.75 7.47 3.75 6.5Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),_.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.35 11.64H14.04V14.81H19.35V11.64Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),_.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.9304 11.64V8.25H15.1504",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),Ce=()=>b(de,{"data-testid":"payment-methods-skeleton",children:[r(T,{size:"medium",variant:"heading"}),r(T,{size:"medium",variant:"empty"}),r(T,{fullWidth:!0,size:"xlarge"}),r(T,{fullWidth:!0,size:"xlarge"})]}),Ee=({UIComponentType:t="ToggleButton",busy:o,code:c,icon:u,onSelectionChange:n,selected:a,title:d})=>{const p={busy:o,className:"checkout-payment-methods__method",label:d,name:"payment-method",onChange:()=>n({code:c,title:d}),value:c};return t==="ToggleButton"?r(pe,{...p,icon:u?r(q,{source:u}):void 0,selected:a}):r(he,{...p,checked:a,icon:u??void 0})},ve=({className:t,error:o=null,busy:c=!1,onDismissError:u,onSelectionChange:n=()=>{},options:a,paymentMethodContent:d,selection:p,title:M,UIComponentType:I})=>{const E=F({EmptyState:"Checkout.PaymentMethods.emptyState"}),m=o!==null,g=ye(null);return ke(()=>{m&&g.current&&fe(g.current)},[m]),b("div",{className:U(["checkout-payment-methods",t]),"data-testid":"checkout-payment-methods",children:[M&&r(ne,{className:"checkout-payment-methods__title",node:M}),!c&&a.length===0&&r(ue,{"data-testid":"checkout-payment-methods-empty",icon:r(q,{source:Se}),message:r("p",{children:E.EmptyState})}),b("div",{className:U(["checkout-payment-methods__wrapper",["checkout-payment-methods__wrapper--busy",c]]),"data-testid":"checkout-payment-methods-wrapper",children:[r("div",{className:U(["checkout-payment-methods__methods",["checkout-payment-methods--full-width",a.length%2!==0]]),children:a==null?void 0:a.map(y=>r(Ee,{UIComponentType:I,busy:c,code:y.code,icon:y.icon,selected:(p==null?void 0:p.code)===y.code,title:y.displayLabel??!0?y.title:"",onSelectionChange:n},y.code))}),d&&r("div",{className:"checkout-payment-methods__content",children:d})]}),m&&r("div",{ref:g,className:"checkout-payment-methods__error","data-testid":"checkout-payment-methods-alert",children:r(le,{heading:o,type:"error",variant:"primary",onDismiss:u})})]})},Te=me(ve,Ce),_e=(t,o)=>{let c;return function(...u){clearTimeout(c),c=setTimeout(()=>t.apply(this,u),o)}},$=(t,o)=>({enabled:!0,autoSync:!1,render:c=>{var d;const u=String(((d=c.additionalData)==null?void 0:d.purchase_order_number)??""),n=document.createElement("div"),a=_e(p=>{Z({code:o,purchase_order_number:p}).catch(console.error)},1e3);Pe.render(t,{initialReferenceNumber:u,onReferenceNumberChange:a})(n),c.replaceHTML(n)}}),we={companycredit:$(Me,"companycredit"),purchaseorder:$(ge,"purchaseorder")};function O(t,o){return t?o.some(c=>c.code===t.code):!1}function Ie(t,o){return!t||!o?!1:t.code===o.code}function Ve(t){return t?!!t.code&&!!t.title:!1}const st=({UIComponentType:t="ToggleButton",active:o=!0,autoSync:c=!0,displayTitle:u=!0,slots:n,onCartSyncError:a,onSelectionChange:d})=>{const[p,M]=w(null),[I,E]=w(!1),[m,g]=w(null),[y,N]=w([]),G=re.value,l=H(()=>{const e=(n==null?void 0:n.Methods)??{};return ce(we,e)},[n==null?void 0:n.Methods]),J=y.filter(e=>{var s;return((s=l==null?void 0:l[e.code])==null?void 0:s.enabled)!==!1}).map(e=>{const s=(l==null?void 0:l[e.code])||{};return{...e,...s}}),{cartSyncError:W,defaultTitle:x}=F({cartSyncError:"Checkout.PaymentMethods.cartSyncError",defaultTitle:"Checkout.PaymentMethods.title"}),K=P(e=>{g(i=>i&&{...i,additionalData:e});const s=v("selectedPaymentMethod");s&&B({selectedPaymentMethod:{...s,additionalData:e}})},[]),Q=P(()=>{M(null)},[]),f=P(e=>{M(null),g(e),B({selectedPaymentMethod:e})},[]),S=P(async(e,s)=>{if(!(ae()||se()))return;const h=l==null?void 0:l[e.code];((h==null?void 0:h.autoSync)??c)&&Z({code:e.code}).catch(k=>{f(s??null),a==null||a({method:e,error:k}),a||M(W)})},[l,c,f,a,W]),X=P(async e=>{const s=v("selectedPaymentMethod");f(e),d==null||d(e),await S(e,s)},[d,f,S]),C=P(e=>{if(!e||e.isEmpty){f(null),N([]);return}const i=e.availablePaymentMethods??[];if(N(i),i.length===0){f(null);return}const h=e.selectedPaymentMethod??null,V=Ve(h),k=v("selectedPaymentMethod"),L=O(k,i),te=Ie(k,h);if(k&&L&&!te){S(k,h);return}if((!k||!L)&&V&&O(h,i)){f(h);return}if((!k||!L)&&(!V||!O(h,i))){const R=i[0];f(R),S(R)}},[f,S]);j(()=>{if(!o)return;const e=ie();if(e){E(!0);const i=v("selectedPaymentMethod");i&&g(i),C(e);return}const s=D.on("checkout/initialized",i=>{E(!0),C(i)},{eager:!0});return()=>{s==null||s.off()}},[o,C]),j(()=>{if(!o)return;const e=D.on("checkout/updated",C,{eager:!1});return()=>{e==null||e.off()}},[o,C]);const z=l[(m==null?void 0:m.code)||""],Y=z?r(A,{context:{additionalData:m==null?void 0:m.additionalData,cartId:oe.cartId??"",replaceHTML(e){this.replaceWith(e)},setAdditionalData:K},name:"PaymentMethodContent",slot:z.render},m==null?void 0:m.code):void 0,ee=H(()=>{if(u)return r(A,{name:"checkout-payment-methods-title",slot:n==null?void 0:n.Title,children:r("h2",{children:x})})},[u,n==null?void 0:n.Title,x]);return r(Te,{UIComponentType:t,busy:G,error:p,initialized:I,options:J,paymentMethodContent:Y,selection:m,title:ee,visible:o,onDismissError:Q,onSelectionChange:X})};export{st as PaymentMethods,st as default};
//# sourceMappingURL=PaymentMethods.js.map
