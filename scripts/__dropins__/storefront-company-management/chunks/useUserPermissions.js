/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as r,jsxs as B}from"@dropins/tools/preact-jsx-runtime.js";import{Fragment as T}from"@dropins/tools/preact.js";import{classes as w,VComponent as S}from"@dropins/tools/lib.js";import{Button as A,Icon as P,Skeleton as R,SkeletonRow as $}from"@dropins/tools/components.js";import{useText as x}from"@dropins/tools/i18n.js";import{useState as N,useRef as v,useCallback as E,useEffect as U}from"@dropins/tools/preact-hooks.js";import{b as j}from"./company-permissions.js";import{u as z}from"./useCompanyContextListener.js";import{f as V}from"./fetchUserPermissions.js";const X=({className:y,children:D,columns:l=[],rowData:b=[],mobileLayout:m="none",caption:n,expandedRows:d=new Set,loading:p=!1,skeletonRowCount:i=10,onSortChange:c,...f})=>{const a=x({sortedAscending:"Dropin.Table.sortedAscending",sortedDescending:"Dropin.Table.sortedDescending",sortBy:"Dropin.Table.sortBy"}),u=e=>{if(!c)return;let t;e.sortBy===!0?t="asc":e.sortBy==="asc"?t="desc":t=!0,c(e.key,t)},g=e=>{if(e.sortBy===void 0)return null;const t=e.ariaLabel??e.label;let s,o;return e.sortBy==="asc"?(s="ChevronUp",o=a.sortedAscending.replace("{label}",t)):e.sortBy==="desc"?(s="ChevronDown",o=a.sortedDescending.replace("{label}",t)):(s="Sort",o=a.sortBy.replace("{label}",t)),r(A,{variant:"tertiary",size:"medium",className:"dropin-table__header__sort-button",icon:r(P,{source:s}),"aria-label":o,onClick:()=>u(e)})},C=()=>Array.from({length:i},(e,t)=>r("tr",{className:"dropin-table__body__row",children:l.map(s=>r("td",{className:"dropin-table__body__cell","data-label":s.ariaLabel??s.label,children:r(R,{children:r($,{variant:"row",size:"small",fullWidth:!0})})},s.key))},`skeleton-${t}`)),F=()=>b.map((e,t)=>{const s=e._rowDetails!==void 0,o=d.has(t);return B(T,{children:[r("tr",{className:"dropin-table__body__row",children:l.map(_=>{const h=e[_.key],k=_.ariaLabel??_.label;return typeof h=="string"||typeof h=="number"?r("td",{className:"dropin-table__body__cell","data-label":k,children:h},_.key):r("td",{className:"dropin-table__body__cell","data-label":k,children:r(S,{node:h})},_.key)})}),s&&o&&r("tr",{className:"dropin-table__row-details dropin-table__row-details--expanded",id:`row-${t}-details`,children:r("td",{className:"dropin-table__row-details__cell",colSpan:l.length,role:"region","aria-labelledby":`row-${t}-details`,children:typeof e._rowDetails=="string"?e._rowDetails:r(S,{node:e._rowDetails})})},`${t}-details`)]},t)}),L=e=>{if(e.sortBy===!0)return"none";if(e.sortBy==="asc")return"ascending";if(e.sortBy==="desc")return"descending"};return r("div",{className:w(["dropin-table",`dropin-table--mobile-layout-${m}`,y]),children:B("table",{...f,className:"dropin-table__table",children:[n&&r("caption",{className:"dropin-table__caption",children:n}),r("thead",{className:"dropin-table__header",children:r("tr",{className:"dropin-table__header__row",children:l.map(e=>B("th",{className:w(["dropin-table__header__cell",["dropin-table__header__cell--sorted",e.sortBy==="asc"||e.sortBy==="desc"],["dropin-table__header__cell--sortable",e.sortBy!==void 0]]),"aria-sort":L(e),children:[e.label,g(e)]},e.key))})}),r("tbody",{className:"dropin-table__body",children:p?C():F()})]})})},Y=()=>{const[y,D]=N(null),[l,b]=N(!0),[m,n]=N(null),d=v(!1),p=v(!1),i=E(async()=>{var c,f;if(!d.current){d.current=!0,b(!0),n(null);try{const{roleResponse:a}=await V(),u=(f=(c=a==null?void 0:a.data)==null?void 0:c.customer)==null?void 0:f.role,g=j(u);D(g)}catch(a){console.error("Failed to fetch user permissions:",a),n(a)}finally{b(!1),d.current=!1}}},[]);return U(()=>{p.current||(p.current=!0,i())},[i]),z(i,{eager:!0}),{permissions:y,loading:l,error:m,refetch:i}};export{X as T,Y as u};
//# sourceMappingURL=useUserPermissions.js.map
