/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as e,jsxs as m,Fragment as x}from"@dropins/tools/preact-jsx-runtime.js";import*as k from"@dropins/tools/preact-compat.js";import{useState as q,useEffect as T,useCallback as p,useMemo as D}from"@dropins/tools/preact-compat.js";import{Card as E,Icon as N,Button as F,InLineAlert as V}from"@dropins/tools/components.js";import{c as H,R as J,f as K,h as X,t as Y}from"../chunks/updateRequisitionList.js";import{events as I}from"@dropins/tools/event-bus.js";import"@dropins/tools/preact-hooks.js";import"@dropins/tools/lib.js";import"../chunks/RequisitionListForm.js";import{R as Z}from"../chunks/RequisitionListForm2.js";import{s as l,a as $,b,u as ii}from"../chunks/state.js";import{g as ti}from"../chunks/getRequisitionLists.js";import{u as si,S as P,E as ei}from"../chunks/RequisitionListView.js";import"@dropins/tools/preact.js";import{R as oi}from"../chunks/RequisitionListActions.js";import{R as ni}from"../chunks/RequisitionListModal.js";import{useText as ri}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";let L=0;const ai=()=>{const[u,o]=q(l.requisitionLists),[d,c]=q(l.requisitionListsLoading),[n,r]=q(L);return T(()=>{l.requisitionLists.length===0&&!l.requisitionListsLoading&&($(!0),ti(1,100).then(t=>{const i=(t==null?void 0:t.items)||[];b(i),L++}).catch(t=>{console.error("Error fetching requisition lists:",t),b([]),L++}).finally(()=>{$(!1)}))},[]),T(()=>{const t=I.on("requisitionLists/data",s=>{s&&(b(s),L++,r(L),o(l.requisitionLists),c(l.requisitionListsLoading))}),i=I.on("requisitionList/data",s=>{s&&(ii(s),L++,r(L),o([...l.requisitionLists]),c(l.requisitionListsLoading))});return()=>{t==null||t.off(),i==null||i.off()}},[]),T(()=>{n!==L&&(o(l.requisitionLists),c(l.requisitionListsLoading),r(L))},[n]),{lists:u,loading:d}},li=()=>{var d,c;const[u,o]=q(((d=l.config)==null?void 0:d.is_requisition_list_active)==="1"&&((c=l.config)==null?void 0:c.company_enabled)===!0);return T(()=>{const n=I.on("requisitionList/initialized",()=>{var r,t;o(((r=l.config)==null?void 0:r.is_requisition_list_active)==="1"&&((t=l.config)==null?void 0:t.company_enabled)===!0)});return()=>n==null?void 0:n.off()},[]),{isEnabled:u}},ci=`
  mutation ADD_PRODUCTS_TO_REQUISITION_LIST_MUTATION(
      $requisitionListUid: ID!, 
      $requisitionListItems: [RequisitionListItemsInput!]!
    ) {
    addProductsToRequisitionList(
      requisitionListUid: $requisitionListUid
      requisitionListItems: $requisitionListItems
    ) {
      requisition_list {
        ...REQUISITION_LIST_FRAGMENT
        items {
          ...REQUISITION_LIST_ITEMS_FRAGMENT
        }
      }
    }
  }
${H}
${J}
`,di=async(u,o)=>{var t;const d=o.map(i=>{const s={sku:i.sku,quantity:i.quantity};return i.parent_sku&&(s.parent_sku=i.parent_sku),i.selected_options&&i.selected_options.length>0&&(s.selected_options=i.selected_options),i.entered_options&&i.entered_options.length>0&&(s.entered_options=i.entered_options),s}),{errors:c,data:n}=await K(ci,{variables:{requisitionListUid:u,requisitionListItems:d}});if(c)return X(c);if(!((t=n==null?void 0:n.addProductsToRequisitionList)!=null&&t.requisition_list))return null;const r=Y(n.addProductsToRequisitionList.requisition_list);return I.emit("requisitionList/data",r),r},ui=u=>k.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...u},k.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M7.74512 9.87701L12.0001 14.132L16.2551 9.87701",stroke:"currentColor",strokeWidth:1,strokeLinecap:"square",strokeLinejoin:"round"})),Ai=({canCreate:u=!0,sku:o,selectedOptions:d,quantity:c=1,beforeAddProdToReqList:n})=>{const r=ri({createTitle:"RequisitionList.RequisitionListForm.createTitle",addToRequisitionList:"RequisitionList.RequisitionListForm.addToRequisitionList",emptyList:"RequisitionList.RequisitionListWrapper.emptyList",addToNewRequisitionList:"RequisitionList.RequisitionListSelector.addToNewRequisitionList",addToSelected:"RequisitionList.RequisitionListSelector.addToSelected"}),[t,i]=q(!1),[s,A]=q(null),{lists:_}=ai(),{isEnabled:O}=li(),{alert:f,setAlert:w,handleRequisitionListAlert:R}=si(),[U,M]=q({isOpen:!1,isLoading:!1}),g=p(()=>{M({isOpen:!0,isLoading:!1})},[]),S=p(()=>{M({isOpen:!1,isLoading:!1}),A(null),i(!1),w(null)},[w]),C=p(async a=>{try{const h={sku:o,quantity:c,...d&&d.length>0?{selected_options:d}:{}};await di(a,[h])}catch(h){throw console.error("Error adding product to list:",h),h}},[o,c,d]),v=p(async a=>{try{await C(a),R({action:"add",type:"success",context:"product",skus:[o]})}catch{R({action:"add",type:"error",context:"product",skus:[o]})}finally{setTimeout(()=>{S()},2e3)}},[o,C,S,R]),Q=p(a=>{a.preventDefault(),s&&v(s)},[s,v]),G=p(()=>{if(!n){g();return}Promise.resolve(n()).then(()=>{g()}).catch(()=>{})},[n,g]),y=D(()=>[...(_==null?void 0:_.map(a=>({value:a.uid,text:a.name})))??[]],[_]),j=D(()=>e("div",{className:"requisition-list-selector__available-lists",children:y.map(a=>m(E,{variant:s===a.value?"primary":"secondary",onClick:()=>{A(a.value)},children:[e(N,{source:P}),e("span",{children:a.text})]},a.value))}),[y,s]),z=y.length>0?t?m("button",{type:"button","aria-label":"Select a requisition list",role:"button",className:"requisition-list-actions","data-testid":"requisition-list-actions-button",onClick:()=>i(!1),children:[e("span",{className:"requisition-list-actions__title","data-testid":"requisition-list-actions-button-text",children:r.addToRequisitionList}),e(N,{source:ui,size:"32"})]}):e(E,{variant:"secondary",children:m("form",{onSubmit:Q,className:"requisition-list-selector__form",children:[j,e("div",{className:"requisition-list-form__actions",children:e(F,{type:"submit",disabled:!s,children:r.addToSelected})})]})}):e(ei,{textContent:r.emptyList}),W=t?e(E,{variant:"secondary",children:e(Z,{mode:"create",onSuccess:async a=>{await v(a.uid)},onError:()=>{R({action:"add",type:"error",context:"product",skus:[o]})},onCancel:()=>{i(!1)}})}):e(oi,{onAddNew:()=>{i(!0)}}),B=m(x,{children:[f&&e("div",{className:"requisition-list__alert-wrapper",children:e(V,{id:`requisition-list-selector__alert__${o}`,heading:f.description,type:f.type,variant:"primary",className:"requisition-list-selector__alert"},`requisition-list-selector__alert__${o}`)}),!f&&m(x,{children:[z,u&&W]})]});return O===null||!O?null:m("div",{className:"requisition-list-selector",children:[e(F,{"aria-label":r.addToRequisitionList,"data-testid":"requisition-list-selector",size:"medium",variant:"tertiary",icon:e(N,{source:P}),onClick:G}),U.isOpen&&e(ni,{isOpen:!0,isLoading:U.isLoading,title:r.addToRequisitionList,modalContent:B,handleModalOnClose:S})]})};export{Ai as RequisitionListSelector,Ai as default};
//# sourceMappingURL=RequisitionListSelector.js.map
