/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as i,jsxs as S,Fragment as A}from"@dropins/tools/preact-jsx-runtime.js";import{classes as L,VComponent as q,Slot as N}from"@dropins/tools/lib.js";import{Card as R,Header as E,Accordion as V,AccordionSection as B,ContentGrid as M,Image as U}from"@dropins/tools/components.js";import{useState as G,useEffect as D}from"@dropins/tools/preact-hooks.js";import"../chunks/ShippingStatusCard.js";import"@dropins/tools/preact-compat.js";import{u as nn}from"../chunks/useGetStoreConfig.js";import"@dropins/tools/preact.js";import{events as en}from"@dropins/tools/event-bus.js";import{C as pn}from"../chunks/OrderLoaders.js";import{u as tn}from"../chunks/useIsMobile.js";import{Text as H,useText as rn}from"@dropins/tools/i18n.js";import"../chunks/getStoreConfig.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";var Y=(l=>(l.PENDING="pending",l.SHIPPING="shipping",l.COMPLETE="complete",l.PROCESSING="processing",l.HOLD="on hold",l.CANCELED="Canceled",l.SUSPECTED_FRAUD="suspected fraud",l.PAYMENT_REVIEW="payment review",l))(Y||{});const ln=({orderData:l})=>{const[r,p]=G(!0),[n,c]=G(l),[s,g]=G(!1);return D(()=>{const h=en.on("order/data",a=>{c(a),g(a==null?void 0:a.isVirtual),p(!1)},{eager:!0});return l!=null&&l.id&&p(!1),()=>{h==null||h.off()}},[l]),{loading:r,order:n,isVirtualProduct:s}},k=({value:l,variant:r="primary",size:p="medium",icon:n,className:c,children:s,disabled:g=!1,active:h=!1,activeChildren:a,activeIcon:C,href:e,...f})=>{let u="dropin-button";(n&&!s||n&&h&&!a||!n&&h&&C)&&(u="dropin-iconButton"),h&&a&&(u="dropin-button"),c=L([u,`${u}--${p}`,`${u}--${r}`,[`${u}--${r}--disabled`,g],s&&n&&`${u}--with-icon`,!s&&a&&n&&`${u}--with-icon`,h&&C&&`${u}--with-icon`,c]);const b=L(["dropin-button-icon",`dropin-button-icon--${r}`,[`dropin-button-icon--${r}--disabled`,g],n==null?void 0:n.props.className]),m=e?{node:i("a",{}),role:"link",href:e,...f,disabled:g,active:h,onKeyDown:I=>{g&&I.preventDefault()},tabIndex:g?-1:0}:{node:i("button",{}),role:"button",...f,value:l,disabled:g,active:h};return S(q,{...m,className:c,children:[n&&!h&&i(q,{node:n,className:b}),C&&h&&i(q,{node:C,className:b}),s&&!h&&(typeof s=="string"?i("span",{children:s}):s),h&&a&&(typeof a=="string"?i("span",{children:a}):a)]})},sn=({placeholderImage:l,slots:r,collapseThreshold:p,translations:n,returnData:c,routeTracking:s,routeProductDetails:g})=>{var C;const h=tn(),a=g?"a":"span";return S(R,{variant:"secondary",className:L(["order-shipping-status-card","order-shipping-status-card--return-order"]),children:[i(E,{title:n.returnOrderCardTitle}),S("div",{children:[(C=c==null?void 0:c.tracking)==null?void 0:C.map((e,f)=>{var I,O;const u={title:"",number:(e==null?void 0:e.trackingNumber)??"",carrier:((I=e==null?void 0:e.carrier)==null?void 0:I.label)??""},b=s==null?void 0:s(u),m=b?()=>{window.open(b,"_blank","noreferrer")}:null;return S("div",{className:"order-shipping-status-card__header",children:[S("div",{children:[`${n.carrier} `,`${(O=u.carrier)==null?void 0:O.toLocaleUpperCase()} | `,u.number]}),m?i(k,{onClick:m,children:n.trackButton}):null]},`${u.number}_${f}`)}),r!=null&&r.ReturnItemsDetails?i(N,{"data-testid":"returnItemsDetails",name:"ReturnItemsDetails",slot:r==null?void 0:r.ReturnItemsDetails,context:{items:c.items}}):null,i(V,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(B,{defaultOpen:p>=c.items.length,title:i(H,{id:"Order.ShippingStatusCard.itemText",plural:c.items.reduce((e,f)=>e+f.requestQuantity,0),fields:{count:c.items.reduce((e,f)=>e+f.requestQuantity,0)}}),children:i(M,{maxColumns:h?3:9,emptyGridContent:i(A,{}),className:L(["order-shipping-status-card__images",["order-shipping-status-card__images-3",h]]),children:c.items.map((e,f)=>{var b,m,I;const u={title:((b=e.thumbnail)==null?void 0:b.label)??"",src:((m=e.thumbnail)==null?void 0:m.url)??l,alt:((I=e.thumbnail)==null?void 0:I.label)??"",width:85,height:114,loading:"lazy"};return i(a,{href:(g==null?void 0:g(e))??"#","data-testid":`${f}${e.uid}`,children:i(N,{slotTag:"span",contentTag:"span",name:"ShippingStatusCardImage",slot:r==null?void 0:r.ShippingStatusReturnCardImage,context:{data:e,defaultImageProps:u},children:i(U,{...u})})},`${f}${e.uid}`)})})})})]})]})},dn=({placeholderImage:l,translations:r,slots:p,orderData:n,collapseThreshold:c=10,routeProductDetails:s,routeTracking:g})=>{var O,j,z,F,Q,K,W;const h=!!(n!=null&&n.returnNumber),a=n==null?void 0:n.returnNumber,C=s?"a":"span",e=(O=n==null?void 0:n.status)==null?void 0:O.toLocaleLowerCase(),u=((j=n==null?void 0:n.shipments)==null?void 0:j.length)===1&&(e==null?void 0:e.includes(Y.COMPLETE)),b=(z=n==null?void 0:n.shipments)==null?void 0:z.every(t=>t.tracking.length===0),m=(F=n==null?void 0:n.items)==null?void 0:F.filter(t=>(t==null?void 0:t.quantityShipped)===0||(t==null?void 0:t.quantityShipped)<(t==null?void 0:t.quantityOrdered)),I=(Q=n==null?void 0:n.items)==null?void 0:Q.reduce((t,o)=>{const T=o.quantityOrdered-o.quantityShipped;return t+(T>0?T:0)},0);if(h&&(n!=null&&n.returns.length)){const t=n.returns.find(o=>o.returnNumber===a);return!t||t.tracking.length===0?null:i(sn,{placeholderImage:l,slots:p,collapseThreshold:c,translations:r,returnData:t,routeTracking:g,routeProductDetails:s})}return!n||e!=null&&e.includes(Y.CANCELED)?null:(K=n==null?void 0:n.shipments)!=null&&K.length?b&&!(m!=null&&m.length)&&u?null:S(A,{children:[(W=n==null?void 0:n.shipments)==null?void 0:W.map(({tracking:t,items:o,id:T},w)=>{const _=o.reduce((d,y)=>d+((y==null?void 0:y.quantityShipped)??y.orderItem.quantityShipped??0),0);return S(R,{variant:"secondary",className:"order-shipping-status-card",children:[i(E,{title:r.shippingCardTitle}),t==null?void 0:t.map(d=>{var x;const y=g==null?void 0:g(d),$=y?()=>{window.open(y,"_blank","noreferrer")}:null;return S("div",{className:"order-shipping-status-card__header",role:"status",children:[S("div",{className:"order-shipping-status-card__header--content",children:[S("p",{children:[r.carrier," ",(x=d==null?void 0:d.carrier)==null?void 0:x.toLocaleUpperCase()," | ",d==null?void 0:d.number]}),i("p",{children:d==null?void 0:d.title})]}),p!=null&&p.DeliveryTrackActions?i(N,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:p==null?void 0:p.DeliveryTrackActions,context:{trackInformation:d}}):$?i(k,{onClick:$,children:r.trackButton}):null]},d.number)}),u?null:i(V,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(B,{"data-position":w+1,defaultOpen:c>=(o==null?void 0:o.length),title:i(H,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:_,fields:{count:_}}),children:i(M,{maxColumns:6,emptyGridContent:i(A,{}),className:"order-shipping-status-card__images",children:o==null?void 0:o.map(d=>{var x,J,X,Z,v,P;const y=((X=(J=(x=d==null?void 0:d.orderItem)==null?void 0:x.product)==null?void 0:J.thumbnail)==null?void 0:X.label)??"",$={title:y,src:((P=(v=(Z=d==null?void 0:d.orderItem)==null?void 0:Z.product)==null?void 0:v.thumbnail)==null?void 0:P.url)??l,alt:y,width:85,height:114,loading:"eager"};return i(C,{href:(s==null?void 0:s(d))??"#",children:i(N,{slotTag:"span",contentTag:"span",name:"ShippingStatusCardImage",slot:p==null?void 0:p.ShippingStatusCardImage,context:{data:d,defaultImageProps:$},children:i(U,{...$})})},d.id)})})})}),p!=null&&p.DeliveryTimeLine?i(N,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:p==null?void 0:p.DeliveryTimeLine,context:{}}):null]},T)}),m!=null&&m.length?S(R,{variant:"secondary",className:"order-shipping-status-card","data-testid":"dropinAccordionNotYetShipped2",children:[i(E,{title:r.notYetShippedTitle}),i(V,{actionIconPosition:"right",children:i(B,{defaultOpen:c>=(m==null?void 0:m.length),title:i(H,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:I,fields:{count:I}}),children:i(M,{maxColumns:6,emptyGridContent:i(A,{}),className:"order-shipping-status-card__images",children:m==null?void 0:m.map(t=>{var T,w,_;const o={title:((T=t.thumbnail)==null?void 0:T.label)??"",src:((w=t.thumbnail)==null?void 0:w.url)??"",alt:((_=t.thumbnail)==null?void 0:_.label)??"",width:85,height:114,loading:"lazy"};return i(C,{href:(s==null?void 0:s(t))??"#",children:i(N,{slotTag:"span",contentTag:"span",name:"NotYetShippedProductImage",slot:p==null?void 0:p.NotYetShippedProductImage,context:{data:t,defaultImageProps:o},children:i(U,{...o})})},t.id)})})})})]}):null]}):S(R,{variant:"secondary",className:"order-shipping-status-card",children:[i(E,{title:r.shippingInfoTitle}),i("div",{className:"order-shipping-status-card__header",children:S("div",{className:"order-shipping-status-card__header--content",children:[n!=null&&n.carrier?i("p",{children:n==null?void 0:n.carrier}):null,i("p",{children:r.noInfoTitle})]})})]})},On=({slots:l,className:r,collapseThreshold:p,orderData:n,routeOrderDetails:c,routeTracking:s,routeProductDetails:g})=>{const{loading:h,order:a,isVirtualProduct:C}=ln({orderData:n}),e=nn(),f=rn({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",returnOrderCardTitle:"Order.ShippingStatusCard.returnOrderCardTitle",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",noInfoTitle:"Order.ShippingStatusCard.noInfoTitle",returnNumber:"Order.ShippingStatusCard.returnNumber",orderNumber:"Order.ShippingStatusCard.orderNumber",trackButton:"Order.ShippingStatusCard.trackButton"});if(!h&&C)return null;const u=(e==null?void 0:e.baseMediaUrl)??"";return i("div",{className:L(["order-shipping-status",r]),children:!h&&a?i(dn,{placeholderImage:u,translations:f,routeOrderDetails:c,routeTracking:s,slots:l,orderData:a,collapseThreshold:p,routeProductDetails:g}):i(pn,{withCard:!1})})};export{On as ShippingStatus,On as default};
//# sourceMappingURL=ShippingStatus.js.map
