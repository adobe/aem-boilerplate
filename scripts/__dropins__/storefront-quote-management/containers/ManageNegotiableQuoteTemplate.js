/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as a,jsxs as c}from"@dropins/tools/preact-jsx-runtime.js";import{useState as x,useEffect as z,useCallback as D,useMemo as d}from"@dropins/tools/preact-compat.js";import{classes as m,VComponent as r,Slot as o}from"@dropins/tools/lib.js";import{f as C}from"../chunks/dateUtils.js";import{events as P}from"@dropins/tools/event-bus.js";import{Skeleton as j,SkeletonRow as b,TextArea as A,Button as O}from"@dropins/tools/components.js";/* empty css                                     */import"@dropins/tools/preact.js";import"@dropins/tools/preact-hooks.js";/* empty css                        *//* empty css                                  */import{T as s}from"../chunks/TabbedContent.js";/* empty css                          */import"../chunks/state.js";import{s as B}from"../chunks/sendQuoteTemplateForReview.js";import{I as V}from"../chunks/ItemsQuotedTemplate.js";import{Q as $}from"../chunks/QuoteTemplateCommentsList.js";import{Q as E}from"../chunks/QuoteTemplateHistoryLog.js";import{useText as G}from"@dropins/tools/i18n.js";import"../chunks/transform-quote-template.js";import"../chunks/transform-quote.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/NegotiableQuoteTemplateFragment.js";import"../chunks/QuotePricesSummary.js";import"../chunks/QuoteCommentsList.js";import"../chunks/QuoteHistoryLog.js";const J=({className:e,loading:h,templateName:q,templateId:t,banner:f,details:_,actionBar:N,referenceDocuments:l,referenceDocumentsTitle:g,itemsTable:u,commentsTitle:p,comments:n,historyLogTitle:T,historyLog:v,footer:y,...L})=>h?a(K,{}):c("div",{...L,className:m(["quote-management-manage-negotiable-quote-template",e]),children:[c("div",{className:m(["quote-management-manage-negotiable-quote-template__header"]),children:[q&&a(r,{node:q,className:m(["quote-management-manage-negotiable-quote-template__template-name"])}),t&&a(r,{node:t,className:m(["quote-management-manage-negotiable-quote-template__template-id"])})]}),f&&a(r,{node:f,className:m(["quote-management-manage-negotiable-quote-template__banner"])}),_&&a(r,{node:_,className:m(["quote-management-manage-negotiable-quote-template__details"])}),N&&a(r,{node:N,className:m(["quote-management-manage-negotiable-quote-template__action-bar"])}),(g||l)&&c("div",{"data-testid":"reference-documents-container",className:m(["quote-management-manage-negotiable-quote-template__reference-documents-container"]),children:[g&&a(r,{node:g,className:m(["quote-management-manage-negotiable-quote-template__reference-documents-title"])}),l&&a(r,{node:l,className:m(["quote-management-manage-negotiable-quote-template__reference-documents"])})]}),u&&a(r,{node:u,className:m(["quote-management-manage-negotiable-quote-template__items-table"])}),c("div",{"data-testid":"comments-container",className:m(["quote-management-manage-negotiable-quote-template__comments-container"]),children:[p&&a(r,{node:p,className:m(["quote-management-manage-negotiable-quote-template__comments-title"])}),n&&a(r,{node:n,className:m(["quote-management-manage-negotiable-quote-template__comments"])})]}),c("div",{"data-testid":"history-log-container",className:m(["quote-management-manage-negotiable-quote-template__history-log-container"]),children:[T&&a(r,{node:T,className:m(["quote-management-manage-negotiable-quote-template__history-log-title"])}),v&&a(r,{node:v,className:m(["quote-management-manage-negotiable-quote-template__history-log"])})]}),y&&a(r,{node:y,className:m(["quote-management-manage-negotiable-quote-template__footer"])})]}),K=()=>c(j,{"data-testid":"manage-negotiable-quote-template-skeleton",children:[a(b,{variant:"heading",fullWidth:!0,size:"large"}),a(b,{variant:"row",fullWidth:!1,size:"small"}),a(b,{variant:"row",fullWidth:!1,size:"small"}),a(b,{variant:"row",fullWidth:!0}),a(b,{variant:"row",fullWidth:!0,size:"xlarge",lines:2}),a(b,{variant:"row",fullWidth:!1,size:"small"})]}),ye=({slots:e,onSendForReview:h,...q})=>{const[t,f]=x(void 0),[_,N]=x(!0),[l,g]=x(""),[u,p]=x(!1),n=G({createdLabel:"NegotiableQuoteTemplate.Manage.createdLabel",salesRepLabel:"NegotiableQuoteTemplate.Manage.salesRepLabel",expiresLabel:"NegotiableQuoteTemplate.Manage.expiresLabel",referenceDocumentsTitle:"NegotiableQuoteTemplate.Manage.referenceDocuments.title",commentsTitle:"NegotiableQuoteTemplate.Manage.comments.title",historyLogTitle:"NegotiableQuoteTemplate.Manage.historyLog.title",itemsQuotedTab:"NegotiableQuoteTemplate.Manage.tabs.itemsQuoted",commentsTab:"NegotiableQuoteTemplate.Manage.tabs.comments",historyLogTab:"NegotiableQuoteTemplate.Manage.tabs.historyLog",templateCommentsPlaceholder:"NegotiableQuoteTemplate.Manage.templateComments.placeholder",sendForReview:"NegotiableQuoteTemplate.Manage.actionButtons.sendForReview"});z(()=>{const i=P.on("quote-management/quote-template-data",Q=>{Q.quoteTemplate&&(f(Q.quoteTemplate),N(!1),g(""),p(!1))},{eager:!0});return()=>i==null?void 0:i.off()},[]);const T=D(async()=>{if(h){h({templateData:t,comment:l.trim()||void 0});return}p(!0);try{await B({templateId:t.id,comment:l.trim()||void 0})}catch(i){console.error("Failed to send quote template for review:",i),p(!1)}},[t,h,l]),v=d(()=>a(o,{name:"TemplateName",slot:e==null?void 0:e.TemplateName,context:{templateName:t==null?void 0:t.name,templateData:t},children:a("h1",{"data-testid":"template-name",children:t==null?void 0:t.name})}),[e==null?void 0:e.TemplateName,t]),y=d(()=>a(o,{name:"TemplateId",slot:e==null?void 0:e.TemplateId,context:{templateId:t==null?void 0:t.uid,templateData:t},children:c("div",{"data-testid":"template-id",children:["Template #",t==null?void 0:t.uid]})}),[e==null?void 0:e.TemplateId,t]),L=d(()=>{if(!t)return;const i=t.expirationDate?C(t.expirationDate,"short"):void 0;return c(o,{name:"Details",slot:e==null?void 0:e.Details,context:{templateData:t},children:[c("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[a("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"created-label",children:n.createdLabel}),c("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"created-value",children:[C(t.createdAt,"short")," (",t.buyer.firstname," ",t.buyer.lastname,")"]})]}),c("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[a("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"sales-rep-label",children:n.salesRepLabel}),a("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"sales-rep-value",children:t.salesRepName})]}),i&&c("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[a("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"expires-label",children:n.expiresLabel}),a("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"expires-value",children:i})]})]})},[e==null?void 0:e.Details,n,t]),w=d(()=>{if(!(!(t!=null&&t.referenceDocuments)||t.referenceDocuments.length===0))return a(o,{name:"ReferenceDocumentsTitle",slot:e==null?void 0:e.ReferenceDocumentsTitle,context:{templateData:t},children:a("h2",{children:n.referenceDocumentsTitle})})},[e==null?void 0:e.ReferenceDocumentsTitle,n,t]),M=d(()=>{if(!(!(t!=null&&t.referenceDocuments)||t.referenceDocuments.length===0))return a(o,{name:"ReferenceDocuments",slot:e==null?void 0:e.ReferenceDocuments,context:{templateData:t},children:a("ul",{"data-testid":"reference-documents",children:t.referenceDocuments.map(i=>a("li",{children:a("a",{href:i.url,target:"_blank",rel:"noopener noreferrer",children:i.name})},i.uid))})})},[e==null?void 0:e.ReferenceDocuments,t]),R=d(()=>a(o,{name:"ItemsTable",slot:e==null?void 0:e.ItemsTable,context:{templateData:t},children:a(s,{tabs:new Map([["items-quoted",n.itemsQuotedTab],["comments",n.commentsTab],["history-log",n.historyLogTab]]),tabsContent:new Map([["items-quoted",a(o,{name:"ItemsQuotedTab",slot:e==null?void 0:e.ItemsQuotedTab,context:{templateData:t},children:a(V,{templateData:t})},"items-quoted")],["comments",a(o,{name:"CommentsTab",slot:e==null?void 0:e.CommentsTab,context:{templateData:t},children:a($,{templateData:t})},"comments")],["history-log",a(o,{name:"HistoryLogTab",slot:e==null?void 0:e.HistoryLogTab,context:{templateData:t},children:a(E,{templateData:t})},"history-log")]])})}),[e==null?void 0:e.ItemsTable,e==null?void 0:e.ItemsQuotedTab,e==null?void 0:e.CommentsTab,e==null?void 0:e.HistoryLogTab,n,t]),I=d(()=>a(o,{name:"CommentsTitle",slot:e==null?void 0:e.CommentsTitle,context:{templateData:t},children:a("h2",{children:n.commentsTitle})}),[e==null?void 0:e.CommentsTitle,n,t]),H=d(()=>a(o,{name:"Comments",slot:e==null?void 0:e.Comments,context:{templateData:t},children:a(A,{name:"templateComments",placeholder:n.templateCommentsPlaceholder,rows:3,value:l,onInput:i=>{g(i.target.value)},disabled:!(t!=null&&t.canSendForReview)||u})}),[e==null?void 0:e.Comments,n,t,l,u]),F=d(()=>a(o,{name:"HistoryLogTitle",slot:e==null?void 0:e.HistoryLogTitle,context:{templateData:t},children:a("h2",{children:n.historyLogTitle})}),[e==null?void 0:e.HistoryLogTitle,n,t]),S=d(()=>a(o,{name:"HistoryLog",slot:e==null?void 0:e.HistoryLog,context:{templateData:t},children:"TODO: Not yet implemented."}),[e==null?void 0:e.HistoryLog,t]),k=d(()=>a(o,{name:"Footer",slot:e==null?void 0:e.Footer,context:{templateData:t,comment:l,isSubmitting:u},children:a(O,{variant:"primary",onClick:T,"data-testid":"send-for-review-button",disabled:!(t!=null&&t.canSendForReview)||u,children:n.sendForReview})}),[e==null?void 0:e.Footer,n,t,l,u,T]),W={...q,loading:_,templateName:v,templateId:y,details:L,referenceDocumentsTitle:w,referenceDocuments:M,itemsTable:R,commentsTitle:I,comments:H,historyLogTitle:F,historyLog:S,footer:k};return a(J,{...W})};export{ye as ManageNegotiableQuoteTemplate,ye as default};
//# sourceMappingURL=ManageNegotiableQuoteTemplate.js.map
