/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as e,jsxs as u,Fragment as R}from"@dropins/tools/preact-jsx-runtime.js";import{useState as B,useEffect as U}from"@dropins/tools/preact-compat.js";import{classes as T,VComponent as D,Slot as A}from"@dropins/tools/lib.js";import{h as F}from"@dropins/tools/preact.js";import{useState as W,useEffect as J}from"@dropins/tools/preact-hooks.js";import{Skeleton as K,SkeletonRow as X,Input as Y,Picker as Z,Price as M,Checkbox as ee,Button as w,Table as te,Accordion as ae,AccordionSection as ne,Modal as oe,InLineAlert as z}from"@dropins/tools/components.js";/* empty css                 */import{useText as E}from"@dropins/tools/i18n.js";import{events as I}from"@dropins/tools/event-bus.js";import{u as se}from"./updateQuantities.js";import{S as ie,a as re}from"./WarningFilled.js";const G=({className:y,loading:r,table:i,pricesSummary:s,...n})=>r?e(le,{}):u("div",{className:T(["quote-management-items-quoted",y]),...n,children:[i&&e(D,{node:i,className:T(["quote-management-items-quoted__table"]),"data-testid":"quote-management-items-quoted__table"}),s&&e(D,{node:s,className:T(["quote-management-items-quoted__prices-summary"]),"data-testid":"quote-management-items-quoted__prices-summary"})]}),le=()=>e(K,{"data-testid":"items-quoted-skeleton",children:e(X,{variant:"row",fullWidth:!0,size:"medium",lines:4,multilineGap:"xsmall"})}),ce=({className:y,items:r,canEdit:i,onItemCheckboxChange:s,onItemDropdownChange:n,onQuantityChange:a,onUpdate:g,...N})=>{const[h,k]=W({}),[b,_]=W({});J(()=>{const t={};r.forEach(c=>{t[c.uid]=c.quantity}),k(t),_(t)},[r]);const p=Object.keys(b).some(t=>b[t]!==h[t]),o=E({updateButton:"NegotiableQuote.Manage.productListTable.submitButton",productNameHeader:"NegotiableQuote.Manage.productListTable.headers.productName",skuHeader:"NegotiableQuote.Manage.productListTable.headers.sku",priceHeader:"NegotiableQuote.Manage.productListTable.headers.price",quantityHeader:"NegotiableQuote.Manage.productListTable.headers.quantity",discountHeader:"NegotiableQuote.Manage.productListTable.headers.discount",subtotalHeader:"NegotiableQuote.Manage.productListTable.headers.subtotal",actionsHeader:"NegotiableQuote.Manage.productListTable.headers.actions",editNoteToSeller:"NegotiableQuote.Manage.productListTable.actions.editNoteToSeller",remove:"NegotiableQuote.Manage.productListTable.actions.remove"}),Q=[{label:o.productNameHeader,key:"productName"},{label:o.skuHeader,key:"sku"},{label:o.priceHeader,key:"price"},{label:o.quantityHeader,key:"quantity"},{label:o.discountHeader,key:"discount"},{label:o.subtotalHeader,key:"subtotal"}];i&&(Q.unshift({label:"",key:"checkbox"}),Q.push({label:o.actionsHeader,key:"actions"}));const L=(t,c)=>{const m=t.target.checked;s==null||s(c,m)},H=(t,c)=>{const m=t.target.value;n==null||n(c,m)},C=(t,c)=>{const m=parseInt(t.target.value,10);!isNaN(m)&&m>0&&(_(q=>({...q,[c.uid]:m})),a==null||a(c,m))},O=t=>{t.preventDefault(),g==null||g(t)},P=(t,c)=>t>0?u("div",{className:"quote-management-product-list-table__discount-container",children:[u("span",{className:"quote-management-product-list-table__discount-percent",children:[c,"%"]}),u("span",{className:"quote-management-product-list-table__discount-price",children:["(",e(M,{amount:t}),")"]})]}):void 0,S=t=>{var q,j;const c=(q=t.configurableOptions)==null?void 0:q.map(v=>u("div",{className:"quote-management-product-list-table__configurable-option",children:[u("span",{className:"quote-management-product-list-table__configurable-option-label",children:[v.optionLabel,":"]}),e("span",{className:"quote-management-product-list-table__configurable-option-value",children:v.valueLabel})]},v.optionLabel)),m=(j=t.bundleOptions)==null?void 0:j.map(v=>u("div",{className:"quote-management-product-list-table__bundle-option",children:[e("span",{className:"quote-management-product-list-table__bundle-option-label",children:v.label}),e("div",{className:"quote-management-product-list-table__bundle-option-values",children:v.values.map(x=>u("span",{className:"quote-management-product-list-table__bundle-option-value",children:[u("span",{className:"quote-management-product-list-table__bundle-option-value-quantity",children:[x.quantity," x"]}),e("span",{className:"quote-management-product-list-table__bundle-option-value-label",children:x.label}),e(M,{className:"quote-management-product-list-table__bundle-option-value-original-price",amount:x.originalPrice.value,currency:x.originalPrice.currency,weight:"normal"})]},x.label))})]},v.label));return u("div",{className:"quote-management-product-list-table__product-name-container",children:[e("span",{className:"quote-management-product-list-table__product-name",children:t.product.name}),c,m]})},$=r.map(t=>{var m;const c=i?e(Y,{className:"quote-management-product-list-table__quantity-input",type:"number",min:"1",value:((m=b[t.uid])==null?void 0:m.toString())||t.quantity.toString(),onChange:q=>C(q,t),disabled:!i,"data-testid":`quantity-input-${t.product.sku}`}):e("span",{className:"quote-management-product-list-table__quantity",children:t.quantity});return{checkbox:e(ee,{className:"quote-management-product-list-table__checkbox",name:"itemSelected","data-testid":`item-checkbox-${t.product.sku}`,onChange:q=>L(q,t),value:t.product.sku}),productName:S(t),sku:e("span",{className:"quote-management-product-list-table__sku",children:t.product.sku}),price:e(M,{className:"quote-management-product-list-table__price",amount:t.prices.originalItemPrice.value,currency:t.prices.originalItemPrice.currency}),quantity:c,discount:P(t.catalogDiscount.amountOff,t.catalogDiscount.percentOff),subtotal:e(M,{className:"quote-management-product-list-table__subtotal",amount:t.prices.rowTotal.value,currency:t.prices.rowTotal.currency}),actions:e(Z,{className:"quote-management-product-list-table__actions","data-testid":`item-dropdown-${t.product.sku}`,name:`item-dropdown-${t.product.sku}`,onChange:q=>H(q,t),placeholder:"Select",options:[{text:o.editNoteToSeller,value:"edit"},{text:o.remove,value:"remove"}],value:t.product.sku})}}),l=e(te,{columns:Q,rowData:$,"data-testid":"product-list-table",mobileLayout:"stacked"}),d=i?F("form",{}):F("div",{}),f=i?{onSubmit:O,...N}:N,V=e(w,{type:"submit",disabled:!i||!p,"data-testid":"product-list-table-submit-button",children:o.updateButton});return u(D,{node:d,className:T(["quote-management-product-list-table-container",y]),"data-testid":"product-list-table-container",...f,children:[l,e("div",{className:"quote-management-product-list-table-container__submit-container",children:V})]})},ue=({className:y,entries:r,...i})=>{const s=n=>{var g;const a=(g=n.children)==null?void 0:g.map(s);return e("div",{className:"quote-management-quote-prices-summary__entry","data-testid":`quote-prices-summary-entry-${n.id}`,children:a?e(ae,{className:"quote-management-quote-prices-summary__accordion","data-testid":`quote-prices-summary-entry-accordion-${n.id}`,children:e(ne,{className:"quote-management-quote-prices-summary__accordion-section",title:n.label,ariaLabelTitle:n.label,secondaryText:n.value,children:a})}):u(R,{children:[e("span",{className:T(["quote-management-quote-prices-summary__label",["quote-management-quote-prices-summary__label--strong",n.strong]]),"data-testid":`quote-prices-summary-entry-label-${n.id}`,children:n.label}),e("span",{className:"quote-management-quote-prices-summary__value","data-testid":`quote-prices-summary-entry-value-${n.id}`,children:n.value})]})},n.id)};return e("div",{className:T(["quote-management-quote-prices-summary",y]),"data-testid":"quote-prices-summary",...i,children:r==null?void 0:r.map(s)})},de=({open:y=!1,title:r,message:i,cancelLabel:s,confirmLabel:n,onCancel:a,onConfirm:g,showCloseButton:N,confirmationBanner:h,...k})=>{const b=E({cancel:"ConfirmationModal.cancel",confirm:"ConfirmationModal.confirm"});if(!y)return null;const{className:_,...p}=k;return e(oe,{...p,size:"medium",onClose:a,clickToDismiss:!0,escapeToDismiss:!0,showCloseButton:N,"data-testid":"confirmation-modal",className:_,children:u("div",{className:"confirmation-modal__content",children:[h&&e("div",{className:"confirmation-modal__banner","data-testid":"confirmation-modal-banner",children:h}),r&&e("div",{className:"confirmation-modal__title","data-testid":"confirmation-modal-title",children:r}),i&&e("div",{className:"confirmation-modal__message","data-testid":"confirmation-modal-message",children:i}),u("div",{className:"confirmation-modal__actions","data-testid":"confirmation-modal-actions",children:[e(w,{variant:"secondary",onClick:a,"data-testid":"confirmation-modal-cancel",children:s??b.cancel}),e(w,{variant:"primary",onClick:g,"data-testid":"confirmation-modal-confirm",children:n??b.confirm})]})]})})},Qe=({quoteData:y,onItemCheckboxChange:r,onItemDropdownChange:i,slots:s,...n})=>{const[a,g]=B(y),[N,h]=B({}),[k,b]=B(!1),[_,p]=B({type:null,message:""}),o=E({subtotal:"NegotiableQuote.Manage.quotePricesSummary.subtotal.excludingTax",grandTotal:"NegotiableQuote.Manage.quotePricesSummary.grandTotal.includingTax",appliedTaxes:"NegotiableQuote.Manage.quotePricesSummary.appliedTaxes",modalTitle:"NegotiableQuote.Manage.updateQuantitiesModal.title",modalDescription:"NegotiableQuote.Manage.updateQuantitiesModal.description",modalCancelButton:"NegotiableQuote.Manage.updateQuantitiesModal.cancelButton",modalUpdateButton:"NegotiableQuote.Manage.updateQuantitiesModal.updateButton",successHeading:"NegotiableQuote.Manage.updateQuantitiesModal.successHeading",successMessage:"NegotiableQuote.Manage.updateQuantitiesModal.successMessage",errorHeading:"NegotiableQuote.Manage.updateQuantitiesModal.errorHeading",errorMessage:"NegotiableQuote.Manage.updateQuantitiesModal.errorMessage"});if(U(()=>{const l=I.on("quote-management/quote-data",d=>{g(d.quote),h({}),p({type:null,message:""})},{eager:!0});return()=>l==null?void 0:l.off()},[]),U(()=>{const l=I.on("quote-management/quantities-updated",d=>{g(d.quote),h({}),p({type:"success",message:o.successMessage}),setTimeout(()=>{b(!1),p({type:null,message:""})},3e3)});return()=>l==null?void 0:l.off()},[o.successMessage]),!a)return e(G,{loading:!0});const Q=!!a.canUpdateQuote,L=(l,d)=>{h(f=>({...f,[l.uid]:d}))},H=l=>{l.preventDefault(),p({type:null,message:""}),b(!0)},C=async()=>{if(!a)return;if(Object.keys(N).length===0){b(!1);return}p({type:null,message:""});const l=Object.entries(N).map(([d,f])=>({quoteItemUid:d,quantity:f}));try{await se({quoteUid:a.uid,items:l})}catch(d){const f=d instanceof Error?d.message:o.errorMessage;p({type:"error",message:f}),console.error("Failed to update quantities:",d)}},O=()=>{b(!1),p({type:null,message:""})},P=()=>{p({type:null,message:""})},S=[];a.prices.subtotalExcludingTax&&S.push({label:o.subtotal,id:"subtotal",value:e(M,{amount:a.prices.subtotalExcludingTax.value,currency:a.prices.subtotalExcludingTax.currency,weight:"normal"})}),a.prices.grandTotal&&S.push({label:o.grandTotal,id:"total",value:e(M,{amount:a.prices.grandTotal.value,currency:a.prices.grandTotal.currency}),strong:!0});const $=_.type==="success"?e(z,{type:"success",variant:"primary",icon:e(ie,{}),heading:o.successHeading,description:_.message,onDismiss:P,"data-testid":"update-quantities-success-banner"}):_.type==="error"?e(z,{type:"error",variant:"primary",icon:e(re,{}),heading:o.errorHeading,description:_.message,onDismiss:P,"data-testid":"update-quantities-error-banner"}):null;return u(R,{children:[e(G,{"data-testid":"items-quoted-container",...n,loading:!1,table:e(A,{name:"ProductListTable",slot:s==null?void 0:s.ProductListTable,context:{items:a.items,canEdit:Q,onItemCheckboxChange:r,onItemDropdownChange:i,onQuantityChange:L,onUpdate:H},children:e(ce,{items:a.items,canEdit:Q,onItemCheckboxChange:r,onItemDropdownChange:i,onQuantityChange:L,onUpdate:H})}),pricesSummary:e(A,{name:"QuotePricesSummary",slot:s==null?void 0:s.QuotePricesSummary,context:{items:a.items,prices:a.prices},children:e(ue,{entries:S})})}),e(de,{open:k,title:o.modalTitle,message:o.modalDescription,cancelLabel:o.modalCancelButton,confirmLabel:o.modalUpdateButton,onCancel:O,onConfirm:C,confirmationBanner:$})]})};export{de as C,Qe as I};
//# sourceMappingURL=ItemsQuoted.js.map
