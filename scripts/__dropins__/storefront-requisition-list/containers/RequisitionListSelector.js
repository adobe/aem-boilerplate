/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as s,jsxs as f,Fragment as k}from"@dropins/tools/preact-jsx-runtime.js";import*as C from"@dropins/tools/preact-compat.js";import{useState as q,useEffect as h,useCallback as R,useMemo as H}from"@dropins/tools/preact-compat.js";import{Card as M,Icon as w,Button as D,InLineAlert as W}from"@dropins/tools/components.js";import{c as z,R as J,f as K,h as X,t as Y}from"../chunks/updateRequisitionList.js";import{events as m}from"@dropins/tools/event-bus.js";import{i as ii}from"../chunks/isRequisitionListEnabled.js";import"@dropins/tools/preact-hooks.js";import"@dropins/tools/lib.js";import"../chunks/RequisitionListForm.js";import{R as ti}from"../chunks/RequisitionListForm2.js";import{s as a,a as F,b as N,u as si}from"../chunks/state.js";import{g as ei}from"../chunks/getRequisitionLists.js";import{u as oi,E as ni}from"../chunks/RequisitionListView.js";import"@dropins/tools/preact.js";import{R as ri}from"../chunks/RequisitionListActions.js";import{R as ai}from"../chunks/RequisitionListModal.js";import{useText as li}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";let u=0;const ci=()=>{const[l,e]=q(a.requisitionLists),[L,c]=q(a.requisitionListsLoading),[r,d]=q(u);return h(()=>{a.requisitionLists.length===0&&!a.requisitionListsLoading&&(F(!0),ei(1,100).then(o=>{const i=(o==null?void 0:o.items)||[];N(i),u++}).catch(o=>{console.error("Error fetching requisition lists:",o),N([]),u++}).finally(()=>{F(!1)}))},[]),h(()=>{const o=m.on("requisitionLists/data",n=>{n&&(N(n),u++,d(u),e(a.requisitionLists),c(a.requisitionListsLoading))}),i=m.on("requisitionList/data",n=>{n&&(si(n),u++,d(u),e([...a.requisitionLists]),c(a.requisitionListsLoading))});return()=>{o==null||o.off(),i==null||i.off()}},[]),h(()=>{r!==u&&(e(a.requisitionLists),c(a.requisitionListsLoading),d(u))},[r]),{lists:l,loading:L}},di=`
  mutation ADD_PRODUCTS_TO_REQUISITION_LIST_MUTATION(
      $requisitionListUid: ID!, 
      $requisitionListItems: [RequisitionListItemsInput!]!
    ) {
    addProductsToRequisitionList(
      requisitionListUid: $requisitionListUid
      requisitionListItems: $requisitionListItems
    ) {
      requisition_list {
        ...REQUISITION_LIST_FRAGMENT
        items {
          ...REQUISITION_LIST_ITEMS_FRAGMENT
        }
      }
    }
  }
${z}
${J}
`,ui=async(l,e)=>{var o;const L=e.map(i=>{const n={sku:i.sku,quantity:i.quantity};return i.parent_sku&&(n.parent_sku=i.parent_sku),i.selected_options&&i.selected_options.length>0&&(n.selected_options=i.selected_options),i.entered_options&&i.entered_options.length>0&&(n.entered_options=i.entered_options),n}),{errors:c,data:r}=await K(di,{variables:{requisitionListUid:l,requisitionListItems:L}});if(c)return X(c);if(!((o=r==null?void 0:r.addProductsToRequisitionList)!=null&&o.requisition_list))return null;const d=Y(r.addProductsToRequisitionList.requisition_list);return m.emit("requisitionList/data",d),d},Li=l=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...l},C.createElement("path",{d:"M7.74512 9.87701L12.0001 14.132L16.2551 9.87701",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round"})),Z=l=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...l},C.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M16.8569 2C18.5138 2 19.8569 3.34315 19.8569 5V19C19.8569 20.6569 18.5138 22 16.8569 22H7.14307L6.98877 21.9961C5.45484 21.9183 4.22469 20.6883 4.14697 19.1543L4.14307 19V5C4.14307 3.39498 5.40374 2.08434 6.98877 2.00391L7.14307 2H16.8569ZM7.14307 3.5C6.31475 3.50013 5.64307 4.17165 5.64307 5V19C5.64307 19.8283 6.31475 20.4999 7.14307 20.5H16.8569C17.6854 20.5 18.3569 19.8284 18.3569 19V5C18.3569 4.17157 17.6854 3.5 16.8569 3.5H7.14307ZM7.71436 15.5713C8.10871 15.5713 8.42897 15.8909 8.4292 16.2852C8.4292 16.6796 8.10884 17 7.71436 17C7.32006 16.9998 7.00049 16.6795 7.00049 16.2852C7.00071 15.891 7.3202 15.5715 7.71436 15.5713ZM16.2866 17H9.85791V15.5H16.2866V17ZM16.2866 12.7148H9.85791V11.2148H16.2866V12.7148ZM7.71436 11.2861C8.10884 11.2861 8.4292 11.6055 8.4292 12C8.42916 12.3945 8.10882 12.7139 7.71436 12.7139C7.32008 12.7136 7.00053 12.3943 7.00049 12C7.00049 11.6057 7.32006 11.2864 7.71436 11.2861ZM7.71436 7C8.10871 7 8.42897 7.31957 8.4292 7.71387C8.4292 8.10836 8.10884 8.42871 7.71436 8.42871C7.32006 8.42848 7.00049 8.10822 7.00049 7.71387C7.00071 7.31971 7.3202 7.00023 7.71436 7ZM16.2866 8.42871H9.85791V6.92871H16.2866V8.42871Z",fill:"currentColor"})),Ai=({canCreate:l=!0,sku:e,selectedOptions:L,quantity:c=1,beforeAddProdToReqList:r})=>{const[d,o]=q(null),i=li({createTitle:"RequisitionList.RequisitionListForm.createTitle",addToRequisitionList:"RequisitionList.RequisitionListForm.addToRequisitionList",emptyList:"RequisitionList.RequisitionListWrapper.emptyList",addToNewRequisitionList:"RequisitionList.RequisitionListSelector.addToNewRequisitionList",addToSelected:"RequisitionList.RequisitionListSelector.addToSelected"}),[n,_]=q(!1),[p,A]=q(null),{lists:T}=ci(),{alert:I,setAlert:O,handleRequisitionListAlert:b}=oi(),[U,x]=q({isOpen:!1,isLoading:!1});h(()=>{ii().then(o)},[]),h(()=>{const t=m.on("requisitionList/alert",b);return()=>{t==null||t.off()}},[b]);const S=R(()=>{x({isOpen:!0,isLoading:!1})},[]),v=R(()=>{x({isOpen:!1,isLoading:!1}),A(null),_(!1),O(null)},[O]),V=R(async t=>{try{const g={sku:e,quantity:c,...L&&L.length>0?{selected_options:L}:{}};await ui(t,[g])}catch(g){throw console.error("Error adding product to list:",g),g}},[e,c,L]),E=R(async t=>{try{await V(t),m.emit("requisitionList/alert",{action:"add",type:"success",context:"product",skus:[e]})}catch{m.emit("requisitionList/alert",{action:"add",type:"error",context:"product",skus:[e]})}finally{setTimeout(()=>{v()},2e3)}},[e,V,v]),$=R(t=>{t.preventDefault(),p&&E(p)},[p,E]),P=R(()=>{if(!r){S();return}Promise.resolve(r()).then(()=>{S()}).catch(()=>{})},[r,S]),y=H(()=>[...(T==null?void 0:T.map(t=>({value:t.uid,text:t.name})))??[]],[T]),Q=H(()=>s("div",{className:"requisition-list-selector__available-lists",children:y.map(t=>f(M,{variant:p===t.value?"primary":"secondary",onClick:()=>{A(t.value)},children:[s(w,{source:Z}),s("span",{children:t.text})]},t.value))}),[y,p]),G=y.length>0?n?f("button",{type:"button","aria-label":"Select a requisition list",role:"button",className:"requisition-list-actions","data-testid":"requisition-list-actions-button",onClick:()=>_(!1),children:[s("span",{className:"requisition-list-actions__title","data-testid":"requisition-list-actions-button-text",children:i.addToRequisitionList}),s(w,{source:Li,size:"32"})]}):s(M,{variant:"secondary",children:f("form",{onSubmit:$,className:"requisition-list-selector__form",children:[Q,s("div",{className:"requisition-list-form__actions",children:s(D,{type:"submit",disabled:!p,children:i.addToSelected})})]})}):s(ni,{textContent:i.emptyList}),j=n?s(M,{variant:"secondary",children:s(ti,{mode:"create",onSuccess:async t=>{await E(t.uid)},onError:()=>{m.emit("requisitionList/alert",{action:"add",type:"error",context:"product",skus:[e]})},onCancel:()=>{_(!1)}})}):s(ri,{onAddNew:()=>{_(!0)}}),B=f(k,{children:[I&&s(W,{id:`requisition-list-selector__alert__${e}`,className:"requisition-list-selector__alert",heading:I.description,type:I.type,variant:"primary"},`requisition-list-selector__alert__${e}`),!I&&f(k,{children:[G,l&&j]})]});return d===null||!d?null:f("div",{className:"requisition-list-selector",children:[s(D,{"aria-label":i.addToRequisitionList,"data-testid":"requisition-list-selector",size:"medium",variant:"tertiary",icon:s(w,{source:Z}),onClick:P}),U.isOpen&&s(ai,{isOpen:!0,isLoading:U.isLoading,title:i.addToRequisitionList,modalContent:B,handleModalOnClose:v})]})};export{Ai as RequisitionListSelector,Ai as default};
//# sourceMappingURL=RequisitionListSelector.js.map
