/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as w,jsx as n,Fragment as D}from"@dropins/tools/preact-jsx-runtime.js";import{useState as M,useCallback as m,useMemo as W,useEffect as S}from"@dropins/tools/preact-compat.js";import{Button as b,Header as G,InLineAlert as U,Table as V,Pagination as B,Card as j}from"@dropins/tools/components.js";import{Slot as Z,classes as v,VComponent as $}from"@dropins/tools/lib.js";import{D as N,R as J}from"../chunks/RequisitionListForm.js";import"@dropins/tools/preact-hooks.js";import{R as K}from"../chunks/RequisitionListForm2.js";import"../chunks/state.js";import{events as g}from"@dropins/tools/event-bus.js";import{u as Q,E as X}from"../chunks/RequisitionListView.js";import"@dropins/tools/preact.js";import{R as Y}from"../chunks/RequisitionListActions.js";import{R as z}from"../chunks/RequisitionListModal.js";import{P as I}from"../chunks/PageSizePicker.js";import{useText as x}from"@dropins/tools/i18n.js";import{u as ii}from"../chunks/updateRequisitionList.js";import{d as ei}from"../chunks/deleteRequisitionList.js";import{g as E}from"../chunks/getRequisitionLists.js";import"@dropins/tools/fetch-graphql.js";function ti(c,l,t){const d=x({actionRename:"RequisitionList.RequisitionListView.actionRename",actionDeleteList:"RequisitionList.RequisitionListView.actionDeleteList"}),[e,o]=M(null),[h,L]=M(!1),[C,R]=M(!1),q=m(()=>{t&&t(),L(!0)},[t]),f=m(()=>L(!1),[]),u=W(()=>{if(c)return{handleOpenRenameModal:i=>{L(s=>s&&!1),c.handleOpenRenameModal(i)},handleOpenDeleteModal:i=>{L(s=>s&&!1),c.handleOpenDeleteModal(i)}}},[c]),a=m(async(i,s)=>{var r,_,P;R(!0);try{const p=await E(i,s),T=((r=p==null?void 0:p.page_info)==null?void 0:r.current_page)??1,F=((_=p==null?void 0:p.page_info)==null?void 0:_.total_pages)??0;if(!((((P=p==null?void 0:p.items)==null?void 0:P.length)??0)>0)&&T>1&&F>=T-1){const H=T-1,k=await E(H,s);o(k)}else o(p)}finally{R(!1)}},[]);S(()=>{const i=g.on("requisitionLists/data",s=>{s&&s.items&&o(s)},{eager:!0});return()=>{i==null||i.off()}},[]),S(()=>{e||a(1,N)},[e,a]);const O=m(i=>{var _,P;const s=i??((_=e==null?void 0:e.page_info)==null?void 0:_.current_page)??1,r=((P=e==null?void 0:e.page_info)==null?void 0:P.page_size)??N;return a(s,r)},[a,e]),A=m(async i=>{await a(1,i)},[a]);return{rows:W(()=>((e==null?void 0:e.items)??[]).map(i=>({name:w("div",{className:"requisition-list-grid-wrapper__name",children:[n("div",{className:"requisition-list-grid-wrapper__name__title",children:n("a",{href:"#",onClick:s=>{if(s.preventDefault(),l){const r=l(i.uid);typeof r=="string"&&(window.location.href=r)}},children:i.name})}),i.description&&n("div",{className:"requisition-list-grid-wrapper__name__description",children:i.description})]}),items_count:i.items_count,last_updated:new Date(i.updated_at).toLocaleString(),actions:w("div",{className:"requisition-list-grid-wrapper__actions",children:[n(b,{variant:"tertiary",type:"button","data-testid":"rename-button",onClick:()=>u==null?void 0:u.handleOpenRenameModal(i),children:d.actionRename}),n(b,{variant:"tertiary",type:"button","data-testid":"delete-button",onClick:()=>u==null?void 0:u.handleOpenDeleteModal(i),children:d.actionDeleteList})]})})),[e==null?void 0:e.items,d.actionRename,d.actionDeleteList,u,l]),isLoading:C||!e,pageInfo:e==null?void 0:e.page_info,handlePageChange:O,handlePageSizeChange:A,isAdding:h,handleAddNew:q,handleCancelCreate:f}}const Oi=({routeRequisitionListDetails:c,slots:l})=>{const[t,d]=M({type:null,isOpen:!1,isLoading:!1,requisitionList:null}),e=m(()=>{d({type:null,isOpen:!1,isLoading:!1,requisitionList:null})},[]),o=m(r=>{d({type:"rename",isOpen:!0,isLoading:!1,requisitionList:r})},[]),h=m(r=>{d({type:"delete",isOpen:!0,isLoading:!1,requisitionList:r})},[]),{rows:L,isLoading:C,pageInfo:R,handlePageChange:q,handlePageSizeChange:f,isAdding:u,handleAddNew:a,handleCancelCreate:O}=ti({handleOpenRenameModal:o,handleOpenDeleteModal:h},c,e),A=m(async r=>{if(t.requisitionList)try{await ii(t.requisitionList.uid,r.name,r.description),g.emit("requisitionList/alert",{action:"update",type:"success",context:"requisitionList"}),await q(),e()}catch{g.emit("requisitionList/alert",{action:"update",type:"error",context:"requisitionList"})}},[t.requisitionList,q,e]),y=async()=>{t.requisitionList&&(d({...t,isLoading:!0}),await ei(t.requisitionList.uid).then(async()=>{g.emit("requisitionList/alert",{type:"success",action:"delete",context:"requisitionList"})}).catch(()=>{g.emit("requisitionList/alert",{type:"error",action:"delete",context:"requisitionList"})}).finally(async()=>{await q(),e()}))},i=x({containerTitle:"RequisitionList.containerTitle",updateTitle:"RequisitionList.RequisitionListForm.updateTitle",deleteRequisitionListTitle:"RequisitionList.RequisitionListWrapper.deleteRequisitionListTitle",deleteRequisitionListMessage:"RequisitionList.RequisitionListWrapper.deleteRequisitionListMessage",cancelAction:"RequisitionList.RequisitionListWrapper.cancelAction",confirmAction:"RequisitionList.RequisitionListWrapper.confirmAction"}),s=m(()=>l!=null&&l.Header?n(Z,{name:"Header","aria-label":i.containerTitle,title:i.containerTitle,slot:l.Header}):n(G,{"aria-label":i.containerTitle,role:"region",title:i.containerTitle}),[l,i.containerTitle]);return w(D,{children:[n(ni,{header:s(),rows:L,skeletonRowCount:10,isLoading:C,pageInfo:R,handlePageChange:q,handlePageSizeChange:f,defaultPageSize:10,isAdding:u,handleAddNew:a,handleCancelCreate:O}),t.type==="rename"&&t.isOpen&&t.requisitionList&&n(z,{isOpen:t.isOpen,isLoading:t.isLoading,title:i.updateTitle,modalContent:n(J,{mode:"update",defaultValues:{name:t.requisitionList.name,description:t.requisitionList.description||""},onSubmit:A,onCancel:e}),handleModalOnClose:e}),t.type==="delete"&&t.isOpen&&n(z,{isOpen:t.isOpen,isLoading:t.isLoading,title:i.deleteRequisitionListTitle,modalContent:i.deleteRequisitionListMessage,confirmBtnCaption:i.confirmAction,closeBtnCaption:i.cancelAction,handleModalOnClose:e,handleModalOnConfirm:y})]})},ni=({className:c,isLoading:l=!1,header:t,rows:d=[],skeletonRowCount:e=10,pageInfo:o,handlePageChange:h,handlePageSizeChange:L,defaultPageSize:C=10,isAdding:R,handleAddNew:q,handleCancelCreate:f,...u})=>{const a=x({name:"RequisitionList.RequisitionListWrapper.name",itemsCount:"RequisitionList.RequisitionListWrapper.itemsCount",lastUpdated:"RequisitionList.RequisitionListWrapper.lastUpdated",actions:"RequisitionList.RequisitionListWrapper.actions",emptyList:"RequisitionList.RequisitionListWrapper.emptyList"}),O=((o==null?void 0:o.total_pages)??0)>0,A=!l&&d.length===0&&!O,{alert:y,setAlert:i,handleRequisitionListAlert:s}=Q();return S(()=>{g.on("requisitionList/alert",s)},[s]),w("div",{...u,className:v(["requisition-list-grid-wrapper",c]),"data-testid":"requisition-list-grid-wrapper",children:[t&&n("div",{className:v(["requisition-list-grid-wrapper__header",c]),"data-testid":"requisition-list-grid-wrapper-header",children:n($,{node:t})}),y&&n(D,{children:n(U,{heading:y.description,type:y.type,variant:"primary",onDismiss:()=>i(null)})}),A?n(X,{textContent:a.emptyList}):w(D,{children:[n(V,{columns:[{key:"name",label:a.name},{key:"items_count",label:a.itemsCount},{key:"last_updated",label:a.lastUpdated},{key:"actions",label:a.actions}],rowData:d,loading:l,skeletonRowCount:e}),n("div",{className:v(["requisition-list-grid-wrapper__pagination",c]),children:w("div",{className:"requisition-list-grid-wrapper__pagination-controls",children:[n(I,{currentPageSize:(o==null?void 0:o.page_size)||C,onPageSizeChange:L||(()=>Promise.resolve()),disabled:l}),o&&o.total_pages>1&&n(B,{totalPages:o.total_pages,currentPage:o.current_page,onChange:h})]})})]}),n("div",{className:v(["requisition-list-grid-wrapper__add-new",c]),children:R?n(j,{variant:"secondary",children:n(K,{mode:"create",onSuccess:async()=>{await h(),f(),g.emit("requisitionList/alert",{type:"success",action:"create",context:"requisitionList"})},onError:()=>{g.emit("requisitionList/alert",{type:"error",action:"create",context:"requisitionList"})},onCancel:f})}):n(Y,{onAddNew:q})})]})};export{Oi as RequisitionListGrid,Oi as default};
//# sourceMappingURL=RequisitionListGrid.js.map
