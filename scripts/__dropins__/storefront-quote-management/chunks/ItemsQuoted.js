/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as e,jsxs as b,Fragment as re}from"@dropins/tools/preact-jsx-runtime.js";import{useState as h,useEffect as w,useCallback as me}from"@dropins/tools/preact-compat.js";import{classes as I,VComponent as J,Slot as ee}from"@dropins/tools/lib.js";import{h as te}from"@dropins/tools/preact.js";import{useState as ae,useEffect as pe}from"@dropins/tools/preact-hooks.js";import{Skeleton as ge,SkeletonRow as be,Input as fe,Picker as ye,Price as O,Checkbox as qe,Button as K,Table as Ne,Accordion as ve,AccordionSection as _e,Modal as Me,InLineAlert as W}from"@dropins/tools/components.js";/* empty css                 */import{useText as X}from"@dropins/tools/i18n.js";import{events as Y}from"@dropins/tools/event-bus.js";import{u as he,r as Qe}from"./removeNegotiableQuoteItems.js";import{S as se,a as oe}from"./WarningFilled.js";const ne=({className:N,loading:m,table:r,pricesSummary:f,...o})=>m?e(Te,{}):b("div",{className:I(["quote-management-items-quoted",N]),...o,children:[r&&e(J,{node:r,className:I(["quote-management-items-quoted__table"]),"data-testid":"quote-management-items-quoted__table"}),f&&e(J,{node:f,className:I(["quote-management-items-quoted__prices-summary"]),"data-testid":"quote-management-items-quoted__prices-summary"})]}),Te=()=>e(ge,{"data-testid":"items-quoted-skeleton",children:e(be,{variant:"row",fullWidth:!0,size:"medium",lines:4,multilineGap:"xsmall"})}),ke=({className:N,items:m,canEdit:r,readOnly:f=!1,onItemCheckboxChange:o,onItemDropdownChange:u,onQuantityChange:p,onUpdate:k,dropdownSelections:n,...v})=>{const[B,Q]=ae({}),[S,_]=ae({});pe(()=>{const t={};m.forEach(c=>{t[c.uid]=c.quantity}),Q(t),_(t)},[m]);const L=Object.keys(S).some(t=>S[t]!==B[t]),l=X({updateButton:"NegotiableQuote.Manage.productListTable.submitButton",productNameHeader:"NegotiableQuote.Manage.productListTable.headers.productName",skuHeader:"NegotiableQuote.Manage.productListTable.headers.sku",priceHeader:"NegotiableQuote.Manage.productListTable.headers.price",quantityHeader:"NegotiableQuote.Manage.productListTable.headers.quantity",discountHeader:"NegotiableQuote.Manage.productListTable.headers.discount",subtotalHeader:"NegotiableQuote.Manage.productListTable.headers.subtotal",actionsHeader:"NegotiableQuote.Manage.productListTable.headers.actions",editNoteToSeller:"NegotiableQuote.Manage.productListTable.actions.editNoteToSeller",remove:"NegotiableQuote.Manage.productListTable.actions.remove"}),D=[{label:l.productNameHeader,key:"productName"},{label:l.skuHeader,key:"sku"},{label:l.priceHeader,key:"price"},{label:l.quantityHeader,key:"quantity"},{label:l.discountHeader,key:"discount"},{label:l.subtotalHeader,key:"subtotal"}];r&&!f&&(D.unshift({label:"",key:"checkbox"}),D.push({label:l.actionsHeader,key:"actions"}));const E=(t,c)=>{const g=t.target.checked;o==null||o(c,g)},T=(t,c)=>{const g=t.target.value;u==null||u(c,g)},$=(t,c)=>{const g=parseInt(t.target.value,10);!isNaN(g)&&g>0&&(_(y=>({...y,[c.uid]:g})),p==null||p(c,g))},z=t=>{t.preventDefault(),k==null||k(t)},C=(t,c)=>t>0?b("div",{className:"quote-management-product-list-table__discount-container",children:[b("span",{className:"quote-management-product-list-table__discount-percent",children:[c,"%"]}),b("span",{className:"quote-management-product-list-table__discount-price",children:["(",e(O,{amount:t}),")"]})]}):void 0,P=t=>{var y,A;const c=(y=t.configurableOptions)==null?void 0:y.map(q=>b("div",{className:"quote-management-product-list-table__configurable-option",children:[b("span",{className:"quote-management-product-list-table__configurable-option-label",children:[q.optionLabel,":"]}),e("span",{className:"quote-management-product-list-table__configurable-option-value",children:q.valueLabel})]},q.optionLabel)),g=(A=t.bundleOptions)==null?void 0:A.map(q=>b("div",{className:"quote-management-product-list-table__bundle-option",children:[e("span",{className:"quote-management-product-list-table__bundle-option-label",children:q.label}),e("div",{className:"quote-management-product-list-table__bundle-option-values",children:q.values.map(H=>b("span",{className:"quote-management-product-list-table__bundle-option-value",children:[b("span",{className:"quote-management-product-list-table__bundle-option-value-quantity",children:[H.quantity," x"]}),e("span",{className:"quote-management-product-list-table__bundle-option-value-label",children:H.label}),e(O,{className:"quote-management-product-list-table__bundle-option-value-original-price",amount:H.originalPrice.value,currency:H.originalPrice.currency,weight:"normal"})]},H.label))})]},q.label));return b("div",{className:"quote-management-product-list-table__product-name-container",children:[e("span",{className:"quote-management-product-list-table__product-name",children:t.product.name}),c,g]})},M=m.map(t=>{var g;const c=r?e(fe,{className:"quote-management-product-list-table__quantity-input",type:"number",min:"1",value:((g=S[t.uid])==null?void 0:g.toString())||t.quantity.toString(),onChange:y=>$(y,t),disabled:f||!r,"data-testid":`quantity-input-${t.product.sku}`}):e("span",{className:"quote-management-product-list-table__quantity",children:t.quantity});return{checkbox:e(qe,{className:"quote-management-product-list-table__checkbox",name:"itemSelected","data-testid":`item-checkbox-${t.product.sku}`,onChange:y=>E(y,t),value:t.product.sku}),productName:P(t),sku:e("span",{className:"quote-management-product-list-table__sku",children:t.product.sku}),price:e(O,{className:"quote-management-product-list-table__price",amount:t.prices.originalItemPrice.value,currency:t.prices.originalItemPrice.currency}),quantity:c,discount:C(t.catalogDiscount.amountOff,t.catalogDiscount.percentOff),subtotal:e(O,{className:"quote-management-product-list-table__subtotal",amount:t.prices.rowTotal.value,currency:t.prices.rowTotal.currency}),actions:e(ye,{className:"quote-management-product-list-table__actions","data-testid":`item-dropdown-${t.product.sku}`,name:`item-dropdown-${t.product.sku}`,handleSelect:y=>T(y,t),placeholder:"Select",value:(n==null?void 0:n[t.uid])??"",options:[{text:l.editNoteToSeller,value:"edit"},{text:l.remove,value:"remove"}]})}}),F=e(Ne,{columns:D,rowData:M,"data-testid":"product-list-table",mobileLayout:"stacked"}),x=r?te("form",{}):te("div",{}),i=r?{onSubmit:z,...v}:v,U=e(K,{type:"submit",disabled:f||!r||!L,"data-testid":"product-list-table-submit-button",children:l.updateButton});return b(J,{node:x,className:I(["quote-management-product-list-table-container",N]),"data-testid":"product-list-table-container",...i,children:[F,e("div",{className:"quote-management-product-list-table-container__submit-container",children:U})]})},Se=({className:N,entries:m,...r})=>{const f=o=>{var p;const u=(p=o.children)==null?void 0:p.map(f);return e("div",{className:"quote-management-quote-prices-summary__entry","data-testid":`quote-prices-summary-entry-${o.id}`,children:u?e(ve,{className:"quote-management-quote-prices-summary__accordion","data-testid":`quote-prices-summary-entry-accordion-${o.id}`,children:e(_e,{className:"quote-management-quote-prices-summary__accordion-section",title:o.label,ariaLabelTitle:o.label,secondaryText:o.value,children:u})}):b(re,{children:[e("span",{className:I(["quote-management-quote-prices-summary__label",["quote-management-quote-prices-summary__label--strong",o.strong]]),"data-testid":`quote-prices-summary-entry-label-${o.id}`,children:o.label}),e("span",{className:"quote-management-quote-prices-summary__value","data-testid":`quote-prices-summary-entry-value-${o.id}`,children:o.value})]})},o.id)};return e("div",{className:I(["quote-management-quote-prices-summary",N]),"data-testid":"quote-prices-summary",...r,children:m==null?void 0:m.map(f)})},ie=({open:N=!1,title:m,message:r,cancelLabel:f,confirmLabel:o,onCancel:u,onConfirm:p,onClose:k,showCloseButton:n,confirmationBanner:v,...B})=>{const Q=X({cancel:"ConfirmationModal.cancel",confirm:"ConfirmationModal.confirm"});if(!N)return null;const{className:S,..._}=B;return e(Me,{..._,size:"medium",onClose:k||u,clickToDismiss:!0,escapeToDismiss:!0,showCloseButton:n,"data-testid":"confirmation-modal",className:S,children:b("div",{className:"confirmation-modal__content",children:[v&&e("div",{className:"confirmation-modal__banner","data-testid":"confirmation-modal-banner",children:v}),m&&e("div",{className:"confirmation-modal__title","data-testid":"confirmation-modal-title",children:m}),r&&e("div",{className:"confirmation-modal__message","data-testid":"confirmation-modal-message",children:r}),b("div",{className:"confirmation-modal__actions","data-testid":"confirmation-modal-actions",children:[u&&e(K,{variant:"secondary",onClick:u,"data-testid":"confirmation-modal-cancel",children:f??Q.cancel}),e(K,{variant:"primary",onClick:p,"data-testid":"confirmation-modal-confirm",children:o??Q.confirm})]})]})})},xe=3e3,Ae=({quoteData:N,onItemCheckboxChange:m,onItemDropdownChange:r,onUpdate:f,onRemoveItemsRef:o,onRemoveModalStateChange:u,slots:p,...k})=>{const[n,v]=h(N),[B,Q]=h({}),[S,_]=h(!1),[L,l]=h({type:null,message:""}),[D,E]=h(!1),[T,$]=h([]),[z,C]=h(!1),[P,M]=h({type:null,message:""}),[F,x]=h({}),i=X({subtotal:"NegotiableQuote.Manage.quotePricesSummary.subtotal.excludingTax",grandTotal:"NegotiableQuote.Manage.quotePricesSummary.grandTotal.includingTax",appliedTaxes:"NegotiableQuote.Manage.quotePricesSummary.appliedTaxes",modalTitle:"NegotiableQuote.Manage.updateQuantitiesModal.title",modalDescription:"NegotiableQuote.Manage.updateQuantitiesModal.description",modalCancelButton:"NegotiableQuote.Manage.updateQuantitiesModal.cancelButton",modalUpdateButton:"NegotiableQuote.Manage.updateQuantitiesModal.updateButton",successHeading:"NegotiableQuote.Manage.updateQuantitiesModal.successHeading",successMessage:"NegotiableQuote.Manage.updateQuantitiesModal.successMessage",errorHeading:"NegotiableQuote.Manage.updateQuantitiesModal.errorHeading",errorMessage:"NegotiableQuote.Manage.updateQuantitiesModal.errorMessage",removeModalTitle:"NegotiableQuote.Manage.removeItemsModal.title",removeModalDescription:"NegotiableQuote.Manage.removeItemsModal.description",removeModalCancelButton:"NegotiableQuote.Manage.removeItemsModal.cancelButton",removeModalConfirmButton:"NegotiableQuote.Manage.removeItemsModal.confirmButton",removeModalConfirmButtonRemoving:"NegotiableQuote.Manage.removeItemsModal.confirmButtonRemoving",removeSuccessHeading:"NegotiableQuote.Manage.removeItemsModal.successHeading",removeSuccessMessage:"NegotiableQuote.Manage.removeItemsModal.successMessage",removeErrorHeading:"NegotiableQuote.Manage.removeItemsModal.errorHeading",removeErrorMessage:"NegotiableQuote.Manage.removeItemsModal.errorMessage"});w(()=>{const a=Y.on("quote-management/quote-data",s=>{v(s.quote),Q({}),l({type:null,message:""}),x({})},{eager:!0});return()=>a==null?void 0:a.off()},[]),w(()=>{const a=Y.on("quote-management/quantities-updated",s=>{v(s.quote),Q({}),l({type:"success",message:i.successMessage}),setTimeout(()=>{_(!1),l({type:null,message:""})},3e3)});return()=>a==null?void 0:a.off()},[i.successMessage]),w(()=>{const a=Y.on("quote-management/quote-items-removed",s=>{v(s.quote),$([]),C(!1),M({type:"success",message:i.removeSuccessMessage}),setTimeout(()=>{E(!1),M({type:null,message:""}),u==null||u(!1)},xe)});return()=>a==null?void 0:a.off()},[i.removeSuccessMessage,u]);const U=me(a=>{!a||a.length===0||($(a),M({type:null,message:""}),E(!0))},[]);w(()=>{o==null||o(U)},[U,o]);const t=()=>{M({type:null,message:""})},c=(a,s)=>{if(s==="remove"){x(d=>({...d,[a.uid]:s})),U([a]),r==null||r(a,s);return}r==null||r(a,s),x(d=>{if(!(a.uid in d))return d;const j={...d};return delete j[a.uid],j})},g=async()=>{if(!n||T.length===0)return;const a=T.map(s=>s.uid);C(!0),M({type:null,message:""});try{await Qe({quoteUid:n.uid,quoteItemUids:a})}catch(s){const d=s instanceof Error?s.message:i.removeErrorMessage;if(M({type:"error",message:d}),T.length===1){const j=T[0];x(V=>{if(!(j.uid in V))return V;const R={...V};return delete R[j.uid],R})}C(!1)}},y=()=>{if(E(!1),M({type:null,message:""}),u==null||u(!1),T.length===1){const a=T[0];x(s=>{if(!(a.uid in s))return s;const d={...s};return delete d[a.uid],d})}$([])};if(!n)return e(ne,{loading:!0});const A=!!n.canUpdateQuote,q=(a,s)=>{Q(d=>({...d,[a.uid]:s}))},H=a=>{a.preventDefault(),l({type:null,message:""}),_(!0)},le=async()=>{if(!n)return;if(Object.keys(B).length===0){_(!1);return}l({type:null,message:""});const a=Object.entries(B).map(([s,d])=>({quoteItemUid:s,quantity:d}));try{await he({quoteUid:n.uid,items:a})}catch(s){const d=s instanceof Error?s.message:i.errorMessage;l({type:"error",message:d}),console.error("Failed to update quantities:",s)}},ue=()=>{_(!1),l({type:null,message:""})},Z=()=>{l({type:null,message:""})},G=[];n.prices.subtotalExcludingTax&&G.push({label:i.subtotal,id:"subtotal",value:e(O,{amount:n.prices.subtotalExcludingTax.value,currency:n.prices.subtotalExcludingTax.currency,weight:"normal"})}),n.prices.grandTotal&&G.push({label:i.grandTotal,id:"total",value:e(O,{amount:n.prices.grandTotal.value,currency:n.prices.grandTotal.currency}),strong:!0});const ce=L.type==="success"?e(W,{type:"success",variant:"primary",icon:e(se,{}),heading:i.successHeading,description:L.message,onDismiss:Z,"data-testid":"update-quantities-success-banner"}):L.type==="error"?e(W,{type:"error",variant:"primary",icon:e(oe,{}),heading:i.errorHeading,description:L.message,onDismiss:Z,"data-testid":"update-quantities-error-banner"}):null,de=P.type==="success"?e(W,{type:"success",variant:"primary",icon:e(se,{}),heading:i.removeSuccessHeading,description:P.message,onDismiss:t,"data-testid":"remove-items-success-banner"}):P.type==="error"?e(W,{type:"error",variant:"primary",icon:e(oe,{}),heading:i.removeErrorHeading,description:P.message,onDismiss:t,"data-testid":"remove-items-error-banner"}):null;return b(re,{children:[e(ne,{"data-testid":"items-quoted-container",...k,loading:!1,table:e(ee,{name:"ProductListTable",slot:p==null?void 0:p.ProductListTable,context:{items:n.items,canEdit:A,readOnly:n.readOnly,onItemCheckboxChange:m,onItemDropdownChange:c,onQuantityChange:q,onUpdate:f,dropdownSelections:F},children:e(ke,{items:n.items,canEdit:A,readOnly:n.readOnly,onItemCheckboxChange:m,onItemDropdownChange:c,onQuantityChange:q,onUpdate:H,dropdownSelections:F})}),pricesSummary:e(ee,{name:"QuotePricesSummary",slot:p==null?void 0:p.QuotePricesSummary,context:{items:n.items,prices:n.prices},children:e(Se,{entries:G})})}),e(ie,{open:S,title:i.modalTitle,message:i.modalDescription,cancelLabel:i.modalCancelButton,confirmLabel:i.modalUpdateButton,onCancel:ue,onConfirm:le,confirmationBanner:ce,"data-testid":"update-quantities-modal"}),e(ie,{open:D,title:i.removeModalTitle,message:i.removeModalDescription,cancelLabel:i.removeModalCancelButton,confirmLabel:z?i.removeModalConfirmButtonRemoving:i.removeModalConfirmButton,onCancel:y,onConfirm:g,confirmationBanner:de,"data-testid":"remove-items-modal"})]})};export{ie as C,Ae as I};
//# sourceMappingURL=ItemsQuoted.js.map
