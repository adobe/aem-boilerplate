/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as t,jsxs as C,Fragment as v}from"@dropins/tools/preact-jsx-runtime.js";import{useState as i,useEffect as D,useCallback as g}from"@dropins/tools/preact-compat.js";import{Slot as x}from"@dropins/tools/lib.js";import{events as F}from"@dropins/tools/event-bus.js";import{Price as S,InLineAlert as H}from"@dropins/tools/components.js";/* empty css                 */import{I as h,Q as O,P as j,L as A}from"./LineItemNoteModal2.js";/* empty css                *//* empty css                  */import"./state.js";import{a as B}from"./addQuoteTemplateLineItemNote.js";import{S as k}from"./WarningFilled.js";import{useText as U}from"@dropins/tools/i18n.js";const te=({templateData:M,slots:n,...P})=>{const[e,Q]=i(M),[o,f]=i(null),[E,T]=i(!1),[L,m]=i(!1),[b,s]=i(""),[I,u]=i({}),d=U({subtotal:"NegotiableQuoteTemplate.Manage.quotePricesSummary.subtotal.excludingTax",grandTotal:"NegotiableQuoteTemplate.Manage.quotePricesSummary.grandTotal.includingTax",appliedTaxes:"NegotiableQuoteTemplate.Manage.quotePricesSummary.appliedTaxes",errorHeading:"NegotiableQuoteTemplate.Manage.lineItemNoteModal.errorHeading"});D(()=>{const r=F.on("quote-management/quote-template-data",a=>{Q(a.quoteTemplate),u({})},{eager:!0});return()=>r==null?void 0:r.off()},[]);const y=g((r,a)=>{const l=r;a==="edit"&&(f(l),T(!0),u(w=>({...w,[l.uid||""]:""})))},[]),c=g(()=>{o&&u(r=>{const a={...r};return delete a[o.uid||""],a}),T(!1),f(null),m(!1),s("")},[o]),N=g(async r=>{if(!(!o||!e)){m(!0),s("");try{await B({templateId:e.id,itemId:o.uid||"",note:r}),c()}catch(a){console.error("Failed to set template line item note:",a);const l=a instanceof Error?a.message:"Unable to update the item. Please try again.";s(l),m(!1)}}},[o,e,c]);if(!e)return t(h,{loading:!0});const p=[];e.prices.subtotalExcludingTax&&p.push({label:d.subtotal,id:"subtotal",value:t(S,{amount:e.prices.subtotalExcludingTax.value,currency:e.prices.subtotalExcludingTax.currency,weight:"normal"})}),e.prices.grandTotal&&p.push({label:d.grandTotal,id:"total",value:t(S,{amount:e.prices.grandTotal.value,currency:e.prices.grandTotal.currency}),strong:!0});const q=b?t(H,{type:"error",variant:"primary",icon:t(k,{}),heading:d.errorHeading,description:b,onDismiss:()=>s(""),"data-testid":"line-item-note-error-banner"}):null;return C(v,{children:[t(h,{"data-testid":"items-quoted-template-container",...P,loading:!1,table:t(x,{name:"ProductListTable",slot:n==null?void 0:n.ProductListTable,context:{items:e.items,canEdit:!1,onItemDropdownChange:y,dropdownSelections:I},children:t(j,{items:e.items,canEdit:!1,showActions:e.canEditTemplateItems,onItemDropdownChange:y,dropdownSelections:I})}),pricesSummary:t(x,{name:"QuotePricesSummary",slot:n==null?void 0:n.QuotePricesSummary,context:{items:e.items,prices:e.prices},children:t(O,{entries:p})})}),o&&t(A,{open:E,item:o,onClose:c,onConfirm:N,isSubmitting:L,readOnlyQuantity:!0,errorBanner:q||void 0})]})};export{te as I};
//# sourceMappingURL=ItemsQuotedTemplate.js.map
