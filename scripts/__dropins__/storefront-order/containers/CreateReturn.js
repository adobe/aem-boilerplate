/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsx as a,jsxs as N}from"@dropins/tools/preact-jsx-runtime.js";import{classes as A,Slot as T}from"@dropins/tools/lib.js";import{Icon as B,Header as H,InLineAlert as $,Button as M,Checkbox as j,CartItem as G,Image as V}from"@dropins/tools/components.js";import{useState as w,useRef as Z,useEffect as q,useCallback as Q}from"@dropins/tools/preact-hooks.js";import{u as D,a as U}from"../chunks/ShippingStatusCard.js";import*as _ from"@dropins/tools/preact-compat.js";import{u as z}from"../chunks/useGetStoreConfig.js";import{createRef as J,Fragment as K}from"@dropins/tools/preact.js";import{s as X,p as Y,r as I,m as ee}from"../chunks/returnOrdersHelper.js";import{events as te}from"@dropins/tools/event-bus.js";import{g as W}from"../chunks/getQueryParam.js";import{g as re,r as ne,a as ae}from"../chunks/requestGuestReturn.js";import{s as se}from"../chunks/setTaxStatus.js";import{S as ie,C as ce}from"../chunks/CartSummaryItem.js";import{a as ue}from"../chunks/OrderLoaders.js";import{useText as oe}from"@dropins/tools/i18n.js";import"../chunks/getStoreConfig.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/getFormValues.js";import"../chunks/network-error.js";import"../chunks/transform-attributes-form.js";import"../fragments.js";import"../chunks/initialize.js";const le=s=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},_.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),_.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.75 12.762L10.2385 15.75L17.25 9",stroke:"currentColor"})),de=s=>_.createElement("svg",{id:"Icon_Warning_Base",width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},_.createElement("g",{clipPath:"url(#clip0_841_1324)"},_.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.9949 2.30237L0.802734 21.6977H23.1977L11.9949 2.30237Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),_.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M12.4336 10.5504L12.3373 14.4766H11.6632L11.5669 10.5504V9.51273H12.4336V10.5504ZM11.5883 18.2636V17.2687H12.4229V18.2636H11.5883Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),_.createElement("defs",null,_.createElement("clipPath",{id:"clip0_841_1324"},_.createElement("rect",{width:24,height:21,fill:"white",transform:"translate(0 1.5)",strokeWidth:1})))),pe=({onSuccess:s,onError:n,handleSetInLineAlert:i,orderData:l})=>{const[R,L]=w(!1),[u,b]=w({id:"",email:"",...l}),[v,x]=w("products"),[h,d]=w(!0),[g,f]=w([]),[C,e]=w([]),[m,t]=w([]),o=Z([]);o.current.length!==g.length&&(o.current=g.map((r,p)=>o.current[p]||J())),q(()=>{const r=te.on("order/data",p=>{var c;b(p);const O=X(p);t(O),L(((c=W("orderRef"))==null?void 0:c.length)>20),d(!1)},{eager:!0});return()=>{r==null||r.off()}},[]),q(()=>{re("RMA_ITEM").then(r=>{r!=null&&r.length&&(e(r),d(!1))})},[]);const y=Q(r=>{f(p=>p.findIndex(c=>(c==null?void 0:c.productSku)===(r==null?void 0:r.productSku))>-1?p.filter(c=>(c==null?void 0:c.productSku)!==(r==null?void 0:r.productSku)):[...p,r])},[]),S=Q(r=>{x(r),i(),r==="products"&&f([])},[i]),E=Q((r,p)=>{const O=g.map(c=>c.productSku===p?{...c,currentReturnOrderQuantity:r}:c);f(O)},[g]),F=Q(async(r,p)=>{if(!p)return;d(!0);const O={orderUid:u.id,contactEmail:u.email},c=Y(o);R?ae({token:W("orderRef"),contactEmail:O.contactEmail,items:c,commentText:"."}).then(k=>{s==null||s(k),S("success"),i()}).catch(k=>{n==null||n(k.message),i({type:"error",heading:k.message})}):ne({...O,items:c}).then(k=>{s==null||s(k),S("success"),i()}).catch(k=>{n==null||n(k.message),i({type:"error",heading:k.message})}),d(!1)},[S,n,s,i,u,R]);return{order:u,steps:v,loading:h,formsRef:o,attributesList:C,selectedProductList:g,itemsEligibleForReturn:m,handleSelectedProductList:y,handleSetQuantity:E,handleChangeStep:S,onSubmit:F}},me={success:le,warning:de,error:ie},he=()=>{const[s,n]=w({type:"success",heading:""}),i=Q(l=>{if(!(l!=null&&l.type)){n({type:"success",heading:""});return}const R=a(B,{source:me[l.type]});n({...l,icon:R})},[]);return{inLineAlertProps:s,handleSetInLineAlert:i}},$e=({className:s,orderData:n,slots:i,onSuccess:l,onError:R,routeReturnSuccess:L,showConfigurableOptions:u})=>{const b=oe({headerText:"Order.CreateReturn.headerText",successTitle:"Order.CreateReturn.success.title",successMessage:"Order.CreateReturn.success.message",sender:"Order.CreateReturn.giftCard.sender",recipient:"Order.CreateReturn.giftCard.recipient",message:"Order.CreateReturn.giftCard.message",outOfStock:"Order.CreateReturn.stockStatus.outOfStock",nextStep:"Order.CreateReturn.buttons.nextStep",backStep:"Order.CreateReturn.buttons.backStep",submit:"Order.CreateReturn.buttons.submit",backStore:"Order.CreateReturn.buttons.backStore",downloadableCount:"Order.CreateReturn.downloadableCount",returnedItems:"Order.CreateReturn.returnedItems",configurationsListQuantity:"Order.CreateReturn.configurationsList.quantity"}),{inLineAlertProps:v,handleSetInLineAlert:x}=he(),h=z(),{order:d,itemsEligibleForReturn:g,formsRef:f,attributesList:C,steps:e,loading:m,selectedProductList:t,handleSelectedProductList:o,handleSetQuantity:y,handleChangeStep:S,onSubmit:E}=pe({orderData:n,onSuccess:l,onError:R,handleSetInLineAlert:x});if(m)return a("div",{children:a(ue,{})});if(!m&&!C.length)return a("div",{});const F=(h==null?void 0:h.baseMediaUrl)??"",r={products:a(fe,{itemsEligibleForReturn:g,placeholderImage:F,taxConfig:se((h==null?void 0:h.shoppingOrderDisplayPrice)??0),slots:i,translations:b,loading:m,selectedProductList:t,handleSelectedProductList:o,showConfigurableOptions:u,handleSetQuantity:y,handleChangeStep:S}),attributes:a(ke,{placeholderImage:F,slots:i,formsRef:f,loading:m,fieldsConfig:C,selectedProductList:t,handleChangeStep:S,translations:b,onSubmit:E}),success:a(ge,{translations:b,routeReturnSuccess:L,orderData:d}),error:null};return N("div",{className:A(["order-create-return",s]),children:[a(H,{title:b.headerText}),v.heading?a($,{className:"order-create-return_notification",variant:"secondary","data-testid":"orderCreateReturnNotification",...v}):null,r[e]]})},ge=({routeReturnSuccess:s,translations:n,orderData:i})=>N("div",{className:"order-return-order-message",children:[a("p",{className:"order-return-order-message__title",children:n.successTitle}),a("p",{className:"order-return-order-message__subtitle",children:n.successMessage}),a(M,{href:(s==null?void 0:s(i))??"#",children:n.backStore})]}),fe=({placeholderImage:s,itemsEligibleForReturn:n,slots:i,loading:l,taxConfig:R,translations:L,selectedProductList:u,handleSelectedProductList:b,showConfigurableOptions:v,handleSetQuantity:x,handleChangeStep:h})=>N("ul",{className:"order-return-order-product-list",children:[n==null?void 0:n.map((d,g)=>{const{quantityReturnRequested:f,quantityShipped:C,eligibleForReturn:e}=d,m=u.some(y=>(y==null?void 0:y.productSku)===d.productSku&&d.eligibleForReturn),t=C===f&&e||!e,o=C-f===0?f:C-f;return N("li",{className:A(["order-return-order-product-list__item",["order-return-order-product-list__item--blur",t]]),children:[a(j,{"data-testid":`key_${g}`,name:`key_${g}`,checked:m,disabled:t,onChange:()=>{b({...d,currentReturnOrderQuantity:1})}}),a(ce,{slots:i,placeholderImage:s,loading:l,product:{...d,totalQuantity:o||1},itemType:"",taxConfig:R,translations:L,showConfigurableOptions:v,disabledIncrementer:!m,onQuantity:o>1?y=>{x(y,d.productSku)}:void 0}),a(T,{"data-testid":"returnOrderItem",name:"ReturnOrderItem",slot:i==null?void 0:i.ReturnOrderItem})]},d.id)}),a("li",{className:"order-return-order-product-list__item",children:a(M,{type:"button",onClick:()=>h("attributes"),disabled:!u.length,children:L.nextStep})})]}),ke=({placeholderImage:s,slots:n,formsRef:i,selectedProductList:l,loading:R,fieldsConfig:L,translations:u,handleChangeStep:b,onSubmit:v})=>{const{formData:x,errors:h,formRef:d,handleChange:g,handleBlur:f,handleSubmit:C}=D({fieldsConfig:I(L,l==null?void 0:l.length),onSubmit:v});return N("form",{className:"order-return-reason-form",ref:d,onSubmit:C,name:"returnReasonForm",children:[l.map((e,m)=>{var O,c,k,P;const t=e==null?void 0:e.giftCard,o=e==null?void 0:e.product,y=ee(L,m),S=`${e==null?void 0:e.id}_${m}`,E=(e==null?void 0:e.currentReturnOrderQuantity)??1,F={...e!=null&&e.currentReturnOrderQuantity?{[u.configurationsListQuantity]:E}:{},...e.configurableOptions||{},...e.bundleOptions||{},...t!=null&&t.senderName?{[u.sender]:t==null?void 0:t.senderName}:{},...t!=null&&t.senderEmail?{[u.sender]:t==null?void 0:t.senderEmail}:{},...t!=null&&t.recipientName?{[u.recipient]:t==null?void 0:t.recipientName}:{},...t!=null&&t.recipientEmail?{[u.recipient]:t==null?void 0:t.recipientEmail}:{},...t!=null&&t.message?{[u.message]:t==null?void 0:t.message}:{},...e!=null&&e.downloadableLinks?{[`${(O=e==null?void 0:e.downloadableLinks)==null?void 0:O.count} ${u.downloadableCount}`]:(c=e==null?void 0:e.downloadableLinks)==null?void 0:c.result}:{}},r=(k=e==null?void 0:e.product)==null?void 0:k.name,p={title:r,src:((P=o==null?void 0:o.thumbnail)==null?void 0:P.url)??s,alt:r,width:90,height:120,loading:"lazy"};return N(K,{children:[a(G,{loading:R,title:a("div",{"data-testid":"product-name",children:r}),sku:a("div",{children:o==null?void 0:o.sku}),image:a(T,{name:"ReturnReasonFormImage",slot:n==null?void 0:n.ReturnReasonFormImage,context:{data:e,defaultImageProps:p},children:a(V,{...p})}),configurations:F}),a("form",{name:S,ref:i==null?void 0:i.current[m],"data-quantity":E,children:a(U,{className:"className",loading:R,fields:y,onChange:g,onBlur:f,errors:h,values:x})})]},e.id)}),a(T,{"data-testid":"returnFormActions",name:"ReturnFormActions",slot:n==null?void 0:n.ReturnFormActions,context:{handleChangeStep:b},children:N("div",{className:"order-return-reason-form__actions",children:[a(M,{variant:"secondary",type:"button",onClick:()=>{b("products")},children:u.backStep}),a(M,{children:u.submit})]})})]})};export{$e as CreateReturn,$e as default};
//# sourceMappingURL=CreateReturn.js.map
