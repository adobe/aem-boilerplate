/*! Copyright 2025 Adobe
All Rights Reserved. */
import{s as f}from"./state.js";import{FetchGraphQL as T}from"@dropins/tools/fetch-graphql.js";var E=(e=>(e.NEW="NEW",e.SUBMITTED="SUBMITTED",e.PENDING="PENDING",e.UPDATED="UPDATED",e.OPEN="OPEN",e.ORDERED="ORDERED",e.CLOSED="CLOSED",e.DECLINED="DECLINED",e.EXPIRED="EXPIRED",e.DRAFT="DRAFT",e))(E||{});const x=["DRAFT","UPDATED","DECLINED","EXPIRED","NEW","OPEN"];function D(e){var r,t,s,g,m,h,v;const c=b(e);return{uid:e.uid,name:e.name,createdAt:e.created_at,updatedAt:e.updated_at,expirationDate:e.expiration_date,status:c?E.NEW:e.status,isVirtual:!!e.is_virtual,salesRepName:e.sales_rep_name,buyer:{firstname:e.buyer.firstname,lastname:e.buyer.lastname},templateName:e.template_name,comments:(r=e.comments)==null?void 0:r.map(a=>{const i={uid:a.uid,createdAt:a.created_at,author:{firstname:a.author.firstname,lastname:a.author.lastname},text:a.text};return Array.isArray(a.attachments)&&a.attachments.length>0&&(i.attachments=a.attachments.map(p=>({name:p.name,url:p.url}))),i}),prices:e.prices&&{appliedDiscounts:(t=e.prices.discounts)==null?void 0:t.map(a=>({amount:{value:a.amount.value,currency:a.amount.currency},label:a.label,coupon:a.coupon})),appliedTaxes:(s=e.prices.applied_taxes)==null?void 0:s.map(a=>({amount:{value:a.amount.value,currency:a.amount.currency},label:a.label})),discount:e.prices.discounts&&e.prices.grand_total&&y(e.prices.discounts,e.prices.grand_total.currency),grandTotal:e.prices.grand_total&&{value:e.prices.grand_total.value,currency:e.prices.grand_total.currency},grandTotalExcludingTax:e.prices.grand_total_excluding_tax&&{value:e.prices.grand_total_excluding_tax.value,currency:e.prices.grand_total_excluding_tax.currency},subtotalExcludingTax:e.prices.subtotal_excluding_tax&&{value:e.prices.subtotal_excluding_tax.value,currency:e.prices.subtotal_excluding_tax.currency},subtotalIncludingTax:e.prices.subtotal_including_tax&&{value:e.prices.subtotal_including_tax.value,currency:e.prices.subtotal_including_tax.currency},subtotalWithDiscountExcludingTax:e.prices.subtotal_with_discount_excluding_tax&&{value:e.prices.subtotal_with_discount_excluding_tax.value,currency:e.prices.subtotal_with_discount_excluding_tax.currency},...A(e),totalTax:e.prices.applied_taxes&&e.prices.grand_total&&y(e.prices.applied_taxes,e.prices.grand_total.currency)},history:(g=e.history)==null?void 0:g.map(a=>{var i,p,u,o,d,_,n;return{uid:a.uid,createdAt:a.created_at,author:{firstname:a.author.firstname,lastname:a.author.lastname},changeType:a.change_type,changes:{commentAdded:((i=a.changes)==null?void 0:i.comment_added)&&{comment:a.changes.comment_added.comment},customChanges:((p=a.changes)==null?void 0:p.custom_changes)&&{new_value:a.changes.custom_changes.new_value,old_value:a.changes.custom_changes.old_value,title:a.changes.custom_changes.title},expiration:((u=a.changes)==null?void 0:u.expiration)&&{newExpiration:a.changes.expiration.new_expiration,oldExpiration:a.changes.expiration.old_expiration},productsRemoved:((o=a.changes)==null?void 0:o.products_removed)&&{productsRemovedFromCatalog:a.changes.products_removed.products_removed_from_catalog||[],productsRemovedFromQuote:a.changes.products_removed.products_removed_from_quote||[]},statuses:((d=a.changes)==null?void 0:d.statuses)&&{changes:((_=a.changes.statuses.changes)==null?void 0:_.map(l=>({newStatus:l.new_status,oldStatus:l.old_status})))||[]},total:((n=a.changes)==null?void 0:n.total)&&a.changes.total.new_price&&a.changes.total.old_price&&{newPrice:{value:a.changes.total.new_price.value,currency:a.changes.total.new_price.currency},oldPrice:{value:a.changes.total.old_price.value,currency:a.changes.total.old_price.currency}}}}}),items:((m=e.items)==null?void 0:m.map(a=>{var i,p,u,o,d,_;return{uid:a.uid,product:{uid:a.product.uid,sku:a.product.sku,name:a.product.name},catalogDiscount:{amountOff:a.prices.catalog_discount.amount_off,percentOff:a.prices.catalog_discount.percent_off},discounts:((p=(i=a.prices)==null?void 0:i.discounts)==null?void 0:p.map(n=>({label:n.label,value:n.value,amount:{value:n.amount.value,currency:n.amount.currency}})))??[],stockStatus:a.product.stock_status,quantity:a.quantity,prices:{originalItemPrice:{value:a.prices.original_item_price.value,currency:a.prices.original_item_price.currency},rowTotal:{value:a.prices.row_total.value,currency:a.prices.row_total.currency}},noteFromBuyer:(u=a.note_from_buyer)==null?void 0:u.map(n=>({createdAt:n.created_at,creatorId:n.creator_id,creatorType:n.creator_type,negotiableQuoteItemUid:n.negotiable_quote_item_uid,note:n.note,noteUid:n.note_uid})),noteFromSeller:(o=a.note_from_seller)==null?void 0:o.map(n=>({createdAt:n.created_at,creatorId:n.creator_id,creatorType:n.creator_type,negotiableQuoteItemUid:n.negotiable_quote_item_uid,note:n.note,noteUid:n.note_uid})),configurableOptions:(d=a.configurable_options)==null?void 0:d.map(n=>({optionLabel:n.option_label,valueLabel:n.value_label})),bundleOptions:(_=a.bundle_options)==null?void 0:_.map(n=>({label:n.label,values:n.values.map(l=>({label:l.label,quantity:l.quantity,originalPrice:{value:l.original_price.value,currency:l.original_price.currency},price:{value:l.priceV2.value,currency:l.priceV2.currency}}))}))}}))||[],shippingAddresses:(h=e.shipping_addresses)==null?void 0:h.map(a=>{const i={uid:a.uid,firstname:a.firstname,lastname:a.lastname,company:a.company,street:a.street,city:a.city,postcode:a.postcode,country:{code:a.country.code,label:a.country.label},telephone:a.telephone};return a.region&&(i.region={code:a.region.code,label:a.region.label,regionId:a.region.region_id}),i}),canCheckout:["UPDATED","DECLINED","OPEN"].includes(e.status)&&f.permissions.checkoutQuote&&((v=e.shipping_addresses)==null?void 0:v.length)>0,canSendForReview:(c||x.includes(e.status))&&f.permissions.editQuote,canUpdateQuote:(c||x.includes(e.status))&&f.permissions.editQuote,canDelete:!["PENDING","SUBMITTED","ORDERED"].includes(e.status)&&f.permissions.deleteQuote,canClose:e.status?!["DRAFT","CLOSED","ORDERED","OPEN"].includes(e.status):!1}}function R(e){return e?D(e):null}function b(e){return e.status==="SUBMITTED"&&!(e.history??[]).some(c=>{var r,t;return c.change_type==="UPDATED"&&(((t=(r=c.changes)==null?void 0:r.statuses)==null?void 0:t.changes)??[]).length>0})}function I(e){const c=b(e);return{uid:e.uid,name:e.name,createdAt:e.created_at,updatedAt:e.updated_at,status:c?E.NEW:e.status,buyer:{firstname:e.buyer.firstname,lastname:e.buyer.lastname},templateName:e.template_name,prices:{grandTotal:{value:e.prices.grand_total.value,currency:e.prices.grand_total.currency}}}}function N(e){var t;if(!e)return null;const c={items:((t=e.items)==null?void 0:t.filter(s=>s==null?void 0:s.uid).map(I))||[],pageInfo:{currentPage:e.page_info.current_page,pageSize:e.page_info.page_size,totalPages:e.page_info.total_pages},totalCount:e.total_count,sortFields:e.sort_fields?{default:e.sort_fields.default,options:e.sort_fields.options}:void 0},r=P(c);return{...c,paginationInfo:r||void 0}}function P(e){if(!(e!=null&&e.pageInfo)||!e.totalCount)return null;const{currentPage:c,pageSize:r,totalPages:t}=e.pageInfo,{totalCount:s}=e,g=s>0?(c-1)*r+1:0,m=Math.min(c*r,s);return{currentPage:c,totalCount:s,pageSize:r,startItem:g,endItem:m,totalPages:t,pageSizeOptions:[20,30,50,100,200]}}const C=()=>[20,30,50,100,200];function y(e,c){return e!=null&&e.length?e.reduce((r,t)=>({value:r.value+t.amount.value,currency:t.amount.currency}),{value:0,currency:c}):{value:0,currency:c}}function A(e){var t;if(!e||!((t=e.shipping_addresses)!=null&&t.length))return{};const r=e.shipping_addresses[0].selected_shipping_method;return r?{shippingIncludingTax:r.price_incl_tax&&{value:r.price_incl_tax.value,currency:r.price_incl_tax.currency},shippingExcludingTax:r.price_excl_tax&&{value:r.price_excl_tax.value,currency:r.price_excl_tax.currency}}:{}}const{setEndpoint:U,setFetchGraphQlHeader:F,removeFetchGraphQlHeader:S,setFetchGraphQlHeaders:L,fetchGraphQl:Q,getConfig:G}=new T().getMethods();export{N as a,F as b,L as c,G as d,Q as f,C as g,S as r,U as s,R as t};
//# sourceMappingURL=fetch-graphql.js.map
