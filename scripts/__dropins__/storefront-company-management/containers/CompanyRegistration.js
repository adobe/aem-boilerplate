/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as g,jsx as m,Fragment as J}from"@dropins/tools/preact-jsx-runtime.js";import{useRef as D,useEffect as H,useState as $,useMemo as G,useCallback as ee}from"@dropins/tools/preact-hooks.js";import{Field as B,Picker as ae,Input as re,ProgressSpinner as z,InLineAlert as ne,Button as oe}from"@dropins/tools/components.js";import{classes as w,Slot as te}from"@dropins/tools/lib.js";import{memo as se}from"@dropins/tools/preact-compat.js";import{useText as P}from"@dropins/tools/i18n.js";import{g as ie,c as le}from"../chunks/createCompany.js";import{g as Z,v as de}from"../chunks/validateCompanyEmail.js";/* empty css            */import{u as ce}from"../chunks/useInLineAlert.js";import{a as me,i as ue}from"../chunks/isCompanyUser.js";import"../chunks/network-error.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/event-bus.js";import"../chunks/fetch-error.js";import"../chunks/company-permissions.js";var A=(a=>(a.TEXT="TEXT",a.EMAIL="EMAIL",a.TEL="TEL",a.SELECT="SELECT",a.HIDDEN="HIDDEN",a))(A||{});const pe=se(({loading:a,values:e={},fields:p,errors:n={},className:h="",regionOptions:t,countryOptions:y,onChange:s,onBlur:l,onFocus:u,slots:E,fieldIdPrefix:f})=>{const _=`${h}__field`,S=P({selectCountry:"Company.FormText.selectCountry",selectRegion:"Company.FormText.selectRegion",selectCountryFirst:"Company.FormText.selectCountryFirst",country:"Company.shared.fields.country",stateProvince:"Company.shared.fields.stateProvince","Company.Registration.companyInformation":"Company.shared.fields.companyInformation","Company.Registration.legalAddress":"Company.shared.fields.legalAddress","Company.Registration.companyAdmin":"Company.shared.fields.companyAdmin"}),N={CompanyInformationSection:["companyName","legalName","companyEmail","vatTaxId","resellerId"],LegalAddressSection:["street","streetLine2","city","countryCode","region","postcode","addressTelephone"],CompanyAdministratorSection:["adminEmail","adminFirstname","adminLastname","adminJobTitle","adminWorkTelephone","adminGender"]},b=r=>({CompanyInformationSection:"Company.Registration.companyInformation",LegalAddressSection:"Company.Registration.legalAddress",CompanyAdministratorSection:"Company.Registration.companyAdmin"})[r],T=r=>{var C,L,F,V;if((r.code==="region"||r.code==="regionCode")&&r.fieldType===A.SELECT){const x=((C=e.regionCode)==null?void 0:C.toString())||"",I=((L=e.regionId)==null?void 0:L.toString())||"";return x&&I?`${x},${I}`:(F=e[r.code])!=null&&F.toString().includes(",")?(V=e[r.code])==null?void 0:V.toString():""}return null},i=r=>{var C;return r.code==="street"?Array.isArray(e.street)?e.street[0]||"":((C=e.street)==null?void 0:C.toString())||"":r.code==="streetLine2"?Array.isArray(e.street)&&e.street[1]||"":null},o=(r,C)=>{const L=`CompanyFormInput_${r.code}`,F=E==null?void 0:E[L];if(!F)return null;const V={inputName:r.code,handleOnChange:s||(()=>{}),errorMessage:C,errors:Object.values(n),formData:e,fieldConfig:{required:r.required,disabled:r.disabled||a,placeholder:r.placeholder||r.label,label:r.label}};return m(te,{"data-testid":`companyFormInput_${r.code}`,name:L,slot:F,context:V})},d=(r,C,L)=>{let F=r.options;return r.code==="countryCode"||r.code==="country_code"?F=(y==null?void 0:y.map(V=>({value:V.value,text:V.text,isDefault:!1})))||[]:(r.code==="region"||r.code==="regionCode")&&(F=(t==null?void 0:t.map(V=>({text:V.text,value:V.value,isDefault:!1})))||[]),m(J,{children:o(r,L)??m(B,{error:L,className:w([_,`${_}--${r.id}`,[`${_}--${r.id}-hidden`,r.isHidden],r.className]),"data-testid":`${h}--${r.id}`,disabled:a,children:m(ae,{"aria-label":r.label,"aria-required":r.required?"true":"false",id:f?`${f}_${r.code}`:r.code,required:r==null?void 0:r.required,name:r.customUpperCode||r.code,floatingLabel:`${r.label} ${r.required?"*":""}`,placeholder:r.label,options:F,onBlur:l,onFocus:u,handleSelect:s,defaultValue:C,value:C})},r.id)})},c=(r,C,L)=>{let F="text";return r.fieldType===A.EMAIL?F="email":r.fieldType===A.TEL&&(F="tel"),m(J,{children:o(r,L)??m(B,{error:L,className:w([_,`${_}--${r.id}`,[`${_}--${r.id}-hidden`,r.isHidden],r.className]),"data-testid":`${h}--${r.id}`,disabled:a,children:m(re,{"aria-label":r.label,"aria-required":r.required?"true":"false",id:f?`${f}_${r.code}`:r.code,type:F,name:r.customUpperCode,value:C??r.defaultValue,placeholder:r.label,floatingLabel:`${r.label} ${r.required?"*":""}`,maxLength:r.maxlength,onBlur:l,onFocus:u,onChange:s})},r.id)})},v=r=>p==null?void 0:p.filter(C=>r.includes(C.code)&&!C.isHidden).map(C=>{var I,q;let L=((I=e[C.code])==null?void 0:I.toString())||"";const F=i(C);F!==null&&(L=F);const V=T(C);V!==null&&(L=V);const x=n[C.customUpperCode||C.code]||"";return C.code==="region"||C.code==="regionCode"?C.fieldType===A.SELECT?d(C,L,x):c(C,L,x):C.fieldType===A.SELECT||((q=C.options)==null?void 0:q.length)>0?d(C,L,x):c(C,L,x)}),R=r=>{const C=N[r],L=b(r);return(p==null?void 0:p.some(V=>C.includes(V.code)&&!V.isHidden))?g("div",{className:`${h}__section`,children:[m("h3",{className:`${h}__section-title`,children:S[L]}),v(C)]},`section-${r}`):null};return g("div",{className:`${h}__inputs`,children:[R("CompanyInformationSection"),R("LegalAddressSection"),R("CompanyAdministratorSection")]})}),he=({showFormLoader:a,slots:e,name:p="companyForm",loading:n,submitting:h,children:t,className:y="company-form",fieldsConfig:s=[],values:l={},errors:u={},onSubmit:E,onChange:f,onBlur:_,regionOptions:S,countryOptions:N,fieldIdPrefix:b})=>{const T=D(null),i=P({loading:"Company.FormText.loading",submitting:"Company.FormText.submitting"});H(()=>{h&&window.scrollTo({top:0,behavior:"smooth"})},[h]);const o=async c=>{c.preventDefault(),E&&await E(c,!0)};if(a||n)return g("div",{className:w(["company-form-loader"]),"data-testid":"company-form-loader",children:[m(z,{size:"large"}),m("div",{className:"company-form-loader__text",children:i.loading})]});const d=c=>{const v=c.target,{name:R,value:r}=v;f&&f({[R]:r})};return g("div",{className:"company-form-container",children:[g("form",{id:p,ref:T,className:w(["company-form",y,h&&"company-form--submitting"]),onSubmit:o,noValidate:!0,children:[m(pe,{className:y,fields:s,values:l,errors:u,loading:h,onChange:d,onBlur:_,slots:e,regionOptions:S,countryOptions:N,fieldIdPrefix:b}),t]}),h&&g("div",{className:"company-form__submitting-overlay","data-testid":"company-form-submitting-overlay",children:[m(z,{size:"large"}),m("div",{className:"company-form__submitting-text",children:i.submitting})]})]})},ye=(a={})=>{const{defaultCountry:e="US",formName:p="company_registration"}=a,[n,h]=$(null),[t,y]=$(()=>{var d;try{const c=sessionStorage.getItem(`${p}_formData`);return c?{countryCode:(d=JSON.parse(c))==null?void 0:d.countryCode}:{countryCode:e}}catch{return{countryCode:e}}}),[s,l]=$(!0),[u,E]=$(!0),[f,_]=$([]);H(()=>{l(!0),E(!0),Z().then(({availableCountries:d,countriesWithRequiredRegion:c,optionalZipCountries:v})=>{h({availableCountries:d,countriesWithRequiredRegion:c,optionalZipCountries:v}),l(!1),E(!1)}).catch(d=>{console.error("Failed to load countries:",d),l(!1),E(!1)})},[]),H(()=>{if(t!=null&&t.countryCode&&n){const d=n.availableCountries.find(c=>c.value===t.countryCode);if(d!=null&&d.availableRegions&&d.availableRegions.length>0){const c=d.availableRegions.map(v=>({text:v.name,value:`${v.code},${v.id}`,id:v.id,code:v.code}));_(c)}else _([])}else _([])},[t==null?void 0:t.countryCode,n]);const S=G(()=>(n==null?void 0:n.availableCountries)||[],[n]),N=G(()=>!(t!=null&&t.countryCode)||!n?!1:n.countriesWithRequiredRegion.includes(t.countryCode),[t==null?void 0:t.countryCode,n]),b=G(()=>!(t!=null&&t.countryCode)||!n?!0:!n.optionalZipCountries.includes(t.countryCode),[t==null?void 0:t.countryCode,n]),T=G(()=>f,[f]),i=G(()=>T.length>0,[T.length]),o=ee((d,c)=>{y(v=>{const R={...v,[d]:c};return d==="countryCode"&&(R.regionCode="",R.regionId=void 0),R})},[]);return{countryOptions:S,regionOptions:T,isRequiredRegion:N,isRequiredPostCode:b,disableField:s,loadingCountries:u,hasRegions:i,handleInputChange:o,inputChange:t}},ge=a=>{var E;const{formData:e,isRequiredRegion:p=!1,isRequiredPostCode:n=!1,hasRegions:h=!1,disableField:t=!1,translations:y={}}=a,s=f=>(y==null?void 0:y[f])||f,l=f=>{const _=s(f);return f==="countryCode"||f==="region"||f==="adminGender"?`Select ${_.toLowerCase()}`:`Enter ${_.toLowerCase()}`},u={isRequiredRegion:p,isRequiredPostCode:n};return[{code:"companyName",name:"companyName",id:"companyName",label:s("companyName"),placeholder:l("companyName"),required:!0,fieldType:A.TEXT,isHidden:!1,customUpperCode:"companyName",defaultValue:(e==null?void 0:e.companyName)||"",options:[],maxlength:40,...u,validateRules:[]},{code:"legalName",name:"legalName",id:"legalName",label:s("legalName"),placeholder:l("legalName"),required:!1,fieldType:A.TEXT,isHidden:!1,customUpperCode:"legalName",defaultValue:(e==null?void 0:e.legalName)||"",options:[],maxlength:80,validateRules:[],...u},{code:"companyEmail",name:"companyEmail",id:"companyEmail",label:s("companyEmail"),placeholder:l("companyEmail"),required:!0,fieldType:A.EMAIL,isHidden:!1,customUpperCode:"companyEmail",defaultValue:(e==null?void 0:e.companyEmail)||"",options:[],maxlength:254,validateRules:[{INPUT_VALIDATION:"email"},{MIN_TEXT_LENGTH:5},{MAX_TEXT_LENGTH:254}],...u},{code:"vatTaxId",name:"vatTaxId",id:"vatTaxId",label:s("vatTaxId"),placeholder:l("vatTaxId"),required:!1,fieldType:A.TEXT,isHidden:!1,customUpperCode:"vatTaxId",defaultValue:(e==null?void 0:e.vatTaxId)||"",options:[],maxlength:40,validateRules:[],...u},{code:"resellerId",name:"resellerId",id:"resellerId",label:s("resellerId"),placeholder:l("resellerId"),required:!1,fieldType:A.TEXT,isHidden:!1,customUpperCode:"resellerId",defaultValue:(e==null?void 0:e.resellerId)||"",options:[],maxlength:40,validateRules:[],...u},{code:"street",name:"street",id:"street",label:s("street"),placeholder:l("street"),required:!0,fieldType:A.TEXT,isHidden:!1,customUpperCode:"street",defaultValue:Array.isArray(e==null?void 0:e.street)?e.street[0]:(e==null?void 0:e.street)||"",options:[],validateRules:[],...u},{code:"streetLine2",name:"streetLine2",id:"streetLine2",label:s("streetLine2"),placeholder:l("streetLine2"),required:!1,fieldType:A.TEXT,isHidden:!1,customUpperCode:"streetLine2",defaultValue:Array.isArray(e==null?void 0:e.street)?e.street[1]:"",options:[],validateRules:[],...u},{code:"city",name:"city",id:"city",label:s("city"),placeholder:l("city"),required:!0,fieldType:A.TEXT,isHidden:!1,customUpperCode:"city",defaultValue:(e==null?void 0:e.city)||"",options:[],validateRules:[],...u},{code:"countryCode",name:"countryCode",id:"countryCode",label:s("country"),placeholder:l("country"),required:!0,disabled:t,fieldType:A.SELECT,isHidden:!1,customUpperCode:"countryCode",defaultValue:(e==null?void 0:e.countryCode)||"",options:[],validateRules:[]},{code:"region",name:"region",id:"region",label:s("stateProvince"),placeholder:l("stateProvince"),required:p,disabled:!1,fieldType:h?A.SELECT:A.TEXT,isHidden:!1,customUpperCode:"region",defaultValue:(e==null?void 0:e.regionCode)||"",options:[]},{code:"postcode",name:"postcode",id:"postcode",label:s("postalCode"),placeholder:l("postalCode"),required:n,fieldType:A.TEXT,isHidden:!1,customUpperCode:"postcode",defaultValue:(e==null?void 0:e.postcode)||"",options:[],validateRules:[{INPUT_VALIDATION:"postal-code"},{MIN_TEXT_LENGTH:3},{MAX_TEXT_LENGTH:20}],...u},{code:"addressTelephone",name:"addressTelephone",id:"addressTelephone",label:s("telephone"),placeholder:l("telephone"),required:!0,fieldType:A.TEL,isHidden:!1,customUpperCode:"addressTelephone",defaultValue:(e==null?void 0:e.addressTelephone)||"",options:[],validateRules:[{INPUT_VALIDATION:"phone"},{MIN_TEXT_LENGTH:1},{MAX_TEXT_LENGTH:20}],...u},{code:"adminJobTitle",name:"adminJobTitle",id:"adminJobTitle",label:s("adminJobTitle"),placeholder:l("adminJobTitle"),required:!1,fieldType:A.TEXT,isHidden:!1,customUpperCode:"adminJobTitle",defaultValue:(e==null?void 0:e.adminJobTitle)||"",options:[],validateRules:[],...u},{code:"adminWorkTelephone",name:"adminWorkTelephone",id:"adminWorkTelephone",label:s("adminWorkTelephone"),placeholder:l("adminWorkTelephone"),required:!1,fieldType:A.TEL,isHidden:!1,customUpperCode:"adminWorkTelephone",defaultValue:(e==null?void 0:e.adminWorkTelephone)||"",options:[],validateRules:[{INPUT_VALIDATION:"phone"},{MIN_TEXT_LENGTH:1},{MAX_TEXT_LENGTH:20}],...u},{code:"adminEmail",name:"adminEmail",id:"adminEmail",label:s("adminEmail"),placeholder:l("adminEmail"),required:!0,fieldType:A.EMAIL,isHidden:!1,customUpperCode:"adminEmail",defaultValue:(e==null?void 0:e.adminEmail)||"",options:[],validateRules:[{INPUT_VALIDATION:"email"},{MIN_TEXT_LENGTH:5},{MAX_TEXT_LENGTH:254}],...u},{code:"adminFirstname",name:"adminFirstname",id:"adminFirstname",label:s("adminFirstname"),placeholder:l("adminFirstname"),required:!0,fieldType:A.TEXT,isHidden:!1,customUpperCode:"adminFirstname",defaultValue:(e==null?void 0:e.adminFirstname)||"",options:[],validateRules:[{INPUT_VALIDATION:"name"},{MIN_TEXT_LENGTH:1},{MAX_TEXT_LENGTH:255}],...u},{code:"adminLastname",name:"adminLastname",id:"adminLastname",label:s("adminLastname"),placeholder:l("adminLastname"),required:!0,fieldType:A.TEXT,isHidden:!1,customUpperCode:"adminLastname",defaultValue:(e==null?void 0:e.adminLastname)||"",options:[],validateRules:[{INPUT_VALIDATION:"name"},{MIN_TEXT_LENGTH:1},{MAX_TEXT_LENGTH:255}],...u},{code:"adminGender",name:"adminGender",id:"adminGender",label:s("adminGender"),placeholder:l("adminGender"),required:!1,fieldType:A.SELECT,isHidden:!1,customUpperCode:"adminGender",defaultValue:((E=e==null?void 0:e.adminGender)==null?void 0:E.toString())||"",options:[{value:"1",text:"Male",isDefault:!0},{value:"2",text:"Female",isDefault:!1},{value:"0",text:"Not Specified",isDefault:!1}],validateRules:[],...u}]},Ce=a=>a.reduce((e,p)=>({...e,...p}),{}),fe=a=>/^[0-9]+$/.test(a),Te=a=>/^[a-zA-Z0-9]+$/.test(a),Ee=a=>/^[a-zA-Z0-9\s]+$/.test(a),_e=a=>/^[a-zA-Z]+$/.test(a),Ne=a=>/^[a-z0-9,!#$%&'*+/=?^_`{|}~-]+(\.[a-z0-9,!#$%&'*+/=?^_`{|}~-]+)*@([a-z0-9-]+\.)+[a-z]{2,}$/i.test(a),ve=a=>/(?:[\d\s+\-()]{1,20})/u.test(a),be=a=>/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/i.test(a),Ie=a=>/^[A-Z0-9\s-]{3,10}$/i.test(a),Ae=a=>/^(?:[\p{L}\p{M},\-_.'`&\s\d]){1,255}$/u.test(a),Re=(a,e,p)=>{const n=a.length;return n>=e&&n<=p},Q=(a,e,p,n)=>{var r,C;const{requiredFieldError:h,lengthTextError:t,numericError:y,alphaNumWithSpacesError:s,alphaNumericError:l,alphaError:u,emailError:E,phoneError:f,postalCodeError:_,urlError:S,nameError:N}=p,b=e==null?void 0:e.customUpperCode,T={[b]:""};n[b]&&delete n[b];const i=(a==null?void 0:a.trim())||"";if(e!=null&&e.required&&(!i||i==="false"))return{[b]:h};if(!(e!=null&&e.required)&&!i||!((r=e==null?void 0:e.validateRules)!=null&&r.length))return T;const o=Ce(e==null?void 0:e.validateRules),d=Number(o.MIN_TEXT_LENGTH)??1,c=Number(o.MAX_TEXT_LENGTH)??255;if(!Re(i,d,c))return{[b]:t.replace("{min}",d.toString()).replace("{max}",c.toString())};const R={numeric:{validate:fe,error:y},"alphanum-with-spaces":{validate:Ee,error:s},alphanumeric:{validate:Te,error:l},alpha:{validate:_e,error:u},email:{validate:Ne,error:E},phone:{validate:ve,error:f},"postal-code":{validate:L=>Ie(L),error:_},url:{validate:be,error:S},name:{validate:Ae,error:N}}[o.INPUT_VALIDATION];return R&&!R.validate(i)&&!((C=n[b])!=null&&C.length)?{[b]:R.error}:T},Le=a=>({requiredFieldError:a.requiredFieldError,lengthTextError:a.lengthTextError,numericError:a.numericError,alphaNumWithSpacesError:a.alphaNumWithSpacesError,alphaNumericError:a.alphaNumericError,alphaError:a.alphaError,emailError:a.emailError,phoneError:a.phoneError,postalCodeError:a.postalCodeError,urlError:a.urlError,nameError:a.nameError}),Y=(a,e)=>({fieldsConfig:a,translations:Le(e)}),Se=(a,e,p)=>{const{fieldsConfig:n,translations:h}=p,t=n.find(u=>u.code===a);if(!t)return"";const y=Array.isArray(e)?e.join(""):e.toString(),s={validateRules:t.validateRules||[],customUpperCode:t.customUpperCode,required:t.required};return Q(y,s,h,{})[t.customUpperCode]||""},Fe=(a,e)=>{const{fieldsConfig:p,translations:n}=e,h=p[0],t=(h==null?void 0:h.isRequiredRegion)||!1,y=(h==null?void 0:h.isRequiredPostCode)||!1;let s=!1;const l={};Object.entries(a).forEach(([_,S])=>{const N=p.find(o=>o.code===_);if(!N)return;const b=Array.isArray(S)?S.join(""):S.toString(),T={validateRules:N.validateRules,customUpperCode:N.customUpperCode,required:N.required},i=Q(b,T,n,{});i[N.customUpperCode]&&(l[N.customUpperCode]=i[N.customUpperCode],s=!0)});const u=typeof a.regionId=="number"&&a.regionId>0,E=a.regionCode&&a.regionCode.toString().trim(),f=a.region&&a.region.toString().trim();return t&&!u&&!E&&!f&&(l.region=n.requiredFieldError,s=!0),y&&!a.postcode.toString().trim()&&(l.postcode=n.requiredFieldError,s=!0),{isValid:!s,fieldErrors:l}},K=(a,e,p,n)=>{const h=Y(p,n);return Se(a,e,h)},xe=(a,e,p)=>{const n=Y(e,p);return Fe(a,n)},qe=a=>{const{setFormData:e,hasRegions:p,regionOptions:n,fieldsConfig:h,formTranslations:t,setFieldErrors:y}=a,s=(i,o)=>{const d=K(i,o,h,t);y&&d?y(c=>({...c,[i]:d})):y&&y(c=>{const v={...c};return delete v[i],v})},l=i=>{e(o=>{const d=Array.isArray(o.street)?o.street:[o.street||"",""],c=Array.isArray(i)?i:[i,d[1]||""];return{...o,street:c}}),s("street",i)},u=i=>{e(o=>{const c=[(Array.isArray(o.street)?o.street:[o.street||"",""])[0]||"",i];return{...o,street:c}}),s("streetLine2",i)},E=i=>{e(o=>({...o,region:i,regionCode:"",regionId:void 0})),s("region",i)},f=i=>{e(o=>({...o,regionCode:i,...p?{}:{regionId:void 0}})),s("regionCode",i)},_=i=>{const o=typeof i=="string"?parseInt(i,10)||void 0:i;e(d=>{const c={...d,regionId:o};if(o&&n.length>0){const v=n.find(R=>R.id===o||R.value===(o==null?void 0:o.toString()));v&&v.code&&(c.regionCode=v.code)}return c}),s("regionId",i)},S=i=>{e(o=>({...o,countryCode:i,regionCode:"",regionId:void 0,region:""})),s("countryCode",i),y&&y(o=>{const d={...o};return delete d.region,delete d.regionCode,delete d.regionId,d})},N=(i,o)=>{e(d=>({...d,[i]:o})),s(i,o)};return{handleInputChange:i=>{const o=i.target;if(!o)return;const{name:d,value:c}=o;switch(d){case"street":l(c);break;case"streetLine2":u(c);break;case"region":p?_(c):E(c);break;case"regionCode":f(c);break;case"countryCode":S(c);break;default:N(d,c);break}},handleInputChangeFromValues:i=>{Object.entries(i).forEach(([o,d])=>{switch(o){case"street":l(d);break;case"streetLine2":u(d);break;case"region":E(d);break;case"regionCode":f(d);break;case"regionId":_(d);break;case"countryCode":S(d);break;default:N(o,d);break}})},handleStreetChange:l,handleStreetLine2Change:u,handleRegionTextChange:E,handleRegionCodeChange:f,handleRegionDropdownChange:_,handleCountryChange:S,handleGenericFieldChange:N}},Ve=({onSuccess:a,onError:e})=>{const[p,n]=$(!1),[h,t]=$({}),[y,s]=$("US"),[l,u]=$(!0),{countryOptions:E,regionOptions:f,isRequiredRegion:_,isRequiredPostCode:S,hasRegions:N,loadingCountries:b,disableField:T,handleInputChange:i}=ye({defaultCountry:y,formName:"companyRegistration"}),[o,d]=$({countryCode:y,region:"",regionCode:"",regionId:"",street:["",""]});H(()=>{(async()=>{try{u(!0);const q=(await ie()).defaultCountry||"US";s(q),d(k=>({...k,countryCode:q}))}catch(I){console.error("Failed to load store config:",I)}finally{u(!1)}})()},[]),H(()=>{y&&!l&&i("countryCode",y)},[y,i,l]);const c=P({requiredFieldError:"Company.shared.validation.required",lengthTextError:"Company.FormText.lengthTextError",numericError:"Company.FormText.numericError",alphaNumWithSpacesError:"Company.FormText.alphaNumWithSpacesError",alphaNumericError:"Company.FormText.alphaNumericError",alphaError:"Company.FormText.alphaError",emailError:"Company.shared.validation.invalidEmail",phoneError:"Company.shared.validation.phoneInvalid",postalCodeError:"Company.shared.validation.postalCodeInvalid",urlError:"Company.FormText.urlError",nameError:"Company.FormText.nameError"}),v=P({title:"Company.shared.fields.title",submitButton:"Company.shared.fields.submit",submittingButton:"Company.shared.fields.submitting",cancelButton:"Company.shared.buttons.cancel",createCompanyError:"Company.shared.fields.createCompanyError",unexpectedError:"Company.shared.fields.unexpectedError",emailNotAvailable:"Company.shared.validation.emailNotAvailable",companyName:"Company.shared.fields.companyName",legalName:"Company.shared.fields.legalName",companyEmail:"Company.shared.fields.companyEmail",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId",street:"Company.shared.fields.street",streetLine2:"Company.shared.fields.streetLine2",city:"Company.shared.fields.city",country:"Company.shared.fields.country",stateProvince:"Company.shared.fields.stateProvince",postalCode:"Company.shared.fields.postalCode",telephone:"Company.shared.fields.telephone",adminJobTitle:"Company.shared.fields.adminJobTitle",adminWorkTelephone:"Company.shared.fields.adminWorkTelephone",adminEmail:"Company.shared.fields.adminEmail",adminFirstname:"Company.shared.fields.adminFirstname",adminLastname:"Company.shared.fields.adminLastname",adminGender:"Company.shared.fields.adminGender"}),R=G(()=>ge({formData:{countryCode:o.countryCode,regionCode:o.regionCode,regionId:o.regionId},isRequiredRegion:_,isRequiredPostCode:S,hasRegions:N,disableField:T,translations:v}).map(I=>I.code==="region"?{...I,required:_,disabled:b,fieldType:N?"SELECT":"TEXT",options:N?f.map(q=>({text:q.text,value:q.value,isDefault:!1})):[]}:I.code==="postcode"?{...I,required:!0}:I.code==="countryCode"?{...I,disabled:T||b,options:E.map(q=>({text:q.text,value:q.value,isDefault:!1}))}:I),[_,S,N,b,T,E,f,o.countryCode,o.regionCode,o.regionId,v]),r=x=>{const I=xe(x,R,c);return t(I.fieldErrors),I.isValid},C=G(()=>qe({setFormData:d,hasRegions:N,regionOptions:f,fieldsConfig:R,formTranslations:c,setFieldErrors:t}),[N,f,R,c]);return{formValues:o,fieldErrors:h,isSubmitting:p,loadingStoreConfig:l,fieldsConfig:R,countryOptions:E,regionOptions:f,loadingCountries:b,handleInputChange:x=>{C.handleInputChangeFromValues(x),Object.entries(x).forEach(([I,q])=>{I==="countryCode"&&i("countryCode",q)})},handleBlur:x=>{const I=x.target,{name:q,value:k}=I,W=R.find(X=>X.customUpperCode===q);if(W){const X=K(W.code,k,R,c);t(O=>({...O,[q]:X||""}))}},handleFormSubmit:async(x,I)=>{const q=x.target,k=new FormData(q),W={};for(const[M,U]of k.entries())W[M]=U;const X={...W,...o},O=r(X);if(!(!I||!O)){n(!0);try{const M=await de(X.companyEmail);if(!M.isValid){t(j=>({...j,companyEmail:M.error||v.emailNotAvailable})),n(!1);return}const U=await le(X);if(U.success&&U.company)a==null||a(U.company);else{const j=U.errors||[v.createCompanyError];e==null||e(j)}}catch(M){const U=M instanceof Error?M.message:v.unexpectedError;e==null||e([U])}finally{n(!1)}}},translations:v,formTranslations:c}},$e=({onSuccess:a,onError:e,className:p="",slots:n,hideActionFormButtons:h=!1,inLineAlertProps:t})=>{const{formValues:y,fieldErrors:s,isSubmitting:l,loadingStoreConfig:u,fieldsConfig:E,countryOptions:f,regionOptions:_,loadingCountries:S,handleInputChange:N,handleBlur:b,handleFormSubmit:T,translations:i}=Ve({onSuccess:a,onError:e}),o=u||S;return g("div",{className:w(["company-form-wrapper",p]),children:[m("h2",{children:i.title}),(t==null?void 0:t.text)&&m(ne,{className:"company-form-wrapper__notification",type:t.type,variant:"secondary",heading:t.text,icon:t.icon,"data-testid":"companyRegistrationFormAlert"}),m(he,{regionOptions:_,countryOptions:f,slots:n,className:"company-registration-form",name:"companyRegistrationForm",fieldsConfig:E,values:y,errors:s,onChange:N,onBlur:b,onSubmit:T,loading:o,submitting:l,children:!h&&m("div",{className:w(["company-form-wrapper__buttons"]),children:m(oe,{type:"submit",disabled:l||o,className:"company-form-wrapper__submit",children:i.submitButton})})})]})},Ue=({company:a})=>{var h;const[e,p]=$(""),n=P({pendingApproval:"Company.CompanyRegistration.success.pendingApproval",companyDetails:"Company.CompanyRegistration.success.companyDetails",companyName:"Company.shared.fields.companyName",companyEmail:"Company.shared.fields.companyEmail",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId",address:"Company.shared.fields.legalAddress",street:"Company.shared.fields.street",city:"Company.shared.fields.city",stateProvince:"Company.shared.fields.stateProvince",postcode:"Company.shared.fields.postcode",country:"Company.shared.fields.country",telephone:"Company.shared.fields.telephone",companyAdmin:"Company.shared.fields.companyAdmin",adminFirstname:"Company.shared.fields.adminFirstname",adminLastname:"Company.shared.fields.adminLastname",adminEmail:"Company.shared.fields.adminEmail",adminJobTitle:"Company.shared.fields.adminJobTitle",adminWorkTelephone:"Company.shared.fields.adminWorkTelephone"});return H(()=>{(async()=>{var y;if((y=a.legalAddress)!=null&&y.countryCode)try{const{availableCountries:s}=await Z(),l=s.find(u=>{var E;return u.value===((E=a.legalAddress)==null?void 0:E.countryCode)});l&&p(l.text)}catch(s){console.error("Failed to fetch countries:",s),p(a.legalAddress.countryCode)}})()},[(h=a.legalAddress)==null?void 0:h.countryCode]),g("div",{className:"company-registration-success",children:[m("div",{className:"company-registration-success__header",children:m("p",{className:"company-registration-success__pending",children:n.pendingApproval})}),g("div",{className:"company-registration-success__details",children:[m("h2",{className:"company-registration-success__details-title",children:n.companyDetails}),g("div",{className:"company-registration-success__grid",children:[g("div",{className:"company-registration-success__item",children:[g("span",{className:"company-registration-success__label",children:[n.companyName,":"]}),m("span",{className:"company-registration-success__value",children:a.name})]}),a.legalName&&g("div",{className:"company-registration-success__item",children:[g("span",{className:"company-registration-success__label",children:[n.legalName,":"]}),m("span",{className:"company-registration-success__value",children:a.legalName})]}),g("div",{className:"company-registration-success__item",children:[g("span",{className:"company-registration-success__label",children:[n.companyEmail,":"]}),m("span",{className:"company-registration-success__value",children:a.email})]}),a.vatTaxId&&g("div",{className:"company-registration-success__item",children:[g("span",{className:"company-registration-success__label",children:[n.vatTaxId,":"]}),m("span",{className:"company-registration-success__value",children:a.vatTaxId})]}),a.resellerId&&g("div",{className:"company-registration-success__item",children:[g("span",{className:"company-registration-success__label",children:[n.resellerId,":"]}),m("span",{className:"company-registration-success__value",children:a.resellerId})]}),a.legalAddress&&g(J,{children:[m("div",{className:"company-registration-success__section-header",children:m("h3",{children:n.address})}),a.legalAddress.street&&a.legalAddress.street[0]&&g("div",{className:"company-registration-success__item",children:[g("span",{className:"company-registration-success__label",children:[n.street,":"]}),m("span",{className:"company-registration-success__value",children:a.legalAddress.street.map((t,y)=>m("div",{children:t},y))})]}),a.legalAddress.city&&g("div",{className:"company-registration-success__item",children:[g("span",{className:"company-registration-success__label",children:[n.city,":"]}),m("span",{className:"company-registration-success__value",children:a.legalAddress.city})]}),a.legalAddress.countryCode&&g("div",{className:"company-registration-success__item",children:[g("span",{className:"company-registration-success__label",children:[n.country,":"]}),m("span",{className:"company-registration-success__value",children:e||a.legalAddress.countryCode})]}),a.legalAddress.region&&g("div",{className:"company-registration-success__item",children:[g("span",{className:"company-registration-success__label",children:[n.stateProvince,":"]}),m("span",{className:"company-registration-success__value",children:a.legalAddress.region.region||a.legalAddress.region.regionCode})]}),a.legalAddress.postcode&&g("div",{className:"company-registration-success__item",children:[g("span",{className:"company-registration-success__label",children:[n.postcode,":"]}),m("span",{className:"company-registration-success__value",children:a.legalAddress.postcode})]}),a.legalAddress.telephone&&g("div",{className:"company-registration-success__item",children:[g("span",{className:"company-registration-success__label",children:[n.telephone,":"]}),m("span",{className:"company-registration-success__value",children:a.legalAddress.telephone})]})]}),a.companyAdmin&&g(J,{children:[m("div",{className:"company-registration-success__section-header",children:m("h3",{children:n.companyAdmin})}),a.companyAdmin.jobTitle&&g("div",{className:"company-registration-success__item",children:[g("span",{className:"company-registration-success__label",children:[n.adminJobTitle,":"]}),m("span",{className:"company-registration-success__value",children:a.companyAdmin.jobTitle})]}),a.companyAdmin.telephone&&g("div",{className:"company-registration-success__item",children:[g("span",{className:"company-registration-success__label",children:[n.adminWorkTelephone,":"]}),m("span",{className:"company-registration-success__value",children:a.companyAdmin.telephone})]}),g("div",{className:"company-registration-success__item",children:[g("span",{className:"company-registration-success__label",children:[n.adminEmail,":"]}),m("span",{className:"company-registration-success__value",children:a.companyAdmin.email})]})]})]})]})]})},Ke=({isAuthenticated:a=!1,onRedirectLogin:e,onRedirectAccount:p,onSuccess:n,onError:h,className:t,slots:y})=>{const[s,l]=$("loading"),[u,E]=$(null),{inLineAlertProps:f,showError:_,clearAlert:S}=ce();H(()=>{let T=!0;return(async()=>{try{if(!await me()){if(T){const o=a?"redirect-account":"redirect-login";console.log(`Company registration disabled - redirecting to ${a?"account dashboard":"login page"}`),l(o)}return}if(a)try{if(await ue()){T&&(console.log("User already belongs to a company - redirecting to account dashboard"),l("redirect-account"));return}}catch(o){console.error("Error checking company membership - redirecting to account dashboard:",o),T&&l("redirect-account");return}T&&l("show-form")}catch(i){console.error("Error checking B2B status:",i),T&&l(a?"redirect-account":"redirect-login")}})(),()=>{T=!1}},[a]),H(()=>{s==="redirect-login"&&e&&e(),s==="redirect-account"&&p&&p()},[s,e,p]);const N=T=>{S(),l("success"),E(T),n==null||n(T)},b=T=>{const i=T.join(". ");_(i,!1),h==null||h(T)};return s==="loading"||s==="redirect-login"||s==="redirect-account"?null:s==="success"&&u?m("div",{className:`company-registration-container ${t||""}`,children:m(Ue,{company:u})}):m("div",{className:`company-registration-container ${t||""}`,children:m($e,{onSuccess:N,onError:b,slots:y,inLineAlertProps:f})})};export{Ke as CompanyRegistration,Ke as default};
//# sourceMappingURL=CompanyRegistration.js.map
