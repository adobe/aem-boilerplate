/*! Copyright 2025 Adobe
All Rights Reserved. */
import{merge as me,Initializer as ce}from"@dropins/tools/lib.js";import{events as E}from"@dropins/tools/event-bus.js";import{PRODUCT_FRAGMENT as re}from"../fragments.js";import{FetchGraphQL as fe}from"@dropins/tools/fetch-graphql.js";function He(e){const n=new URLSearchParams(window.location.search);Object.entries(e).forEach(([r,t])=>{t===null?n.delete(r):n.set(r,String(t))});let i=window.location.pathname;i+=`?${n.toString()}`,i+=window.location.hash,window.history.replaceState({},"",i)}function ie(){const e=new URLSearchParams(window.location.search),n={};return e.forEach((i,r)=>{n[r]=i}),n}function Pe(e=1){const i=(ie()||{}).quantity;if(i){const r=parseInt(i,10);if(!isNaN(r)&&Number.isInteger(r)&&r>0)return r}return e}function de(e){var n,i,r,t,s,a,o,u,m,l,c,f;return{productId:Number(e==null?void 0:e.externalId),name:e==null?void 0:e.name,sku:(e==null?void 0:e.variantSku)||(e==null?void 0:e.sku),topLevelSku:e==null?void 0:e.sku,specialToDate:void 0,specialFromDate:void 0,newToDate:void 0,newFromDate:void 0,createdAt:void 0,updatedAt:void 0,manufacturer:void 0,countryOfManufacture:void 0,categories:void 0,productType:e==null?void 0:e.productType,pricing:{regularPrice:((i=(n=e==null?void 0:e.prices)==null?void 0:n.regular)==null?void 0:i.amount)||0,minimalPrice:(t=(r=e==null?void 0:e.prices)==null?void 0:r.final)==null?void 0:t.minimumAmount,maximalPrice:(a=(s=e==null?void 0:e.prices)==null?void 0:s.final)==null?void 0:a.maximumAmount,specialPrice:(u=(o=e==null?void 0:e.prices)==null?void 0:o.final)==null?void 0:u.amount,tierPricing:void 0,currencyCode:((l=(m=e==null?void 0:e.prices)==null?void 0:m.final)==null?void 0:l.currency)||"USD"},canonicalUrl:e==null?void 0:e.url,mainImageUrl:(f=(c=e==null?void 0:e.images)==null?void 0:c[0])==null?void 0:f.url}}const se={PRODUCT_CONTEXT:"productContext",CHANNEL_CONTEXT:"channelContext"},he={PRODUCT_PAGE_VIEW:"product-page-view"};function ae(){return window.adobeDataLayer=window.adobeDataLayer||[],window.adobeDataLayer}function we(){return{_id:"https://ns.adobe.com/xdm/channels/web",_type:"https://ns.adobe.com/xdm/channel-types/web"}}function ue(e,n){const i=ae();i.push({[e]:null}),i.push({[e]:n})}function ye(){typeof window>"u"||ue(se.CHANNEL_CONTEXT,we())}function Ce(e,n){ae().push(r=>{const t=r.getState?r.getState():{};r.push({event:e,eventInfo:{...t,...n}})})}function ge(e){const n=de(e);ue(se.PRODUCT_CONTEXT,n),ye(),Ce(he.PRODUCT_PAGE_VIEW)}var H=(e=>(e.ComplexProduct="complex",e.SimpleProduct="simple",e))(H||{}),le=(e=>(e.ComplexProductView="ComplexProductView",e.SimpleProductView="SimpleProductView",e))(le||{});function q(e,n){var a,o,u,m,l,c,f,d,h,y,P,k;const i=((m=(u=(o=(a=e==null?void 0:e.options)==null?void 0:a[0])==null?void 0:o.values)==null?void 0:u[0])==null?void 0:m.__typename)==="ProductViewOptionValueProduct",r=be(e,i,n==null?void 0:n.preselectFirstOption),t=(e==null?void 0:e.__typename)===le.SimpleProductView?H.SimpleProduct:H.ComplexProduct,s=e?{name:e.name,sku:e.sku,isBundle:i,addToCartAllowed:e.addToCartAllowed,inStock:e.inStock,shortDescription:e.shortDescription,metaDescription:e.metaDescription,metaKeyword:e.metaKeyword,metaTitle:e.metaTitle,description:e.description,images:xe(e),prices:Se(e,i,r),attributes:De(e),options:Te(e,i),optionUIDs:r,url:e.url,urlKey:e.urlKey,externalId:e.externalId,externalParentId:e.externalParentId,variantSku:e.variantSku,productType:t}:null;return me(s,((d=(f=(c=(l=_.getConfig())==null?void 0:l.models)==null?void 0:c.ProductDetails)==null?void 0:f.transformer)==null?void 0:d.call(f,e))??((k=(P=(y=(h=_.getConfig())==null?void 0:h.models)==null?void 0:y.ProductDetails)==null?void 0:P.transform)==null?void 0:k.call(P,e)))}function xe(e){var n,i;return(i=(n=e.images)==null?void 0:n.filter(r=>{var t;return!((t=r.roles)!=null&&t.includes("hide_from_pdp"))}))==null?void 0:i.map(r=>(r.url=r.url.replace(/^https?:/,""),r))}function De(e){var n,i;return(i=(n=e.attributes)==null?void 0:n.filter(({roles:r})=>(r==null?void 0:r.indexOf("visible_in_pdp"))!==-1))==null?void 0:i.map(({label:r,value:t,name:s})=>({id:s,label:r,value:t.toString().split(",").join(", ")}))}function Te(e,n){const{options:i,optionUIDs:r}=e;return i==null?void 0:i.map(({id:t,title:s,required:a,multi:o,values:u})=>{var c;const m=(c=u==null?void 0:u[0])==null?void 0:c.__typename;let l=u==null?void 0:u[0].type;return l?l=l.replace("COLOR_HEX","color").replace("TEXT","text").replace("IMAGE","image"):l="dropdown",{id:t,type:l,typename:m,label:s,required:a,multiple:o,items:n?Ee(u,r):Oe(u,r,l)}})}function Ee(e,n){return e==null?void 0:e.filter(({enabled:i})=>typeof i>"u"||i).map(({id:i,title:r,inStock:t,isDefault:s,product:a})=>({id:i,inStock:t,label:r,selected:(n==null?void 0:n.indexOf(i))>-1||s,value:i,product:a}))}function Oe(e,n,i){return e==null?void 0:e.map(({id:r,title:t,inStock:s,value:a})=>({id:r,inStock:s,label:t,selected:(n==null?void 0:n.indexOf(r))>-1,value:(i==null?void 0:i.toLowerCase())==="dropdown"?r:a==null?void 0:a.replace(/^https?:/,"")}))}function Se(e,n,i){var P,k,K,B,z;const{price:r,priceRange:t,options:s,optionUIDs:a=i}=e;let{__typename:o}=e;function u(){var D;const g=r==null?void 0:r.regular.amount.value,w=((D=r==null?void 0:r.final)==null?void 0:D.amount.value)??(r==null?void 0:r.regular.amount.value),x=(r==null?void 0:r.regular.amount.currency)==="NONE"?"USD":r==null?void 0:r.regular.amount.currency;return[g,w,w,x]}function m(){var O,S,p,v,A,U,I,N,V,F,G,L;const g=(O=t==null?void 0:t.minimum)==null?void 0:O.final.amount.value,w=(S=t==null?void 0:t.maximum)==null?void 0:S.final.amount.value;let x;((v=(p=t==null?void 0:t.minimum)==null?void 0:p.regular)==null?void 0:v.amount.value)===((U=(A=t==null?void 0:t.maximum)==null?void 0:A.regular)==null?void 0:U.amount.value)&&(x=(N=(I=t==null?void 0:t.minimum)==null?void 0:I.regular)==null?void 0:N.amount.value);const D=((F=(V=t==null?void 0:t.minimum)==null?void 0:V.final)==null?void 0:F.amount.currency)==="NONE"?"USD":(L=(G=t==null?void 0:t.minimum)==null?void 0:G.final)==null?void 0:L.amount.currency;return[x,g,w,D]}function l(){var p,v,A,U,I,N,V,F,G,L,W,Y,J;let g=0,w=0;s==null||s.forEach(b=>{var Z;const j=b==null?void 0:b.values;if(j&&Array.isArray(j)){const T=j.map(C=>{var M,$,R,ee;return(ee=(R=($=(M=C==null?void 0:C.product)==null?void 0:M.price)==null?void 0:$.regular)==null?void 0:R.amount)==null?void 0:ee.value}).filter(C=>C!==void 0),Q=T.length>0?Math.max(...T):0;g+=Q}(Z=b==null?void 0:b.values)==null||Z.forEach(T=>{var Q,C,M,$;a!=null&&a.includes(T.id)&&(w+=($=(M=(C=(Q=T==null?void 0:T.product)==null?void 0:Q.price)==null?void 0:C.final)==null?void 0:M.amount)==null?void 0:$.value)})});const x=(p=t==null?void 0:t.minimum)==null?void 0:p.final.amount.value,D=(v=t==null?void 0:t.maximum)==null?void 0:v.final.amount.value;let O;((U=(A=t==null?void 0:t.minimum)==null?void 0:A.regular)==null?void 0:U.amount.value)===((N=(I=t==null?void 0:t.maximum)==null?void 0:I.regular)==null?void 0:N.amount.value)&&(O=(F=(V=t==null?void 0:t.minimum)==null?void 0:V.regular)==null?void 0:F.amount.value);const S=((L=(G=t==null?void 0:t.minimum)==null?void 0:G.final)==null?void 0:L.amount.currency)==="NONE"?"USD":(Y=(W=t==null?void 0:t.minimum)==null?void 0:W.final)==null?void 0:Y.amount.currency;return n&&(a==null?void 0:a.length)<1?[O,x,D,S]:g===((J=t==null?void 0:t.maximum)==null?void 0:J.regular.amount.value)?[w,w,w,S]:[O,x,D,S]}const[c,f,d,h]=o==="SimpleProductView"?u():n?l():m(),y=o==="SimpleProductView"?(P=r==null?void 0:r.roles)==null?void 0:P.includes("visible"):((K=(k=t==null?void 0:t.maximum)==null?void 0:k.roles)==null?void 0:K.includes("visible"))&&((z=(B=t==null?void 0:t.minimum)==null?void 0:B.roles)==null?void 0:z.includes("visible"));return d&&f===d?{regular:{amount:c,currency:h,variant:c&&f!==c?"strikethrough":"default"},final:{amount:d,currency:h,variant:"default"},visible:y}:{final:{minimumAmount:f,maximumAmount:d,currency:h},visible:y}}function be(e,n,i){var r;return n?((r=e==null?void 0:e.options)==null?void 0:r.map(({values:s})=>{var u;const a=((u=s==null?void 0:s.find(({isDefault:m})=>m))==null?void 0:u.id)??null,o=i?s[0].id:null;return a||o})).filter(s=>s!==null):e==null?void 0:e.optionUIDs}const X=new ce({init:async e=>{var o,u,m;const n=(u=(o=e==null?void 0:e.models)==null?void 0:o.ProductDetails)==null?void 0:u.initialData,r=((m=(ie()||{}).optionsUIDs)==null?void 0:m.split(","))||(n==null?void 0:n.optionsUIDs),t=Pe(1),a={...{defaultLocale:"en-US",persistURLParams:!1,acdl:!1,optionsUIDs:r},...e};if(X.config.setConfig({...a}),a!=null&&a.sku){const l=n?q(n):await ne(a.sku,{preselectFirstOption:a.preselectFirstOption});E.emit("pdp/data",l,{scope:a.scope});const c={sku:a.sku,quantity:t,optionsUIDs:l==null?void 0:l.optionUIDs};Ve(()=>({...c}),{scope:a.scope}),Ge(()=>{var f;return l!=null&&l.options?l.options.length===((f=l==null?void 0:l.optionUIDs)==null?void 0:f.length):!0},{scope:a.scope}),a.acdl&&l&&ge(l)}},listeners:()=>[E.on("locale",async()=>{const{sku:e,scope:n}=X.config.getConfig();if(e){const i=await ne(e);E.emit("pdp/data",i,{scope:n})}})]}),_=X.config,{setEndpoint:Xe,setFetchGraphQlHeader:qe,removeFetchGraphQlHeader:Ke,setFetchGraphQlHeaders:Be,fetchGraphQl:oe,getConfig:ze}=new fe().getMethods(),_e=`
query GET_PRODUCT_DATA($skus: [String]) {
    products(skus: $skus) {
        ...PRODUCT_FRAGMENT
    }
}

${re}
`,ke=async(e,n,i)=>{var s;const{data:r}=await oe(_e,{method:"GET",variables:{skus:[e]}}),t=(s=r==null?void 0:r.products)==null?void 0:s[0];return n!=null&&n.optionsUIDs&&(t.optionUIDs=n.optionsUIDs),t?i?t:q(t,{preselectFirstOption:n==null?void 0:n.preselectFirstOption}):null},pe=`
query REFINE_PRODUCT_QUERY(
    $optionIds: [String!]!
    $sku: String!
) {
    # Refined Product
    refineProduct(
        optionIds: $optionIds 
        sku: $sku
    ) {
        ...PRODUCT_FRAGMENT
    }

    # Parent Product
    products(skus: [$sku]) {
        ...PRODUCT_FRAGMENT
    }

    # %extendedPlaceholder%
}

${re}
`;async function te(e,n){const i=Ae(n),r=Ue(i,e),t=pe.replace("# %extendedPlaceholder%",r),{data:s}=await oe(t,{method:"GET",variables:{optionIds:n,sku:e}});return s}const ve=async(e,n,i,r)=>{var d,h,y;const t=await te(e,n);if(!t)return null;let{products:s,refineProduct:a,...o}=t;const u=s==null?void 0:s[0],m=Ie(Object.values(o),u.options,i);if(i!=null&&i.length&&a===null){n=Ne(m,n,i);const P=await te(e,n);a=P==null?void 0:P.refineProduct}const l={...a||u,sku:u.sku,name:u.name,externalParentId:u==null?void 0:u.externalId,options:m,optionUIDs:n,variantSku:(a==null?void 0:a.__typename)==="SimpleProductView"?a==null?void 0:a.sku:void 0},c=r?l:q(l),f=(y=(h=(d=_==null?void 0:_.getConfig())==null?void 0:d.models)==null?void 0:h.ProductDetails)==null?void 0:y.fallbackData;return f?f(u,c):c};function Ae(e){if(e.length<2)return[e];const n=[];return e.forEach(i=>{const r=[];e.forEach(t=>{i!==t&&r.push(t)}),n.push(r)}),n}function Ue(e,n){return e.map((i,r)=>`
          ProductOption${r}: refineProduct(
            optionIds: [
              ${i.map(t=>`"${t}"`).join(", ")}
            ]
            sku: "${n}"
          ) {
            ... on ComplexProductView {
              options {
                ...PRODUCT_OPTION_FRAGMENT
              }
            }
          }
        `).join("")}function Ie(e,n=[],i){const r=Object.values(e).filter(s=>!!s).reduce((s,a)=>a.options?[...s,...a.options]:[...s],[]),t=new Map(n.map(s=>[s.id,s]));return r.forEach(s=>{i!=null&&i.includes(s.id)||t.set(s.id,s)}),[...t.values()]}function Ne(e,n,i){const r=[];let t;return e.forEach(s=>{var a,o,u,m;i.includes(s.id)?t=((o=(a=s.values)==null?void 0:a.find(l=>n.includes(l==null?void 0:l.id)))==null?void 0:o.id)||((u=s.values[0])==null?void 0:u.id):t=(m=s.values[0])==null?void 0:m.id,r.push(t)}),r}const ne=async(e,n)=>{const{anchors:i,optionsUIDs:r}=_.getConfig(),{optionsUIDs:t=r,anchors:s=i,preselectFirstOption:a,isBundle:o,skipTransform:u}=n??{};return!o&&t?await ve(e,t,s,u):await ke(e,{preselectFirstOption:a,optionsUIDs:t},u)},Ve=(e,n)=>{const i=Fe({scope:n==null?void 0:n.scope}),r=e(i);E.emit("pdp/values",{...r},{scope:n==null?void 0:n.scope})},Fe=({scope:e}={})=>E.lastPayload("pdp/values",{scope:e})??null,Ge=(e,n)=>{const i=Le({scope:n==null?void 0:n.scope}),r=e(i);E.emit("pdp/valid",r,{scope:n==null?void 0:n.scope})},Le=({scope:e}={})=>E.lastPayload("pdp/valid",{scope:e})??null;export{qe as a,Be as b,_ as c,ke as d,ve as e,oe as f,ze as g,ne as h,X as i,Ve as j,Fe as k,Ge as l,Le as m,Pe as n,He as o,ge as p,Ke as r,Xe as s,q as t};
//# sourceMappingURL=isProductConfigurationValid.js.map
