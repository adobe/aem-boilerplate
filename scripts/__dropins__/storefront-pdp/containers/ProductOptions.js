/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as g}from"@dropins/tools/preact-jsx-runtime.js";import{useState as d,useEffect as q,useCallback as k}from"@dropins/tools/preact-compat.js";import{Slot as j}from"@dropins/tools/lib.js";import{events as h}from"@dropins/tools/event-bus.js";import"@dropins/tools/components.js";/* empty css             */import{S as z}from"../chunks/Swatches.js";import"@dropins/tools/preact.js";import{c as C,o as A,k as y,j as v,h as G,l as b,p as H}from"../chunks/isProductConfigurationValid.js";import{g as J}from"../chunks/getFetchedProductData.js";import"@dropins/tools/i18n.js";import"../fragments.js";import"@dropins/tools/fetch-graphql.js";const K=({initialData:r={data:null,optionsUIDs:[]},hideSelectedValue:l=!1,slots:o,onValues:p,onErrors:f,children:Q,...O})=>{var S;const[t,B]=d(r.data),[u,T]=d(r.optionsUIDs),[F,M]=d();q(()=>{const i=h.on("pdp/data",B),s=h.on("pdp/values",({optionsUIDs:a})=>{a&&T(a)});return()=>{i==null||i.off(),s==null||s.off()}},[]);const L=k(async i=>{var I,P,U,w;if(!(t!=null&&t.sku))return;const{persistURLParams:s,anchors:a,acdl:R}=C.getConfig()??{};let n=Object.keys(i).map(e=>i[e].value).filter(e=>e!==void 0);if(s&&!(t!=null&&t.isBundle)&&A({optionsUIDs:n.join(",")}),((P=(I=y())==null?void 0:I.optionsUIDs)==null?void 0:P.join("|"))!==(n==null?void 0:n.join("|"))){v(c=>({...c,optionsUIDs:n})),p==null||p(n);const e=await G(t.sku,{optionsUIDs:n??[],isBundle:t==null?void 0:t.isBundle,anchors:a});h.emit("pdp/data",e);let D=(n==null?void 0:n.length)===((U=e==null?void 0:e.options)==null?void 0:U.length);if(a!=null&&a.length){const c=(e==null?void 0:e.optionUIDs)??[];n.every(m=>c.includes(m))||(M(e==null?void 0:e.options),v(m=>({...m,optionsUIDs:c})),D=(c==null?void 0:c.length)===((w=e==null?void 0:e.options)==null?void 0:w.length))}b(()=>D),R&&e&&(e==null?void 0:e.variantSku)!==t.sku&&H(e)}},[t==null?void 0:t.isBundle,t==null?void 0:t.sku,p]),N=k(i=>{Object.keys(i).length!==0&&(b(()=>!1),f==null||f(i))},[f]);return!t||!t.options?null:g(j,{name:"Swatches",slot:o==null?void 0:o.Swatches,context:{data:t,optionsUIDs:u},children:g(z,{...O,options:t.options,selectedUIDs:u,defaultOptions:u,selectionsToUpdate:F,hideSelectedValue:l,disablePreselections:!((S=C.getConfig())!=null&&S.preselectFirstOption),onValues:L,onErrors:N,imageSwatchNode:o!=null&&o.SwatchImage?({imageSwatchContext:i,...s})=>g(j,{name:"SwatchImage",slot:o==null?void 0:o.SwatchImage,slotTag:"span",contentTag:"span",context:{data:t,optionsUIDs:u,defaultImageProps:s,imageSwatchContext:i}}):void 0})})};K.getInitialData=async function(){var o;const r=await J(),l=((o=y())==null?void 0:o.optionsUIDs)??[];return{data:r,optionsUIDs:l}};export{K as ProductOptions,K as default};
