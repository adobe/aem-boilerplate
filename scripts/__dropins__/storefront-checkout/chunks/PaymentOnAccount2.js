/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as A,jsx as n}from"@dropins/tools/preact-jsx-runtime.js";import{useState as m,useCallback as g,useEffect as N}from"@dropins/tools/preact-compat.js";import{Skeleton as O,SkeletonRow as _,Price as E,Field as W,Input as z,InLineAlert as I}from"@dropins/tools/components.js";import{classes as S}from"@dropins/tools/lib.js";/* empty css                */import{W as T}from"./ConditionalWrapper.js";import{useText as V,Text as w}from"@dropins/tools/i18n.js";import{s as H}from"./fetch-graphql.js";import{events as j}from"@dropins/tools/event-bus.js";import{g as F}from"./getCompanyCredit.js";const p=()=>A(O,{"data-testid":"payment-on-account-skeleton",children:[n(_,{fullWidth:!0,size:"medium"}),n(_,{fullWidth:!0,size:"medium"})]}),M=({className:d,referenceNumber:r="",onReferenceNumberChange:u,onReferenceNumberBlur:h,companyCredit:e=null,cartAmount:o=null,...f})=>{var i;const c=(()=>{if(!(e!=null&&e.availableCredit)||!o)return null;const k=e.availableCredit.value,t=o.value-k;return t<=0?null:{value:t,currency:e.availableCredit.currency}})(),v=((i=e==null?void 0:e.availableCredit)==null?void 0:i.value)||0,x=(c==null?void 0:c.value)||0,a=V({referenceNumberLabel:"Checkout.PaymentOnAccount.referenceNumberLabel",referenceNumberPlaceholder:"Checkout.PaymentOnAccount.referenceNumberPlaceholder",referenceNumberHint:"Checkout.PaymentOnAccount.referenceNumberHint",availableCreditLabel:"Checkout.PaymentOnAccount.availableCreditLabel",exceedLimitError:"Checkout.PaymentOnAccount.exceedLimitError",exceedLimitWarning:c?n(w,{fields:{creditLimit:v,exceededAmount:x},id:"Checkout.PaymentOnAccount.exceedLimitWarning"}):""}),s=e&&o&&c;return n("div",{className:"checkout-payment-on-account","data-testid":"checkout-payment-on-account",children:A("form",{...f,noValidate:!0,className:S(["checkout-payment-on-account__form",d]),"data-testid":"checkout-payment-on-account-form",name:"checkout-payment-on-account__form",children:[e&&e.availableCredit&&A("div",{className:"checkout-payment-on-account__credit","data-testid":"checkout-payment-on-account-credit",children:[n("span",{className:"checkout-payment-on-account__credit-label",children:a.availableCreditLabel}),n("span",{className:"checkout-payment-on-account__credit-amount",children:n(E,{amount:e==null?void 0:e.availableCredit.value,currency:e==null?void 0:e.availableCredit.currency})})]}),n(W,{hint:a.referenceNumberHint,children:n(z,{"aria-label":a.referenceNumberLabel,floatingLabel:a.referenceNumberLabel,id:"reference-number",name:"reference-number",placeholder:a.referenceNumberPlaceholder,type:"text",value:r,onBlur:h,onChange:u})}),s&&n("div",{className:"checkout-payment-on-account__exceed-message","data-testid":"checkout-payment-on-account-exceed-message",children:n(I,{heading:e!=null&&e.exceedLimit?a.exceedLimitWarning:a.exceedLimitError,type:e!=null&&e.exceedLimit?"warning":"error",variant:"primary"})})]})})},$=T(M,p),Z=({initialReferenceNumber:d="",onReferenceNumberChange:r,onReferenceNumberBlur:u,...h})=>{const[e,o]=m(!1),[f,b]=m(null),[c,v]=m(null),[x,a]=m(d),s=H.authenticated,i=g(t=>{var l;const L=((l=t==null?void 0:t.total)==null?void 0:l.includingTax)||null;v(L)},[]),k=g(t=>{const l=t.target.value;a(l),r==null||r(l)},[r]),P=g(t=>{const l=t.target.value;u==null||u(l)},[u]);return N(()=>{const t=j.on("cart/data",i,{eager:!0});return()=>{t==null||t.off()}},[i]),N(()=>{s&&F().then(t=>{b(t)}).catch(t=>{console.error("Failed to fetch company credit:",t),b(null)}).finally(()=>{o(!0)})},[s]),n("div",{...h,children:n($,{cartAmount:c,companyCredit:f,initialized:e,referenceNumber:x,onReferenceNumberBlur:P,onReferenceNumberChange:k})})};export{Z as P};
//# sourceMappingURL=PaymentOnAccount2.js.map
