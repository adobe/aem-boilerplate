/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as t,jsxs as A,Fragment as _}from"@dropins/tools/preact-jsx-runtime.js";import{useState as U,useRef as M,useCallback as V,useEffect as C}from"@dropins/tools/preact-compat.js";import{ContentGrid as H,Skeleton as J,SkeletonRow as K,ProductItemCard as Q,Button as X,Price as Y,Image as Z}from"@dropins/tools/components.js";import{classes as D,VComponent as ee,Slot as h}from"@dropins/tools/lib.js";import{events as te}from"@dropins/tools/event-bus.js";import{p as ne,g as re,a as oe,b as ie}from"../chunks/getRecommendations.js";import{useText as ce}from"@dropins/tools/i18n.js";import"../fragments.js";import"../chunks/initialize.js";import"@dropins/tools/fetch-graphql.js";const ae=({className:m,children:f,heading:v,products:u=null,loading:g=!0,...b})=>t("section",{...b,role:"region","aria-label":"Product recommendations",className:D(["recommendations-product-list",m,["recommendations-product-list--empty",!u]]),children:g?t(de,{}):A(_,{children:[v&&t(ee,{node:v,className:"recommendations-product-list__heading"}),t(H,{className:"recommendations-product-list__content","data-testid":"recommendations-product-list__content",maxColumns:0,columnWidth:"minmax(240px, 1fr)",children:u})]})}),de=()=>t(J,{"data-testid":"recommendations-product-list-skeleton",className:"recommendations-product-list-skeleton",rowGap:"medium",children:[...Array(2)].map((m,f)=>t(K,{variant:"row",size:"large",fullWidth:!0,lines:2,multilineGap:"small"},f))}),Re=({recId:m,initialData:f=null,hideHeading:v,routeProduct:u,currentSku:g,cartSkus:b,userPurchaseHistory:k,userViewHistory:y,pagePlacement:N,slots:o,...E})=>{var B,O,L;const[S,R]=U(!f),[r,x]=U((B=f==null?void 0:f.recommendations)!=null&&B.results?f.recommendations.results.filter(e=>e.unitId===m):[]),p=M(null),P=ce({addToCartText:"Recommendations.ProductList.addToCart",optionsText:"Recommendations.ProductList.selectOptions",viewProductText:"Recommendations.ProductList.viewProduct"}),T=V(()=>!!m&&!!g,[m,g]);if(C(()=>{const e=te.on("recommendations/data",d=>{d&&d.length>0&&x(i=>{const n=i||[],c=d.filter(a=>{var l;return(a==null?void 0:a.unitId)===m&&((l=a==null?void 0:a.items)==null?void 0:l.length)&&!n.some(s=>s.unitId===a.unitId)});return c.forEach(a=>{var l,s;ne({recommendationUnit:a,pagePlacement:"product-list",yOffsetTop:((l=p.current)==null?void 0:l.getBoundingClientRect().top)??0,yOffsetBottom:((s=p.current)==null?void 0:s.getBoundingClientRect().bottom)??0,backupProducts:0,searchTime:0})}),[...n,...c]}),R(!1)});return()=>{e==null||e.off()}},[m]),C(()=>{if(!(r!=null&&r.length)||!p.current)return;const e={root:null,rootMargin:"0px",threshold:.5},d=n=>{n.forEach(c=>{c.intersectionRatio>.5&&r.forEach(a=>{var l,s;oe({recommendationUnit:a,pagePlacement:"product-list",yOffsetTop:((l=p.current)==null?void 0:l.getBoundingClientRect().top)??0,yOffsetBottom:((s=p.current)==null?void 0:s.getBoundingClientRect().bottom)??0})})})},i=new IntersectionObserver(d,e);return i.observe(p.current),()=>i.disconnect()},[r]),C(()=>{if(!T()){R(!1);return}R(!0),re({currentSku:g,pageType:"Product",cartSkus:b,userPurchaseHistory:k,userViewHistory:y,recId:m}).catch(e=>{console.error("Recommendations error:",e),x([]),R(!1)})},[g,b,k,y,T,m]),!T())return m||console.warn("ProductList: recId is missing. Please provide a valid recId to display product recommendations."),g||console.warn("ProductList: currentSku is missing. Please provide a valid currentSku to display product recommendations."),null;const F=(e,d)=>{var c,a,l,s;const i={loading:d<4?"eager":"lazy",src:((a=(c=e.images)==null?void 0:c[0])==null?void 0:a.url)||"",alt:((s=(l=e.images)==null?void 0:l[0])==null?void 0:s.label)||"",width:"300",height:"300",params:{width:300}},n=t(Z,{"data-testid":"product-list-item-image",...i,"aria-label":e.sku});return t(h,{name:"Thumbnail",slot:o==null?void 0:o.Thumbnail,context:{item:e,defaultImageProps:i},children:u?t("a",{href:u(e),children:n}):n})},z=t(h,{name:"Heading",slot:o==null?void 0:o.Heading,context:{},children:t("div",{"data-testid":"default-product-list-heading",children:((O=r==null?void 0:r[0])==null?void 0:O.title)||P.heading})}),G=(e,d)=>t(h,{name:"Footer",slot:o==null?void 0:o.Footer,context:{item:e,index:d},children:t("div",{"data-testid":"default-product-list-footer",children:u&&t("a",{href:u(e),children:t(X,{"data-testid":"default-product-list-footer-button",children:P.viewProductText,"aria-label":P.viewProductText,variant:"primary"})})})}),I=e=>t(h,{name:"Title",slot:o==null?void 0:o.Title,context:{item:e,productUrl:u?u(e):""},children:u?t("a",{href:u(e),children:e.name}):t("span",{children:e.name})}),$=e=>t(h,{name:"Sku",slot:o==null?void 0:o.Sku,context:{item:e},children:t("span",{children:e.sku})}),j=e=>{var d,i,n,c;return t(h,{name:"Price",slot:o==null?void 0:o.Price,context:{item:e},children:t("div",{"data-testid":"default-product-price",children:t(Y,{amount:((i=(d=e.price.final)==null?void 0:d.amount)==null?void 0:i.value)??void 0,currency:((c=(n=e.price.final)==null?void 0:n.amount)==null?void 0:c.currency)??void 0})})})},W=(e,d)=>{var n,c;const i=r==null?void 0:r.find(a=>{var l;return(l=a.items)==null?void 0:l.some(s=>s.sku===e.sku)});i&&ie({recommendationUnit:i,pagePlacement:N||"",yOffsetTop:((n=p.current)==null?void 0:n.getBoundingClientRect().top)??0,yOffsetBottom:((c=p.current)==null?void 0:c.getBoundingClientRect().bottom)??0,productId:d})},q=(L=r==null?void 0:r[0])!=null&&L.totalProducts?t(_,{children:r==null?void 0:r.map(({items:e,totalProducts:d},i)=>d>0?e.map((n,c)=>{const{sku:a}=n;return t("span",{role:"group","aria-label":`Product ${i*e.length+c+1} of ${d}`,onClick:()=>W(n,i*e.length+c),children:t(Q,{"data-testid":"recommendations-product-item-card",initialized:!0,sku:$(n),image:F(n,i*e.length+c),titleNode:I(n),price:j(n),actionButton:G(n,i*e.length+c)})},a)}):null)}):null,w=!r||r.length===0||r.every(e=>!e.items||e.items.length===0);return t("div",{ref:p,children:t(ae,{...E,className:w?"recommendations-product-list--empty":"",heading:v?void 0:z,loading:S,products:w?null:q})})};export{Re as ProductList,Re as default};
//# sourceMappingURL=ProductList.js.map
