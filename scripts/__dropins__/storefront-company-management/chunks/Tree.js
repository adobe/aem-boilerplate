/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as $,jsxs as st}from"@dropins/tools/preact-jsx-runtime.js";import{useMemo as et,useRef as nt,useCallback as X}from"@dropins/tools/preact-hooks.js";import{Checkbox as ot}from"@dropins/tools/components.js";var at=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},J={exports:{}};/*! mobile-drag-drop 3.0.0-rc.0 | Copyright (c) 2022 Tim Ruffles | MIT License */(function(x,w){(function(E,I){I(w)})(at,function(E){var I="dnd-poly-",y=["none","copy","copyLink","copyMove","link","linkMove","move","all"],d=["none","copy","move","link"];function H(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch{}return t}var L=H();function P(t){return t&&t.tagName}function N(t,e,i){document.addEventListener(t,e,!!L&&{passive:i})}function z(t,e){document.removeEventListener(t,e)}function j(t,e,i,r){r===void 0&&(r=!1);var s=L?{passive:!0,capture:r}:r;return t.addEventListener(e,i,s),{off:function(){t.removeEventListener(e,i,s)}}}function Y(t){return t.length===0?0:t.reduce(function(e,i){return i+e},0)/t.length}function q(t,e){for(var i=0;i<t.changedTouches.length;i++)if(t.changedTouches[i].identifier===e)return!0;return!1}function B(t,e,i){for(var r=[],s=[],l=0;l<e.touches.length;l++){var n=e.touches[l];r.push(n[t+"X"]),s.push(n[t+"Y"])}i.x=Y(r),i.y=Y(s)}var F=["","-webkit-"];function A(t,n,i,r,s){var l=n.x,n=n.y;r&&(l+=r.x,n+=r.y),(s=s===void 0||s)&&(l-=parseInt(t.offsetWidth,10)/2,n-=parseInt(t.offsetHeight,10)/2);for(var o="translate3d("+l+"px,"+n+"px, 0)",a=0;a<F.length;a++){var u=F[a]+"transform";t.style[u]=o+" "+i[a]}}var C=(Object.defineProperty(O.prototype,"dropEffect",{get:function(){return this.t},set:function(t){this.i.mode!==0&&-1<y.indexOf(t)&&(this.t=t)},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"types",{get:function(){if(this.i.mode!==0)return Object.freeze(this.i.types)},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"effectAllowed",{get:function(){return this.i.effectAllowed},set:function(t){this.i.mode===2&&-1<y.indexOf(t)&&(this.i.effectAllowed=t)},enumerable:!1,configurable:!0}),O.prototype.setData=function(t,e){if(this.i.mode===2){if(-1<t.indexOf(" "))throw new Error("illegal arg: type contains space");this.i.data[t]=e,this.i.types.indexOf(t)===-1&&this.i.types.push(t)}},O.prototype.getData=function(t){if(this.i.mode===1||this.i.mode===2)return this.i.data[t]||""},O.prototype.clearData=function(t){this.i.mode===2&&(t&&this.i.data[t]?(delete this.i.data[t],-1<(t=this.i.types.indexOf(t))&&this.i.types.splice(t,1)):(this.i.data={},this.i.types=[]))},O.prototype.setDragImage=function(t,e,i){this.i.mode===2&&this.h(t,e,i)},O);function O(t,e){this.i=t,this.h=e,this.t=d[0]}function G(t,e){return t?t===y[0]?d[0]:t.indexOf(y[1])===0||t===y[7]?d[1]:t.indexOf(y[4])===0?d[3]:t===y[6]?d[2]:d[1]:e.nodeType===3&&e.tagName==="A"?d[3]:d[1]}function S(t,e,i,r,s,l,n){return n===void 0&&(n=null),s=function(o,a,u,m,c,h,v){n===void 0&&(v=null);var b=i.changedTouches[0],m=new Event(t,{bubbles:!0,cancelable:m});return m.dataTransfer=h,m.relatedTarget=v,m.screenX=b.screenX,m.screenY=b.screenY,m.clientX=b.clientX,m.clientY=b.clientY,m.pageX=b.pageX,m.pageY=b.pageY,o=o.getBoundingClientRect(),m.offsetX=m.clientX-o.left,m.offsetY=m.clientY-o.top,m}(e,0,0,l=l===void 0||l,document.defaultView,s,n),s=!e.dispatchEvent(s),r.mode=0,s}function K(t,e){if(!t||t===y[7])return e;if(e===d[1]){if(t.indexOf(d[1])===0)return d[1]}else if(e===d[3]){if(t.indexOf(d[3])===0||-1<t.indexOf("Link"))return d[3]}else if(e===d[2]&&(t.indexOf(d[2])===0||-1<t.indexOf("Move")))return d[2];return d[0]}var _=(T.prototype.o=function(){var t=this;this.u=1,this.l=d[0],this.v={data:{},effectAllowed:void 0,mode:3,types:[]},this.p={x:null,y:null},this.g={x:null,y:null};var e=this.m;if(this.I=new C(this.v,function(l,n,o){e=l,typeof n!="number"&&typeof o!="number"||(t.j={x:n||0,y:o||0})}),this.v.mode=2,this.I.dropEffect=d[0],S("dragstart",this.m,this.k,this.v,this.I))return this.u=3,this.C(),!1;B("page",this.k,this.g);var i,r,s=this.S.dragImageSetup(e);return this.A=(i=s,F.map(function(l){return l=i.style[l+"transform"],l&&l!=="none"?l.replace(/translate\(\D*\d+[^,]*,\D*\d+[^,]*\)\s*/g,""):""})),s.style.position="absolute",s.style.left="0px",s.style.top="0px",s.style.zIndex="999999",s.classList.add("dnd-poly-drag-image"),s.classList.add("dnd-poly-icon"),this.O=s,this.j||(this.S.dragImageOffset?this.j={x:this.S.dragImageOffset.x,y:this.S.dragImageOffset.y}:this.S.dragImageCenterOnTouch?(r=getComputedStyle(e),this.j={x:0-parseInt(r.marginLeft,10),y:0-parseInt(r.marginTop,10)}):(s=e.getBoundingClientRect(),r=getComputedStyle(e),this.j={x:s.left-this.M.clientX-parseInt(r.marginLeft,10)+s.width/2,y:s.top-this.M.clientY-parseInt(r.marginTop,10)+s.height/2})),A(this.O,this.g,this.A,this.j,this.S.dragImageCenterOnTouch),document.body.appendChild(this.O),this.D=window.setInterval(function(){t.F||(t.F=!0,t.N(),t.F=!1)},this.S.iterationInterval),!0},T.prototype.C=function(){this.D&&(clearInterval(this.D),this.D=null),z("touchmove",this.P),z("touchend",this.T),z("touchcancel",this.T),this.O&&(this.O.parentNode.removeChild(this.O),this.O=null),this.L(this.S,this.k,this.u)},T.prototype._=function(t){var e=this;if(q(t,this.M.identifier)!==!1){if(this.k=t,this.u===0){var i=void 0;if(this.S.dragStartConditionOverride)try{i=this.S.dragStartConditionOverride(t)}catch{i=!1}else i=t.touches.length===1;return i?void(this.o()===!0&&(this.H.preventDefault(),t.preventDefault())):void this.C()}if(t.preventDefault(),B("client",t,this.p),B("page",t,this.g),this.S.dragImageTranslateOverride)try{var r=!1;if(this.S.dragImageTranslateOverride(t,{x:this.p.x,y:this.p.y},this.V,function(s,l){e.O&&(r=!0,e.p.x+=s,e.p.y+=l,e.g.x+=s,e.g.y+=l,A(e.O,e.g,e.A,e.j,e.S.dragImageCenterOnTouch))}),r)return}catch{}A(this.O,this.g,this.A,this.j,this.S.dragImageCenterOnTouch)}},T.prototype.X=function(t){if(q(t,this.M.identifier)!==!1){if(this.S.dragImageTranslateOverride)try{this.S.dragImageTranslateOverride(void 0,void 0,void 0,function(){})}catch{}this.u!==0?(t.preventDefault(),this.u=t.type==="touchcancel"?3:2):this.C()}},T.prototype.N=function(){var t=this,e=this.l;this.v.mode=3,this.I.dropEffect=d[0];var i,r,s,l,n,o=S("drag",this.m,this.k,this.v,this.I);if(o&&(this.l=d[0]),o||this.u===2||this.u===3)return this.Y(this.u)?(l=this.m,i=this.O,r=this.A,u=function(){t.q()},void((n=getComputedStyle(l)).visibility!=="hidden"&&n.display!=="none"?(i.classList.add("dnd-poly-snapback"),s=getComputedStyle(i),o=parseFloat(s.transitionDuration),isNaN(o)||o===0?u():((l={x:(a=l.getBoundingClientRect()).left,y:a.top}).x+=document.body.scrollLeft||document.documentElement.scrollLeft,l.y+=document.body.scrollTop||document.documentElement.scrollTop,l.x-=parseInt(n.marginLeft,10),l.y-=parseInt(n.marginTop,10),a=parseFloat(s.transitionDelay),a=Math.round(1e3*(o+a)),A(i,l,r,void 0,!1),setTimeout(u,a))):u())):void this.q();var a=this.S.elementFromPoint(this.p.x,this.p.y),u=this.B;a!==this.V&&a!==this.B&&(this.V=a,this.B!==null&&(this.v.mode=3,this.I.dropEffect=d[0],S("dragexit",this.B,this.k,this.v,this.I,!1)),this.V===null?this.B=this.V:(this.v.mode=3,this.I.dropEffect=G(this.v.effectAllowed,this.m),S("dragenter",this.V,this.k,this.v,this.I)?(this.B=this.V,this.l=K(this.I.effectAllowed,this.I.dropEffect)):this.V!==document.body&&(this.B=document.body))),u!==this.B&&P(u)&&(this.v.mode=3,this.I.dropEffect=d[0],S("dragleave",u,this.k,this.v,this.I,!1,this.B)),P(this.B)&&(this.v.mode=3,this.I.dropEffect=G(this.v.effectAllowed,this.m),S("dragover",this.B,this.k,this.v,this.I)===!1?this.l=d[0]:this.l=K(this.I.effectAllowed,this.I.dropEffect)),e!==this.l&&this.O.classList.remove(I+e),e=I+this.l,this.O.classList.add(e)},T.prototype.Y=function(t){return t=this.l===d[0]||this.B===null||t===3,t?P(this.B)&&(this.v.mode=3,this.I.dropEffect=d[0],S("dragleave",this.B,this.k,this.v,this.I,!1)):P(this.B)&&(this.v.mode=1,this.I.dropEffect=this.l,S("drop",this.B,this.k,this.v,this.I)===!0?this.l=this.I.dropEffect:this.l=d[0]),t},T.prototype.q=function(){this.v.mode=3,this.I.dropEffect=this.l,S("dragend",this.m,this.k,this.v,this.I,!1),this.u=2,this.C()},T);function T(t,e,i,r){this.H=t,this.S=e,this.m=i,this.L=r,this.u=0,this.V=null,this.B=null,this.k=t,this.M=t.changedTouches[0],this.P=this._.bind(this),this.T=this.X.bind(this),N("touchmove",this.P,!1),N("touchend",this.T,!1),N("touchcancel",this.T,!1)}var R,g={iterationInterval:150,tryFindDraggableTarget:function(t){for(var e=0,i=t.composedPath();e<i.length;e++){var r=i[e];do if(r.draggable!==!1&&(r.draggable===!0||r.getAttribute&&r.getAttribute("draggable")==="true"))return r;while((r=r.parentNode)&&r!==document.body)}},dragImageSetup:function(t){var e=t.cloneNode(!0);return function i(r,s){if(r.nodeType===1){for(var l,n,o=getComputedStyle(r),a=0;a<o.length;a++){var u=o[a];s.style.setProperty(u,o.getPropertyValue(u),o.getPropertyPriority(u))}s.style.pointerEvents="none",s.removeAttribute("id"),s.removeAttribute("class"),s.removeAttribute("draggable"),s.nodeName==="CANVAS"&&(l=s,n=(n=r).getContext("2d").getImageData(0,0,n.width,n.height),l.getContext("2d").putImageData(n,0,0))}if(r.hasChildNodes())for(a=0;a<r.childNodes.length;a++)i(r.childNodes[a],s.childNodes[a]);(function f(c){if(c instanceof HTMLElement&&(c.style.pointerEvents="none"),c.children&&c.children.length)for(var h=0;h<c.children.length;h++)f(c.children[h]);if(c.shadowRoot&&c.shadowRoot.children.length)for(h=0;h<c.shadowRoot.children.length;h++)f(c.shadowRoot.children[h])})(s)}(t,e),e},elementFromPoint:function(t,e){var i=document.elementFromPoint(t,e);if(i){for(;i.shadowRoot;){var r=i.shadowRoot.elementFromPoint(t,e);if(r===null||r===i)break;i=r}return i}}};function W(t){if(!R){var e=g.tryFindDraggableTarget(t);if(e)try{R=new _(t,g,e,k)}catch(i){throw k(g,t,3),i}}}function M(t){function e(a){s.off(),l.off(),n.off(),o.off(),i&&i.dispatchEvent(new CustomEvent("dnd-poly-dragstart-cancel",{bubbles:!0,cancelable:!0})),clearTimeout(r)}var i=t.target;i&&i.dispatchEvent(new CustomEvent("dnd-poly-dragstart-pending",{bubbles:!0,cancelable:!0}));var r=window.setTimeout(function(){s.off(),l.off(),n.off(),o.off(),W(t)},g.holdToDrag),s=j(i,"touchend",e),l=j(i,"touchcancel",e),n=j(i,"touchmove",e),o=j(window,"scroll",e,!0)}function k(t,e,i){if(i===0&&t.defaultActionOverride)try{t.defaultActionOverride(e),e.defaultPrevented}catch{}R=null}E.polyfill=function(t){if(t&&Object.keys(t).forEach(function(i){g[i]=t[i]}),!g.forceApply&&(e=(e=!!window.chrome||/chrome/i.test(navigator.userAgent),{dragEvents:"ondragstart"in document.documentElement,draggable:"draggable"in document.documentElement,userAgentSupportingNativeDnD:!(/iPad|iPhone|iPod|Android/.test(navigator.userAgent)||e&&"ontouchstart"in document.documentElement)}),e.userAgentSupportingNativeDnD&&e.draggable&&e.dragEvents))return!1;var e;return g.holdToDrag?N("touchstart",M,!1):N("touchstart",W,!1),!0},E.supportsPassiveEventListener=H,Object.defineProperty(E,"G",{value:!0})})})(J,J.exports);var lt=J.exports;let it=!1;if(typeof window<"u"&&!it){try{window.addEventListener("touchmove",()=>{},{passive:!1})}catch{}lt.polyfill({holdToDrag:300,tryFindDraggableTarget:x=>{let w=x.target;for(;w&&w!==document.body;){if(w.getAttribute("draggable")==="true")return w;w=w.parentElement}}}),document.addEventListener("contextmenu",x=>{x.target.closest('[draggable="true"]')&&x.preventDefault()}),it=!0}const dt=(x,w=!1)=>{const E=new Map;for(const I of x){const y=I.parentId??null,d=E.get(y)??[];d.push(I),E.set(y,d)}if(!w)for(const[,I]of E)I.sort((y,d)=>y.label.localeCompare(d.label));return E},ut=({items:x,rootId:w=null,className:E,expandedIds:I,selectedId:y=null,selectedIds:d,onExpandedChange:H,onSelectedChange:L,onSelectedIdsChange:P,renderNode:N,role:z="tree",preserveOrder:j=!1,draggable:Y,canDrop:q,onMove:B,isCheckable:F,checkedIds:A,onCheckedChange:C,biDirectionalChecking:O=!1,renderExpander:G,renderCheckbox:S,renderIcon:K})=>{const _=et(()=>dt(x,j),[x,j]),T=nt(null),R=nt(!1),g=et(()=>new Map(x.map(n=>[n.id,n])),[x]),W=(n,o)=>{const a=[],u=[o];for(;u.length;){const f=u.pop(),c=n.get(f)??[];for(const h of c)a.push(h.id),u.push(h.id)}return a},M=X(n=>W(_,n),[_]),k=X(n=>F?F(n):!0,[F]),t=X(n=>{if(!g.get(n))return{checked:!1,indeterminate:!1};const a=A??new Set;if(O){if(a.has(n))return{checked:!0,indeterminate:!1};const c=M(n).filter(v=>{const b=g.get(v);return b?k(b):!1});return c.length===0?{checked:!1,indeterminate:!1}:c.reduce((v,b)=>a.has(b)?v+1:v,0)===0?{checked:!1,indeterminate:!1}:{checked:!1,indeterminate:!0}}const u=[n,...M(n)].filter(c=>{const h=g.get(c);return h?k(h):!1});if(u.length===0)return{checked:!1,indeterminate:!1};const f=u.reduce((c,h)=>a.has(h)?c+1:c,0);return f===0?{checked:!1,indeterminate:!1}:f===u.length?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}},[g,M,k,A,O]),e=X(n=>{if(!C)return;const o=new Set(A??[]),{checked:a}=t(n),u=M(n),f=[n,...u].filter(c=>{const h=g.get(c);return h?k(h):!1});if(a)for(const c of f)o.delete(c);else for(const c of f)o.add(c);if(O&&!a){const c=g.get(n);if(c){let h=c.parentId;for(;h;){const v=g.get(h);if(!v||!k(v))break;o.add(h),h=v.parentId}}}C(o)},[A,C,t,M,g,k,O]),i=X(n=>$(ot,{name:`tree-checkbox-${Math.random().toString(36).substr(2,9)}`,checked:n.checked,indeterminate:n.indeterminate,onChange:n.onCheck}),[]),r=X(n=>{const o=new Set(I);o.has(n)?o.delete(n):o.add(n),H(o)},[I,H]),s=X(n=>{const o=g.get(n);if(o&&k(o)&&C&&e(n),!P){L==null||L(n);return}const a=!!R.current,u=a?new Set(d??[]):new Set;a&&u.has(n)?u.delete(n):u.add(n),P(u),R.current=!1},[L,P,d,g,k,C,e]),l=(n,o)=>{const a=_.get(n)??[];return a.length?$("ul",{role:o===1?z:"group",className:o===1?E??"acm-tree":"acm-tree__group",children:a.map((f,c)=>{const h=(_.get(f.id)??[]).length>0,v=I.has(f.id),b=d?d.has(f.id):y===f.id,m=!!(Y!=null&&Y(f)),Q=p=>q?q(p,f.id):p!==f.id,U=h?()=>G?G({expanded:v,hasChildren:h,toggle:()=>r(f.id)}):null:void 0,Z=(()=>{if(!C)return;const p=g.get(f.id);if(!p||!k(p))return;const D=t(f.id),V=S||i;return()=>V({checked:D.checked,indeterminate:D.indeterminate,onCheck:()=>e(f.id)})})(),tt=K?()=>K({item:f,level:o,hasChildren:h,expanded:v}):void 0,rt=N({item:f,level:o,expanded:v,selected:!!b,hasChildren:h,toggle:()=>r(f.id),select:()=>s(f.id),...U?{expander:U}:{},...Z?{checkbox:Z}:{},...tt?{icon:tt}:{}});return st("li",{role:"treeitem",className:"acm-tree__item","data-level":o,"aria-expanded":h?v:void 0,"aria-selected":b||void 0,"aria-level":o,"aria-setsize":a.length,"aria-posinset":c+1,draggable:m,onMouseDown:p=>{R.current=!!(p.metaKey||p.ctrlKey)},onDragStart:p=>{var D;if(p.stopPropagation(),!!m){T.current=f.id;try{(D=p.dataTransfer)==null||D.setData("text/plain",f.id)}catch{}}},onDragEnter:p=>{p.preventDefault()},onDragOver:p=>{var V;p.stopPropagation();const D=T.current??(((V=p.dataTransfer)==null?void 0:V.getData("text/plain"))||"");D&&Q(D)&&p.preventDefault()},onDrop:p=>{var V;p.stopPropagation();const D=T.current??(((V=p.dataTransfer)==null?void 0:V.getData("text/plain"))||"");T.current=null,D&&Q(D)&&(B==null||B({id:D,newParentId:f.id}))},children:[rt,h&&v?l(f.id,o+1):null]},f.id)})}):null};return $("div",{className:"acm-tree-root",children:l(w,1)})};export{ut as T};
//# sourceMappingURL=Tree.js.map
