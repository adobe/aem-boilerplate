/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as V,jsx as n,Fragment as G}from"@dropins/tools/preact-jsx-runtime.js";import{h as ce,a as ae}from"../chunks/fetch-graphql.js";import{classes as z,VComponent as le,Slot as ue}from"@dropins/tools/lib.js";import{t as pe}from"../chunks/transform-shipping-estimate.js";import{h as D,g as de}from"../chunks/events.js";import{n as he,g as I}from"../chunks/values.js";import{events as B}from"@dropins/tools/event-bus.js";import{c as J}from"../chunks/synchronizeCheckout.js";import{s as me}from"../chunks/setShippingMethods.js";import{W as fe}from"../chunks/ConditionalWrapper.js";/* empty css                       */import{Skeleton as ge,SkeletonRow as O,IllustratedMessage as ke,Icon as ve,InLineAlert as Se,RadioButton as Ee,Price as K,ToggleButton as Ce}from"@dropins/tools/components.js";import{s as Le}from"../chunks/dom.js";import{useRef as Me,useEffect as A,useState as T,useCallback as p,useMemo as X}from"@dropins/tools/preact-hooks.js";import*as a from"@dropins/tools/preact-compat.js";import{useText as Y}from"@dropins/tools/i18n.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";import"../fragments.js";import"../chunks/transform-shipping-methods.js";import"../chunks/guards.js";const ye=i=>a.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...i},a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M2.47266 4.90002H15.1851V10.9645H21.2495L23 12.715V17.6124H20.073",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M15.1758 5.87573H19.0019L21.0394 10.7636",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M9.76151 16.7898C9.76151 18.0525 8.72845 19.076 7.46582 19.076C6.20318 19.076 5.17969 18.0429 5.17969 16.7803C5.17969 15.5176 6.20318 14.4941 7.46582 14.4941C8.72845 14.4941 9.75195 15.5176 9.76151 16.7803C9.76151 16.7803 9.76151 16.7803 9.76151 16.7898Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.8726 16.7898C19.8726 18.062 18.8491 19.0855 17.5769 19.0855C16.3047 19.0855 15.2812 18.062 15.2812 16.7898C15.2812 15.5176 16.3047 14.4941 17.5769 14.4941C18.8491 14.4941 19.8726 15.5176 19.8726 16.7898Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M8.08792 7.63574H1.69824",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M7.11229 10.3619H1",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M5.16084 13.0402H1.92773",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M9.76172 16.7611H15.2809",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M2.38672 16.7611H5.17025",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),_e=()=>V(ge,{"data-testid":"shipping-methods-skeleton",children:[n(O,{size:"small",variant:"heading"}),n(O,{size:"small",variant:"empty"}),n(O,{fullWidth:!0,size:"medium"}),n(O,{fullWidth:!0,size:"medium"})]}),We=({className:i,busy:r=!1,onSelectionChange:g=()=>{},options:v,selection:d,title:l,UIComponentType:u="RadioButton",error:h=null,onDismissError:R=()=>{},...b})=>{const S=Y({EmptyState:"Checkout.ShippingMethods.emptyState"}),E=h!==null,C=Me(null);A(()=>{E&&C.current&&Le(C.current)},[E]);const L=(o,U)=>{const M={busy:r,className:"checkout-shipping-methods__method",key:o.value,name:"shipping-method",value:o.value,onChange:()=>g(o)};return U==="RadioButton"?n(Ee,{...M,checked:(d==null?void 0:d.value)===o.value,"data-testid":"shipping-method-radioButton",description:o.title,disabled:r,id:o.value,label:V(G,{children:[n(K,{amount:o.amount.value,currency:o.amount.currency}),"Â ",n("span",{children:o.carrier.title})]})}):n(Ce,{...M,"data-testid":"shipping-method-toggleButton",label:V(G,{children:[n("span",{children:o.carrier.title}),n(K,{amount:o.amount.value,currency:o.amount.currency})]}),selected:(d==null?void 0:d.value)===o.value})};return V("div",{...b,className:z(["checkout-shipping-methods",i]),"data-testid":"checkout-shipping-methods",children:[l&&n(le,{className:"checkout-shipping-methods__title",node:l}),n("div",{className:z(["checkout-shipping-methods__content"]),children:n("div",{className:z(["checkout-shipping-methods__options",["checkout-shipping-methods__options--busy",r],["checkout-shipping-methods__options--toggleButton",u==="ToggleButton"]]),"data-testid":"checkout-shipping-methods-options",children:v.length===0?n(ke,{"data-testid":"checkout-shipping-methods-empty",icon:n(ve,{source:ye}),message:n("p",{children:S.EmptyState})}):v.map(o=>L(o,u))})}),E&&n("div",{ref:C,className:"checkout-shipping-methods__error","data-testid":"checkout-shipping-methods-alert",children:n(Se,{heading:h,type:"error",variant:"primary",onDismiss:R})})]})},je=fe(We,_e);function N(i,r){return i?r.some(g=>P(g,i)):!1}function P(i,r){return!i||!r||i.amount.value!==r.amount.value?!1:i.code===r.code&&i.carrier.code===r.carrier.code}function Be(i){const r=B.lastPayload("shipping/estimate");r&&B.emit("shipping/estimate",{...r,shippingMethod:pe(i)})}const Ge=({UIComponentType:i="RadioButton",active:r=!0,autoSync:g=!0,displayTitle:v=!0,initialData:d,slots:l,onCartSyncError:u,onSelectionChange:h,...R})=>{const[b,S]=T(null),[E,C]=T(!1),[L,o]=T(),[U,M]=T(null),ee=ce.value,te=ae.value,{cartSyncError:Z,defaultTitle:q}=Y({cartSyncError:"Checkout.ShippingMethods.cartSyncError",defaultTitle:"Checkout.ShippingMethods.title"}),w=p(e=>{if(!e||e.length===0)return[];const{shipping:t}=J.getConfig();return t!=null&&t.filterOptions?e.filter(t.filterOptions):e},[]),F=p(e=>{if(e.length===0)return null;const{defaults:t}=J.getConfig();return t.selectedShippingMethod(e)},[]),re=X(()=>w(L),[L,w]),ne=p(()=>{S(null)},[]),c=p(e=>{S(null),M(t=>P(t,e)?t:(he({selectedShippingMethod:e}),e))},[]),y=p(async(e,t)=>{if(!g||!D())return;const s={carrierCode:e.carrier.code,methodCode:e.code};me([s]).catch(m=>{c(t??null),u==null||u({method:e,error:m}),u||S(Z)})},[g,c,u,Z]),oe=p(async e=>{const t=I("selectedShippingMethod");c(e),h==null||h(e),D()||Be(e),await y(e,t)},[h,c,y]),_=p(e=>{var $;const t=!e||e.isEmpty,s=!!(e!=null&&e.isVirtual);if(t||s){C(s),c(null),o([]);return}const m=($=e.shippingAddresses)==null?void 0:$[0];if(!m)return;const W=m.availableShippingMethods??[],j=w(W);if(o(W),j.length===0){c(null);return}const f=m.selectedShippingMethod??null,k=I("selectedShippingMethod"),x=N(k,j),se=P(k,f);if(k&&x&&!se){y(k,f);return}if((!k||!x)&&f&&N(f,j)){c(f);return}if((!k||!x)&&(!f||!N(f,j))){const H=F(j);c(H),H&&y(H)}},[w,F,c,y]),Q=p(e=>{if(e===void 0)return;const{shippingMethod:t,availableShippingMethods:s}=e,m=(s==null?void 0:s.find(W=>W.code===(t==null?void 0:t.methodCode)&&W.carrier.code===(t==null?void 0:t.carrierCode)))??null;o(s),c(m)},[c]);A(()=>{if(!r)return;const e=de();if(e){const s=I("selectedShippingMethod");s&&M(s),_(e);return}const t=B.on("checkout/initialized",_,{eager:!0});return()=>{t==null||t.off()}},[r,_]),A(()=>{if(!r)return;const e=B.on("checkout/updated",_,{eager:!1});return()=>{e==null||e.off()}},[r,_]),A(()=>{if(!r||D())return;const e=B.on("shipping/estimate",Q,{eager:!0});return()=>{e==null||e.off()}},[r,Q]);const ie=X(()=>{if(v)return n(ue,{name:"checkout-shipping-methods-title",slot:l==null?void 0:l.Title,children:n("h3",{children:q})})},[v,l==null?void 0:l.Title,q]);return n(je,{...R,UIComponentType:i,busy:ee||te,error:b,initialized:L!==void 0,options:re,selection:U,title:ie,visible:r&&!E,onDismissError:ne,onSelectionChange:oe})};export{Ge as ShippingMethods,Ge as default,Be as emitShippingEstimateEvent};
//# sourceMappingURL=ShippingMethods.js.map
