/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as q,jsx as n,Fragment as pe}from"@dropins/tools/preact-jsx-runtime.js";import*as u from"@dropins/tools/preact-compat.js";import{useState as E,useEffect as ie,useCallback as V}from"@dropins/tools/preact-compat.js";import{b as be,a as ke,d as ve,u as ye,g as ne,i as Ce}from"../chunks/addRequisitionListItemsToCart.js";import{Icon as Z,Button as ee,Price as me,Field as Re,Input as Se,Image as Ie,Checkbox as Pe,Table as Ee,ProgressSpinner as Ae,InLineAlert as Ne,Pagination as xe}from"@dropins/tools/components.js";import{events as v}from"@dropins/tools/event-bus.js";import{useState as ge,useCallback as se}from"@dropins/tools/preact-hooks.js";import{classes as he,VComponent as Te}from"@dropins/tools/lib.js";import{D as U}from"../chunks/RequisitionListForm.js";import"../chunks/state.js";import{u as Ve,E as Me}from"../chunks/RequisitionListView.js";import{h as De}from"@dropins/tools/preact.js";import{useText as oe}from"@dropins/tools/i18n.js";import{R as He}from"../chunks/RequisitionListHeader.js";import{R as Be}from"../chunks/RequisitionListModal.js";import{P as ze}from"../chunks/PageSizePicker.js";import"../chunks/updateRequisitionList.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/deleteRequisitionList.js";function Fe(){const[o,S]=ge(null),[g,d]=ge(new Set),y=se((_,I)=>{d(m=>{const b=new Set(m);return I?b.add(_):b.delete(_),b})},[]),C=se(()=>{var I;const _=(I=o==null?void 0:o.items)==null?void 0:I.map(m=>m.uid);d(new Set(_))},[o]),A=se(()=>{d(new Set)},[]);return{currentRequisitionList:o,setCurrentRequisitionList:S,selectedItems:g,setSelectedItems:d,handleItemSelection:y,handleSelectAll:C,handleSelectNone:A}}const We=o=>u.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...o},u.createElement("g",{clipPath:"url(#clip0_102_196)"},u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3601 18.16H6.5601L4.8801 3H2.3501M19.6701 19.59C19.6701 20.3687 19.0388 21 18.2601 21C17.4814 21 16.8501 20.3687 16.8501 19.59C16.8501 18.8113 17.4814 18.18 18.2601 18.18C19.0388 18.18 19.6701 18.8113 19.6701 19.59ZM7.42986 19.59C7.42986 20.3687 6.79858 21 6.01986 21C5.24114 21 4.60986 20.3687 4.60986 19.59C4.60986 18.8113 5.24114 18.18 6.01986 18.18C6.79858 18.18 7.42986 18.8113 7.42986 19.59Z",stroke:"currentColor",strokeLinejoin:"round"}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M5.25 6.37L20.89 8.06L20.14 14.8H6.19",stroke:"currentColor",strokeLinejoin:"round"})),u.createElement("defs",null,u.createElement("clipPath",{id:"clip0_102_196"},u.createElement("rect",{vectorEffect:"non-scaling-stroke",width:19.29,height:19.5,fill:"white",transform:"translate(2.3501 2.25)"})))),$e=o=>u.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...o},u.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),je=o=>u.createElement("svg",{id:"Icon_Search_Base","data-name":"Icon \\u2013 Search \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",viewBox:"0 0 24 24",...o},u.createElement("g",{id:"Large"},u.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),u.createElement("g",{id:"Search_icon","data-name":"Search icon",transform:"translate(3.75 3.75)"},u.createElement("circle",{vectorEffect:"non-scaling-stroke",id:"Ellipse_186","data-name":"Ellipse 186",cx:6,cy:6,r:6,fill:"none",stroke:"currentColor"}),u.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_556","data-name":"Line 556",x2:6,y2:6,transform:"translate(10.5 10.5)",fill:"none",stroke:"currentColor"})))),fe=o=>u.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",...o},u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M1 5H23",stroke:"currentColor",strokeWidth:1,strokeMiterlimit:10}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.3674 22H6.63446C5.67952 22 4.88992 21.2688 4.8379 20.3338L4 5H20L19.1621 20.3338C19.1119 21.2688 18.3223 22 17.3655 22H17.3674Z",stroke:"currentColor",strokeWidth:1,strokeMiterlimit:10}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M9.87189 2H14.1281C14.6085 2 15 2.39766 15 2.88889V5H9V2.88889C9 2.39912 9.39006 2 9.87189 2Z",stroke:"currentColor",strokeWidth:1,strokeMiterlimit:10}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M8.87402 8.58057L9.39348 17.682",stroke:"currentColor",strokeWidth:1,strokeMiterlimit:10}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M14.6673 8.58057L14.146 17.682",stroke:"currentColor",strokeWidth:1,strokeMiterlimit:10})),Qe=({className:o,title:S="404 - Not Found",message:g="The requisition list you are looking for does not exist.",actionLabel:d,onAction:y,...C})=>q("div",{className:he(["not-found",o]),"data-testid":"not-found",...C,children:[n(Z,{source:je,size:"64",stroke:"2"}),n("h2",{children:S}),g&&n("p",{children:g}),d&&y&&n(ee,{variant:"primary",onClick:y,children:d})]}),Ze=({className:o,items:S,selectedItems:g,currentPage:d,pageSize:y,canEdit:C=!0,handleItemSelection:A,handleUpdateQuantity:_,onAddToCart:I,onDeleteItem:m,...b})=>{const h=oe({productNameHeader:"RequisitionList.RequisitionListView.productListTable.headers.productName",skuHeader:"RequisitionList.RequisitionListView.productListTable.headers.sku",priceHeader:"RequisitionList.RequisitionListView.productListTable.headers.price",quantityHeader:"RequisitionList.RequisitionListView.productListTable.headers.quantity",subtotalHeader:"RequisitionList.RequisitionListView.productListTable.headers.subtotal",actionsHeader:"RequisitionList.RequisitionListView.productListTable.headers.actions",actionAddToCart:"RequisitionList.RequisitionListView.actionAddToCart",actionDelete:"RequisitionList.RequisitionListView.actionDelete",itemQuantity:"RequisitionList.RequisitionListView.productListTable.itemQuantity"}),F=[{label:"#",key:"index"},{label:"item",key:"item"},{label:h.priceHeader,key:"price"},{label:h.quantityHeader,key:"quantity"},{label:h.subtotalHeader,key:"subtotal"}];C&&(F.unshift({label:"",key:"selector"}),F.push({label:h.actionsHeader,key:"actions"}));const O=(e,a)=>{const c=e.target.checked;A(a.uid,c)},J=e=>(d-1)*y+e+1,B=e=>{var a,c;return((a=e.configured_product)==null?void 0:a.name)||((c=e.product)==null?void 0:c.name)||e.sku},x=e=>{var a,c,f,P;return(a=e.configured_product)!=null&&a.images?(c=e.configured_product.images[0])==null?void 0:c.url:(f=e.product)!=null&&f.images?(P=e.product.images[0])==null?void 0:P.url:""},K=e=>{var a;return((a=e.product)==null?void 0:a.name)||e.sku},te=e=>{var a;return(a=e.configured_product)==null?void 0:a.name},W=e=>e.bundle_options?e.bundle_options.map((c,f)=>q("span",{className:"requisition-list-view-product-list-table__product-configurable-name",children:[c.values[0].label," x ",c.values[0].quantity]},c.values[0].label||f)):void 0,X=e=>{var a;return((a=e.configured_product)==null?void 0:a.sku)||e.sku},z=e=>{var a,c,f,P,r,N,D,T;return e.bundle_options?e.bundle_options.reduce((w,j)=>{var Q,Y,G;return w+(((Y=(Q=j.values[0])==null?void 0:Q.priceV2)==null?void 0:Y.value)||0)*(((G=j.values[0])==null?void 0:G.quantity)||0)},0):((P=(f=(c=(a=e.configured_product)==null?void 0:a.price)==null?void 0:c.final)==null?void 0:f.amount)==null?void 0:P.value)||((T=(D=(N=(r=e.product)==null?void 0:r.price)==null?void 0:N.final)==null?void 0:D.amount)==null?void 0:T.value)||0},M=e=>{var a,c,f,P,r,N,D,T;return((P=(f=(c=(a=e.configured_product)==null?void 0:a.price)==null?void 0:c.final)==null?void 0:f.amount)==null?void 0:P.currency)||((T=(D=(N=(r=e.product)==null?void 0:r.price)==null?void 0:N.final)==null?void 0:D.amount)==null?void 0:T.currency)},$=e=>z(e)*e.quantity,t=S.map((e,a)=>({selector:n(Pe,{className:"requisition-list-view-product-list-table__checkbox",name:"itemSelected","data-testid":`item-checkbox-${e.sku}`,onChange:c=>O(c,e),value:e.sku,checked:g.has(e.uid)}),index:n("div",{className:"requisition-list-view-product-list-table__index-container",children:J(a)}),item:q("div",{className:"requisition-list-view-product-list-table__item-container",children:[n(Ie,{className:"requisition-list-view-product-list-table__thumbnail",alt:B(e),src:x(e)}),q("div",{className:"requisition-list-view-product-list-table__item-details",children:[n("div",{className:"requisition-list-view-product-list-table__product-name",children:K(e)}),n("span",{className:"requisition-list-view-product-list-table__product-configurable-name",children:te(e)}),n("div",{className:"requisition-list-view-product-list-table__sku",children:X(e)}),W(e)]})]}),price:n(me,{className:"requisition-list-view-product-list-table__price",amount:z(e),currency:M(e)}),quantity:n("span",{className:"requisition-list-view-product-list-table__quantity",children:n(Re,{disabled:!1,children:n(Se,{id:"requisition-list-item-quantity",name:"quantity",type:"text",value:e.quantity,onBlur:c=>{const f=Number.parseInt(c.target.value,10);_(e.uid,f)}})})}),subtotal:n(me,{className:"requisition-list-view-product-list-table__price",amount:$(e),currency:M(e)}),actions:q("div",{className:"requisition-list-view__bulk-actions",children:[n(ee,{type:"button",onClick:()=>I([e.uid]),icon:n(Z,{source:We}),"data-testid":"product-list-table-add-to-cart-button"}),n(ee,{type:"button",variant:"secondary",icon:n(Z,{source:fe}),onClick:()=>m([e.uid]),"data-testid":"product-list-table-delete-button"})]})})),p=n(Ee,{columns:F,rowData:t,"data-testid":"product-list-table",mobileLayout:"stacked"});return n(Te,{node:De("div",{}),className:he(["requisition-list-view-product-list-table-container",o]),"data-testid":"product-list-table-container",...b,children:p})},Oe=({selectedItems:o,deletingItemId:S,addingToCartItemId:g,bulkAddingToCart:d,updatingQuantityItemId:y,onSelectAll:C,onSelectNone:A,onBulkAddToCart:_,onBulkDelete:I})=>{const m=oe({statusDeleting:"RequisitionList.RequisitionListView.statusDeleting",actionSelectAll:"RequisitionList.RequisitionListView.actionSelectAll",actionSelectNone:"RequisitionList.RequisitionListView.actionSelectNone",actionAddToCart:"RequisitionList.RequisitionListView.actionAddToCart",actionDeleteSelectedItems:"RequisitionList.RequisitionListView.actionDeleteSelectedItems",statusBulkAddingToCart:"RequisitionList.RequisitionListView.statusBulkAddingToCart"}),b=S!==null||g!==null||d||y!==null,h=o.size>0;return q("div",{className:"requisition-list-view__batch-actions",children:[q("div",{className:"requisition-list-view__batch-actions-left",children:[n("button",{"data-testid":"bulk-actions-select-toggle-btn",type:"button",className:`requisition-list-view__batch-actions-select-toggle ${h?"requisition-list-view__batch-actions-select-toggle--active":""}`,onClick:h?A:C,disabled:b,"aria-label":h?m.actionSelectNone:m.actionSelectAll,children:n(Z,{source:$e})}),n("button",{type:"button",className:"requisition-list-view__batch-actions-select-label",onClick:h?A:C,disabled:b,children:m.actionSelectAll})]}),h&&q("div",{className:"requisition-list-view__batch-actions-buttons",children:[n("span",{className:"requisition-list-view__batch-actions-count-badge","aria-label":`${o.size} items selected`,children:o.size}),n(ee,{"data-testid":"bulk-actions-add-to-cart-btn",type:"button",variant:"secondary",onClick:_,disabled:b,children:d?m.statusBulkAddingToCart:m.actionAddToCart}),n("button",{"data-testid":"bulk-actions-delete-btn",type:"button",className:"requisition-list-view__batch-actions-delete-icon",onClick:I,disabled:b,"aria-label":m.actionDeleteSelectedItems,children:n(Z,{source:fe})})]})]})},pt=({requisitionListUid:o,skipProductLoading:S=!1,pageSize:g=U,routeRequisitionListGrid:d})=>{var ae,re,ce,le,ue;const[y,C]=E(!1),[A,_]=E(null),[I,m]=E(null),[b,h]=E(!1),[F,O]=E(null),[J,B]=E(!1),[x,K]=E(g),[te,W]=E(!0),[X,z]=E(!1),[M,$]=E([]),{currentRequisitionList:t,setCurrentRequisitionList:p,selectedItems:e,setSelectedItems:a,handleItemSelection:c,handleSelectAll:f,handleSelectNone:P}=Fe(),r=oe({emptyRequisitionList:"RequisitionList.RequisitionListView.emptyRequisitionList",errorLoadingProducts:"RequisitionList.RequisitionListView.errorLoadingProducts",errorLoadPage:"RequisitionList.RequisitionListView.errorLoadPage",notFoundTitle:"RequisitionList.RequisitionListView.notFoundTitle",notFoundMessage:"RequisitionList.RequisitionListView.notFoundMessage",notFoundActionLabel:"RequisitionList.RequisitionListView.notFoundActionLabel",show:"RequisitionList.RequisitionListView.show",itemsCounter:"RequisitionList.RequisitionListView.itemsCounter",deleteItemsTitle:"RequisitionList.RequisitionListView.deleteItemsTitle",deleteItemsMessage:"RequisitionList.RequisitionListView.deleteItemsMessage",confirmAction:"RequisitionList.RequisitionListView.confirmAction",cancelAction:"RequisitionList.RequisitionListView.cancelAction"}),{alert:N,setAlert:D,handleRequisitionListAlert:T}=Ve();ie(()=>{const i=v.on("requisitionList/data",l=>{(l==null?void 0:l.uid)===o&&(p(l),a(new Set))}),s=v.on("requisitionList/alert",T);return()=>{i==null||i.off(),s==null||s.off()}},[T,o,p,a]),ie(()=>{K(g)},[g]);const w=V(async i=>{var l,k;const s=((l=i.items)==null?void 0:l.map(R=>R.sku))||[];if(s.length===0)return i;C(!0);try{const R=await be(s);if(R){const H=new Map;return R.forEach(L=>{H.set(L.sku,L)}),{...i,items:(k=i.items)==null?void 0:k.map(L=>({...L,product:H.get(L.sku)||L.product}))}}return console.warn("No products found"),i}catch(R){return console.warn(R instanceof Error?R.message:r.errorLoadingProducts),i}finally{C(!1)}},[r.errorLoadingProducts]);ie(()=>{if(!o){W(!1);return}if(t&&t.uid===o)return;W(!0),(async()=>{try{const s=await ne(o,1,g);if(s)if(S)p(s);else{const l=await w(s);p(l)}}catch(s){console.error("Failed to initialize requisition list from UID:",s)}finally{W(!1)}})()},[o,g,S,w,p,t]);const j=V(async i=>{i&&i.length===1?(h(!1),m(i)):(h(!0),m(null));try{const s=await ke(t.uid,i);s&&s.length>0?v.emit("requisitionList/alert",{action:"move",type:"error",context:"product",message:s.map(l=>l.message)}):v.emit("requisitionList/alert",{action:"move",type:"success",context:"product"})}catch{v.emit("requisitionList/alert",{action:"move",type:"error",context:"product"})}finally{m(null),h(!1)}},[t]),Q=V(i=>{i&&i.length>0&&($(i),z(!0))},[]),Y=V(async()=>{M.length===1?_(M[0]):_("bulk");try{const i=await ve(t.uid,M,x,t.page_info.current_page);if(i){const s=await w(i);p(s),v.emit("requisitionList/alert",{action:"delete",type:"success",context:"product"})}else v.emit("requisitionList/alert",{action:"delete",type:"error",context:"product"})}catch{v.emit("requisitionList/alert",{action:"delete",type:"error",context:"product"})}finally{_(null),z(!1),$([])}},[M,t,x,w,p]),G=V(async(i,s)=>{var l;O(i);try{const k=(l=t.items)==null?void 0:l.find(L=>L.uid===i);if(!k){v.emit("requisitionList/alert",{action:"update",type:"error",context:"product"});return}const R={item_id:k.uid,entered_options:k.entered_options,selected_options:k.selected_options,quantity:s},H=await ye(t.uid,[R],x,t.page_info.current_page);if(H){const L=await w(H);p(L),v.emit("requisitionList/alert",{action:"update",type:"success",context:"product"})}else v.emit("requisitionList/alert",{action:"update",type:"error",context:"product"})}catch{v.emit("requisitionList/alert",{action:"update",type:"error",context:"product"})}finally{O(null)}},[t,w,p,x]),we=V(async i=>{B(!0);try{const s=await ne(t.uid,i,x);if(s){const l=await w(s);p(l)}else console.warn(r.errorLoadPage)}catch(s){console.warn(s instanceof Error?s.message:r.errorLoadPage)}finally{B(!1)}},[t==null?void 0:t.uid,w,x,r,p]),Le=V(async i=>{K(i),B(!0);try{const s=await ne(t.uid,1,i);if(s){const l=await w(s);p(l)}else console.warn(r.errorLoadPage)}catch{console.warn(r.errorLoadPage)}finally{B(!1)}},[t==null?void 0:t.uid,w,r,p]),qe=V(async i=>{const s=await w(i);p(s)},[p,w]),_e=()=>{var L,de;const i=((L=t.page_info)==null?void 0:L.page_size)??U,s=((de=t.page_info)==null?void 0:de.current_page)??1,l=i*s,k=(t==null?void 0:t.items_count)??0,R=l-i+1,H=l>k?k:l;return n("span",{className:"requisition-list-view__pagination-items",children:r.itemsCounter.replace("{from}",R.toString()).replace("{to}",H.toString()).replace("{total}",k.toString())})};return q("div",{className:"requisition-list-view__container",children:[te?n("div",{className:"requisition-list-view__loading",children:n(Ae,{stroke:"4",size:"large"})}):!t||!Ce(t==null?void 0:t.uid)?n(Qe,{title:r.notFoundTitle,message:r.notFoundMessage,actionLabel:d?r.notFoundActionLabel:void 0,onAction:d?()=>{const i=d();i&&typeof i=="string"&&(window.location.href=i)}:void 0}):q(pe,{children:[n(He,{requisitionList:t,routeRequisitionListGrid:d,onUpdate:qe}),t.items_count===0?n(Me,{textContent:`${t.name} ${r.emptyRequisitionList}`}):q(pe,{children:[N&&n(Ne,{heading:N.description,type:N.type,variant:"primary",onDismiss:()=>D(null)}),n(Oe,{selectedItems:e,deletingItemId:A,addingToCartItemId:I,bulkAddingToCart:b,updatingQuantityItemId:F,onSelectAll:f,onSelectNone:P,onBulkAddToCart:()=>j(Array.from(e)),onBulkDelete:()=>Q(Array.from(e))}),n(Ze,{items:t.items,selectedItems:e,currentPage:((ae=t.page_info)==null?void 0:ae.current_page)||1,pageSize:((re=t.page_info)==null?void 0:re.page_size)||U,handleItemSelection:c,handleUpdateQuantity:G,onAddToCart:j,onDeleteItem:Q}),t.page_info&&q("div",{className:"requisition-list-view__pagination",children:[_e(),(((ce=t.page_info)==null?void 0:ce.total_pages)||0)>1&&n(xe,{totalPages:t.page_info.total_pages,currentPage:((le=t.page_info)==null?void 0:le.current_page)||1,onChange:we,disabled:J||y}),q("div",{className:"requisition-list-view__pagination-picker",children:[n("span",{children:r.show}),n(ze,{currentPageSize:((ue=t.page_info)==null?void 0:ue.page_size)||U,onPageSizeChange:Le,disabled:J||y})]})]})]})]}),X&&n(Be,{isOpen:X,isLoading:A!==null,title:r.deleteItemsTitle,modalContent:r.deleteItemsMessage,confirmBtnCaption:r.confirmAction,closeBtnCaption:r.cancelAction,handleModalOnClose:()=>{z(!1),$([])},handleModalOnConfirm:Y})]})};export{pt as RequisitionListView,pt as default};
//# sourceMappingURL=RequisitionListView.js.map
