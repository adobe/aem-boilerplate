/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as a,jsxs as U,Fragment as ce}from"@dropins/tools/preact-jsx-runtime.js";import{useState as c,useEffect as q,useCallback as le}from"@dropins/tools/preact-compat.js";import{Slot as Y}from"@dropins/tools/lib.js";import{events as E}from"@dropins/tools/event-bus.js";import{Modal as ue,Button as $,Price as G,InLineAlert as B}from"@dropins/tools/components.js";/* empty css                             */import{I as J,Q as me,P as de}from"./QuotePricesSummary.js";import{useText as Z}from"@dropins/tools/i18n.js";/* empty css                *//* empty css                          *//* empty css                  */import{u as ge,r as pe}from"./removeNegotiableQuoteItems.js";import{S as K,a as V}from"./WarningFilled.js";const X=({open:x=!1,title:g,message:r,cancelLabel:I,confirmLabel:p,onCancel:n,onConfirm:l,onClose:S,showCloseButton:o,confirmationBanner:f,...N})=>{const M=Z({cancel:"ConfirmationModal.cancel",confirm:"ConfirmationModal.confirm"});if(!x)return null;const{className:C,...y}=N;return a(ue,{...y,size:"medium",onClose:S||n,clickToDismiss:!0,escapeToDismiss:!0,showCloseButton:o,"data-testid":"confirmation-modal",className:C,children:U("div",{className:"confirmation-modal__content",children:[f&&a("div",{className:"confirmation-modal__banner","data-testid":"confirmation-modal-banner",children:f}),g&&a("div",{className:"confirmation-modal__title","data-testid":"confirmation-modal-title",children:g}),r&&a("div",{className:"confirmation-modal__message","data-testid":"confirmation-modal-message",children:r}),U("div",{className:"confirmation-modal__actions","data-testid":"confirmation-modal-actions",children:[n&&a($,{variant:"secondary",onClick:n,"data-testid":"confirmation-modal-cancel",children:I??M.cancel}),a($,{variant:"primary",onClick:l,"data-testid":"confirmation-modal-confirm",children:p??M.confirm})]})]})})},fe=3e3,Ce=({quoteData:x,onItemCheckboxChange:g,onItemDropdownChange:r,onUpdate:I,onRemoveItemsRef:p,onRemoveModalStateChange:n,slots:l,...S})=>{const[o,f]=c(x),[N,M]=c({}),[C,y]=c(!1),[T,u]=c({type:null,message:""}),[w,O]=c(!1),[b,P]=c([]),[R,_]=c(!1),[h,d]=c({type:null,message:""}),[L,Q]=c({}),s=Z({subtotal:"NegotiableQuote.Manage.quotePricesSummary.subtotal.excludingTax",grandTotal:"NegotiableQuote.Manage.quotePricesSummary.grandTotal.includingTax",appliedTaxes:"NegotiableQuote.Manage.quotePricesSummary.appliedTaxes",modalTitle:"NegotiableQuote.Manage.updateQuantitiesModal.title",modalDescription:"NegotiableQuote.Manage.updateQuantitiesModal.description",modalCancelButton:"NegotiableQuote.Manage.updateQuantitiesModal.cancelButton",modalUpdateButton:"NegotiableQuote.Manage.updateQuantitiesModal.updateButton",successHeading:"NegotiableQuote.Manage.updateQuantitiesModal.successHeading",successMessage:"NegotiableQuote.Manage.updateQuantitiesModal.successMessage",errorHeading:"NegotiableQuote.Manage.updateQuantitiesModal.errorHeading",errorMessage:"NegotiableQuote.Manage.updateQuantitiesModal.errorMessage",removeModalTitle:"NegotiableQuote.Manage.removeItemsModal.title",removeModalDescription:"NegotiableQuote.Manage.removeItemsModal.description",removeModalCancelButton:"NegotiableQuote.Manage.removeItemsModal.cancelButton",removeModalConfirmButton:"NegotiableQuote.Manage.removeItemsModal.confirmButton",removeModalConfirmButtonRemoving:"NegotiableQuote.Manage.removeItemsModal.confirmButtonRemoving",removeSuccessHeading:"NegotiableQuote.Manage.removeItemsModal.successHeading",removeSuccessMessage:"NegotiableQuote.Manage.removeItemsModal.successMessage",removeErrorHeading:"NegotiableQuote.Manage.removeItemsModal.errorHeading",removeErrorMessage:"NegotiableQuote.Manage.removeItemsModal.errorMessage"});q(()=>{const e=E.on("quote-management/quote-data",t=>{f(t.quote),M({}),u({type:null,message:""}),Q({})},{eager:!0});return()=>e==null?void 0:e.off()},[]),q(()=>{const e=E.on("quote-management/quantities-updated",t=>{f(t.quote),M({}),u({type:"success",message:s.successMessage}),setTimeout(()=>{y(!1),u({type:null,message:""})},3e3)});return()=>e==null?void 0:e.off()},[s.successMessage]),q(()=>{const e=E.on("quote-management/quote-items-removed",t=>{f(t.quote),P([]),_(!1),d({type:"success",message:s.removeSuccessMessage}),setTimeout(()=>{O(!1),d({type:null,message:""}),n==null||n(!1)},fe)});return()=>e==null?void 0:e.off()},[s.removeSuccessMessage,n]);const D=le(e=>{!e||e.length===0||(P(e),d({type:null,message:""}),O(!0))},[]);q(()=>{p==null||p(D)},[D,p]);const k=()=>{d({type:null,message:""})},j=(e,t)=>{const i=e;if(t==="remove"){Q(m=>({...m,[i.uid]:t})),D([i]),r==null||r(i,t);return}r==null||r(i,t),Q(m=>{if(!(i.uid in m))return m;const v={...m};return delete v[i.uid],v})},ee=async()=>{if(!o||b.length===0)return;const e=b.map(t=>t.uid);_(!0),d({type:null,message:""});try{await pe({quoteUid:o.uid,quoteItemUids:e})}catch(t){const i=t instanceof Error?t.message:s.removeErrorMessage;if(d({type:"error",message:i}),b.length===1){const m=b[0];Q(v=>{if(!(m.uid in v))return v;const z={...v};return delete z[m.uid],z})}_(!1)}},te=()=>{if(O(!1),d({type:null,message:""}),n==null||n(!1),b.length===1){const e=b[0];Q(t=>{if(!(e.uid in t))return t;const i={...t};return delete i[e.uid],i})}P([])};if(!o)return a(J,{loading:!0});const A=!!o.canUpdateQuote,F=(e,t)=>{M(i=>({...i,[e.uid]:t}))},ae=e=>{e.preventDefault(),u({type:null,message:""}),y(!0)},se=async()=>{if(!o)return;if(Object.keys(N).length===0){y(!1);return}u({type:null,message:""});const e=Object.entries(N).map(([t,i])=>({quoteItemUid:t,quantity:i}));try{await ge({quoteUid:o.uid,items:e})}catch(t){const i=t instanceof Error?t.message:s.errorMessage;u({type:"error",message:i}),console.error("Failed to update quantities:",t)}},oe=()=>{y(!1),u({type:null,message:""})},W=()=>{u({type:null,message:""})},H=[];o.prices.subtotalExcludingTax&&H.push({label:s.subtotal,id:"subtotal",value:a(G,{amount:o.prices.subtotalExcludingTax.value,currency:o.prices.subtotalExcludingTax.currency,weight:"normal"})}),o.prices.grandTotal&&H.push({label:s.grandTotal,id:"total",value:a(G,{amount:o.prices.grandTotal.value,currency:o.prices.grandTotal.currency}),strong:!0});const ie=T.type==="success"?a(B,{type:"success",variant:"primary",icon:a(K,{}),heading:s.successHeading,description:T.message,onDismiss:W,"data-testid":"update-quantities-success-banner"}):T.type==="error"?a(B,{type:"error",variant:"primary",icon:a(V,{}),heading:s.errorHeading,description:T.message,onDismiss:W,"data-testid":"update-quantities-error-banner"}):null,ne=g?(e,t)=>{g(e,t)}:void 0,re=h.type==="success"?a(B,{type:"success",variant:"primary",icon:a(K,{}),heading:s.removeSuccessHeading,description:h.message,onDismiss:k,"data-testid":"remove-items-success-banner"}):h.type==="error"?a(B,{type:"error",variant:"primary",icon:a(V,{}),heading:s.removeErrorHeading,description:h.message,onDismiss:k,"data-testid":"remove-items-error-banner"}):null;return U(ce,{children:[a(J,{"data-testid":"items-quoted-container",...S,loading:!1,table:a(Y,{name:"ProductListTable",slot:l==null?void 0:l.ProductListTable,context:{items:o.items,canEdit:A,readOnly:o.readOnly,onItemCheckboxChange:g,onItemDropdownChange:j,onQuantityChange:F,onUpdate:I,dropdownSelections:L},children:a(de,{items:o.items,canEdit:A,onItemCheckboxChange:ne,readOnly:o.readOnly,onItemDropdownChange:j,onQuantityChange:F,onUpdate:ae,dropdownSelections:L})}),pricesSummary:a(Y,{name:"QuotePricesSummary",slot:l==null?void 0:l.QuotePricesSummary,context:{items:o.items,prices:o.prices},children:a(me,{entries:H})})}),a(X,{open:C,title:s.modalTitle,message:s.modalDescription,cancelLabel:s.modalCancelButton,confirmLabel:s.modalUpdateButton,onCancel:oe,onConfirm:se,confirmationBanner:ie,"data-testid":"update-quantities-modal"}),a(X,{open:w,title:s.removeModalTitle,message:s.removeModalDescription,cancelLabel:s.removeModalCancelButton,confirmLabel:R?s.removeModalConfirmButtonRemoving:s.removeModalConfirmButton,onCancel:te,onConfirm:ee,confirmationBanner:re,"data-testid":"remove-items-modal"})]})};export{X as C,Ce as I};
//# sourceMappingURL=ItemsQuoted.js.map
