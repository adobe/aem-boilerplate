/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as h,jsxs as M}from"@dropins/tools/preact-jsx-runtime.js";import{useState as R,useEffect as N,useMemo as z,useCallback as _}from"@dropins/tools/preact-compat.js";import{classes as P}from"@dropins/tools/lib.js";import{Picker as A,ColorSwatch as y,ImageSwatch as B,TextSwatch as D}from"@dropins/tools/components.js";/* empty css     */import{useText as C}from"@dropins/tools/i18n.js";const F=["text","image","color","dropdown"],G=t=>t.map(s=>({...s,text:s.label,disabled:!s.inStock}));function H(t,s){return t.reduce((m,i)=>{const n=s==null?void 0:s.find(f=>f.items.find(w=>w.id===i));if(!n)return m;const b=n.items.find(f=>f.id===i);return{...m,[n.id]:{label:b.label,value:b.id}}},{})}const I=({options:t,hideSelectedValue:s,disablePreselections:m,selectedUIDs:i,onValues:n,onErrors:b,defaultOptions:f,selectionsToUpdate:w,className:L,children:K,imageSwatchNode:O,...q})=>{const j=C("PDP.Swatches.Required.label").label,k=C("PDP.Swatches.ChooseOption.label").label,[S,x]=R(()=>t==null?void 0:t.reduce((r,e)=>{const{items:a}=e,d=a==null?void 0:a.find(c=>f==null?void 0:f.includes(c.id)),u=a==null?void 0:a.find(c=>c.selected);return d?{...r,[e.id]:{label:d.label,value:d.id}}:u?{...r,[e.id]:{label:u.label,value:u.id}}:r},{}));N(()=>{if(i){const l=H(i,t);if(JSON.stringify(l)===JSON.stringify(S))return;x(r=>{let e={...r,...l};return n==null||n(e),e})}},[i]),N(()=>{w==null||w.forEach(l=>{x(r=>{var d;const e=(d=l==null?void 0:l.items)==null?void 0:d.find(u=>u.selected);return e?{...r,[l.id]:{label:e==null?void 0:e.label,value:e==null?void 0:e.id}}:r})})},[w,x]),z(()=>{const l=t==null?void 0:t.reduce((r,e)=>{var d;let a=!1;return(d=e==null?void 0:e.items)==null||d.forEach(u=>{var v;((v=S[e.id])==null?void 0:v.value)===u.id&&(a=!0)}),e.required&&!a&&(r[e.id]=j),r},{});return b==null||b(l),l},[S]);const g=_((l,r,e)=>{x(a=>{let d={...a,...l&&{[l]:{label:r,value:e}}};return r===k&&delete d[l],n==null||n(d,e),d})},[n]),$=_((l,r)=>{var a;const e=((a=r.selectedOptions[0])==null?void 0:a.label)??"";g(l,e,r.value)},[g]),J=_(({items:l,id:r,required:e,type:a,selected:d,label:u})=>(l==null?void 0:l.length)>0&&h("div",{className:P(["pdp-swatches__options"]),children:(a==null?void 0:a.toLowerCase())==="dropdown"?h(A,{"aria-label":u,placeholder:m?k:void 0,handleSelect:c=>$(r,c.target),options:G(l),value:d}):l==null?void 0:l.map(c=>{const v={key:c.id,id:c.id,name:r,value:c.value,label:c.label,groupAriaLabel:u,selected:d===c.id,outOfStock:!c.inStock,required:e===null?!0:e,onValue:()=>{g(r,c.label,c.id)}};switch(a){case"text":return h(D,{...v,label:c.label});case"image":return h(B,{...v,src:c.value,alt:c.label,imageNode:O});case"color":return h(y,{...v,size:"large",color:c.value});default:return console.warn(`Invalid swatch type ${a}`),null}})}),[k,g,$]);return h("div",{...q,className:P(["pdp-swatches",L]),children:t==null?void 0:t.map(({type:l,label:r,id:e,multiple:a,required:d,items:u})=>{var c;return F.includes(l)||console.warn(`Invalid swatch type ${l}`),a&&console.warn("Multiple selection swatches are not currently supported."),M("div",{id:`swatch-item-${e}`,"data-slot-key":`product-swatch--${e}`,className:"pdp-swatches__field",children:[h("div",{className:"pdp-swatches__field__label",children:S[e]?s?`${r}`:`${r}: ${S[e].label}`:r}),h(J,{id:e,type:l,required:d,items:u,label:r,selected:(c=S[e])==null?void 0:c.value})]},`swatch-item-${e}`)})})};export{I as S};
