/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as H,jsx as n,Fragment as q}from"@dropins/tools/preact-jsx-runtime.js";import{h as ee,a as te}from"../chunks/errors.js";import{classes as x,VComponent as ne,Slot as re}from"@dropins/tools/lib.js";import{s as oe,t as ie}from"../chunks/setShippingMethods.js";import{events as W}from"@dropins/tools/event-bus.js";import{W as se,h as z,g as ce}from"../chunks/ConditionalWrapper.js";import{n as ae,g as A}from"../chunks/values.js";/* empty css                       */import{Skeleton as le,SkeletonRow as B,IllustratedMessage as ue,Icon as pe,InLineAlert as de,RadioButton as he,Price as F,ToggleButton as me}from"@dropins/tools/components.js";import{s as fe}from"../chunks/dom.js";import{useRef as ge,useEffect as T,useState as w,useCallback as k,useMemo as ke}from"@dropins/tools/preact-hooks.js";import*as a from"@dropins/tools/preact-compat.js";import{useText as $}from"@dropins/tools/i18n.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/synchronizeCheckout.js";import"../fragments.js";const ve=i=>a.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...i},a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M2.47266 4.90002H15.1851V10.9645H21.2495L23 12.715V17.6124H20.073",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M15.1758 5.87573H19.0019L21.0394 10.7636",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M9.76151 16.7898C9.76151 18.0525 8.72845 19.076 7.46582 19.076C6.20318 19.076 5.17969 18.0429 5.17969 16.7803C5.17969 15.5176 6.20318 14.4941 7.46582 14.4941C8.72845 14.4941 9.75195 15.5176 9.76151 16.7803C9.76151 16.7803 9.76151 16.7803 9.76151 16.7898Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.8726 16.7898C19.8726 18.062 18.8491 19.0855 17.5769 19.0855C16.3047 19.0855 15.2812 18.062 15.2812 16.7898C15.2812 15.5176 16.3047 14.4941 17.5769 14.4941C18.8491 14.4941 19.8726 15.5176 19.8726 16.7898Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M8.08792 7.63574H1.69824",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M7.11229 10.3619H1",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M5.16084 13.0402H1.92773",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M9.76172 16.7611H15.2809",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M2.38672 16.7611H5.17025",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),Ee=()=>H(le,{"data-testid":"shipping-methods-skeleton",children:[n(B,{size:"small",variant:"heading"}),n(B,{size:"small",variant:"empty"}),n(B,{fullWidth:!0,size:"medium"}),n(B,{fullWidth:!0,size:"medium"})]}),Se=({className:i,busy:t=!1,onSelectionChange:u=()=>{},options:v,selection:d,title:l,UIComponentType:p="RadioButton",error:h=null,onDismissError:V=()=>{},...R})=>{const E=$({EmptyState:"Checkout.ShippingMethods.emptyState"}),S=h!==null,C=ge(null);T(()=>{S&&C.current&&fe(C.current)},[S]);const j=(r,P)=>{const M={busy:t,className:"checkout-shipping-methods__method",key:r.value,name:"shipping-method",value:r.value,onChange:()=>u(r)};return P==="RadioButton"?n(he,{...M,checked:(d==null?void 0:d.value)===r.value,"data-testid":"shipping-method-radioButton",description:r.title,disabled:t,id:r.value,label:H(q,{children:[n(F,{amount:r.amount.value,currency:r.amount.currency}),"Â ",n("span",{children:r.carrier.title})]})}):n(me,{...M,"data-testid":"shipping-method-toggleButton",label:H(q,{children:[n("span",{children:r.carrier.title}),n(F,{amount:r.amount.value,currency:r.amount.currency})]}),selected:(d==null?void 0:d.value)===r.value})};return H("div",{...R,className:x(["checkout-shipping-methods",i]),"data-testid":"checkout-shipping-methods",children:[l&&n(ne,{className:"checkout-shipping-methods__title",node:l}),n("div",{className:x(["checkout-shipping-methods__content"]),children:n("div",{className:x(["checkout-shipping-methods__options",["checkout-shipping-methods__options--busy",t],["checkout-shipping-methods__options--toggleButton",p==="ToggleButton"]]),"data-testid":"checkout-shipping-methods-options",children:v.length===0?n(ue,{"data-testid":"checkout-shipping-methods-empty",icon:n(pe,{source:ve}),message:n("p",{children:E.EmptyState})}):v.map(r=>j(r,p))})}),S&&n("div",{ref:C,className:"checkout-shipping-methods__error","data-testid":"checkout-shipping-methods-alert",children:n(de,{heading:h,type:"error",variant:"primary",onDismiss:V})})]})},Ce=se(Se,Ee);function Me(i,t){return i?t.some(u=>D(u,i)):!1}function D(i,t){return!i||!t||i.amount.value!==t.amount.value?!1:i.code===t.code&&i.carrier.code===t.carrier.code}function Le(i){const t=W.lastPayload("shipping/estimate");t&&W.emit("shipping/estimate",{...t,shippingMethod:ie(i)})}const Ie=({UIComponentType:i="RadioButton",active:t=!0,autoSync:u=!0,displayTitle:v=!0,initialData:d,slots:l,onCartSyncError:p,onSelectionChange:h,...V})=>{const[R,E]=w(null),[S,C]=w(!1),[j,r]=w(),[P,M]=w(null),G=ee.value,J=te.value,{cartSyncError:I,defaultTitle:N}=$({cartSyncError:"Checkout.ShippingMethods.cartSyncError",defaultTitle:"Checkout.ShippingMethods.title"}),K=k(()=>{E(null)},[]),c=k(e=>{E(null),M(o=>D(o,e)?o:(ae({selectedShippingMethod:e}),e))},[]),L=k(async(e,o)=>{if(!u||!z())return;const s={method_code:e.code,carrier_code:e.carrier.code};oe([s]).catch(m=>{c(o??null),p==null||p({method:e,error:m}),p||E(I)})},[u,c,p,I]),Q=k(async e=>{const o=A("selectedShippingMethod");c(e),h==null||h(e),z()||Le(e),await L(e,o)},[h,c,L]),_=k(e=>{var O;const o=!e||e.isEmpty,s=!!(e!=null&&e.isVirtual);if(o||s){C(s),c(null),r([]);return}const m=(O=e.shippingAddresses)==null?void 0:O[0];if(!m)return;const f=m.availableShippingMethods??[];if(r(f),f.length===0){c(null);return}const y=m.selectedShippingMethod??null,g=A("selectedShippingMethod"),U=Me(g,f),Y=D(g,y);if(g&&U&&!Y){L(g,y);return}if((!g||!U)&&y){c(y);return}if((!g||!U)&&!y){const Z=f[0];c(Z),u&&L(Z)}},[L,c,u]),b=k(e=>{if(e===void 0)return;const{shippingMethod:o,availableShippingMethods:s}=e,m=(s==null?void 0:s.find(f=>f.code===(o==null?void 0:o.methodCode)&&f.carrier.code===(o==null?void 0:o.carrierCode)))??null;r(s),c(m)},[c]);T(()=>{if(!t)return;const e=ce();if(e){const s=A("selectedShippingMethod");s&&M(s),_(e);return}const o=W.on("checkout/initialized",_,{eager:!0});return()=>{o==null||o.off()}},[t,_]),T(()=>{if(!t)return;const e=W.on("checkout/updated",_,{eager:!1});return()=>{e==null||e.off()}},[t,_]),T(()=>{if(!t||z())return;const e=W.on("shipping/estimate",b,{eager:!0});return()=>{e==null||e.off()}},[t,b]);const X=ke(()=>{if(v)return n(re,{name:"checkout-shipping-methods-title",slot:l==null?void 0:l.Title,children:n("h3",{children:N})})},[v,l==null?void 0:l.Title,N]);return n(Ce,{...V,UIComponentType:i,busy:G||J,error:R,initialized:j!==void 0,options:j??[],selection:P,title:X,visible:t&&!S,onDismissError:K,onSelectionChange:Q})};export{Ie as ShippingMethods,Ie as default,Le as emitShippingEstimateEvent};
//# sourceMappingURL=ShippingMethods.js.map
