/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as f,jsx as r}from"@dropins/tools/preact-jsx-runtime.js";import{useState as d,useEffect as F,useCallback as w}from"@dropins/tools/preact-compat.js";import{g as ne,a as W,d as H,u as re,b as oe}from"../chunks/deleteRequisitionListItems.js";import{Button as S,InLineAlert as Q,Pagination as se}from"@dropins/tools/components.js";/* empty css                           */import{useText as K}from"@dropins/tools/i18n.js";import"../chunks/transform-requisition-list.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/RequisitionListItemsFragment.graphql.js";const ae=({currentRequisitionList:s,loadingProducts:k,productError:V,selectedItems:R,deletingItemId:i,deleteError:q,addingToCartItemId:c,addToCartError:_,bulkAddingToCart:p,updatingQuantityItemId:a,updateQuantityError:B,onItemSelection:D,onSelectAll:$,onSelectNone:v,onAddToCart:C,onBulkAddToCart:A,onBulkDelete:z,onUpdateQuantity:x,onDeleteItem:M,onPageChange:y,loadingPage:O=!1,routeRequisitionListGrid:P})=>{var b;const u=K({actionDelete:"RequisitionList.RequisitionListView.actionDelete",statusDeleting:"RequisitionList.RequisitionListView.statusDeleting",errorDelete:"RequisitionList.RequisitionListView.errorDelete",actionDeleteSelected:"RequisitionList.RequisitionListView.actionDeleteSelected",actionSelectAll:"RequisitionList.RequisitionListView.actionSelectAll",actionSelectNone:"RequisitionList.RequisitionListView.actionSelectNone",actionAddToCart:"RequisitionList.RequisitionListView.actionAddToCart",statusAddingToCart:"RequisitionList.RequisitionListView.statusAddingToCart",errorAddToCart:"RequisitionList.RequisitionListView.errorAddToCart",successAddToCart:"RequisitionList.RequisitionListView.successAddToCart",actionAddSelectedToCart:"RequisitionList.RequisitionListView.actionAddSelectedToCart",statusBulkAddingToCart:"RequisitionList.RequisitionListView.statusBulkAddingToCart",errorUpdateQuantity:"RequisitionList.RequisitionListView.errorUpdateQuantity",successUpdateQuantity:"RequisitionList.RequisitionListView.successUpdateQuantity",actionBackToRequisitionListsOverview:"RequisitionList.RequisitionListView.actionBackToRequisitionListsOverview"});return f("div",{children:[f("h3",{children:[s.name,P&&r(S,{type:"button",variant:"secondary",onClick:P,children:u.actionBackToRequisitionListsOverview})]}),q&&r(Q,{type:"error",variant:"primary",heading:q,"data-testid":"requisition-list-view-delete-error"}),_&&r(Q,{type:"error",variant:"primary",heading:_,"data-testid":"requisition-list-view-add-to-cart-error"}),B&&r(Q,{type:"error",variant:"primary",heading:B,"data-testid":"requisition-list-view-update-quantity-error"}),V&&r(Q,{type:"error",variant:"primary",heading:V,"data-testid":"requisition-list-view-product-error"}),f("div",{class:"requisition-list-view__bulk-actions",children:[r(S,{type:"button",variant:"secondary",onClick:$,disabled:i!==null||c!==null||p||a!==null,children:u.actionSelectAll}),r(S,{type:"button",variant:"secondary",onClick:v,disabled:i!==null||c!==null||p||a!==null,children:u.actionSelectNone}),R.size>0&&r(S,{type:"button",variant:"primary",onClick:A,disabled:i!==null||c!==null||p||a!==null,children:p?u.statusBulkAddingToCart:`${u.actionAddSelectedToCart} (${R.size})`}),R.size>0&&r(S,{type:"button",variant:"secondary",onClick:z,disabled:i!==null||c!==null||p||a!==null,children:i==="bulk"?u.statusDeleting:`${u.actionDeleteSelected} (${R.size})`})]}),k&&r("div",{children:"Loading products..."}),!k&&s&&f("div",{children:[f("h4",{children:["Requisition List Items (",s.items_count||0,")"]}),r("ul",{children:(b=s==null?void 0:s.items)==null?void 0:b.map(n=>f("li",{className:"requisition-list-view__item",children:[r("input",{type:"checkbox",checked:R.has(n.uid),onChange:g=>D(n.uid,g.target.checked),disabled:i!==null||c!==null||p||a!==null}),f("div",{className:"item-info",children:[f("div",{children:[r("strong",{children:"Item UID:"})," ",n.uid]}),n.product&&f("div",{className:"product-info",children:[f("div",{children:[r("strong",{children:"SKU:"})," ",n.product.sku," ",r("strong",{children:n.product.name})]}),n.product.images&&n.product.images.length>0&&r("div",{children:r("img",{src:n.product.images[0].url,alt:n.product.images[0].label,style:{maxWidth:"50px",maxHeight:"50px",margin:"2px"}},0)})]})]}),r("input",{type:"number",min:"1",value:n.quantity,onChange:g=>{const E=parseInt(g.currentTarget.value,10);E>0&&E!==n.quantity&&x(n.uid,E)},disabled:a===n.uid||i!==null||c!==null||p,"data-testid":`quantity-input-${n.uid}`}),r(S,{type:"button",variant:"primary",onClick:()=>C(n.uid),disabled:c===n.uid||i!==null||p||a!==null,"data-testid":"requisition-list-view-add-to-cart-button",children:c===n.uid?u.statusAddingToCart:u.actionAddToCart}),r(S,{type:"button",variant:"secondary",onClick:()=>M(n.uid),disabled:i===n.uid||c!==null||p||a!==null,"data-testid":"requisition-list-view-delete-item-button",children:i===n.uid?u.statusDeleting:u.actionDelete})]},n.uid))}),s.page_info&&s.page_info.total_pages>1&&r("div",{className:"requisition-list-view__pagination",children:r(se,{totalPages:s.page_info.total_pages,currentPage:s.page_info.current_page,onChange:y,disabled:O||k})})]})]})},qe=({requisitionList:s,routeRequisitionListGrid:k,skipProductLoading:V=!1,pageSize:R=10})=>{const[i,q]=d(s),[c,_]=d(!1),[p,a]=d(null),[B,D]=d(null),[$,v]=d(null),[C,A]=d(new Set),[z,x]=d(null),[M,y]=d(null),[O,P]=d(!1),[u,b]=d(null),[n,g]=d(null),[E,j]=d(!1),o=K({errorDelete:"RequisitionList.RequisitionListView.errorDelete",errorAddToCart:"RequisitionList.RequisitionListView.errorAddToCart",errorUpdateQuantity:"RequisitionList.RequisitionListView.errorUpdateQuantity",errorLoadingProducts:"RequisitionList.RequisitionListView.errorLoadingProducts"});F(()=>{q(s),A(new Set)},[s]);const m=w(async e=>{var h,l;const t=((h=e.items)==null?void 0:h.map(L=>L.sku))||[];if(t.length===0)return e;_(!0),a(null);try{const L=await ne(t);if(L){const U=new Map;return L.forEach(T=>{U.set(T.sku,T)}),{...e,items:(l=e.items)==null?void 0:l.map(T=>({...T,product:U.get(T.sku)||T.product}))}}return a("No products found"),e}catch(L){return a(L instanceof Error?L.message:o.errorLoadingProducts),e}finally{_(!1)}},[o.errorLoadingProducts]);F(()=>{if(V)return;(async()=>{const t=await m(s);q(t)})()},[s,m,V]);const J=w((e,t)=>{A(h=>{const l=new Set(h);return t?l.add(e):l.delete(e),l})},[]),X=w(()=>{var t;const e=((t=i.items)==null?void 0:t.map(h=>h.uid))||[];A(new Set(e))},[i.items]),Y=w(()=>{A(new Set)},[]),Z=w(async e=>{x(e),y(null);try{const t=await W(i.uid,[e]);t&&t.length>0?y(o.errorAddToCart):y(null)}catch(t){y(t instanceof Error?t.message:o.errorAddToCart)}finally{x(null)}},[i.uid,o.errorAddToCart]),G=w(async()=>{P(!0),y(null);try{const e=await W(i.uid,Array.from(C));e&&e.length>0?y(o.errorAddToCart):(y(null),A(new Set))}catch(e){y(e instanceof Error?e.message:o.errorAddToCart)}finally{P(!1)}},[i.uid,C,o.errorAddToCart]),I=w(async()=>{D("bulk"),v(null);try{const e=await H(i.uid,Array.from(C));e?(q(e),A(new Set)):v(o.errorDelete)}catch(e){v(e instanceof Error?e.message:o.errorDelete)}finally{D(null)}},[i.uid,C,o.errorDelete]),ee=w(async(e,t)=>{var h;b(e),g(null);try{const l=(h=i.items)==null?void 0:h.find(N=>N.uid===e);if(!l){g(o.errorUpdateQuantity);return}const L={item_id:l.uid,entered_options:l.entered_options,selected_options:l.selected_options,quantity:t},U=await re(i.uid,[L]);if(U){const N=await m(U);q(N),g(null)}else g(o.errorUpdateQuantity)}catch(l){g(l instanceof Error?l.message:o.errorUpdateQuantity)}finally{b(null)}},[i.uid,i.items,o.errorUpdateQuantity,m]),te=w(async e=>{D(e),v(null);try{const t=await H(i.uid,[e]);t?q(t):v(o.errorDelete)}catch(t){v(t instanceof Error?t.message:o.errorDelete)}finally{D(null)}},[i.uid,o.errorDelete]),ie=w(async e=>{j(!0),a(null);try{const t=await oe(i.uid,e,R);if(t){const h=await m(t);q(h)}else a("Failed to load page")}catch(t){a(t instanceof Error?t.message:"Failed to load page")}finally{j(!1)}},[i.uid,m,R]);return r(ae,{currentRequisitionList:i,loadingProducts:c,productError:p,selectedItems:C,deletingItemId:B,deleteError:$,addingToCartItemId:z,addToCartError:M,bulkAddingToCart:O,updatingQuantityItemId:u,updateQuantityError:n,onItemSelection:J,onSelectAll:X,onSelectNone:Y,onAddToCart:Z,onBulkAddToCart:G,onBulkDelete:I,onUpdateQuantity:ee,onDeleteItem:te,onPageChange:ie,loadingPage:E,routeRequisitionListGrid:k})};export{qe as RequisitionListView,qe as default};
//# sourceMappingURL=RequisitionListView.js.map
