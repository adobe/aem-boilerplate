/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsx as n}from"@dropins/tools/preact-jsx-runtime.js";import{useRef as g,useEffect as v}from"@dropins/tools/preact-compat.js";import{u as I,s as L,p as M,D as S,f as $}from"../chunks/localizedError.js";import{a as c}from"../chunks/location.js";import{useState as R}from"@dropins/tools/preact-hooks.js";import{useText as k}from"@dropins/tools/i18n.js";import"@dropins/tools/signals.js";import"../chunks/en_US.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/lib.js";const d="payment-services_apple-pay-container";function x(t){const e=M.value;switch(t){case c.CHECKOUT:return e==null?void 0:e.checkout;case c.PRODUCT_DETAIL:return e==null?void 0:e.productDetail;default:throw new Error(`Unsupported location: ${t}`)}}const W=({location:t,getCartId:e,createCart:r,onButtonClick:y,onSuccess:h,onError:u,hidden:C,disabled:m})=>{if(!e&&!r||e&&r)throw new Error("Either getCartId or createCart must be provided and not both.");const s=x(t),[f,_]=R(null),o=g(null),A=I(),b=g(!!m),{methodNotAvailableMessage:E,methodNotLoadedMessage:D,methodLoadingMessage:T}=k({methodNotAvailableMessage:"PaymentServices.messages.methodNotAvailable",methodNotLoadedMessage:"PaymentServices.messages.methodNotLoaded",methodLoadingMessage:"PaymentServices.messages.methodLoading"});v(()=>{let i=null;if(!(s!=null&&s.Payment.ApplePay.isAvailable())||!o.current)return;const P=`apple-pay-${Math.random().toString(36).slice(2,11)}`;o.current.id=P;const N=async()=>{if(e)return e();const a=r.getCartItems();if(!a)throw new Error("No items found to be added to the cart.");return i=s._Utils.addProductsToNewCart(F(a)),(await i).cartId},O=()=>{i!==null&&i.then(async({cartId:a})=>{await s._Utils.setCartAsInactive(a)}).catch(console.error)},U={getCartId:N,useApplePayShippingAddress:t===c.PRODUCT_DETAIL,useApplePayBillingAddress:t===c.PRODUCT_DETAIL,onSuccess:h,onError:a=>{u===void 0?console.error(a):u($("ApplePay",a))},buttonLanguage:{locale:w(A)},container:`#${P}`,onButtonClick:y,onCancel:O,disabled:b.current};let p=null;return s.Payment.ApplePay.render(U).then(a=>{p=a,_(p)}).catch(a=>{console.error("Apple Pay render failed:",a)}),()=>{p&&p.teardown()}},[s,t,e,r,h,u,y,A]),v(()=>{f&&f.setDisabled(!!m)},[f,m]);const l={display:C?"none":"block"};return s&&!s.Payment.ApplePay.isAvailable()?n("div",{ref:o,class:d,style:l,children:n("div",{class:"apple-pay-error",children:E})}):L.value==="error"?n("div",{ref:o,class:d,style:l,children:n("div",{class:"apple-pay-error",children:D})}):L.value==="initializing"?n("div",{ref:o,class:d,style:l,children:n("div",{class:"apple-pay-loading",children:T})}):n("div",{ref:o,class:d,style:l})};function F(t){return t.map(e=>({sku:e.sku,quantity:e.quantity,parent_sku:e.parentSku,selected_options:e.selectedOptions,entered_options:e.enteredOptions}))}function w(t){const e=t.split("_");if(e.length<2){const r=w(S);return console.warn(`Cannot map elsie locale "${t}" to apple pay button locale. Falling back to "${r}".`),r}return`${e[0]}-${e[1]}`}export{W as ApplePay,W as default};
//# sourceMappingURL=ApplePay.js.map
