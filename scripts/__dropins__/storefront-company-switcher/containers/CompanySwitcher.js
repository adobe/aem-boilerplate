/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as h}from"@dropins/tools/preact-jsx-runtime.js";import{useState as f,useCallback as p,useEffect as x,useMemo as I}from"@dropins/tools/preact-hooks.js";import{Picker as w}from"@dropins/tools/components.js";import{events as l}from"@dropins/tools/event-bus.js";import{C as S,e as H,c as g,u as K,h as k}from"../chunks/customerCompanyContext.js";import"@dropins/tools/lib.js";import"@dropins/tools/fetch-graphql.js";const G=()=>{const[c,r]=f([]),[i,a]=f({text:"",value:""}),C=p(async()=>{var e,n;try{const o=await S.getInstance().getCustomerCompanyInfo();r(o.customerCompanies),(e=o.currentCompany)!=null&&e.name&&((n=o.currentCompany)!=null&&n.id)&&a({text:o.currentCompany.name,value:o.currentCompany.id})}catch(t){console.error("Failed to load company data:",t)}},[]),u=p(async e=>{const t=e.target.value,o=c.find(v=>v.value===t);o&&a(o),H().setCompanyHeaders(t),t?sessionStorage.setItem(g.getConfig().companySessionStorageKey,t):sessionStorage.removeItem(g.getConfig().companySessionStorageKey);const d=await K();k().setGroupHeaders(d),d?sessionStorage.setItem(g.getConfig().groupSessionStorageKey,d):sessionStorage.removeItem(g.getConfig().groupSessionStorageKey),l.emit("companyContext/changed",t)},[c]),s=p(()=>{S.getInstance().resetCache(),r([]),a({text:"",value:""})},[]),y=p(e=>{e?C():s()},[C,s]),m=p(e=>{if(!e){s();return}r(n=>{const t=n.find(o=>o.value===e);return t&&a(t),n})},[s,r,a]);return x(()=>{const e=l.on("authenticated",y,{eager:!0}),n=l.on("companyContext/changed",m,{eager:!0});return()=>{var t,o;(t=e==null?void 0:e.off)==null||t.call(e),(o=n==null?void 0:n.off)==null||o.call(n)}},[y,m]),{companies:c,currentCompany:i,handleCompanyChange:u}},P=({ariaLabel:c,...r})=>{const{companies:i,currentCompany:a,handleCompanyChange:C}=G(),[u,s]=f(!0),y=I(()=>i,[i]);return x(()=>{const m=l.on("checkout/initialized",()=>{s(!1)});return()=>m==null?void 0:m.off()},[]),i.length<2||!u?null:h("div",{...r,children:h(w,{options:y,value:a.value,onChange:C,"aria-label":c||"Select company","aria-describedby":"company-switcher-description"})})};export{P as CompanySwitcher,P as default,G as useCompanyData};
//# sourceMappingURL=CompanySwitcher.js.map
