/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as a,jsxs as p,Fragment as pe}from"@dropins/tools/preact-jsx-runtime.js";import{useState as l,useEffect as ne,useCallback as s,useMemo as h,useRef as Sa,createPortal as x}from"@dropins/tools/preact-compat.js";import{classes as d,VComponent as I,Slot as D}from"@dropins/tools/lib.js";import{f as Oe}from"../chunks/dateUtils.js";import{events as Da}from"@dropins/tools/event-bus.js";import{Skeleton as La,SkeletonRow as W,InLineAlert as L,Modal as Ea,Input as ue,Button as k,TextArea as Ia,Icon as ee}from"@dropins/tools/components.js";import{N as Ge}from"../chunks/transform-quote-template.js";import{S as wa,A as ka,T as Ha,R as Ba}from"../chunks/RenameQuoteModal.js";/* empty css                              */import"@dropins/tools/preact.js";import"@dropins/tools/preact-hooks.js";import{C as ae}from"../chunks/ConfirmationModal.js";/* empty css                        *//* empty css                          */import{a as U,S as ge}from"../chunks/WarningFilled.js";import{useText as fe}from"@dropins/tools/i18n.js";import"../chunks/state.js";import{d as Fa,c as Aa,s as xa,a as Wa,o as Ua}from"../chunks/openQuoteTemplate.js";import{g as Oa}from"../chunks/generateQuoteFromTemplate.js";import{S as Ga}from"../chunks/ShippingAddressDisplay.js";import{I as $a}from"../chunks/ItemsQuotedTemplate.js";import{Q as za}from"../chunks/QuoteTemplateCommentsList.js";import{Q as Pa}from"../chunks/QuoteTemplateHistoryLog.js";import"../chunks/transform-quote.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/NegotiableQuoteTemplateFragment.js";import"../chunks/LineItemNoteModal.js";import"../chunks/addQuoteTemplateLineItemNote.js";import"../chunks/QuoteCommentsList.js";import"../chunks/QuoteHistoryLog.js";const ja=({className:n,loading:u,templateName:c,templateStatus:q,banner:e,details:T,actionBar:Q,referenceDocuments:b,itemsTable:M,shippingInformationTitle:m,shippingInformation:r,commentsTitle:v,comments:g,footer:N,...y})=>u?a(Va,{}):p("div",{...y,className:d(["quote-management-manage-negotiable-quote-template",n]),children:[p("div",{className:d(["quote-management-manage-negotiable-quote-template__header"]),children:[c&&a(I,{node:c,className:d(["quote-management-manage-negotiable-quote-template__template-name"])}),q&&a(I,{node:q,className:d(["quote-management-manage-negotiable-quote-template__template-status"])})]}),e&&a(I,{node:e,className:d(["quote-management-manage-negotiable-quote-template__banner"])}),T&&a(I,{node:T,className:d(["quote-management-manage-negotiable-quote-template__details"])}),Q&&a(I,{node:Q,className:d(["quote-management-manage-negotiable-quote-template__action-bar"])}),b&&a("div",{"data-testid":"reference-documents-container",className:d(["quote-management-manage-negotiable-quote-template__reference-documents-container"]),children:a(I,{node:b,className:d(["quote-management-manage-negotiable-quote-template__reference-documents"])})}),M&&a(I,{node:M,className:d(["quote-management-manage-negotiable-quote-template__items-table"])}),p("div",{"data-testid":"template-shipping-information-container",className:d(["quote-management-manage-negotiable-quote-template__shipping-information-container"]),children:[m&&a(I,{node:m,className:d(["quote-management-manage-negotiable-quote-template__shipping-information-title"])}),r&&a(I,{node:r,className:d(["quote-management-manage-negotiable-quote-template__shipping-information"])})]}),p("div",{"data-testid":"comments-container",className:d(["quote-management-manage-negotiable-quote-template__comments-container"]),children:[v&&a(I,{node:v,className:d(["quote-management-manage-negotiable-quote-template__comments-title"])}),g&&a(I,{node:g,className:d(["quote-management-manage-negotiable-quote-template__comments"])})]}),N&&a(I,{node:N,className:d(["quote-management-manage-negotiable-quote-template__footer"])})]}),Va=()=>p(La,{"data-testid":"manage-negotiable-quote-template-skeleton",children:[a(W,{variant:"heading",fullWidth:!0,size:"large"}),a(W,{variant:"row",fullWidth:!1,size:"small"}),a(W,{variant:"row",fullWidth:!1,size:"small"}),a(W,{variant:"row",fullWidth:!0}),a(W,{variant:"row",fullWidth:!0,size:"xlarge",lines:2}),a(W,{variant:"row",fullWidth:!1,size:"small"})]}),Ja=({className:n,open:u,document:c,errorMessage:q,errorBanner:e,successBanner:T,showCloseButton:Q=!0,isSubmitting:b=!1,onSave:M,onClose:m})=>{const[r,v]=l(""),[g,N]=l(""),[y,w]=l(""),[_,R]=l({}),C=fe({title:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.title",documentNameLabel:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.documentNameLabel",documentIdentifierLabel:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.documentIdentifierLabel",referenceUrlLabel:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.referenceUrlLabel",addButton:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.addButton",updateButton:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.updateButton",cancelButton:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.cancelButton",documentNameRequired:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.documentNameRequired",documentIdentifierRequired:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.documentIdentifierRequired",referenceUrlRequired:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.referenceUrlRequired",invalidUrl:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.invalidUrl",errorHeading:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.errorHeading"}),H=e||(q?a(L,{type:"error",variant:"primary",icon:a(U,{}),heading:C.errorHeading,description:q,"data-testid":"reference-document-form-modal-error-banner-inline"}):null),A=!!c;ne(()=>{u&&(c?(v(c.name||""),N(c.identifier||""),w(c.url||"")):(v(""),N(""),w("")),R({}))},[u,c]);const S=s(f=>{if(!f.trim())return!1;try{return new URL(f),!0}catch{return!1}},[]),te=s(()=>{const f={};if(r.trim()||(f.documentName=C.documentNameRequired),y.trim()?S(y.trim())||(f.referenceUrl=C.invalidUrl):f.referenceUrl=C.referenceUrlRequired,g.trim()||(f.documentIdentifier=C.documentIdentifierRequired),Object.keys(f).length>0){R(f);return}M({uid:c==null?void 0:c.uid,name:r.trim(),identifier:g.trim(),url:y.trim()})},[r,g,y,c,C,S,M]),B=s(()=>{v(""),N(""),w(""),R({}),m==null||m()},[m]);return u?p(Ea,{open:u,size:"medium",title:a(pe,{children:C.title}),onClose:B,clickToDismiss:!0,escapeToDismiss:!0,showCloseButton:Q,className:d(["quote-management-reference-document-form-modal",n]),"data-testid":"reference-document-form-modal",children:[H&&a("div",{className:d(["quote-management-reference-document-form-modal__error-banner"]),"data-testid":"reference-document-form-modal-error-banner",children:H}),T&&a("div",{className:d(["quote-management-reference-document-form-modal__success-banner"]),"data-testid":"reference-document-form-modal-success-banner",children:T}),p("div",{className:d(["quote-management-reference-document-form-modal__content"]),children:[p("div",{children:[a(ue,{name:"documentName",type:"text",value:r,onInput:f=>{v(f.target.value),R({..._,documentName:void 0})},floatingLabel:C.documentNameLabel,required:!0,error:!!_.documentName,disabled:b,"data-testid":"reference-document-name-input"}),_.documentName&&a("span",{className:d(["quote-management-reference-document-form-modal__error-text"]),"data-testid":"reference-document-name-error",children:_.documentName})]}),p("div",{children:[a(ue,{name:"documentIdentifier",type:"text",value:g,onInput:f=>{N(f.target.value),R({..._,documentIdentifier:void 0})},floatingLabel:C.documentIdentifierLabel,error:!!_.documentIdentifier,disabled:b,"data-testid":"reference-document-identifier-input"}),_.documentIdentifier&&a("span",{className:d(["quote-management-reference-document-form-modal__error-text"]),"data-testid":"reference-document-identifier-error",children:_.documentIdentifier})]}),p("div",{children:[a(ue,{name:"referenceUrl",type:"url",value:y,onInput:f=>{w(f.target.value),R({..._,referenceUrl:void 0})},floatingLabel:C.referenceUrlLabel,required:!0,error:!!_.referenceUrl,disabled:b,"data-testid":"reference-document-url-input"}),_.referenceUrl&&a("span",{className:d(["quote-management-reference-document-form-modal__error-text"]),"data-testid":"reference-document-url-error",children:_.referenceUrl})]})]}),p("div",{className:d(["quote-management-reference-document-form-modal__actions"]),children:[a(k,{variant:"secondary",size:"medium",onClick:B,disabled:b,className:d(["quote-management-reference-document-form-modal__cancel-button"]),"data-testid":"reference-document-form-cancel-button",children:C.cancelButton}),a(k,{variant:"primary",size:"medium",onClick:te,disabled:b,className:d(["quote-management-reference-document-form-modal__save-button"]),"data-testid":"reference-document-form-save-button",children:A?C.updateButton:C.addButton})]})]}):null},Ka=({className:n,documents:u,isEditable:c=!1,onAdd:q,onEdit:e,onRemove:T,...Q})=>{const b=fe({add:"NegotiableQuoteTemplate.Manage.referenceDocuments.add",edit:"NegotiableQuoteTemplate.Manage.referenceDocuments.edit",remove:"NegotiableQuoteTemplate.Manage.referenceDocuments.remove",noReferenceDocuments:"NegotiableQuoteTemplate.Manage.referenceDocuments.noReferenceDocuments"}),M=r=>r.identifier?`${r.name}, ${r.identifier}`:`${r.name} ${r.url}`,m=(r,v)=>{r.preventDefault(),window.open(v,"_blank","noopener,noreferrer")};return a("div",{className:d(["quote-management-reference-documents-list",n]),"data-testid":"reference-documents-list",...Q,children:p("div",{className:"quote-management-reference-documents-list__content",children:[u.map(r=>p("div",{className:"quote-management-reference-documents-list__document","data-testid":`reference-document-${r.uid||r.url}`,children:[a("a",{href:r.url,onClick:v=>m(v,r.url),className:"quote-management-reference-documents-list__document-link",target:"_blank",rel:"noopener noreferrer","data-testid":`reference-document-link-${r.uid||r.url}`,children:M(r)}),c&&p("div",{className:"quote-management-reference-documents-list__document-actions",children:[a(k,{variant:"tertiary",onClick:()=>e==null?void 0:e(r),className:"quote-management-reference-documents-list__edit-button","data-testid":`reference-document-edit-${r.uid||r.url}`,children:b.edit}),a("span",{className:"quote-management-reference-documents-list__separator",children:"|"}),a(k,{variant:"tertiary",onClick:()=>T==null?void 0:T(r),className:"quote-management-reference-documents-list__remove-button","data-testid":`reference-document-remove-${r.uid||r.url}`,children:b.remove})]})]},r.uid||r.url)),c&&p(k,{variant:"tertiary",onClick:q,className:"quote-management-reference-documents-list__add-button","data-testid":"reference-documents-add-button",children:["+ ",b.add]}),u.length===0&&!c&&a("div",{className:"quote-management-reference-documents-list__empty",children:b.noReferenceDocuments})]})})},Xa=n=>{const{templateReferenceDocuments:u,localReferenceDocuments:c}=n,q=s(m=>{if(u)return u.find(r=>m.uid&&r.uid?r.uid===m.uid:r.url===m.url)},[u]),e=s(m=>q(m)!==void 0,[q]),T=s((m,r)=>m.name!==r.name||m.identifier!==r.identifier||m.url!==r.url,[]),Q=s(()=>u?c.filter(m=>!u.some(r=>m.uid&&r.uid?r.uid===m.uid:r.url===m.url)):c,[u,c]),b=s(()=>c.map(m=>({uid:m.uid,name:m.name,identifier:m.identifier,url:m.url})),[c]),M=h(()=>u?c.some(g=>q(g)===void 0)||u.some(g=>!c.some(N=>N.uid&&g.uid?N.uid===g.uid:N.url===g.url))?!0:c.some(g=>{const N=q(g);return N?T(g,N):!1}):c.length>0,[u,c,q,T]);return{isDocumentInTemplateData:e,getNewDocuments:Q,getReferenceDocumentLinks:b,hasUnsavedChanges:M}},Ya=(n={})=>{const{initialTemplateName:u,templateNameRequiredErrorMessage:c="Template name is required"}=n,[q,e]=l(!1),[T,Q]=l(""),[b,M]=l(""),[m,r]=l(""),[v,g]=l(""),[N,y]=l(""),w=s(S=>{Q(S||u||""),M(""),r(""),g(""),y(""),e(!0)},[u]),_=s(()=>{e(!1),Q(""),M(""),r(""),g(""),y("")},[]),R=s(S=>{Q(S),S.trim()&&g("")},[]),C=s(S=>{M(S)},[]),H=s(()=>T.trim()?(r(""),g(""),e(!1),!0):(g(c),!1),[T,c]),A=s(()=>{Q(""),M(""),r(""),g(""),y("")},[]);return{isRenameModalOpen:q,renameTemplateName:T,renameReason:b,renameError:m,renameTemplateNameError:v,renameSuccess:N,handleRenameClick:w,handleRenameClose:_,handleRenameTemplateNameChange:R,handleRenameReasonChange:C,handleRenameSave:H,resetRenameState:A}},In=({slots:n,onActionsButtonClick:u,onSendForReview:c,...q})=>{var Ue;const[e,T]=l(void 0),[Q,b]=l(!0),[M,m]=l(""),[r,v]=l(!1),[g,N]=l(!1),[y,w]=l(null),[_,R]=l(!1),[C,H]=l(!1),[A,S]=l(null),[te,B]=l(!1),[f,O]=l([]),[be,z]=l(!1),[P,j]=l(void 0),[$e,V]=l(null),[Me,he]=l(!1),[Ne,Te]=l(!1),[Qe,J]=l(""),[ve,K]=l(""),[Ce,qe]=l(!1),[_e,ye]=l(!1),[Re,X]=l(""),[Se,Y]=l(""),De=Sa(!1),{getReferenceDocumentLinks:Le,hasUnsavedChanges:Ee}=Xa({templateReferenceDocuments:e==null?void 0:e.referenceDocuments,localReferenceDocuments:f}),t=fe({createdLabel:"NegotiableQuoteTemplate.Manage.createdLabel",salesRepLabel:"NegotiableQuoteTemplate.Manage.salesRepLabel",expiresLabel:"NegotiableQuoteTemplate.Manage.expiresLabel",templateIdLabel:"NegotiableQuoteTemplate.Manage.templateIdLabel",actionsLabel:"NegotiableQuoteTemplate.Manage.actionsLabel",referenceDocumentsTitle:"NegotiableQuoteTemplate.Manage.referenceDocuments.title",commentsTitle:"NegotiableQuoteTemplate.Manage.comments.title",historyLogTitle:"NegotiableQuoteTemplate.Manage.historyLog.title",itemsQuotedTab:"NegotiableQuoteTemplate.Manage.tabs.itemsQuoted",commentsTab:"NegotiableQuoteTemplate.Manage.tabs.comments",historyLogTab:"NegotiableQuoteTemplate.Manage.tabs.historyLog",templateCommentsPlaceholder:"NegotiableQuoteTemplate.Manage.templateComments.placeholder",sendForReview:"NegotiableQuoteTemplate.Manage.actionButtons.sendForReview",delete:"NegotiableQuoteTemplate.Manage.actionButtons.delete",cancel:"NegotiableQuoteTemplate.Manage.actionButtons.cancel",confirmationModalDeleteTitle:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.title",confirmationModalDeleteMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.message",confirmationModalDeleteConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.confirm",confirmationModalDeleteErrorHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.errorHeading",confirmationModalDeleteErrorFallback:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.errorFallback",confirmationModalDeleteSuccessHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.successHeading",confirmationModalDeleteSuccessDescription:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.successDescription",confirmationModalCancelTitle:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.title",confirmationModalCancelMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.message",confirmationModalCancelConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.confirm",confirmationModalCancelErrorHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.errorHeading",confirmationModalCancelErrorFallback:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.errorFallback",confirmationModalCancelSuccessHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.successHeading",confirmationModalCancelSuccessDescription:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.successDescription",confirmationModalCancel:"NegotiableQuoteTemplate.Manage.confirmationModal.cancel",accept:"NegotiableQuoteTemplate.Manage.actionButtons.accept",generateQuote:"NegotiableQuoteTemplate.Manage.actionButtons.generateQuote",generateQuoteModalTitle:"NegotiableQuoteTemplate.Manage.actionButtons.generateQuote",generateQuoteModalMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.message",generateQuoteModalCancel:"NegotiableQuoteTemplate.Manage.confirmationModal.cancel",generateQuoteModalConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.confirm",generateQuoteModalConfirmLoading:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.confirmLoading",generateQuoteModalSuccessHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.successHeading",generateQuoteSuccessMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.successDescription",generateQuoteModalErrorHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.errorHeading",generateQuoteErrorFallback:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.errorFallback",acceptModalTitle:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.title",acceptModalMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.message",acceptModalCancel:"NegotiableQuoteTemplate.Manage.confirmationModal.cancel",acceptModalConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.confirm",acceptModalConfirmLoading:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.confirmLoading",acceptModalSuccessHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.successHeading",acceptSuccessMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.successDescription",acceptModalErrorHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.errorHeading",acceptErrorFallback:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.errorFallback",documentDuplicateUidError:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.duplicateUidError",renameTitle:"NegotiableQuoteTemplate.Manage.rename.title",renameTemplateNameLabel:"NegotiableQuoteTemplate.Manage.rename.templateNameLabel",renameReasonLabel:"NegotiableQuoteTemplate.Manage.rename.reasonLabel",renameButton:"NegotiableQuoteTemplate.Manage.rename.renameButton",renameCancelButton:"NegotiableQuoteTemplate.Manage.rename.cancelButton",renameErrorHeading:"NegotiableQuoteTemplate.Manage.rename.errorHeading",renameTemplateNameRequired:"NegotiableQuoteTemplate.Manage.rename.templateNameRequired",renameErrorDefault:"NegotiableQuoteTemplate.Manage.rename.errorDefault",renameSuccessHeading:"NegotiableQuoteTemplate.Manage.rename.successHeading",renameSuccessMessage:"NegotiableQuoteTemplate.Manage.rename.successMessage",shippingInformationTitle:"NegotiableQuoteTemplate.Manage.shippingInformation.title",unsavedChangesWarningHeading:"NegotiableQuoteTemplate.Manage.unsavedChangesWarningHeading",unsavedChangesWarningMessage:"NegotiableQuoteTemplate.Manage.unsavedChangesWarningMessage",shippingAddressWarningHeading:"NegotiableQuoteTemplate.Manage.shippingAddressWarningHeading",shippingAddressWarningMessage:"NegotiableQuoteTemplate.Manage.shippingAddressWarningMessage"}),{isRenameModalOpen:Ie,renameTemplateName:E,renameReason:G,renameError:re,renameTemplateNameError:ze,renameSuccess:oe,handleRenameClick:we,handleRenameClose:Pe,handleRenameTemplateNameChange:je,handleRenameReasonChange:Ve,handleRenameSave:Je,resetRenameState:ke}=Ya({initialTemplateName:e==null?void 0:e.name,templateNameRequiredErrorMessage:t.renameTemplateNameRequired}),He=h(()=>E!==""&&E!==(e==null?void 0:e.name),[E,e==null?void 0:e.name]),$=h(()=>Ee||He,[Ee,He]);ne(()=>{const o=Da.on("quote-management/quote-template-data",i=>{i.quoteTemplate&&(T(i.quoteTemplate),b(!1),m(""),v(!1),O(i.quoteTemplate.referenceDocuments||[]),ke())},{eager:!0});return()=>o==null?void 0:o.off()},[ke]),ne(()=>{e!=null&&e.referenceDocuments&&O(e.referenceDocuments)},[e==null?void 0:e.referenceDocuments]),ne(()=>{e&&e.status===Ge.UPDATED&&!De.current&&(De.current=!0,(async()=>{try{await Ua({templateId:e.id})}catch(i){console.error("Failed to auto-open quote template:",i)}})())},[e]);const Ke=s(()=>{N(!1),w(null),R(!1)},[]),Xe=s(async()=>{if(e!=null&&e.id){w(null),R(!1);try{await Fa({templateId:e.id}),R(!0),setTimeout(()=>{N(!1),R(!1)},2e3)}catch(o){const i=o.message||t.confirmationModalDeleteErrorFallback;w(i)}}},[e,t.confirmationModalDeleteErrorFallback]),Ye=s(()=>{w(null)},[]),Ze=s(()=>{R(!1)},[]),ea=s(()=>{H(!1),S(null),B(!1)},[]),aa=s(async()=>{if(e!=null&&e.id){S(null),B(!1);try{await Aa({templateId:e.id}),B(!0),setTimeout(()=>{H(!1),B(!1)},2e3)}catch(o){const i=o.message||t.confirmationModalCancelErrorFallback;S(i)}}},[e,t.confirmationModalCancelErrorFallback]),na=s(()=>{S(null)},[]),ta=s(()=>{B(!1)},[]),ie=s(async()=>{const o=Le(),i=[G.trim(),M.trim()].filter(Boolean).join(`

`).trim()||void 0,F=E&&E!==(e==null?void 0:e.name)?E:void 0;if(c){c({templateData:e,name:F,comment:i,referenceDocumentLinks:o});return}v(!0);try{await xa({templateId:e.id,name:F,comment:i,referenceDocumentLinks:o.length>0?o:void 0})}catch(Ra){console.error("Failed to send quote template for review:",Ra),v(!1)}},[e,c,M,G,E,Le]),ce=s(()=>{j(void 0),V(null),z(!0)},[]),me=s(o=>{j(o),V(null),z(!0)},[]),le=s(o=>{O(i=>i.filter(F=>F.uid!==o.uid||F.url!==o.url))},[]),ra=s(o=>{V(null),O(P?i=>i.map(F=>F.identifier===P.identifier?o:F):i=>[...i,o]),z(!1),j(void 0)},[P]),oa=s(()=>{z(!1),j(void 0),V(null)},[]),ia=s(async()=>{Te(!0),K(""),J("");try{await Oa({templateId:e.id}),J(t.generateQuoteSuccessMessage)}catch(o){console.error("Failed to generate quote from template:",o);const i=o instanceof Error?o.message:t.generateQuoteErrorFallback;K(i)}finally{Te(!1)}},[e,t.generateQuoteSuccessMessage,t.generateQuoteErrorFallback]),ca=s(()=>{he(!1),K(""),J("")},[]),ma=s(async()=>{ye(!0),Y(""),X("");try{await Wa({templateId:e.id}),X(t.acceptSuccessMessage)}catch(o){console.error("Failed to accept quote template:",o);const i=o instanceof Error?o.message:t.acceptErrorFallback;Y(i)}finally{ye(!1)}},[e,t.acceptSuccessMessage,t.acceptErrorFallback]),la=s(()=>{qe(!1),Y(""),X("")},[]),sa=h(()=>{const o=!(e!=null&&e.canSendForReview),i=E||(e==null?void 0:e.name);return a(D,{name:"TemplateName",slot:n==null?void 0:n.TemplateName,context:{templateName:e==null?void 0:e.name,templateData:e,templateDisplayName:i,isRenameDisabled:o},children:p("div",{className:"quote-management-manage-negotiable-quote-template__template-name-wrapper",children:[a("h1",{"data-testid":"template-name",className:"quote-management-manage-negotiable-quote-template__template-name-title",children:i}),a("button",{onClick:()=>we(i),disabled:o,"data-testid":"rename-template-button",className:"quote-management-manage-negotiable-quote-template__rename-button","aria-label":"Rename template",children:a(wa,{})})]})})},[n==null?void 0:n.TemplateName,e,we,E]),da=h(()=>a(D,{name:"TemplateStatus",slot:n==null?void 0:n.TemplateStatus,context:{templateStatus:e==null?void 0:e.status,templateData:e},children:a("div",{"data-testid":"template-status",children:e==null?void 0:e.status})}),[n==null?void 0:n.TemplateStatus,e]),ua=h(()=>{if(!e)return;const o=e.expirationDate?Oe(e.expirationDate,"short"):void 0;return p(D,{name:"Details",slot:n==null?void 0:n.Details,context:{templateData:e},children:[p("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[a("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"template-id-label",children:t.templateIdLabel}),a("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"template-id-value",children:e.id})]}),p("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[a("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"created-label",children:t.createdLabel}),p("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"created-value",children:[Oe(e.createdAt,"short")," (",e.buyer.firstname," ",e.buyer.lastname,")"]})]}),p("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[a("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"sales-rep-label",children:t.salesRepLabel}),a("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"sales-rep-value",children:e.salesRepName})]}),o&&p("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[a("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"expires-label",children:t.expiresLabel}),a("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"expires-value",children:o})]})]})},[n==null?void 0:n.Details,t,e]),Be=h(()=>[{label:t.generateQuote,value:"generateQuote",disabled:!(e!=null&&e.canGenerateQuoteFromTemplate)}],[t,e==null?void 0:e.canGenerateQuoteFromTemplate]),ga=h(()=>{const o=i=>{switch(i){case"generateQuote":he(!0),K(""),J(""),u==null||u(i);break}};return a(D,{name:"ActionBar",slot:n==null?void 0:n.ActionBar,context:{templateData:e},children:a(ka,{dropdownPlaceholder:t.actionsLabel,dropdownOptions:[],buttons:Be.map(i=>a(k,{variant:"tertiary",onClick:()=>o(i.value),"data-testid":`actions-bar-${i.value}-button`,"data-action":i.value,disabled:i.disabled,children:i.label},i.value))})})},[Be,t,n==null?void 0:n.ActionBar,e,u]),Z=h(()=>{const o=e==null?void 0:e.status;return o==="Draft"||o==="Open"},[e==null?void 0:e.status]),pa=h(()=>{const o=f.length>0||Z,i=o?t.referenceDocumentsTitle:void 0;return a(D,{name:"ReferenceDocuments",slot:n==null?void 0:n.ReferenceDocuments,context:{templateData:e,referenceDocuments:f,isEditable:Z,onAddDocument:ce,onEditDocument:me,onRemoveDocument:le,referenceDocumentsTitle:t.referenceDocumentsTitle},children:p("div",{"data-testid":"reference-documents",children:[o&&a("h2",{children:i}),a(Ka,{documents:f,isEditable:Z,onAdd:ce,onEdit:me,onRemove:le})]})})},[n==null?void 0:n.ReferenceDocuments,t,e,f,Z,ce,me,le]),fa=h(()=>a(D,{name:"ShippingInformationTitle",slot:n==null?void 0:n.ShippingInformationTitle,context:{templateData:e},children:a("h2",{children:t.shippingInformationTitle})}),[n==null?void 0:n.ShippingInformationTitle,e,t]),ba=h(()=>{var o;return a(D,{name:"ShippingInformation",slot:n==null?void 0:n.ShippingInformation,context:{templateData:e,loading:Q,setLoading:b},children:a(Ga,{shippingAddress:(o=e==null?void 0:e.shippingAddresses)==null?void 0:o[0],loading:Q,"data-testid":"manage-template-shipping-address"})})},[n==null?void 0:n.ShippingInformation,e,Q,b]),Ma=h(()=>a(D,{name:"ItemsTable",slot:n==null?void 0:n.ItemsTable,context:{templateData:e},children:a(Ha,{tabs:new Map([["items-quoted",t.itemsQuotedTab],["comments",t.commentsTab],["history-log",t.historyLogTab]]),tabsContent:new Map([["items-quoted",a(D,{name:"ItemsQuotedTab",slot:n==null?void 0:n.ItemsQuotedTab,context:{templateData:e},children:a($a,{templateData:e})},"items-quoted")],["comments",a(D,{name:"CommentsTab",slot:n==null?void 0:n.CommentsTab,context:{templateData:e},children:a(za,{templateData:e})},"comments")],["history-log",a(D,{name:"HistoryLogTab",slot:n==null?void 0:n.HistoryLogTab,context:{templateData:e},children:a(Pa,{templateData:e})},"history-log")]])})}),[n==null?void 0:n.ItemsTable,n==null?void 0:n.ItemsQuotedTab,n==null?void 0:n.CommentsTab,n==null?void 0:n.HistoryLogTab,t,e]),ha=h(()=>a(D,{name:"CommentsTitle",slot:n==null?void 0:n.CommentsTitle,context:{templateData:e},children:a("h2",{children:t.commentsTitle})}),[n==null?void 0:n.CommentsTitle,t,e]),Na=h(()=>a(D,{name:"Comments",slot:n==null?void 0:n.Comments,context:{templateData:e},children:a(Ia,{name:"templateComments",placeholder:t.templateCommentsPlaceholder,rows:3,value:M,onInput:o=>{m(o.target.value)},disabled:!(e!=null&&e.canSendForReview)||r})}),[n==null?void 0:n.Comments,t,e,M,r]),Fe=h(()=>$?a(L,{type:"warning",variant:"primary",icon:a(U,{}),heading:t.unsavedChangesWarningHeading,description:t.unsavedChangesWarningMessage,"data-testid":"unsaved-changes-warning-alert"}):void 0,[$,t.unsavedChangesWarningHeading,t.unsavedChangesWarningMessage]),Ae=h(()=>{var o;return(o=e==null?void 0:e.shippingAddresses)!=null&&o.length?void 0:a(L,{type:"warning",variant:"primary",icon:a(U,{}),heading:t.shippingAddressWarningHeading,description:t.shippingAddressWarningMessage,"data-testid":"shipping-address-warning-alert"})},[(Ue=e==null?void 0:e.shippingAddresses)==null?void 0:Ue.length,t.shippingAddressWarningHeading,t.shippingAddressWarningMessage]),Ta=h(()=>p(pe,{children:[Fe,Ae]}),[Fe,Ae]),Qa=h(()=>{var i;const o=(e==null?void 0:e.status)===Ge.OPEN&&(e==null?void 0:e.canAccept);return p(D,{name:"Footer",slot:n==null?void 0:n.Footer,context:{templateData:e,comment:M,isSubmitting:r,referenceDocuments:f,hasUnsavedChanges:$,handleSendForReview:ie,showAcceptButton:o,renameTemplateName:E,renameReason:G},children:[o&&a(k,{variant:"primary",onClick:()=>{qe(!0),Y(""),X("")},"data-testid":"accept-button",disabled:r||$,children:t.accept}),(e==null?void 0:e.canSendForReview)&&a(k,{variant:"primary",onClick:ie,"data-testid":"send-for-review-button",disabled:r||!((i=e==null?void 0:e.shippingAddresses)!=null&&i.length),children:t.sendForReview}),(e==null?void 0:e.canCancel)&&a(k,{variant:"tertiary",onClick:()=>H(!0),"data-testid":"cancel-template-button",disabled:r,children:t.cancel}),(e==null?void 0:e.canDelete)&&a(k,{variant:"tertiary",onClick:()=>N(!0),"data-testid":"delete-template-button",disabled:r,children:t.delete})]})},[n==null?void 0:n.Footer,t,e,M,r,ie,f,$,E,G]),va=y?a(L,{type:"error",variant:"primary",icon:a(U,{}),heading:t.confirmationModalDeleteErrorHeading,description:y,onDismiss:Ye,"data-testid":"confirmation-modal-error-banner"}):null,xe=(_?a(L,{type:"success",variant:"primary",icon:a(ge,{}),heading:t.confirmationModalDeleteSuccessHeading,description:t.confirmationModalDeleteSuccessDescription,onDismiss:Ze,"data-testid":"confirmation-modal-success-banner"}):null)||va,Ca=A?a(L,{type:"error",variant:"primary",icon:a(U,{}),heading:t.confirmationModalCancelErrorHeading,description:A,onDismiss:na,"data-testid":"confirmation-modal-cancel-error-banner"}):null,We=(te?a(L,{type:"success",variant:"primary",icon:a(ge,{}),heading:t.confirmationModalCancelSuccessHeading,description:t.confirmationModalCancelSuccessDescription,onDismiss:ta,"data-testid":"confirmation-modal-cancel-success-banner"}):null)||Ca,qa=h(()=>re?a(L,{type:"error",variant:"primary",icon:a(U,{color:"var(--color-error)"}),heading:t.renameErrorHeading,description:re}):void 0,[re,t.renameErrorHeading]),_a=h(()=>oe?a(L,{type:"success",variant:"primary",icon:a(ge,{}),heading:t.renameSuccessHeading,description:oe}):void 0,[oe,t.renameSuccessHeading]),ya={...q,loading:Q,templateName:sa,templateStatus:da,banner:Ta,details:ua,actionBar:ga,referenceDocuments:pa,itemsTable:Ma,shippingInformationTitle:fa,shippingInformation:ba,commentsTitle:ha,comments:Na,footer:Qa};let se=null;Qe?se=a(L,{type:"success",variant:"primary",icon:a(ee,{source:"CheckWithCircle"}),heading:t.generateQuoteModalSuccessHeading,description:Qe,"data-testid":"generate-quote-success-banner"}):ve&&(se=a(L,{type:"error",variant:"primary",icon:a(ee,{source:"WarningFilled"}),heading:t.generateQuoteModalErrorHeading,description:ve,"data-testid":"generate-quote-error-banner"}));let de=null;return Re?de=a(L,{type:"success",variant:"primary",icon:a(ee,{source:"CheckWithCircle"}),heading:t.acceptModalSuccessHeading,description:Re,"data-testid":"accept-success-banner"}):Se&&(de=a(L,{type:"error",variant:"primary",icon:a(ee,{source:"WarningFilled"}),heading:t.acceptModalErrorHeading,description:Se,"data-testid":"accept-error-banner"})),p(pe,{children:[a(ja,{...ya}),g&&x(a(ae,{open:g,title:t.confirmationModalDeleteTitle,message:t.confirmationModalDeleteMessage,cancelLabel:t.confirmationModalCancel,confirmLabel:t.confirmationModalDeleteConfirm,onCancel:Ke,onConfirm:Xe,showCloseButton:!xe,confirmationBanner:xe}),document.body),C&&x(a(ae,{open:C,title:t.confirmationModalCancelTitle,message:t.confirmationModalCancelMessage,cancelLabel:t.confirmationModalCancel,confirmLabel:t.confirmationModalCancelConfirm,onCancel:ea,onConfirm:aa,showCloseButton:!We,confirmationBanner:We}),document.body),be&&x(a(Ja,{open:be,document:P,errorMessage:$e||void 0,onSave:ra,onClose:oa,isSubmitting:r}),document.body),Me&&x(a(ae,{open:Me,title:t.generateQuoteModalTitle,message:t.generateQuoteModalMessage,cancelLabel:t.generateQuoteModalCancel,confirmLabel:Ne?t.generateQuoteModalConfirmLoading:t.generateQuoteModalConfirm,onCancel:ca,onConfirm:Ne?void 0:ia,showCloseButton:!0,confirmationBanner:se,"data-testid":"generate-quote-confirmation-modal"}),document.body),Ce&&x(a(ae,{open:Ce,title:t.acceptModalTitle,message:t.acceptModalMessage,cancelLabel:t.acceptModalCancel,confirmLabel:_e?t.acceptModalConfirmLoading:t.acceptModalConfirm,onCancel:la,onConfirm:_e?void 0:ma,showCloseButton:!0,confirmationBanner:de,"data-testid":"accept-confirmation-modal"}),document.body),Ie&&x(a(Ba,{open:Ie,quoteName:E,renameReason:G,quoteNameError:ze,errorBanner:qa,successBanner:_a,onQuoteNameChange:je,onRenameReasonChange:Ve,onSave:Je,onClose:Pe}),document.body)]})};export{In as ManageNegotiableQuoteTemplate,In as default};
//# sourceMappingURL=ManageNegotiableQuoteTemplate.js.map
