/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as t,jsxs as o,Fragment as G}from"@dropins/tools/preact-jsx-runtime.js";import{classes as v,VComponent as E}from"@dropins/tools/lib.js";/* empty css                 */import{Skeleton as C,SkeletonRow as ee,Input as V,Picker as te,Price as Q,Checkbox as ae,Button as F,Table as W,Accordion as ne,AccordionSection as oe,Modal as le,TextArea as ie}from"@dropins/tools/components.js";import{h as z}from"@dropins/tools/preact.js";import{useState as R,useEffect as se}from"@dropins/tools/preact-hooks.js";import{g as ue}from"./dateUtils.js";import{useText as Z}from"@dropins/tools/i18n.js";import{useState as D,useEffect as re,useCallback as O}from"@dropins/tools/preact-compat.js";const ye=({className:N,loading:c,table:a,pricesSummary:u,...i})=>c?t(ce,{}):o("div",{className:v(["quote-management-items-quoted",N]),...i,children:[a&&t(E,{node:a,className:v(["quote-management-items-quoted__table"]),"data-testid":"quote-management-items-quoted__table"}),u&&t(E,{node:u,className:v(["quote-management-items-quoted__prices-summary"]),"data-testid":"quote-management-items-quoted__prices-summary"})]}),ce=()=>t(C,{"data-testid":"items-quoted-skeleton",children:t(ee,{variant:"row",fullWidth:!0,size:"medium",lines:4,multilineGap:"xsmall"})}),ve=({className:N,items:c,canEdit:a,readOnly:u=!1,showActions:i,onItemCheckboxChange:d,onItemDropdownChange:p,onQuantityChange:k,onUpdate:M,dropdownSelections:q,..._})=>{const[T,f]=R({}),[h,b]=R({});se(()=>{const e={};c.forEach(s=>{e[s.uid]=s.quantity}),f(e),b(e)},[c]);const y=Object.keys(h).some(e=>h[e]!==T[e]),n=Z({updateButton:"NegotiableQuote.Manage.productListTable.submitButton",productNameHeader:"NegotiableQuote.Manage.productListTable.headers.productName",skuHeader:"NegotiableQuote.Manage.productListTable.headers.sku",priceHeader:"NegotiableQuote.Manage.productListTable.headers.price",quantityHeader:"NegotiableQuote.Manage.productListTable.headers.quantity",discountHeader:"NegotiableQuote.Manage.productListTable.headers.discount",subtotalHeader:"NegotiableQuote.Manage.productListTable.headers.subtotal",actionsHeader:"NegotiableQuote.Manage.productListTable.headers.actions",editNoteToSeller:"NegotiableQuote.Manage.productListTable.actions.editNoteToSeller",remove:"NegotiableQuote.Manage.productListTable.actions.remove",notesHeader:"NegotiableQuote.Manage.productListTable.notes.header",leftANote:"NegotiableQuote.Manage.productListTable.notes.leftANote",buyer:"NegotiableQuote.Manage.productListTable.notes.buyer"}),I=[{label:n.productNameHeader,key:"productName"},{label:n.skuHeader,key:"sku"},{label:n.priceHeader,key:"price"},{label:n.quantityHeader,key:"quantity"},{label:n.discountHeader,key:"discount"},{label:n.subtotalHeader,key:"subtotal"}];a&&!u&&I.unshift({label:"",key:"checkbox"}),(i??a)&&!u&&I.push({label:n.actionsHeader,key:"actions"});const j=(e,s)=>{const l=e.target.checked;d==null||d(s,l)},S=(e,s)=>{const l=e.target.value;p==null||p(s,l)},B=(e,s)=>{const l=parseInt(e.target.value,10);!isNaN(l)&&l>0&&(b(g=>({...g,[s.uid]:l})),k==null||k(s,l))},$=e=>{e.preventDefault(),M==null||M(e)},r=(e,s)=>e>0?o("div",{className:"quote-management-product-list-table__discount-container",children:[o("span",{className:"quote-management-product-list-table__discount-percent",children:[s,"%"]}),o("span",{className:"quote-management-product-list-table__discount-price",children:["(",t(Q,{amount:e}),")"]})]}):void 0,L=e=>{var g,H;const s=(g=e.configurableOptions)==null?void 0:g.map(m=>o("div",{className:"quote-management-product-list-table__configurable-option",children:[o("span",{className:"quote-management-product-list-table__configurable-option-label",children:[m.optionLabel,":"]}),t("span",{className:"quote-management-product-list-table__configurable-option-value",children:m.valueLabel})]},m.optionLabel)),l=(H=e.bundleOptions)==null?void 0:H.map(m=>o("div",{className:"quote-management-product-list-table__bundle-option",children:[t("span",{className:"quote-management-product-list-table__bundle-option-label",children:m.label}),t("div",{className:"quote-management-product-list-table__bundle-option-values",children:m.values.map(w=>o("span",{className:"quote-management-product-list-table__bundle-option-value",children:[o("span",{className:"quote-management-product-list-table__bundle-option-value-quantity",children:[w.quantity," x"]}),t("span",{className:"quote-management-product-list-table__bundle-option-value-label",children:w.label}),t(Q,{className:"quote-management-product-list-table__bundle-option-value-original-price",amount:w.originalPrice.value,currency:w.originalPrice.currency,weight:"normal"})]},w.label))})]},m.label));return o("div",{className:"quote-management-product-list-table__product-name-container",children:[t("span",{className:"quote-management-product-list-table__product-name",children:e.product.name}),s,l]})},A=e=>new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0,timeZone:ue()}),x=e=>{if(!e.noteFromBuyer||e.noteFromBuyer.length===0)return null;const s=e.noteFromBuyer.filter(l=>l&&l.note&&l.note.trim()!=="");return s.length===0?null:o("div",{className:"quote-management-product-list-table__notes-container","data-testid":`item-notes-${e.product.sku}`,children:[t("div",{className:"quote-management-product-list-table__notes-header",children:n.notesHeader}),t("div",{className:"quote-management-product-list-table__notes-list",children:s.map((l,g)=>o("div",{className:"quote-management-product-list-table__note-item",children:[o("div",{className:"quote-management-product-list-table__note-content",children:[o("strong",{className:"quote-management-product-list-table__note-meta",children:[A(l.createdAt)," (",n.buyer,")"]})," ",n.leftANote]}),o("div",{className:"quote-management-product-list-table__note-text",children:[l.note," "]})]},l.noteUid||g))})]})},J=c.flatMap(e=>{var H;const s=a?t(V,{className:"quote-management-product-list-table__quantity-input",type:"number",min:"1",value:((H=h[e.uid])==null?void 0:H.toString())||e.quantity.toString(),onChange:m=>B(m,e),disabled:u||!a,"data-testid":`quantity-input-${e.product.sku}`}):t("span",{className:"quote-management-product-list-table__quantity",children:e.quantity}),l={checkbox:t(ae,{className:"quote-management-product-list-table__checkbox",name:"itemSelected","data-testid":`item-checkbox-${e.product.sku}`,onChange:m=>j(m,e),value:e.product.sku}),productName:L(e),sku:t("span",{className:"quote-management-product-list-table__sku",children:e.product.sku}),price:t(Q,{className:"quote-management-product-list-table__price",amount:e.prices.originalItemPrice.value,currency:e.prices.originalItemPrice.currency}),quantity:s,discount:e.catalogDiscount?r(e.catalogDiscount.amountOff,e.catalogDiscount.percentOff):void 0,subtotal:t(Q,{className:"quote-management-product-list-table__subtotal",amount:e.prices.rowTotal.value,currency:e.prices.rowTotal.currency}),actions:t(te,{className:"quote-management-product-list-table__actions","data-testid":`item-dropdown-${e.product.sku}`,name:`item-dropdown-${e.product.sku}`,handleSelect:m=>S(m,e),placeholder:"Select",value:(q==null?void 0:q[e.uid])??"",options:[{text:n.editNoteToSeller,value:"edit"},{text:n.remove,value:"remove"}]})},g=x(e);return g?[l,{checkbox:"",productName:t("div",{className:"quote-management-product-list-table__notes-row-wrapper",children:g}),sku:"",price:"",quantity:"",discount:"",subtotal:"",actions:""}]:[l]}),K=t(W,{columns:I,rowData:J,"data-testid":"product-list-table",mobileLayout:"stacked"}),U=a?z("form",{}):z("div",{}),X=a?{onSubmit:$,..._}:_,Y=t(F,{type:"submit",disabled:u||!a||!y,"data-testid":"product-list-table-submit-button",children:n.updateButton});return o(E,{node:U,className:v(["quote-management-product-list-table-container",N]),"data-testid":"product-list-table-container",...X,children:[K,t("div",{className:"quote-management-product-list-table-container__submit-container",children:Y})]})},ke=({className:N,entries:c,...a})=>{const u=i=>{var p;const d=(p=i.children)==null?void 0:p.map(u);return t("div",{className:"quote-management-quote-prices-summary__entry","data-testid":`quote-prices-summary-entry-${i.id}`,children:d?t(ne,{className:"quote-management-quote-prices-summary__accordion","data-testid":`quote-prices-summary-entry-accordion-${i.id}`,children:t(oe,{className:"quote-management-quote-prices-summary__accordion-section",title:i.label,ariaLabelTitle:i.label,secondaryText:i.value,children:d})}):o(G,{children:[t("span",{className:v(["quote-management-quote-prices-summary__label",["quote-management-quote-prices-summary__label--strong",i.strong]]),"data-testid":`quote-prices-summary-entry-label-${i.id}`,children:i.label}),t("span",{className:"quote-management-quote-prices-summary__value","data-testid":`quote-prices-summary-entry-value-${i.id}`,children:i.value})]})},i.id)};return t("div",{className:v(["quote-management-quote-prices-summary",N]),"data-testid":"quote-prices-summary",...a,children:c==null?void 0:c.map(u)})},fe=({className:N,open:c,item:a,onClose:u,onConfirm:i,isSubmitting:d=!1,errorBanner:p,successBanner:k,showCloseButton:M=!0,readOnlyQuantity:q=!1})=>{const[_,T]=D(""),[f,h]=D(a.quantity),[b,y]=D({}),n=Z({title:"NegotiableQuote.Manage.lineItemNote.title",productLabel:"NegotiableQuote.Manage.lineItemNote.productLabel",skuLabel:"NegotiableQuote.Manage.lineItemNote.skuLabel",priceLabel:"NegotiableQuote.Manage.lineItemNote.priceLabel",stockLabel:"NegotiableQuote.Manage.lineItemNote.stockLabel",quantityLabel:"NegotiableQuote.Manage.lineItemNote.quantityLabel",discountLabel:"NegotiableQuote.Manage.lineItemNote.discountLabel",subtotalLabel:"NegotiableQuote.Manage.lineItemNote.subtotalLabel",noteLabel:"NegotiableQuote.Manage.lineItemNote.noteLabel",notePlaceholder:"NegotiableQuote.Manage.lineItemNote.notePlaceholder",noteHelper:"NegotiableQuote.Manage.lineItemNote.noteHelper",confirmButton:"NegotiableQuote.Manage.lineItemNote.confirmButton",cancelButton:"NegotiableQuote.Manage.lineItemNote.cancelButton",noteError:"NegotiableQuote.Manage.lineItemNote.noteError",quantityError:"NegotiableQuote.Manage.lineItemNote.quantityError"});re(()=>{var r;if(c){const L=((r=a.noteFromBuyer)==null?void 0:r.filter(x=>x&&x.note))||[],A=L.length>0?L[0].note:"";T(A||""),h(a.quantity),y({})}},[c,a.quantity,a.noteFromBuyer]);const I=O(()=>{const r={};if(_.trim()||(r.note=n.noteError),!q&&f<=0&&(r.quantity=n.quantityError),Object.keys(r).length>0){y(r);return}i(_.trim(),f)},[_,f,i,n,q]),P=O(()=>{T(""),h(a.quantity),y({}),u==null||u()},[u,a.quantity]);if(!c)return null;const S=a.discounts&&a.discounts.length>0?a.discounts.map(r=>r.label).join(", "):"-",B=[{label:n.productLabel,key:"productName"},{label:n.priceLabel,key:"price"},{label:n.stockLabel,key:"stock"},{label:n.quantityLabel,key:"quantity"},{label:n.discountLabel,key:"discount"},{label:n.subtotalLabel,key:"subtotal"}],$=[{productName:o("div",{className:"quote-management-line-item-note-modal__product-info",children:[t("div",{className:"quote-management-line-item-note-modal__product-name",children:a.product.name}),o("div",{className:"quote-management-line-item-note-modal__product-sku",children:[n.skuLabel,": ",a.product.sku]})]}),price:t(Q,{amount:a.prices.originalItemPrice.value,currency:a.prices.originalItemPrice.currency}),stock:t("span",{className:"quote-management-line-item-note-modal__stock",children:a.stockStatus}),quantity:q?t("span",{className:"quote-management-line-item-note-modal__quantity-readonly",children:a.quantity}):t(V,{name:"quantity",type:"number",min:"1",value:f.toString(),onInput:r=>{const L=parseInt(r.target.value,10)||0;h(L),y({...b,quantity:void 0})},disabled:d,error:!!b.quantity,required:!0,"data-testid":"line-item-note-quantity-input",className:"quote-management-line-item-note-modal__quantity-input"}),discount:t("span",{className:"quote-management-line-item-note-modal__discount",children:S}),subtotal:t(Q,{amount:a.prices.rowTotal.value,currency:a.prices.rowTotal.currency})}];return o(le,{open:c,size:"medium",title:t(G,{children:n.title}),onClose:P,clickToDismiss:!0,escapeToDismiss:!0,showCloseButton:M,className:v(["quote-management-line-item-note-modal",N]),"data-testid":"line-item-note-modal",children:[p&&t("div",{className:"quote-management-line-item-note-modal__error-banner","data-testid":"line-item-note-modal-error-banner",children:p}),k&&t("div",{className:"quote-management-line-item-note-modal__success-banner","data-testid":"line-item-note-modal-success-banner",children:k}),o("div",{className:"quote-management-line-item-note-modal__content",children:[o("div",{className:"quote-management-line-item-note-modal__details",children:[t(W,{columns:B,rowData:$,"data-testid":"line-item-note-table",mobileLayout:"stacked",className:"quote-management-line-item-note-modal__details-table"}),b.quantity&&t("div",{className:"quote-management-line-item-note-modal__table-error",children:b.quantity})]}),o("div",{className:"quote-management-line-item-note-modal__form-field",children:[t(ie,{name:"note",placeholder:n.notePlaceholder,rows:4,value:_,onInput:r=>{T(r.target.value),y({...b,note:void 0})},label:n.noteLabel,disabled:d,"data-testid":"line-item-note-textarea"}),!b.note&&t("span",{className:"quote-management-line-item-note-modal__helper-text",children:n.noteHelper}),b.note&&t("span",{className:"quote-management-line-item-note-modal__error-text",children:b.note})]})]}),o("div",{className:"quote-management-line-item-note-modal__actions",children:[t(F,{variant:"secondary",size:"medium",onClick:P,disabled:d,className:"quote-management-line-item-note-modal__cancel-button","data-testid":"line-item-note-cancel-button",children:n.cancelButton}),t(F,{variant:"primary",size:"medium",onClick:I,disabled:d,className:"quote-management-line-item-note-modal__confirm-button","data-testid":"line-item-note-confirm-button",children:n.confirmButton})]})]})};export{ye as I,fe as L,ve as P,ke as Q};
//# sourceMappingURL=LineItemNoteModal2.js.map
