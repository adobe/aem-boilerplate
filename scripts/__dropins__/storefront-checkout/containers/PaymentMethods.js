/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as W,jsx as t}from"@dropins/tools/preact-jsx-runtime.js";import{h as X,s as Y}from"../chunks/errors.js";import{classes as L,VComponent as ee,Slot as j}from"@dropins/tools/lib.js";import{events as A}from"@dropins/tools/event-bus.js";import{W as te,i as ne,h as oe,g as re}from"../chunks/ConditionalWrapper.js";import{n as ae,g as x}from"../chunks/values.js";import{s as ce}from"../chunks/setPaymentMethod.js";/* empty css                      */import{Skeleton as se,SkeletonRow as E,IllustratedMessage as ie,Icon as D,InLineAlert as le,ToggleButton as de,RadioButton as me}from"@dropins/tools/components.js";import{s as ue}from"../chunks/dom.js";import*as T from"@dropins/tools/preact-compat.js";import{useRef as he,useEffect as pe}from"@dropins/tools/preact-compat.js";import{useText as Z}from"@dropins/tools/i18n.js";import{useState as _,useCallback as P,useEffect as R,useMemo as fe}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";import"../fragments.js";import"../chunks/synchronizeCheckout.js";const ye=n=>T.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},T.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.93 14.8V18.75H5.97C4.75 18.75 3.75 17.97 3.75 17V6.5M3.75 6.5C3.75 5.53 4.74 4.75 5.97 4.75H15.94V8.25H5.97C4.75 8.25 3.75 7.47 3.75 6.5Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),T.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.35 11.64H14.04V14.81H19.35V11.64Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),T.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.9304 11.64V8.25H15.1504",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),ke=()=>W(se,{"data-testid":"payment-methods-skeleton",children:[t(E,{size:"medium",variant:"heading"}),t(E,{size:"medium",variant:"empty"}),t(E,{fullWidth:!0,size:"xlarge"}),t(E,{fullWidth:!0,size:"xlarge"})]}),ge=({UIComponentType:n="ToggleButton",busy:r,code:s,icon:u,onSelectionChange:o,selected:a,title:i})=>{const h={busy:r,className:"checkout-payment-methods__method",label:i,name:"payment-method",onChange:()=>o({code:s,title:i}),value:s};return n==="ToggleButton"?t(de,{...h,icon:u?t(D,{source:u}):void 0,selected:a}):t(me,{...h,checked:a,icon:u??void 0})},ve=({className:n,error:r=null,busy:s=!1,onDismissError:u,onSelectionChange:o=()=>{},options:a,paymentMethodContent:i,selection:h,title:g,UIComponentType:w})=>{const C=Z({EmptyState:"Checkout.PaymentMethods.emptyState"}),k=r!==null,v=he(null);return pe(()=>{k&&v.current&&ue(v.current)},[k]),W("div",{className:L(["checkout-payment-methods",n]),"data-testid":"checkout-payment-methods",children:[g&&t(ee,{className:"checkout-payment-methods__title",node:g}),!s&&a.length===0&&t(ie,{"data-testid":"checkout-payment-methods-empty",icon:t(D,{source:ye}),message:t("p",{children:C.EmptyState})}),W("div",{className:L(["checkout-payment-methods__wrapper",["checkout-payment-methods__wrapper--busy",s]]),"data-testid":"checkout-payment-methods-wrapper",children:[t("div",{className:L(["checkout-payment-methods__methods",["checkout-payment-methods--full-width",a.length%2!==0]]),children:a==null?void 0:a.map(p=>t(ge,{UIComponentType:w,busy:s,code:p.code,icon:p.icon,selected:(h==null?void 0:h.code)===p.code,title:p.displayLabel??!0?p.title:"",onSelectionChange:o},p.code))}),i&&t("div",{className:"checkout-payment-methods__content",children:i})]}),k&&t("div",{ref:v,className:"checkout-payment-methods__error","data-testid":"checkout-payment-methods-alert",children:t(le,{heading:r,type:"error",variant:"primary",onDismiss:u})})]})},Me=te(ve,ke);function Se(n,r){return n?r.some(s=>s.code===n.code):!1}function Pe(n,r){return!n||!r?!1:n.code===r.code}function Ce(n){return n?!!n.code&&!!n.title:!1}const Ae=({UIComponentType:n="ToggleButton",active:r=!0,autoSync:s=!0,displayTitle:u=!0,slots:o,onCartSyncError:a,onSelectionChange:i})=>{var N,O;const[h,g]=_(null),[w,C]=_(!1),[k,v]=_(null),[p,b]=_([]),l=o==null?void 0:o.Methods,$=X.value,q=p.filter(e=>{var c;return((c=l==null?void 0:l[e.code])==null?void 0:c.enabled)!==!1}).map(e=>{const c=(l==null?void 0:l[e.code])||{};return{...e,...c}}),{cartSyncError:z,defaultTitle:H}=Z({cartSyncError:"Checkout.PaymentMethods.cartSyncError",defaultTitle:"Checkout.PaymentMethods.title"}),F=P(()=>{g(null)},[]),m=P(e=>{g(null),v(e),ae({selectedPaymentMethod:e})},[]),M=P(async(e,c)=>{if(!(ne()||oe()))return;const f=l==null?void 0:l[e.code];((f==null?void 0:f.autoSync)??s)&&ce({code:e.code}).catch(y=>{m(c??null),a==null||a({method:e,error:y}),a||g(z)})},[l,s,m,a,z]),G=P(async e=>{const c=x("selectedPaymentMethod");m(e),i==null||i(e),await M(e,c)},[i,m,M]),S=P(e=>{if(!e||e.isEmpty){m(null),b([]);return}const d=e.availablePaymentMethods??[];if(b(d),d.length===0){m(null);return}const f=e.selectedPaymentMethod??null,U=Ce(f),y=x("selectedPaymentMethod"),V=Se(y,d),Q=Pe(y,f);if(y&&V&&!Q){M(y,f);return}if((!y||!V)&&U){m(f);return}if((!y||!V)&&!U){const B=d[0];m(B),M(B)}},[m,M]);R(()=>{if(!r)return;const e=re();if(e){C(!0);const d=x("selectedPaymentMethod");d&&v(d),S(e);return}const c=A.on("checkout/initialized",d=>{C(!0),S(d)},{eager:!0});return()=>{c==null||c.off()}},[r,S]),R(()=>{if(!r)return;const e=A.on("checkout/updated",S,{eager:!1});return()=>{e==null||e.off()}},[r,S]);const I=k?(O=(N=o==null?void 0:o.Methods)==null?void 0:N[k.code])==null?void 0:O.render:null,J=I?t(j,{context:{cartId:Y.cartId??"",replaceHTML(e){this.replaceWith(e)}},name:"PaymentMethodContent",slot:I},I):void 0,K=fe(()=>{if(u)return t(j,{name:"checkout-payment-methods-title",slot:o==null?void 0:o.Title,children:t("h2",{children:H})})},[u,o==null?void 0:o.Title,H]);return t(Me,{UIComponentType:n,busy:$,error:h,initialized:w,options:q,paymentMethodContent:J,selection:k,title:K,visible:r,onDismissError:F,onSelectionChange:G})};export{Ae as PaymentMethods,Ae as default};
//# sourceMappingURL=PaymentMethods.js.map
