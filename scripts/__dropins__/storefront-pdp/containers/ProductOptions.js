/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as d}from"@dropins/tools/preact-jsx-runtime.js";import{useState as h,useEffect as z,useCallback as j}from"@dropins/tools/preact-compat.js";import{Slot as C}from"@dropins/tools/lib.js";import{events as S}from"@dropins/tools/event-bus.js";import"@dropins/tools/components.js";/* empty css             */import{S as A}from"../chunks/Swatches.js";import"@dropins/tools/preact.js";import{c as v,o as G,k as O,j as b,h as H,l as y,p as J}from"../chunks/isProductConfigurationValid.js";import{g as K}from"../chunks/getFetchedProductData.js";import"@dropins/tools/i18n.js";import"../fragments.js";import"@dropins/tools/fetch-graphql.js";const Q=({initialData:c={data:null,optionsUIDs:[]},scope:i,hideSelectedValue:p=!1,slots:n,onValues:u,onErrors:l,children:V,...B})=>{var I;const[t,T]=h(c.data),[m,F]=h(c.optionsUIDs),[M,L]=h();z(()=>{const a=S.on("pdp/data",T,{scope:i}),s=S.on("pdp/values",({optionsUIDs:f})=>{f&&F(f)},{scope:i});return()=>{a==null||a.off(),s==null||s.off()}},[]);const N=j(async a=>{var U,w,D,k;if(!(t!=null&&t.sku))return;const{persistURLParams:s,anchors:f,acdl:q}=v.getConfig()??{};let o=Object.keys(a).map(r=>a[r].value).filter(r=>r!==void 0);s&&!(t!=null&&t.isBundle)&&G({optionsUIDs:o.join(",")}),((w=(U=O({scope:i}))==null?void 0:U.optionsUIDs)==null?void 0:w.join("|"))!==(o==null?void 0:o.join("|"))&&b(r=>({...r,optionsUIDs:o}),{scope:i}),u==null||u(o);const e=await H(t.sku,{optionsUIDs:o??[],isBundle:t==null?void 0:t.isBundle,anchors:f});S.emit("pdp/data",e,{scope:i});let P=(o==null?void 0:o.length)===((D=e==null?void 0:e.options)==null?void 0:D.length);if(f!=null&&f.length){const r=(e==null?void 0:e.optionUIDs)??[];o.every(g=>r.includes(g))||(L(e==null?void 0:e.options),b(g=>({...g,optionsUIDs:r}),{scope:i}),P=(r==null?void 0:r.length)===((k=e==null?void 0:e.options)==null?void 0:k.length))}y(()=>P,{scope:i}),q&&e&&(e==null?void 0:e.variantSku)!==t.sku&&J(e)},[t==null?void 0:t.isBundle,t==null?void 0:t.sku,u,i]),R=j(a=>{Object.keys(a).length!==0&&(y(()=>!1,{scope:i}),l==null||l(a))},[l,i]);return!t||!t.options?null:d(C,{name:"Swatches",slot:n==null?void 0:n.Swatches,context:{data:t,optionsUIDs:m},children:d(A,{...B,options:t.options,selectedUIDs:m,defaultOptions:m,selectionsToUpdate:M,hideSelectedValue:p,disablePreselections:!((I=v.getConfig())!=null&&I.preselectFirstOption),onValues:N,onErrors:R,imageSwatchNode:n!=null&&n.SwatchImage?({imageSwatchContext:a,...s})=>d(C,{name:"SwatchImage",slot:n==null?void 0:n.SwatchImage,slotTag:"span",contentTag:"span",context:{data:t,optionsUIDs:m,defaultImageProps:s,imageSwatchContext:a}}):void 0})})};Q.getInitialData=async function(c){var n;const i=await K({scope:c==null?void 0:c.scope}),p=((n=O({scope:c==null?void 0:c.scope}))==null?void 0:n.optionsUIDs)??[];return{data:i,optionsUIDs:p}};export{Q as ProductOptions,Q as default};
//# sourceMappingURL=ProductOptions.js.map
