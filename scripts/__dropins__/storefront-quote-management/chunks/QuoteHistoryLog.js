/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as d,jsx as l}from"@dropins/tools/preact-jsx-runtime.js";import{useState as $,useEffect as Q}from"@dropins/tools/preact-compat.js";import{events as q}from"@dropins/tools/event-bus.js";import{getGlobalLocale as D,classes as U}from"@dropins/tools/lib.js";import{g as P,a as g}from"./dateUtils.js";/* empty css                */import{useText as I}from"@dropins/tools/i18n.js";const j=({className:h,children:v,quoteData:o,...T})=>{const u=D()||"en-US",t=I({quoteCreated:"historyLog.changeTypes.created",quoteUpdated:"historyLog.changeTypes.updated",statusChanged:"historyLog.changeTypes.statusChanged",commentAdded:"historyLog.changeTypes.commentAdded",expirationChanged:"historyLog.changeTypes.expirationChanged",buyerNoteAdded:"historyLog.noteTypes.buyerNoteAdded",sellerNoteAdded:"historyLog.noteTypes.sellerNoteAdded",buyerLabel:"historyLog.authorLabels.buyer",sellerLabel:"historyLog.authorLabels.seller",commentDetail:"historyLog.changeDetails.comment",statusChangedFromTo:"historyLog.changeDetails.statusChangedFromTo",statusSetTo:"historyLog.changeDetails.statusSetTo",expirationChangedFromTo:"historyLog.changeDetails.expirationChangedFromTo",expirationSetTo:"historyLog.changeDetails.expirationSetTo",totalChangedFromTo:"historyLog.changeDetails.totalChangedFromTo",customChange:"historyLog.changeDetails.customChange",productsRemovedFromCatalog:"historyLog.changeDetails.productsRemovedFromCatalog",productsRemovedFromQuote:"historyLog.changeDetails.productsRemovedFromQuote",noDetailsAvailable:"historyLog.changeDetails.noDetailsAvailable",emptyState:"historyLog.emptyState",never:"dateUtils.never"}),c=new Intl.DateTimeFormat(u,{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:P()}),w=e=>{switch(e){case"CREATED":return t.quoteCreated;case"UPDATED":return t.quoteUpdated;case"STATUS_CHANGED":return t.statusChanged;case"COMMENT_ADDED":return t.commentAdded;case"EXPIRATION_CHANGED":return t.expirationChanged;default:return e.replace(/_/g," ").toLowerCase().replace(/\b\w/g,r=>r.toUpperCase())}},S=e=>{var a,n,y,p,s,C,L,N,_,x,b,F;const r=[];if((a=e==null?void 0:e.commentAdded)!=null&&a.comment&&r.push(t.commentDetail.replace("{comment}",e.commentAdded.comment)),(n=e==null?void 0:e.statuses)!=null&&n.changes&&e.statuses.changes.forEach(i=>{i.oldStatus&&i.newStatus?r.push(t.statusChangedFromTo.replace("{oldStatus}",i.oldStatus).replace("{newStatus}",i.newStatus)):i.newStatus&&r.push(t.statusSetTo.replace("{newStatus}",i.newStatus))}),(y=e==null?void 0:e.expiration)!=null&&y.newExpiration&&((p=e==null?void 0:e.expiration)!=null&&p.oldExpiration)){const i=g(e.expiration.newExpiration,c),m=g(e.expiration.oldExpiration,c);r.push(t.expirationChangedFromTo.replace("{oldExpiration}",m).replace("{newExpiration}",i))}else if((s=e==null?void 0:e.expiration)!=null&&s.newExpiration){const i=g(e.expiration.newExpiration,c);r.push(t.expirationSetTo.replace("{newExpiration}",i))}if((C=e==null?void 0:e.total)!=null&&C.newPrice&&((L=e==null?void 0:e.total)!=null&&L.oldPrice)){const i=`${e.total.newPrice.currency} ${e.total.newPrice.value}`,m=`${e.total.oldPrice.currency} ${e.total.oldPrice.value}`;r.push(t.totalChangedFromTo.replace("{oldTotal}",m).replace("{newTotal}",i))}if((N=e==null?void 0:e.customChanges)!=null&&N.title&&((_=e==null?void 0:e.customChanges)!=null&&_.old_value)&&((x=e==null?void 0:e.customChanges)!=null&&x.new_value)&&r.push(t.customChange.replace("{title}",e.customChanges.title).replace("{oldValue}",e.customChanges.old_value).replace("{newValue}",e.customChanges.new_value)),(b=e==null?void 0:e.productsRemoved)!=null&&b.productsRemovedFromCatalog&&e.productsRemoved.productsRemovedFromCatalog.length>0&&r.push(t.productsRemovedFromCatalog.replace("{products}",e.productsRemoved.productsRemovedFromCatalog.join(", "))),(F=e==null?void 0:e.productsRemoved)!=null&&F.productsRemovedFromQuote&&e.productsRemoved.productsRemovedFromQuote.length>0){const i=e.productsRemoved.productsRemovedFromQuote.map(m=>m.name||m.sku||m.uid).join(", ");r.push(t.productsRemovedFromQuote.replace("{products}",i))}return r.length>0?r:[t.noDetailsAvailable]},E=(()=>{const e=[],r=(a,n,y,p)=>{a&&Array.isArray(a)&&a.forEach(s=>{s&&s.note&&s.note.trim()&&e.push({...s,type:n,productName:p.product.name,productSku:p.product.sku,authorName:y})})};return o!=null&&o.items&&o.items.forEach(a=>{r(a.noteFromBuyer,"buyer",`${o.buyer.firstname} ${o.buyer.lastname} ${t.buyerLabel}`,a),r(a.noteFromSeller,"seller",`${o.salesRepName} ${t.sellerLabel}`,a)}),e})(),A=((o==null?void 0:o.history)||[]).map(e=>({...e,entryType:"history"})),R=E.map(e=>({...e,entryType:"note"})),f=[...A,...R];return d("div",{...T,className:U(["quote-management-quote-history-log",h]),children:[f.length>0?l("div",{className:"quote-management-quote-history-log__entries",children:f.map((e,r)=>d("div",{className:"quote-management-quote-history-log__entry",children:[d("div",{className:"quote-management-quote-history-log__entry-header",children:[d("div",{className:"quote-management-quote-history-log__entry-meta",children:[l("span",{className:"quote-management-quote-history-log__entry-date",children:c.format(new Date(e.createdAt))}),l("span",{className:"quote-management-quote-history-log__entry-author",children:e.entryType==="history"?`by ${e.author.firstname} ${e.author.lastname} ${e.author.firstname===(o==null?void 0:o.buyer.firstname)&&e.author.lastname===(o==null?void 0:o.buyer.lastname)?t.buyerLabel:t.sellerLabel}`:`by ${e.authorName}`})]}),l("div",{className:"quote-management-quote-history-log__entry-type",children:e.entryType==="history"?w(e.changeType):e.type==="buyer"?t.buyerNoteAdded:t.sellerNoteAdded})]}),l("div",{className:"quote-management-quote-history-log__entry-changes",children:e.entryType==="history"?S(e.changes).map((a,n)=>l("div",{className:"quote-management-quote-history-log__entry-change",children:a},n)):d("div",{className:"quote-management-quote-history-log__entry-change",children:[d("div",{children:[e.productName,"(",e.productSku,")"]}),d("div",{children:['"',e.note,'"']})]})})]},e.entryType==="history"?e.uid:`${e.noteUid}-${r}`))}):l("div",{className:"quote-management-quote-history-log__empty",children:t.emptyState}),v]})},X=({quoteData:h,...v})=>{const[o,T]=$(h);return Q(()=>{const u=q.on("quote-management/quote-data",t=>{T(t.quote)},{eager:!0});return()=>u==null?void 0:u.off()},[]),o?l("div",{...v,children:l(j,{quoteData:o})}):null};export{X as Q};
//# sourceMappingURL=QuoteHistoryLog.js.map
