/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as c,jsx as m}from"@dropins/tools/preact-jsx-runtime.js";import{classes as h}from"@dropins/tools/lib.js";import{TextArea as T,Button as A,Card as y,Skeleton as w,SkeletonRow as x}from"@dropins/tools/components.js";import{events as F}from"@dropins/tools/event-bus.js";import"../chunks/PurchaseOrderHistoryLogContent.js";import{P as S}from"../chunks/PurchaseOrdersHeader.js";import{useState as a,useMemo as k,useCallback as b}from"@dropins/tools/preact-hooks.js";import{u as M}from"../chunks/usePurchaseOrderData.js";import"@dropins/tools/preact.js";import{a as V}from"../chunks/addPurchaseOrderComment.js";import{useText as j}from"@dropins/tools/i18n.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/fetch-error.js";const p=({t:n,purchaseOrderData:e})=>{const[i,l]=a(!1),[t,s]=a(""),[r,u]=a(""),C=k(()=>!t.trim().length||!(e!=null&&e.uid)||i,[t,e,i]),g=b(d=>{const o=d.target.value;s(o),r&&u("")},[r]),P=b(()=>{const d=(e==null?void 0:e.uid)??"";!d||!t.trim().length||(l(!0),V(d,t).then(o=>{var f;if(o&&(e!=null&&e.uid)){const v=[{uid:o.uid,createdAt:o.createdAt,author:o.author,text:o.text}];F.emit("purchase-order/data",{...e,comments:(f=e==null?void 0:e.comments)==null?void 0:f.concat(v)}),s("")}}).catch(()=>{u(n.errorMessage||"Failed to add comment. Please try again.")}).finally(()=>{l(!1)}))},[e,t,n]);return c("div",{className:h(["b2b-purchase-order-comment-form-content"]),children:[m(T,{errorMessage:r,disabled:i,value:t,label:n.textAreaPlaceholder,onChange:g}),m(A,{variant:"primary",disabled:C,onClick:P,children:n.buttonText})]})},Q=({withHeader:n=!0,withWrapper:e=!0,className:i})=>{const{poDataLoading:l,purchaseOrderData:t}=M(),s=j({headerText:"PurchaseOrders.comments.add.headerText",buttonText:"PurchaseOrders.comments.add.submit",textAreaPlaceholder:"PurchaseOrders.comments.add.placeholder"}),r=l?c(w,{rowGap:"medium","data-testid":"comment-form-loader",children:[m(x,{size:"xlarge",variant:"row",fullWidth:!0,lines:5,style:{maxWidth:500}}),m(x,{size:"medium",variant:"row",lines:1})]}):m(p,{purchaseOrderData:t,t:s});return c("div",{className:h(["b2b-purchase-order-comment-form",i]),"data-testid":"order-history-log-container",children:[n?m(S,{headerText:s.headerText}):null,e?m(y,{variant:"secondary","data-testid":"orderCommentFormCard",children:r}):r]})};export{Q as PurchaseOrderCommentForm,Q as default};
//# sourceMappingURL=PurchaseOrderCommentForm.js.map
