/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as C,jsx as p,Fragment as W}from"@dropins/tools/preact-jsx-runtime.js";import{useRef as K,useState as $,useEffect as M,useMemo as G,useCallback as D}from"@dropins/tools/preact-hooks.js";import{Field as B,Picker as ee,Input as ae,Button as re}from"@dropins/tools/components.js";import{classes as k,Slot as ne}from"@dropins/tools/lib.js";import{memo as se}from"@dropins/tools/preact-compat.js";import{useText as J}from"@dropins/tools/i18n.js";import{g as oe,c as te}from"../chunks/transform-store-config.js";import{g as z,v as ie}from"../chunks/validateCompanyEmail.js";import{a as le,i as de}from"../chunks/isCompanyUser.js";import"../chunks/fetch-error.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/event-bus.js";import"../chunks/company-permissions.js";var A=(a=>(a.TEXT="TEXT",a.EMAIL="EMAIL",a.TEL="TEL",a.SELECT="SELECT",a.HIDDEN="HIDDEN",a))(A||{});const ce=se(({loading:a,values:e={},fields:u,errors:n={},className:g="",regionOptions:t,countryOptions:y,onChange:s,onBlur:i,onFocus:c,slots:E,fieldIdPrefix:f})=>{const _=`${g}__field`,T=J({selectCountry:"Company.FormText.selectCountry",selectRegion:"Company.FormText.selectRegion",selectCountryFirst:"Company.FormText.selectCountryFirst",country:"Company.shared.fields.country",stateProvince:"Company.shared.fields.stateProvince","Company.Registration.companyInformation":"Company.shared.fields.companyInformation","Company.Registration.legalAddress":"Company.shared.fields.legalAddress","Company.Registration.companyAdmin":"Company.shared.fields.companyAdmin"}),N={CompanyInformationSection:["companyName","legalName","companyEmail","vatTaxId","resellerId"],LegalAddressSection:["street","streetLine2","city","countryCode","region","postcode","addressTelephone"],CompanyAdministratorSection:["adminEmail","adminFirstname","adminLastname","adminJobTitle","adminWorkTelephone","adminGender"]},v=r=>({CompanyInformationSection:"Company.Registration.companyInformation",LegalAddressSection:"Company.Registration.legalAddress",CompanyAdministratorSection:"Company.Registration.companyAdmin"})[r],L=r=>{var h,R,F,q;if((r.code==="region"||r.code==="regionCode")&&r.fieldType===A.SELECT){const x=((h=e.regionCode)==null?void 0:h.toString())||"",I=((R=e.regionId)==null?void 0:R.toString())||"";return x&&I?`${x},${I}`:(F=e[r.code])!=null&&F.toString().includes(",")?(q=e[r.code])==null?void 0:q.toString():""}return null},l=r=>{var h;return r.code==="street"?Array.isArray(e.street)?e.street[0]||"":((h=e.street)==null?void 0:h.toString())||"":r.code==="streetLine2"?Array.isArray(e.street)&&e.street[1]||"":null},o=(r,h)=>{const R=`CompanyFormInput_${r.code}`,F=E==null?void 0:E[R];if(!F)return null;const q={inputName:r.code,handleOnChange:s||(()=>{}),errorMessage:h,errors:Object.values(n),formData:e,fieldConfig:{required:r.required,disabled:r.disabled||a,placeholder:r.placeholder||r.label,label:r.label}};return p(ne,{"data-testid":`companyFormInput_${r.code}`,name:R,slot:F,context:q})},d=(r,h,R)=>{let F=r.options;return r.code==="countryCode"||r.code==="country_code"?F=(y==null?void 0:y.map(q=>({value:q.value,text:q.text,isDefault:!1})))||[]:(r.code==="region"||r.code==="regionCode")&&(F=(t==null?void 0:t.map(q=>({text:q.text,value:q.value,isDefault:!1})))||[]),p(W,{children:o(r,R)??p(B,{error:R,className:k([_,`${_}--${r.id}`,[`${_}--${r.id}-hidden`,r.isHidden],r.className]),"data-testid":`${g}--${r.id}`,disabled:a,children:p(ee,{"aria-label":r.label,"aria-required":r.required?"true":"false",id:f?`${f}_${r.code}`:r.code,required:r==null?void 0:r.required,name:r.customUpperCode||r.code,placeholder:r.label,options:F,onBlur:i,onFocus:c,handleSelect:s,defaultValue:h,value:h})},r.id)})},m=(r,h,R)=>{let F="text";return r.fieldType===A.EMAIL?F="email":r.fieldType===A.TEL&&(F="tel"),p(W,{children:o(r,R)??p(B,{error:R,className:k([_,`${_}--${r.id}`,[`${_}--${r.id}-hidden`,r.isHidden],r.className]),"data-testid":`${g}--${r.id}`,disabled:a,children:p(ae,{"aria-label":r.label,"aria-required":r.required?"true":"false",id:f?`${f}_${r.code}`:r.code,type:F,name:r.customUpperCode,value:h??r.defaultValue,placeholder:r.label,floatingLabel:`${r.label} ${r.required?"*":""}`,maxLength:r.maxlength,onBlur:i,onFocus:c,onChange:s})},r.id)})},b=r=>u==null?void 0:u.filter(h=>r.includes(h.code)&&!h.isHidden).map(h=>{var I,V;let R=((I=e[h.code])==null?void 0:I.toString())||"";const F=l(h);F!==null&&(R=F);const q=L(h);q!==null&&(R=q);const x=n[h.customUpperCode||h.code]||"";return h.code==="region"||h.code==="regionCode"?h.fieldType===A.SELECT?d(h,R,x):m(h,R,x):h.fieldType===A.SELECT||((V=h.options)==null?void 0:V.length)>0?d(h,R,x):m(h,R,x)}),S=r=>{const h=N[r],R=v(r);return(u==null?void 0:u.some(q=>h.includes(q.code)&&!q.isHidden))?C("div",{className:`${g}__section`,children:[p("h3",{className:`${g}__section-title`,children:T[R]}),b(h)]},`section-${r}`):null};return C("div",{className:`${g}__inputs`,children:[S("CompanyInformationSection"),S("LegalAddressSection"),S("CompanyAdministratorSection")]})}),me=({showFormLoader:a,slots:e,name:u="companyForm",loading:n,children:g,className:t="company-form",fieldsConfig:y=[],values:s={},errors:i={},onSubmit:c,onChange:E,onBlur:f,regionOptions:_,countryOptions:T,fieldIdPrefix:N})=>{const v=K(null),L=async o=>{o.preventDefault(),c&&await c(o,!0)};if(a||n)return p("div",{className:k(["dropin-form-loader","company-form-loader"]),children:"Loading..."});const l=o=>{const d=o.target,{name:m,value:b}=d;E&&E({[m]:b})};return C("form",{id:u,ref:v,className:k(["company-form",t]),onSubmit:L,noValidate:!0,children:[p(ce,{className:t,fields:y,values:s,errors:i,onChange:l,onBlur:f,slots:e,regionOptions:_,countryOptions:T,fieldIdPrefix:N}),g]})},ue=(a={})=>{const{defaultCountry:e="US",formName:u="company_registration"}=a,[n,g]=$(null),[t,y]=$(()=>{var m;const d=sessionStorage.getItem(`${u}_formData`);return d?{countryCode:(m=JSON.parse(d))==null?void 0:m.countryCode}:{countryCode:e}}),[s,i]=$(!0),[c,E]=$(!0),[f,_]=$([]);M(()=>{i(!0),E(!0),z().then(({availableCountries:d,countriesWithRequiredRegion:m,optionalZipCountries:b})=>{g({availableCountries:d,countriesWithRequiredRegion:m,optionalZipCountries:b}),i(!1),E(!1)}).catch(d=>{console.error("Failed to load countries:",d),i(!1),E(!1)})},[]),M(()=>{if(t!=null&&t.countryCode&&n){const d=n.availableCountries.find(m=>m.value===t.countryCode);if(d!=null&&d.availableRegions&&d.availableRegions.length>0){const m=d.availableRegions.map(b=>({text:b.name,value:`${b.code},${b.id}`,id:b.id,code:b.code}));_(m)}else _([])}else _([])},[t==null?void 0:t.countryCode,n]);const T=G(()=>(n==null?void 0:n.availableCountries)||[],[n]),N=G(()=>!(t!=null&&t.countryCode)||!n?!1:n.countriesWithRequiredRegion.includes(t.countryCode),[t==null?void 0:t.countryCode,n]),v=G(()=>!(t!=null&&t.countryCode)||!n?!0:!n.optionalZipCountries.includes(t.countryCode),[t==null?void 0:t.countryCode,n]),L=G(()=>f,[f]),l=G(()=>L.length>0,[L.length]),o=D((d,m)=>{y(b=>{const S={...b,[d]:m};return d==="countryCode"&&(S.regionCode="",S.regionId=void 0),S})},[]);return{countryOptions:T,regionOptions:L,isRequiredRegion:N,isRequiredPostCode:v,disableField:s,loadingCountries:c,hasRegions:l,handleInputChange:o,inputChange:t}},pe=a=>{var E;const{formData:e,isRequiredRegion:u=!1,isRequiredPostCode:n=!1,hasRegions:g=!1,disableField:t=!1,translations:y={}}=a,s=f=>(y==null?void 0:y[f])||f,i=f=>{const _=s(f);return f==="countryCode"||f==="region"||f==="adminGender"?`Select ${_.toLowerCase()}`:`Enter ${_.toLowerCase()}`},c={isRequiredRegion:u,isRequiredPostCode:n};return[{code:"companyName",name:"companyName",id:"companyName",label:s("companyName"),placeholder:i("companyName"),required:!0,fieldType:A.TEXT,isHidden:!1,customUpperCode:"companyName",defaultValue:(e==null?void 0:e.companyName)||"",options:[],maxlength:40,...c,validateRules:[]},{code:"legalName",name:"legalName",id:"legalName",label:s("legalName"),placeholder:i("legalName"),required:!1,fieldType:A.TEXT,isHidden:!1,customUpperCode:"legalName",defaultValue:(e==null?void 0:e.legalName)||"",options:[],maxlength:80,validateRules:[],...c},{code:"companyEmail",name:"companyEmail",id:"companyEmail",label:s("companyEmail"),placeholder:i("companyEmail"),required:!0,fieldType:A.EMAIL,isHidden:!1,customUpperCode:"companyEmail",defaultValue:(e==null?void 0:e.companyEmail)||"",options:[],maxlength:254,validateRules:[{INPUT_VALIDATION:"email"},{MIN_TEXT_LENGTH:5},{MAX_TEXT_LENGTH:254}],...c},{code:"vatTaxId",name:"vatTaxId",id:"vatTaxId",label:s("vatTaxId"),placeholder:i("vatTaxId"),required:!1,fieldType:A.TEXT,isHidden:!1,customUpperCode:"vatTaxId",defaultValue:(e==null?void 0:e.vatTaxId)||"",options:[],maxlength:40,validateRules:[],...c},{code:"resellerId",name:"resellerId",id:"resellerId",label:s("resellerId"),placeholder:i("resellerId"),required:!1,fieldType:A.TEXT,isHidden:!1,customUpperCode:"resellerId",defaultValue:(e==null?void 0:e.resellerId)||"",options:[],maxlength:40,validateRules:[],...c},{code:"street",name:"street",id:"street",label:s("street"),placeholder:i("street"),required:!0,fieldType:A.TEXT,isHidden:!1,customUpperCode:"street",defaultValue:Array.isArray(e==null?void 0:e.street)?e.street[0]:(e==null?void 0:e.street)||"",options:[],validateRules:[],...c},{code:"streetLine2",name:"streetLine2",id:"streetLine2",label:s("streetLine2"),placeholder:i("streetLine2"),required:!1,fieldType:A.TEXT,isHidden:!1,customUpperCode:"streetLine2",defaultValue:Array.isArray(e==null?void 0:e.street)?e.street[1]:"",options:[],validateRules:[],...c},{code:"city",name:"city",id:"city",label:s("city"),placeholder:i("city"),required:!0,fieldType:A.TEXT,isHidden:!1,customUpperCode:"city",defaultValue:(e==null?void 0:e.city)||"",options:[],validateRules:[],...c},{code:"countryCode",name:"countryCode",id:"countryCode",label:s("country"),placeholder:i("country"),required:!0,disabled:t,fieldType:A.SELECT,isHidden:!1,customUpperCode:"countryCode",defaultValue:(e==null?void 0:e.countryCode)||"",options:[],validateRules:[]},{code:"region",name:"region",id:"region",label:s("stateProvince"),placeholder:i("stateProvince"),required:u,disabled:!1,fieldType:g?A.SELECT:A.TEXT,isHidden:!1,customUpperCode:"region",defaultValue:(e==null?void 0:e.regionCode)||"",options:[]},{code:"postcode",name:"postcode",id:"postcode",label:s("postalCode"),placeholder:i("postalCode"),required:n,fieldType:A.TEXT,isHidden:!1,customUpperCode:"postcode",defaultValue:(e==null?void 0:e.postcode)||"",options:[],validateRules:[{INPUT_VALIDATION:"postal-code"},{MIN_TEXT_LENGTH:3},{MAX_TEXT_LENGTH:20}],...c},{code:"addressTelephone",name:"addressTelephone",id:"addressTelephone",label:s("telephone"),placeholder:i("telephone"),required:!0,fieldType:A.TEL,isHidden:!1,customUpperCode:"addressTelephone",defaultValue:(e==null?void 0:e.addressTelephone)||"",options:[],validateRules:[{INPUT_VALIDATION:"phone"},{MIN_TEXT_LENGTH:1},{MAX_TEXT_LENGTH:20}],...c},{code:"adminJobTitle",name:"adminJobTitle",id:"adminJobTitle",label:s("adminJobTitle"),placeholder:i("adminJobTitle"),required:!1,fieldType:A.TEXT,isHidden:!1,customUpperCode:"adminJobTitle",defaultValue:(e==null?void 0:e.adminJobTitle)||"",options:[],validateRules:[],...c},{code:"adminWorkTelephone",name:"adminWorkTelephone",id:"adminWorkTelephone",label:s("adminWorkTelephone"),placeholder:i("adminWorkTelephone"),required:!1,fieldType:A.TEL,isHidden:!1,customUpperCode:"adminWorkTelephone",defaultValue:(e==null?void 0:e.adminWorkTelephone)||"",options:[],validateRules:[{INPUT_VALIDATION:"phone"},{MIN_TEXT_LENGTH:1},{MAX_TEXT_LENGTH:20}],...c},{code:"adminEmail",name:"adminEmail",id:"adminEmail",label:s("adminEmail"),placeholder:i("adminEmail"),required:!0,fieldType:A.EMAIL,isHidden:!1,customUpperCode:"adminEmail",defaultValue:(e==null?void 0:e.adminEmail)||"",options:[],validateRules:[{INPUT_VALIDATION:"email"},{MIN_TEXT_LENGTH:5},{MAX_TEXT_LENGTH:254}],...c},{code:"adminFirstname",name:"adminFirstname",id:"adminFirstname",label:s("adminFirstname"),placeholder:i("adminFirstname"),required:!0,fieldType:A.TEXT,isHidden:!1,customUpperCode:"adminFirstname",defaultValue:(e==null?void 0:e.adminFirstname)||"",options:[],validateRules:[{INPUT_VALIDATION:"name"},{MIN_TEXT_LENGTH:1},{MAX_TEXT_LENGTH:255}],...c},{code:"adminLastname",name:"adminLastname",id:"adminLastname",label:s("adminLastname"),placeholder:i("adminLastname"),required:!0,fieldType:A.TEXT,isHidden:!1,customUpperCode:"adminLastname",defaultValue:(e==null?void 0:e.adminLastname)||"",options:[],validateRules:[{INPUT_VALIDATION:"name"},{MIN_TEXT_LENGTH:1},{MAX_TEXT_LENGTH:255}],...c},{code:"adminGender",name:"adminGender",id:"adminGender",label:s("adminGender"),placeholder:i("adminGender"),required:!1,fieldType:A.SELECT,isHidden:!1,customUpperCode:"adminGender",defaultValue:((E=e==null?void 0:e.adminGender)==null?void 0:E.toString())||"",options:[{value:"0",text:"Not Specified",isDefault:!0},{value:"1",text:"Male",isDefault:!1},{value:"2",text:"Female",isDefault:!1}],validateRules:[],...c}]},he=a=>a.reduce((e,u)=>({...e,...u}),{}),ge=a=>/^[0-9]+$/.test(a),ye=a=>/^[a-zA-Z0-9]+$/.test(a),Ce=a=>/^[a-zA-Z0-9\s]+$/.test(a),fe=a=>/^[a-zA-Z]+$/.test(a),Te=a=>/^[a-z0-9,!#$%&'*+/=?^_`{|}~-]+(\.[a-z0-9,!#$%&'*+/=?^_`{|}~-]+)*@([a-z0-9-]+\.)+[a-z]{2,}$/i.test(a),Ee=a=>/(?:[\d\s+\-()]{1,20})/u.test(a),_e=a=>/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/i.test(a),Ne=a=>/^[A-Z0-9\s-]{3,10}$/i.test(a),ve=a=>/^(?:[\p{L}\p{M},\-_.'`&\s\d]){1,255}$/u.test(a),be=(a,e,u)=>{const n=a.length;return n>=e&&n<=u},Z=(a,e,u,n)=>{var r,h;const{requiredFieldError:g,lengthTextError:t,numericError:y,alphaNumWithSpacesError:s,alphaNumericError:i,alphaError:c,emailError:E,phoneError:f,postalCodeError:_,urlError:T,nameError:N}=u,v=e==null?void 0:e.customUpperCode,L={[v]:""};n[v]&&delete n[v];const l=(a==null?void 0:a.trim())||"";if(e!=null&&e.required&&(!l||l==="false"))return{[v]:g};if(!(e!=null&&e.required)&&!l||!((r=e==null?void 0:e.validateRules)!=null&&r.length))return L;const o=he(e==null?void 0:e.validateRules),d=Number(o.MIN_TEXT_LENGTH)??1,m=Number(o.MAX_TEXT_LENGTH)??255;if(!be(l,d,m))return{[v]:t.replace("{min}",d.toString()).replace("{max}",m.toString())};const S={numeric:{validate:ge,error:y},"alphanum-with-spaces":{validate:Ce,error:s},alphanumeric:{validate:ye,error:i},alpha:{validate:fe,error:c},email:{validate:Te,error:E},phone:{validate:Ee,error:f},"postal-code":{validate:R=>Ne(R),error:_},url:{validate:_e,error:T},name:{validate:ve,error:N}}[o.INPUT_VALIDATION];return S&&!S.validate(l)&&!((h=n[v])!=null&&h.length)?{[v]:S.error}:L},Ie=a=>({requiredFieldError:a.requiredFieldError,lengthTextError:a.lengthTextError,numericError:a.numericError,alphaNumWithSpacesError:a.alphaNumWithSpacesError,alphaNumericError:a.alphaNumericError,alphaError:a.alphaError,emailError:a.emailError,phoneError:a.phoneError,postalCodeError:a.postalCodeError,urlError:a.urlError,nameError:a.nameError}),Q=(a,e)=>({fieldsConfig:a,translations:Ie(e)}),Ae=(a,e,u)=>{const{fieldsConfig:n,translations:g}=u,t=n.find(c=>c.code===a);if(!t)return"";const y=Array.isArray(e)?e.join(""):e.toString(),s={validateRules:t.validateRules||[],customUpperCode:t.customUpperCode,required:t.required};return Z(y,s,g,{})[t.customUpperCode]||""},Le=(a,e)=>{const{fieldsConfig:u,translations:n}=e,g=u[0],t=(g==null?void 0:g.isRequiredRegion)||!1,y=(g==null?void 0:g.isRequiredPostCode)||!1;let s=!1;const i={};Object.entries(a).forEach(([_,T])=>{const N=u.find(o=>o.code===_);if(!N)return;const v=Array.isArray(T)?T.join(""):T.toString(),L={validateRules:N.validateRules,customUpperCode:N.customUpperCode,required:N.required},l=Z(v,L,n,{});l[N.customUpperCode]&&(i[N.customUpperCode]=l[N.customUpperCode],s=!0)});const c=typeof a.regionId=="number"&&a.regionId>0,E=a.regionCode&&a.regionCode.toString().trim(),f=a.region&&a.region.toString().trim();return t&&!c&&!E&&!f&&(i.region=n.requiredFieldError,s=!0),y&&!a.postcode.toString().trim()&&(i.postcode=n.requiredFieldError,s=!0),{isValid:!s,fieldErrors:i}},Y=(a,e,u,n)=>{const g=Q(u,n);return Ae(a,e,g)},Re=(a,e,u)=>{const n=Q(e,u);return Le(a,n)},Se=a=>{const{setFormData:e,hasRegions:u,regionOptions:n,fieldsConfig:g,formTranslations:t,setFieldErrors:y}=a,s=(l,o)=>{const d=Y(l,o,g,t);y&&d?y(m=>({...m,[l]:d})):y&&y(m=>{const b={...m};return delete b[l],b})},i=l=>{e(o=>{const d=Array.isArray(o.street)?o.street:[o.street||"",""],m=Array.isArray(l)?l:[l,d[1]||""];return{...o,street:m}}),s("street",l)},c=l=>{e(o=>{const m=[(Array.isArray(o.street)?o.street:[o.street||"",""])[0]||"",l];return{...o,street:m}}),s("streetLine2",l)},E=l=>{e(o=>({...o,region:l,regionCode:"",regionId:void 0})),s("region",l)},f=l=>{e(o=>({...o,regionCode:l,...u?{}:{regionId:void 0}})),s("regionCode",l)},_=l=>{const o=typeof l=="string"?parseInt(l,10)||void 0:l;e(d=>{const m={...d,regionId:o};if(o&&n.length>0){const b=n.find(S=>S.id===o||S.value===(o==null?void 0:o.toString()));b&&b.code&&(m.regionCode=b.code)}return m}),s("regionId",l)},T=l=>{e(o=>({...o,countryCode:l,regionCode:"",regionId:void 0,region:""})),s("countryCode",l)},N=(l,o)=>{e(d=>({...d,[l]:o})),s(l,o)};return{handleInputChange:l=>{const o=l.target;if(!o)return;const{name:d,value:m}=o;switch(d){case"street":i(m);break;case"streetLine2":c(m);break;case"region":u?_(m):E(m);break;case"regionCode":f(m);break;case"countryCode":T(m);break;default:N(d,m);break}},handleInputChangeFromValues:l=>{Object.entries(l).forEach(([o,d])=>{switch(o){case"street":i(d);break;case"streetLine2":c(d);break;case"region":E(d);break;case"regionCode":f(d);break;case"regionId":_(d);break;case"countryCode":T(d);break;default:N(o,d);break}})},handleStreetChange:i,handleStreetLine2Change:c,handleRegionTextChange:E,handleRegionCodeChange:f,handleRegionDropdownChange:_,handleCountryChange:T,handleGenericFieldChange:N}},Fe=({onSuccess:a,onError:e})=>{const[u,n]=$(!1),[g,t]=$({}),[y,s]=$("US"),[i,c]=$(!0),{countryOptions:E,regionOptions:f,isRequiredRegion:_,isRequiredPostCode:T,hasRegions:N,loadingCountries:v,disableField:L,handleInputChange:l}=ue({defaultCountry:y,formName:"companyRegistration"}),[o,d]=$({countryCode:y,region:"",regionCode:"",regionId:"",street:["",""]});M(()=>{(async()=>{try{c(!0);const V=(await oe()).defaultCountry||"US";s(V),d(w=>({...w,countryCode:V}))}catch(I){console.error("Failed to load store config:",I)}finally{c(!1)}})()},[]),M(()=>{y&&!i&&l("countryCode",y)},[y,l,i]);const m=J({requiredFieldError:"Company.shared.validation.required",lengthTextError:"Company.FormText.lengthTextError",numericError:"Company.FormText.numericError",alphaNumWithSpacesError:"Company.FormText.alphaNumWithSpacesError",alphaNumericError:"Company.FormText.alphaNumericError",alphaError:"Company.FormText.alphaError",emailError:"Company.shared.validation.invalidEmail",phoneError:"Company.shared.validation.phoneInvalid",postalCodeError:"Company.shared.validation.postalCodeInvalid",urlError:"Company.FormText.urlError",nameError:"Company.FormText.nameError"}),b=J({title:"Company.shared.fields.title",submitButton:"Company.shared.fields.submit",submittingButton:"Company.shared.fields.submitting",cancelButton:"Company.shared.buttons.cancel",createCompanyError:"Company.shared.fields.createCompanyError",unexpectedError:"Company.shared.fields.unexpectedError",emailNotAvailable:"Company.shared.validation.emailNotAvailable",companyName:"Company.shared.fields.companyName",legalName:"Company.shared.fields.legalName",companyEmail:"Company.shared.fields.companyEmail",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId",street:"Company.shared.fields.street",streetLine2:"Company.shared.fields.streetLine2",city:"Company.shared.fields.city",country:"Company.shared.fields.country",stateProvince:"Company.shared.fields.stateProvince",postalCode:"Company.shared.fields.postalCode",telephone:"Company.shared.fields.telephone",adminJobTitle:"Company.shared.fields.adminJobTitle",adminWorkTelephone:"Company.shared.fields.adminWorkTelephone",adminEmail:"Company.shared.fields.adminEmail",adminFirstname:"Company.shared.fields.adminFirstname",adminLastname:"Company.shared.fields.adminLastname",adminGender:"Company.shared.fields.adminGender"}),S=G(()=>pe({formData:{countryCode:o.countryCode,regionCode:o.regionCode,regionId:o.regionId},isRequiredRegion:_,isRequiredPostCode:T,hasRegions:N,disableField:L,translations:b}).map(I=>I.code==="region"?{...I,required:_,disabled:v,fieldType:N?"SELECT":"TEXT",options:N?f.map(V=>({text:V.text,value:V.value,isDefault:!1})):[]}:I.code==="postcode"?{...I,required:T}:I.code==="countryCode"?{...I,disabled:L||v,options:E.map(V=>({text:V.text,value:V.value,isDefault:!1}))}:I),[_,T,N,v,L,E,f,o.countryCode,o.regionCode,o.regionId,b]),r=x=>{const I=Re(x,S,m);return t(I.fieldErrors),I.isValid},h=G(()=>Se({setFormData:d,hasRegions:N,regionOptions:f,fieldsConfig:S,formTranslations:m,setFieldErrors:t}),[N,f,S,m]);return{formValues:o,fieldErrors:g,isSubmitting:u,loadingStoreConfig:i,fieldsConfig:S,countryOptions:E,regionOptions:f,loadingCountries:v,handleInputChange:x=>{h.handleInputChangeFromValues(x),Object.entries(x).forEach(([I,V])=>{I==="countryCode"&&l("countryCode",V)})},handleBlur:x=>{const I=x.target,{name:V,value:w}=I,P=S.find(H=>H.customUpperCode===V);if(P){const H=Y(P.code,w,S,m);t(O=>({...O,[V]:H||""}))}},handleFormSubmit:async(x,I)=>{const V=x.target,w=new FormData(V),P={};for(const[X,U]of w.entries())P[X]=U;const H={...P,...o},O=r(H);if(!(!I||!O)){n(!0);try{const X=await ie(H.companyEmail);if(!X.isValid){t(j=>({...j,companyEmail:X.error||b.emailNotAvailable})),n(!1);return}const U=await te(H);if(U.success&&U.company)a==null||a(U.company);else{const j=U.errors||[b.createCompanyError];e==null||e(j)}}catch(X){const U=X instanceof Error?X.message:b.unexpectedError;e==null||e([U])}finally{n(!1)}}},translations:b,formTranslations:m}},xe=({onSuccess:a,onError:e,className:u="",slots:n,hideActionFormButtons:g=!1})=>{const{formValues:t,fieldErrors:y,isSubmitting:s,loadingStoreConfig:i,fieldsConfig:c,countryOptions:E,regionOptions:f,loadingCountries:_,handleInputChange:T,handleBlur:N,handleFormSubmit:v,translations:L}=Fe({onSuccess:a,onError:e});return C("div",{className:k(["company-form-wrapper",u]),children:[p("h2",{children:L.title}),p(me,{regionOptions:f,countryOptions:E,slots:n,className:"company-registration-form",name:"companyRegistrationForm",fieldsConfig:c,values:t,errors:y,onChange:T,onBlur:N,onSubmit:v,loading:s,showFormLoader:!1,children:!g&&p("div",{className:k(["company-form-wrapper__buttons"]),children:p(re,{type:"submit",disabled:s||i||_,className:"company-form-wrapper__submit",children:s?L.submittingButton:L.submitButton})})})]})},Ve=({company:a})=>{var g;const[e,u]=$(""),n=J({pendingApproval:"Company.CompanyRegistration.success.pendingApproval",companyDetails:"Company.CompanyRegistration.success.companyDetails",companyName:"Company.shared.fields.companyName",companyEmail:"Company.shared.fields.companyEmail",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId",address:"Company.shared.fields.legalAddress",street:"Company.shared.fields.street",city:"Company.shared.fields.city",stateProvince:"Company.shared.fields.stateProvince",postcode:"Company.shared.fields.postcode",country:"Company.shared.fields.country",telephone:"Company.shared.fields.telephone",companyAdmin:"Company.shared.fields.companyAdmin",adminFirstname:"Company.shared.fields.adminFirstname",adminLastname:"Company.shared.fields.adminLastname",adminEmail:"Company.shared.fields.adminEmail",adminJobTitle:"Company.shared.fields.adminJobTitle",adminWorkTelephone:"Company.shared.fields.adminWorkTelephone"});return M(()=>{(async()=>{var y;if((y=a.legalAddress)!=null&&y.countryCode)try{const{availableCountries:s}=await z(),i=s.find(c=>{var E;return c.value===((E=a.legalAddress)==null?void 0:E.countryCode)});i&&u(i.text)}catch(s){console.error("Failed to fetch countries:",s),u(a.legalAddress.countryCode)}})()},[(g=a.legalAddress)==null?void 0:g.countryCode]),C("div",{className:"company-registration-success",children:[p("div",{className:"company-registration-success__header",children:p("p",{className:"company-registration-success__pending",children:n.pendingApproval})}),C("div",{className:"company-registration-success__details",children:[p("h2",{className:"company-registration-success__details-title",children:n.companyDetails}),C("div",{className:"company-registration-success__grid",children:[C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.companyName,":"]}),p("span",{className:"company-registration-success__value",children:a.name})]}),a.legalName&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.legalName,":"]}),p("span",{className:"company-registration-success__value",children:a.legalName})]}),C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.companyEmail,":"]}),p("span",{className:"company-registration-success__value",children:a.email})]}),a.vatTaxId&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.vatTaxId,":"]}),p("span",{className:"company-registration-success__value",children:a.vatTaxId})]}),a.resellerId&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.resellerId,":"]}),p("span",{className:"company-registration-success__value",children:a.resellerId})]}),a.legalAddress&&C(W,{children:[p("div",{className:"company-registration-success__section-header",children:p("h3",{children:n.address})}),a.legalAddress.street&&a.legalAddress.street[0]&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.street,":"]}),p("span",{className:"company-registration-success__value",children:a.legalAddress.street.map((t,y)=>p("div",{children:t},y))})]}),a.legalAddress.city&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.city,":"]}),p("span",{className:"company-registration-success__value",children:a.legalAddress.city})]}),a.legalAddress.countryCode&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.country,":"]}),p("span",{className:"company-registration-success__value",children:e||a.legalAddress.countryCode})]}),a.legalAddress.region&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.stateProvince,":"]}),p("span",{className:"company-registration-success__value",children:a.legalAddress.region.region||a.legalAddress.region.regionCode})]}),a.legalAddress.postcode&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.postcode,":"]}),p("span",{className:"company-registration-success__value",children:a.legalAddress.postcode})]}),a.legalAddress.telephone&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.telephone,":"]}),p("span",{className:"company-registration-success__value",children:a.legalAddress.telephone})]})]}),a.companyAdmin&&C(W,{children:[p("div",{className:"company-registration-success__section-header",children:p("h3",{children:n.companyAdmin})}),a.companyAdmin.jobTitle&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.adminJobTitle,":"]}),p("span",{className:"company-registration-success__value",children:a.companyAdmin.jobTitle})]}),a.companyAdmin.telephone&&C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.adminWorkTelephone,":"]}),p("span",{className:"company-registration-success__value",children:a.companyAdmin.telephone})]}),C("div",{className:"company-registration-success__item",children:[C("span",{className:"company-registration-success__label",children:[n.adminEmail,":"]}),p("span",{className:"company-registration-success__value",children:a.companyAdmin.email})]})]})]})]})]})},je=({isAuthenticated:a=!1,onRedirectLogin:e,onRedirectAccount:u,onSuccess:n,onError:g,className:t,slots:y})=>{const[s,i]=$("loading"),[c,E]=$(null);M(()=>{let T=!0;return(async()=>{try{if(!await le()){if(T){const v=a?"redirect-account":"redirect-login";console.log(`Company registration disabled - redirecting to ${a?"account dashboard":"login page"}`),i(v)}return}if(a)try{if(await de()){T&&(console.log("User already belongs to a company - redirecting to account dashboard"),i("redirect-account"));return}}catch(v){console.error("Error checking company membership - redirecting to account dashboard:",v),T&&i("redirect-account");return}T&&i("show-form")}catch(N){console.error("Error checking B2B status:",N),T&&i(a?"redirect-account":"redirect-login")}})(),()=>{T=!1}},[a]),M(()=>{s==="redirect-login"&&e&&e(),s==="redirect-account"&&u&&u()},[s,e,u]);const f=T=>{i("success"),E(T),n==null||n(T)},_=T=>{g==null||g(T)};return s==="loading"||s==="redirect-login"||s==="redirect-account"?null:s==="success"&&c?p("div",{className:`company-registration-container ${t||""}`,children:p(Ve,{company:c})}):p("div",{className:`company-registration-container ${t||""}`,children:p(xe,{onSuccess:f,onError:_,slots:y})})};export{je as CompanyRegistration,je as default};
//# sourceMappingURL=CompanyRegistration.js.map
