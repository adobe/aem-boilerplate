/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as t,jsxs as m,Fragment as se}from"@dropins/tools/preact-jsx-runtime.js";import{useState as l,useRef as be,useEffect as D,useCallback as N,useMemo as u,createPortal as J}from"@dropins/tools/preact-compat.js";import{classes as i,VComponent as g,Slot as c}from"@dropins/tools/lib.js";import{f as K}from"../chunks/dateUtils.js";import{events as fe}from"@dropins/tools/event-bus.js";import{Skeleton as Me,SkeletonRow as M,Button as R,TextArea as Qe,InLineAlert as F,Icon as S}from"@dropins/tools/components.js";import{N as X}from"../chunks/transform-quote-template.js";import{A as he,T as Te}from"../chunks/TabbedContent.js";/* empty css                         */import"@dropins/tools/preact.js";import"@dropins/tools/preact-hooks.js";import{C as Y}from"../chunks/ConfirmationModal.js";/* empty css                        *//* empty css                          */import"../chunks/state.js";import{s as Ne,a as qe,o as _e}from"../chunks/openQuoteTemplate.js";import{g as ve}from"../chunks/generateQuoteFromTemplate.js";import{I as Ce}from"../chunks/ItemsQuotedTemplate.js";import{Q as ye}from"../chunks/QuoteTemplateCommentsList.js";import{Q as Le}from"../chunks/QuoteTemplateHistoryLog.js";import{useText as we}from"@dropins/tools/i18n.js";import"../chunks/transform-quote.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/NegotiableQuoteTemplateFragment.js";import"../chunks/LineItemNoteModal2.js";import"../chunks/addQuoteTemplateLineItemNote.js";import"../chunks/WarningFilled.js";import"../chunks/QuoteCommentsList.js";import"../chunks/QuoteHistoryLog.js";const xe=({className:a,loading:s,templateName:b,templateId:q,banner:e,details:_,actionBar:v,referenceDocuments:Q,referenceDocumentsTitle:d,itemsTable:h,commentsTitle:p,comments:f,footer:T,...C})=>s?t(Fe,{}):m("div",{...C,className:i(["quote-management-manage-negotiable-quote-template",a]),children:[m("div",{className:i(["quote-management-manage-negotiable-quote-template__header"]),children:[b&&t(g,{node:b,className:i(["quote-management-manage-negotiable-quote-template__template-name"])}),q&&t(g,{node:q,className:i(["quote-management-manage-negotiable-quote-template__template-id"])})]}),e&&t(g,{node:e,className:i(["quote-management-manage-negotiable-quote-template__banner"])}),_&&t(g,{node:_,className:i(["quote-management-manage-negotiable-quote-template__details"])}),v&&t(g,{node:v,className:i(["quote-management-manage-negotiable-quote-template__action-bar"])}),(d||Q)&&m("div",{"data-testid":"reference-documents-container",className:i(["quote-management-manage-negotiable-quote-template__reference-documents-container"]),children:[d&&t(g,{node:d,className:i(["quote-management-manage-negotiable-quote-template__reference-documents-title"])}),Q&&t(g,{node:Q,className:i(["quote-management-manage-negotiable-quote-template__reference-documents"])})]}),h&&t(g,{node:h,className:i(["quote-management-manage-negotiable-quote-template__items-table"])}),m("div",{"data-testid":"comments-container",className:i(["quote-management-manage-negotiable-quote-template__comments-container"]),children:[p&&t(g,{node:p,className:i(["quote-management-manage-negotiable-quote-template__comments-title"])}),f&&t(g,{node:f,className:i(["quote-management-manage-negotiable-quote-template__comments"])})]}),T&&t(g,{node:T,className:i(["quote-management-manage-negotiable-quote-template__footer"])})]}),Fe=()=>m(Me,{"data-testid":"manage-negotiable-quote-template-skeleton",children:[t(M,{variant:"heading",fullWidth:!0,size:"large"}),t(M,{variant:"row",fullWidth:!1,size:"small"}),t(M,{variant:"row",fullWidth:!1,size:"small"}),t(M,{variant:"row",fullWidth:!0}),t(M,{variant:"row",fullWidth:!0,size:"xlarge",lines:2}),t(M,{variant:"row",fullWidth:!1,size:"small"})]}),ia=({slots:a,onActionsButtonClick:s,onSendForReview:b,...q})=>{const[e,_]=l(void 0),[v,Q]=l(!0),[d,h]=l(""),[p,f]=l(!1),[T,C]=l(!1),[k,A]=l(!1),[H,y]=l(""),[B,L]=l(""),[G,W]=l(!1),[P,z]=l(!1),[O,w]=l(""),[j,x]=l(""),$=be(!1),n=we({createdLabel:"NegotiableQuoteTemplate.Manage.createdLabel",salesRepLabel:"NegotiableQuoteTemplate.Manage.salesRepLabel",expiresLabel:"NegotiableQuoteTemplate.Manage.expiresLabel",actionsLabel:"NegotiableQuoteTemplate.Manage.actionsLabel",referenceDocumentsTitle:"NegotiableQuoteTemplate.Manage.referenceDocuments.title",commentsTitle:"NegotiableQuoteTemplate.Manage.comments.title",historyLogTitle:"NegotiableQuoteTemplate.Manage.historyLog.title",itemsQuotedTab:"NegotiableQuoteTemplate.Manage.tabs.itemsQuoted",commentsTab:"NegotiableQuoteTemplate.Manage.tabs.comments",historyLogTab:"NegotiableQuoteTemplate.Manage.tabs.historyLog",templateCommentsPlaceholder:"NegotiableQuoteTemplate.Manage.templateComments.placeholder",sendForReview:"NegotiableQuoteTemplate.Manage.actionButtons.sendForReview",accept:"NegotiableQuoteTemplate.Manage.actionButtons.accept",generateQuote:"NegotiableQuoteTemplate.Manage.actionButtons.generateQuote",generateQuoteModalTitle:"NegotiableQuoteTemplate.Manage.actionButtons.generateQuote",generateQuoteModalMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.message",generateQuoteModalCancel:"NegotiableQuoteTemplate.Manage.confirmationModal.cancel",generateQuoteModalConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.confirm",generateQuoteModalConfirmLoading:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.confirmLoading",generateQuoteModalSuccessHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.successHeading",generateQuoteSuccessMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.successDescription",generateQuoteModalErrorHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.errorHeading",generateQuoteErrorFallback:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.errorFallback",acceptModalTitle:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.title",acceptModalMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.message",acceptModalCancel:"NegotiableQuoteTemplate.Manage.confirmationModal.cancel",acceptModalConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.confirm",acceptModalConfirmLoading:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.confirmLoading",acceptModalSuccessHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.successHeading",acceptSuccessMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.successDescription",acceptModalErrorHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.errorHeading",acceptErrorFallback:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.errorFallback"});D(()=>{const o=fe.on("quote-management/quote-template-data",r=>{r.quoteTemplate&&(_(r.quoteTemplate),Q(!1),h(""),f(!1))},{eager:!0});return()=>o==null?void 0:o.off()},[]),D(()=>{e&&e.status===X.UPDATED&&!$.current&&($.current=!0,(async()=>{try{await _e({templateId:e.id})}catch(r){console.error("Failed to auto-open quote template:",r)}})())},[e]);const U=N(async()=>{if(b){b({templateData:e,comment:d.trim()||void 0});return}f(!0);try{await Ne({templateId:e.id,comment:d.trim()||void 0})}catch(o){console.error("Failed to send quote template for review:",o),f(!1)}},[e,b,d]),Z=N(async()=>{A(!0),L(""),y("");try{await ve({templateId:e.id}),y(n.generateQuoteSuccessMessage)}catch(o){console.error("Failed to generate quote from template:",o);const r=o instanceof Error?o.message:n.generateQuoteErrorFallback;L(r)}finally{A(!1)}},[e,n.generateQuoteSuccessMessage,n.generateQuoteErrorFallback]),ee=N(()=>{C(!1),L(""),y("")},[]),ae=N(async()=>{z(!0),x(""),w("");try{await qe({templateId:e.id}),w(n.acceptSuccessMessage)}catch(o){console.error("Failed to accept quote template:",o);const r=o instanceof Error?o.message:n.acceptErrorFallback;x(r)}finally{z(!1)}},[e,n.acceptSuccessMessage,n.acceptErrorFallback]),te=N(()=>{W(!1),x(""),w("")},[]),ne=u(()=>t(c,{name:"TemplateName",slot:a==null?void 0:a.TemplateName,context:{templateName:e==null?void 0:e.name,templateData:e},children:t("h1",{"data-testid":"template-name",children:e==null?void 0:e.name})}),[a==null?void 0:a.TemplateName,e]),oe=u(()=>t(c,{name:"TemplateId",slot:a==null?void 0:a.TemplateId,context:{templateId:e==null?void 0:e.uid,templateData:e},children:m("div",{"data-testid":"template-id",children:["Template #",e==null?void 0:e.uid]})}),[a==null?void 0:a.TemplateId,e]),re=u(()=>{if(!e)return;const o=e.expirationDate?K(e.expirationDate,"short"):void 0;return m(c,{name:"Details",slot:a==null?void 0:a.Details,context:{templateData:e},children:[m("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[t("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"created-label",children:n.createdLabel}),m("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"created-value",children:[K(e.createdAt,"short")," (",e.buyer.firstname," ",e.buyer.lastname,")"]})]}),m("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[t("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"sales-rep-label",children:n.salesRepLabel}),t("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"sales-rep-value",children:e.salesRepName})]}),o&&m("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[t("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"expires-label",children:n.expiresLabel}),t("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"expires-value",children:o})]})]})},[a==null?void 0:a.Details,n,e]),V=u(()=>[{label:n.generateQuote,value:"generateQuote",disabled:!(e!=null&&e.canGenerateQuoteFromTemplate)}],[n,e==null?void 0:e.canGenerateQuoteFromTemplate]),ie=u(()=>{const o=r=>{switch(r){case"generateQuote":C(!0),L(""),y(""),s==null||s(r);break}};return t(c,{name:"ActionBar",slot:a==null?void 0:a.ActionBar,context:{templateData:e},children:t(he,{dropdownPlaceholder:n.actionsLabel,dropdownOptions:[],buttons:V.map(r=>t(R,{variant:"tertiary",onClick:()=>o(r.value),"data-testid":`actions-bar-${r.value}-button`,"data-action":r.value,disabled:r.disabled,children:r.label},r.value))})})},[V,n,a==null?void 0:a.ActionBar,e,s]),ce=u(()=>{if(!(!(e!=null&&e.referenceDocuments)||e.referenceDocuments.length===0))return t(c,{name:"ReferenceDocumentsTitle",slot:a==null?void 0:a.ReferenceDocumentsTitle,context:{templateData:e},children:t("h2",{children:n.referenceDocumentsTitle})})},[a==null?void 0:a.ReferenceDocumentsTitle,n,e]),me=u(()=>{if(!(!(e!=null&&e.referenceDocuments)||e.referenceDocuments.length===0))return t(c,{name:"ReferenceDocuments",slot:a==null?void 0:a.ReferenceDocuments,context:{templateData:e},children:t("ul",{"data-testid":"reference-documents",children:e.referenceDocuments.map(o=>t("li",{children:t("a",{href:o.url,target:"_blank",rel:"noopener noreferrer",children:o.name})},o.uid))})})},[a==null?void 0:a.ReferenceDocuments,e]),le=u(()=>t(c,{name:"ItemsTable",slot:a==null?void 0:a.ItemsTable,context:{templateData:e},children:t(Te,{tabs:new Map([["items-quoted",n.itemsQuotedTab],["comments",n.commentsTab],["history-log",n.historyLogTab]]),tabsContent:new Map([["items-quoted",t(c,{name:"ItemsQuotedTab",slot:a==null?void 0:a.ItemsQuotedTab,context:{templateData:e},children:t(Ce,{templateData:e})},"items-quoted")],["comments",t(c,{name:"CommentsTab",slot:a==null?void 0:a.CommentsTab,context:{templateData:e},children:t(ye,{templateData:e})},"comments")],["history-log",t(c,{name:"HistoryLogTab",slot:a==null?void 0:a.HistoryLogTab,context:{templateData:e},children:t(Le,{templateData:e})},"history-log")]])})}),[a==null?void 0:a.ItemsTable,a==null?void 0:a.ItemsQuotedTab,a==null?void 0:a.CommentsTab,a==null?void 0:a.HistoryLogTab,n,e]),de=u(()=>t(c,{name:"CommentsTitle",slot:a==null?void 0:a.CommentsTitle,context:{templateData:e},children:t("h2",{children:n.commentsTitle})}),[a==null?void 0:a.CommentsTitle,n,e]),ue=u(()=>t(c,{name:"Comments",slot:a==null?void 0:a.Comments,context:{templateData:e},children:t(Qe,{name:"templateComments",placeholder:n.templateCommentsPlaceholder,rows:3,value:d,onInput:o=>{h(o.target.value)},disabled:!(e!=null&&e.canSendForReview)||p})}),[a==null?void 0:a.Comments,n,e,d,p]),ge=u(()=>{const o=(e==null?void 0:e.status)===X.OPEN&&(e==null?void 0:e.canAccept);return m(c,{name:"Footer",slot:a==null?void 0:a.Footer,context:{templateData:e,comment:d,isSubmitting:p},children:[o&&t(R,{variant:"primary",onClick:()=>{W(!0),x(""),w("")},"data-testid":"accept-button",disabled:p,children:n.accept}),(e==null?void 0:e.canSendForReview)&&t(R,{variant:"primary",onClick:U,"data-testid":"send-for-review-button",disabled:p,children:n.sendForReview})]})},[a==null?void 0:a.Footer,n,e,d,p,U]),pe={...q,loading:v,templateName:ne,templateId:oe,details:re,actionBar:ie,referenceDocumentsTitle:ce,referenceDocuments:me,itemsTable:le,commentsTitle:de,comments:ue,footer:ge};let I=null;H?I=t(F,{type:"success",variant:"primary",icon:t(S,{source:"CheckWithCircle"}),heading:n.generateQuoteModalSuccessHeading,description:H,"data-testid":"generate-quote-success-banner"}):B&&(I=t(F,{type:"error",variant:"primary",icon:t(S,{source:"WarningFilled"}),heading:n.generateQuoteModalErrorHeading,description:B,"data-testid":"generate-quote-error-banner"}));let E=null;return O?E=t(F,{type:"success",variant:"primary",icon:t(S,{source:"CheckWithCircle"}),heading:n.acceptModalSuccessHeading,description:O,"data-testid":"accept-success-banner"}):j&&(E=t(F,{type:"error",variant:"primary",icon:t(S,{source:"WarningFilled"}),heading:n.acceptModalErrorHeading,description:j,"data-testid":"accept-error-banner"})),m(se,{children:[t(xe,{...pe}),T&&J(t(Y,{open:T,title:n.generateQuoteModalTitle,message:n.generateQuoteModalMessage,cancelLabel:n.generateQuoteModalCancel,confirmLabel:k?n.generateQuoteModalConfirmLoading:n.generateQuoteModalConfirm,onCancel:ee,onConfirm:k?void 0:Z,showCloseButton:!0,confirmationBanner:I,"data-testid":"generate-quote-confirmation-modal"}),document.body),G&&J(t(Y,{open:G,title:n.acceptModalTitle,message:n.acceptModalMessage,cancelLabel:n.acceptModalCancel,confirmLabel:P?n.acceptModalConfirmLoading:n.acceptModalConfirm,onCancel:te,onConfirm:P?void 0:ae,showCloseButton:!0,confirmationBanner:E,"data-testid":"accept-confirmation-modal"}),document.body)]})};export{ia as ManageNegotiableQuoteTemplate,ia as default};
//# sourceMappingURL=ManageNegotiableQuoteTemplate.js.map
