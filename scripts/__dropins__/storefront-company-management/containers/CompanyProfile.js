/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as a,jsxs as g,Fragment as Q}from"@dropins/tools/preact-jsx-runtime.js";import{classes as re,Slot as X}from"@dropins/tools/lib.js";import{Card as K,Button as ae,Field as L,Input as M,Picker as pe,Header as he,InLineAlert as ye,Skeleton as ve,SkeletonRow as ee}from"@dropins/tools/components.js";import{useState as $,useEffect as q,useMemo as J,useRef as te,useCallback as R}from"@dropins/tools/preact-hooks.js";import{g as ge,v as Ce,a as Ee,u as be}from"../chunks/getCountries.js";import{useText as j}from"@dropins/tools/i18n.js";import*as S from"@dropins/tools/preact-compat.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/fetch-graphql.js";const Ne=({company:t,slots:e,showEditForm:n,handleShowEditForm:p})=>{const i=j({editButton:"Company.shared.buttons.edit",noDataMessage:"Company.CompanyProfile.companyProfileCard.noDataMessage",companyName:"Company.shared.fields.companyName",email:"Company.shared.fields.email",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId",legalAddress:"Company.shared.fields.legalAddress",contacts:"Company.CompanyProfile.companyProfileCard.contacts",companyAdministrator:"Company.CompanyProfile.companyProfileCard.companyAdministrator",salesRepresentative:"Company.CompanyProfile.companyProfileCard.salesRepresentative",paymentInformation:"Company.CompanyProfile.companyProfileCard.paymentInformation",shippingInformation:"Company.CompanyProfile.companyProfileCard.shippingInformation",availablePaymentMethods:"Company.CompanyProfile.companyProfileCard.availablePaymentMethods",availableShippingMethods:"Company.CompanyProfile.companyProfileCard.availableShippingMethods",noPaymentMethods:"Company.CompanyProfile.companyProfileCard.noPaymentMethods",noShippingMethods:"Company.CompanyProfile.companyProfileCard.noShippingMethods"}),o=i.paymentInformation||"Payment Information",r=i.availablePaymentMethods||"Available Payment Methods",h=i.shippingInformation||"Shipping Information",_=i.availableShippingMethods||"Available Shipping Methods",s=i.noPaymentMethods||"This company has no payment methods. Please contact store administrator.",m=i.noShippingMethods||"This company has no shipping methods. Please contact store administrator.";if(!t)return a(K,{variant:"secondary",className:"account-company-profile-card",children:a("div",{className:"account-company-profile-card__wrapper",children:a("div",{className:"account-company-profile-card__content",children:a("div",{className:"account-company-profile-card__no-data",children:a("p",{children:i.noDataMessage})})})})});const d=t.permissionsFlags||{canViewAccount:!0,canEditAccount:!!t.canEdit,canViewAddress:!0,canEditAddress:!!t.canEdit,canViewContacts:!0,canViewPaymentInformation:!0,canViewShippingInformation:!0},f=[d.canViewAccount?{name:"name",label:i.companyName,value:t.name||""}:null,d.canViewAccount?{name:"email",label:i.email,value:t.email||""}:null,d.canViewAccount?{name:"legal_name",label:i.legalName,value:t.legal_name||""}:null,d.canViewAccount?{name:"vat_tax_id",label:i.vatTaxId,value:t.vat_tax_id||""}:null,d.canViewAccount?{name:"reseller_id",label:i.resellerId,value:t.reseller_id||""}:null].filter(Boolean);return a(K,{variant:"secondary",className:re(["account-company-profile-card",["account-company-profile-card-short",n]]),children:g("div",{className:"account-company-profile-card__wrapper",children:[a("div",{className:"account-company-profile-card__actions",children:!!t.canEdit&&a(ae,{type:"button",variant:"tertiary",onClick:p,children:i.editButton})}),g("div",{className:"account-company-profile-card__content",children:[(e==null?void 0:e.CompanyDataBefore)&&a(X,{name:"CompanyDataBefore",slot:e.CompanyDataBefore,context:{companyData:f}}),(()=>{var b,V;const v=g(Q,{children:[f.map((l,E)=>{if(!l.value)return null;const T=l.label?`${l.label}: ${l.value}`:l.value;return a("p",{"data-testid":`${l.name}_${E}`,children:T},`${l.name}_${E}`)}),d.canViewAddress&&t.legal_address&&g("div",{className:"company-legal-address",children:[a("p",{children:g("strong",{children:[i.legalAddress,":"]})}),(b=t.legal_address.street)==null?void 0:b.map((l,E)=>a("p",{children:l},E)),g("p",{children:[t.legal_address.city,", ",(V=t.legal_address.region)==null?void 0:V.region," ",t.legal_address.postcode]}),a("p",{children:t.legal_address.countryCode}),t.legal_address.telephone&&g("p",{children:["Phone: ",t.legal_address.telephone]})]}),d.canViewContacts&&(t.company_admin||t.sales_representative)&&g("div",{className:"company-contacts",children:[a("p",{children:g("strong",{children:[i.contacts,":"]})}),t.company_admin&&g("div",{className:"company-contact",children:[a("p",{children:g("strong",{children:[i.companyAdministrator,":"]})}),g("p",{children:[t.company_admin.firstname," ",t.company_admin.lastname]}),t.company_admin.job_title&&a("p",{children:t.company_admin.job_title}),a("p",{children:t.company_admin.email})]}),t.sales_representative&&g("div",{className:"company-contact",children:[a("p",{children:g("strong",{children:[i.salesRepresentative,":"]})}),g("p",{children:[t.sales_representative.firstname," ",t.sales_representative.lastname]}),a("p",{children:t.sales_representative.email})]})]}),d.canViewPaymentInformation&&g("div",{className:"company-payment-methods",children:[a("p",{children:g("strong",{children:[o,":"]})}),t.available_payment_methods&&t.available_payment_methods.length>0?g(Q,{children:[a("p",{children:g("strong",{children:[r,":"]})}),a("ul",{className:"payment-methods-list",children:t.available_payment_methods.map((l,E)=>a("li",{children:l.title},`payment_${E}`))})]}):a("div",{className:"message message-notice notice",children:a("div",{children:s})})]}),d.canViewShippingInformation&&g("div",{className:"company-shipping-methods",children:[a("p",{children:g("strong",{children:[h,":"]})}),t.available_shipping_methods&&t.available_shipping_methods.length>0?g(Q,{children:[a("p",{children:g("strong",{children:[_,":"]})}),a("ul",{className:"shipping-methods-list",children:t.available_shipping_methods.map((l,E)=>a("li",{children:l.title},`shipping_${E}`))})]}):a("div",{className:"message message-notice notice",children:a("div",{children:m})})]})]});return e!=null&&e.CompanyData?a(X,{name:"CompanyData",slot:e.CompanyData,context:{companyData:f,Default:v}}):v})(),(e==null?void 0:e.CompanyDataAfter)&&a(X,{name:"CompanyDataAfter",slot:e.CompanyDataAfter,context:{companyData:f}})]})]})})},we=t=>{const[e,n]=$(null),[p,i]=$(!0);q(()=>{let s=!0;return ge().then(({availableCountries:m,countriesWithRequiredRegion:d,optionalZipCountries:f})=>{s&&(n({availableCountries:m,countriesWithRequiredRegion:d,optionalZipCountries:f}),i(!1))}).catch(()=>{s&&i(!1)}),()=>{s=!1}},[]);const o=J(()=>(e==null?void 0:e.availableCountries)||[],[e]),r=J(()=>{if(!t||!e)return[];const s=e.availableCountries.find(m=>m.value===t);return!(s!=null&&s.availableRegions)||s.availableRegions.length===0?[]:s.availableRegions.map(m=>({text:m.name,value:`${m.code},${m.id}`}))},[t,e]),h=J(()=>!t||!e?!1:e.countriesWithRequiredRegion.includes(t),[t,e]),_=J(()=>r.length>0,[r]);return{countryOptions:o,regionOptions:r,isRegionRequired:h,hasRegionOptions:_,loadingCountries:p}},Ae=({loading:t,value:e,errors:n,touched:p,onChange:i,onBlur:o,namePrefix:r="",fieldPathPrefix:h=""})=>{const _=j({companyName:"Company.shared.fields.companyName",email:"Company.shared.fields.email",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId"}),s=r?`${r}_`:"",m=d=>h?`${h}.${d}`:d;return g("div",{className:"account-edit-company-profile-form__group",children:[a(L,{label:_.companyName,required:!0,className:"account-edit-company-profile-form__field",error:p.name&&n.name?n.name:void 0,children:a(M,{name:`${s}name`,type:"text",value:e.name,onValue:i(m("name")),onBlur:()=>o(m("name")),disabled:!!t,variant:"primary",size:"medium"})}),a(L,{label:_.email,required:!0,className:"account-edit-company-profile-form__field",error:p.email&&n.email?n.email:void 0,children:a(M,{name:`${s}email`,type:"email",value:e.email,onValue:i(m("email")),onBlur:()=>o(m("email")),disabled:!!t,variant:"primary",size:"medium"})}),a(L,{label:_.legalName,className:"account-edit-company-profile-form__field",children:a(M,{name:`${s}legal_name`,type:"text",value:e.legal_name,onValue:i(m("legal_name")),disabled:!!t,variant:"primary",size:"medium"})}),a(L,{label:_.vatTaxId,className:"account-edit-company-profile-form__field",children:a(M,{name:`${s}vat_tax_id`,type:"text",value:e.vat_tax_id,onValue:i(m("vat_tax_id")),disabled:!!t,variant:"primary",size:"medium"})}),a(L,{label:_.resellerId,className:"account-edit-company-profile-form__field",children:a(M,{name:`${s}reseller_id`,type:"text",value:e.reseller_id,onValue:i(m("reseller_id")),disabled:!!t,variant:"primary",size:"medium"})})]})},Pe=({loading:t,loadingCountries:e,value:n,errors:p,touched:i,onChange:o,onBlur:r,countryOptions:h,regionOptions:_,isRegionRequired:s,hasRegionOptions:m,namePrefix:d="legal_address",fieldPathPrefix:f="legal_address",requiredConfig:v})=>{var T;const b=j({legalAddress:"Company.shared.fields.legalAddress",streetAddress:"Company.shared.fields.streetAddress",city:"Company.shared.fields.city",country:"Company.shared.fields.country",stateProvince:"Company.shared.fields.stateProvince",zipPostalCode:"Company.shared.fields.zipPostalCode",phoneNumber:"Company.shared.fields.phoneNumber"}),V={street:`${d}_street`,street_2:`${d}_street_2`,city:`${d}_city`,country_code:`${d}_country_code`,region:`${d}_region`,postcode:`${d}_postcode`,telephone:`${d}_telephone`},l={street:`${f}.street`,street_2:`${f}.street_2`,city:`${f}.city`,country_code:`${f}.country_code`,region:`${f}.region`,region_code:`${f}.region_code`,postcode:`${f}.postcode`,telephone:`${f}.telephone`},E={street:(v==null?void 0:v.street)??!0,city:(v==null?void 0:v.city)??!0,postcode:(v==null?void 0:v.postcode)??!0,telephone:(v==null?void 0:v.telephone)??!0};return g("div",{className:"account-edit-company-profile-form__section",children:[a("h3",{className:"account-edit-company-profile-form__section-title",children:b.legalAddress}),a(L,{label:b.streetAddress,required:E.street,className:"account-edit-company-profile-form__field",error:i[l.street]&&p[l.street]?p[l.street]:void 0,children:a(M,{name:V.street,type:"text",value:n.street,onValue:o(l.street),onBlur:()=>r(l.street),disabled:!!t,variant:"primary",size:"medium"})}),a(L,{label:`${b.streetAddress} 2`,className:"account-edit-company-profile-form__field",children:a(M,{name:V.street_2,type:"text",value:n.street_2,onValue:o(l.street_2),disabled:!!t,variant:"primary",size:"medium"})}),a(L,{label:b.city,required:E.city,className:"account-edit-company-profile-form__field",error:i[l.city]&&p[l.city]?p[l.city]:void 0,children:a(M,{name:V.city,type:"text",value:n.city,onValue:o(l.city),onBlur:()=>r(l.city),disabled:!!t,variant:"primary",size:"medium"})}),a(L,{label:b.country,required:!0,className:"account-edit-company-profile-form__field",error:i[l.country_code]&&p[l.country_code]?p[l.country_code]:void 0,children:a(pe,{name:V.country_code,floatingLabel:`${b.country} *`,placeholder:b.country,options:h,value:n.country_code,handleSelect:A=>{const k=A.target;o(l.country_code)(k.value)},onBlur:()=>r(l.country_code),disabled:!!t||e})}),a(L,{label:b.stateProvince,required:s,className:"account-edit-company-profile-form__field",error:i["legal_address.region"]&&p["legal_address.region"]?p["legal_address.region"]:void 0,children:m?a(pe,{name:"legal_address_region",floatingLabel:`${b.stateProvince} ${s?"*":""}`,placeholder:b.stateProvince,options:_,value:n.region_code&&((T=_.find(A=>A.value.split(",")[0]===n.region_code))==null?void 0:T.value)||"",handleSelect:A=>{var W;const k=A.target,[z]=k.value.split(","),H=((W=_.find(I=>I.value===k.value))==null?void 0:W.text)||"";o(l.region)(H),o(l.region_code)(z)},onBlur:()=>r(l.region),disabled:!!t||e},`region_picker_${n.country_code}`):a(M,{name:V.region,type:"text",value:n.region,onValue:o(l.region),onBlur:()=>r(l.region),disabled:!!t||e,variant:"primary",size:"medium"},`region_input_${n.country_code}`)}),a(L,{label:b.zipPostalCode,required:E.postcode,className:"account-edit-company-profile-form__field",error:i[l.postcode]&&p[l.postcode]?p[l.postcode]:void 0,children:a(M,{name:V.postcode,type:"text",value:n.postcode,onValue:o(l.postcode),onBlur:()=>r(l.postcode),disabled:!!t,variant:"primary",size:"medium"})}),a(L,{label:b.phoneNumber,required:E.telephone,className:"account-edit-company-profile-form__field",error:i[l.telephone]&&p[l.telephone]?p[l.telephone]:void 0,children:a(M,{name:V.telephone,type:"tel",value:n.telephone,onValue:o(l.telephone),onBlur:()=>r(l.telephone),disabled:!!t,variant:"primary",size:"medium"})})]})},Ve=({inLineAlertProps:t,company:e,loading:n=!1,onSubmit:p,onCancel:i})=>{var I,O,U,Y,G,C,x,B,Z,se,ne,le,ie,oe;const o=j({title:"Company.EditCompanyProfile.title",cancel:"Company.shared.buttons.cancel",save:"Company.shared.buttons.save",saving:"Company.shared.buttons.saving",required:"Company.shared.validation.required",invalidEmail:"Company.shared.validation.invalidEmail",companyNameRequired:"Company.shared.validation.companyNameRequired",emailRequired:"Company.shared.validation.emailRequired",emailNotAvailable:"Company.shared.validation.emailNotAvailable"}),[r,h]=$({name:(e==null?void 0:e.name)||"",email:(e==null?void 0:e.email)||"",legal_name:(e==null?void 0:e.legal_name)||"",vat_tax_id:(e==null?void 0:e.vat_tax_id)||"",reseller_id:(e==null?void 0:e.reseller_id)||"",legal_address:{street:((O=(I=e==null?void 0:e.legal_address)==null?void 0:I.street)==null?void 0:O[0])||"",street_2:((Y=(U=e==null?void 0:e.legal_address)==null?void 0:U.street)==null?void 0:Y[1])||"",city:((G=e==null?void 0:e.legal_address)==null?void 0:G.city)||"",region:((x=(C=e==null?void 0:e.legal_address)==null?void 0:C.region)==null?void 0:x.region)||"",region_code:((Z=(B=e==null?void 0:e.legal_address)==null?void 0:B.region)==null?void 0:Z.regionCode)||"",country_code:((se=e==null?void 0:e.legal_address)==null?void 0:se.countryCode)||"",postcode:((ne=e==null?void 0:e.legal_address)==null?void 0:ne.postcode)||"",telephone:((le=e==null?void 0:e.legal_address)==null?void 0:le.telephone)||""}}),[_,s]=$({}),[m,d]=$({}),f=((ie=e==null?void 0:e.permissionsFlags)==null?void 0:ie.canEditAccount)===!0,v=((oe=e==null?void 0:e.permissionsFlags)==null?void 0:oe.canEditAddress)===!0,{countryOptions:b,regionOptions:V,isRegionRequired:l,hasRegionOptions:E,loadingCountries:T}=we(r.legal_address.country_code),A=(u,y)=>u==="name"?y.trim()?null:o.companyNameRequired:u==="email"?y.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(y)?null:o.invalidEmail:o.emailRequired:u==="legal_address.street"||u==="legal_address.city"||u==="legal_address.postcode"||u==="legal_address.telephone"||u==="legal_address.country_code"?y.trim()?null:o.required:u==="legal_address.region"&&l&&!y.trim()?o.required:null,k=()=>{var F,P;const u={};let y=!0;const D=!!((F=e==null?void 0:e.permissionsFlags)!=null&&F.canEditAccount)||!!(e!=null&&e.canEdit),N=!!((P=e==null?void 0:e.permissionsFlags)!=null&&P.canEditAddress)||!!(e!=null&&e.canEdit);if(D){const c=A("name",r.name);c&&(u.name=c,y=!1);const w=A("email",r.email);w&&(u.email=w,y=!1)}if(N){const c=A("legal_address.street",r.legal_address.street);c&&(u["legal_address.street"]=c,y=!1);const w=A("legal_address.city",r.legal_address.city);w&&(u["legal_address.city"]=w,y=!1);const de=A("legal_address.postcode",r.legal_address.postcode);de&&(u["legal_address.postcode"]=de,y=!1);const ce=A("legal_address.telephone",r.legal_address.telephone);ce&&(u["legal_address.telephone"]=ce,y=!1);const me=A("legal_address.country_code",r.legal_address.country_code);me&&(u["legal_address.country_code"]=me,y=!1);const ue=A("legal_address.region",r.legal_address.region);ue&&(u["legal_address.region"]=ue,y=!1)}return s(u),y},z=async u=>{var F,P;u.preventDefault();const y=((F=e==null?void 0:e.permissionsFlags)==null?void 0:F.canEditAccount)===!0,D=((P=e==null?void 0:e.permissionsFlags)==null?void 0:P.canEditAddress)===!0,N={};if(y&&(N.name=!0,N.email=!0,N.legal_name=!0,N.vat_tax_id=!0,N.reseller_id=!0),D&&(N["legal_address.street"]=!0,N["legal_address.street_2"]=!0,N["legal_address.city"]=!0,N["legal_address.region"]=!0,N["legal_address.region_code"]=!0,N["legal_address.country_code"]=!0,N["legal_address.postcode"]=!0,N["legal_address.telephone"]=!0),d(N),!!k()){if(y&&r.email!==(e==null?void 0:e.email)){const c=await Ce(r.email);if(!c.isValid){s(w=>({...w,email:c.error||o.emailNotAvailable}));return}}if(p){const c={};y&&(c.name=r.name,c.email=r.email,c.legal_name=r.legal_name,c.vat_tax_id=r.vat_tax_id,c.reseller_id=r.reseller_id),D&&(c.legal_address={street:[r.legal_address.street,r.legal_address.street_2].filter(Boolean),city:r.legal_address.city,region:{region:r.legal_address.region,region_code:r.legal_address.region_code},country_code:r.legal_address.country_code,postcode:r.legal_address.postcode,telephone:r.legal_address.telephone}),await p(c)}}},H=u=>y=>{const D=new Set(["name","email","legal_name","vat_tax_id","reseller_id"]),N=u.startsWith("legal_address.");if(!(D.has(u)&&!f||N&&!v)){if(u.startsWith("legal_address.")){const P=u.split(".")[1];P==="country_code"?(h(c=>({...c,legal_address:{...c.legal_address,[P]:y,region:"",region_code:""}})),s(c=>{const w={...c};return delete w["legal_address.region"],delete w["legal_address.region_code"],w}),d(c=>{const w={...c};return delete w["legal_address.region"],delete w["legal_address.region_code"],w})):h(P==="region"?c=>({...c,legal_address:{...c.legal_address,region:y,region_code:E?c.legal_address.region_code:y}}):c=>({...c,legal_address:{...c.legal_address,[P]:y}}))}else h(P=>({...P,[u]:y}));_[u]&&s(P=>{const c={...P};return delete c[u],c})}},W=u=>{const y=new Set(["name","email","legal_name","vat_tax_id","reseller_id"]),D=u.startsWith("legal_address.");if(y.has(u)&&!f||D&&!v)return;d(c=>({...c,[u]:!0}));let F="";if(u.startsWith("legal_address.")){const c=u.split(".")[1],w=r.legal_address[c];F=typeof w=="string"?w:""}else{const c=r[u];F=typeof c=="string"?c:""}const P=A(u,F);P&&s(c=>({...c,[u]:P}))};return g(K,{variant:"secondary",className:"account-edit-company-profile",children:[a(he,{title:o.title,divider:!1,className:"account-edit-company-profile__title"}),t!=null&&t.text?a(ye,{className:"account-edit-company-profile__notification",type:t.type,variant:"secondary",heading:t.text,icon:t.icon,"data-testid":"editCompanyInLineAlert"}):null,g("form",{className:"account-edit-company-profile-form",onSubmit:z,children:[f&&a(Ae,{loading:n,value:{name:r.name,email:r.email,legal_name:r.legal_name,vat_tax_id:r.vat_tax_id,reseller_id:r.reseller_id},errors:_,touched:m,onChange:H,onBlur:W}),v&&a(Pe,{loading:n,loadingCountries:T,value:r.legal_address,errors:_,touched:m,onChange:H,onBlur:W,countryOptions:b,regionOptions:V,isRegionRequired:l,hasRegionOptions:E}),g("div",{className:"account-edit-company-profile__actions",children:[a(ae,{disabled:n,type:"button",variant:"secondary",onClick:()=>i==null?void 0:i(),children:o.cancel}),a(ae,{disabled:n||!f&&!v,type:"submit",variant:"primary",children:n?o.saving:o.save})]})]})]})},$e=({testId:t,withCard:e=!0})=>{const n=g(ve,{"data-testid":t||"companySkeletonLoader",children:[a(ee,{variant:"heading",size:"xlarge",fullWidth:!1,lines:1}),a(ee,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1}),a(ee,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1})]});return e?n:a(K,{variant:"secondary",className:re(["company-company-loaders","company-company-loaders--card-loader"]),children:n})},xe=function(){const e=typeof document<"u"&&document.createElement("link").relList;return e&&e.supports&&e.supports("modulepreload")?"modulepreload":"preload"}(),Se=function(t){return"/"+t},_e={},Ie=function(e,n,p){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),h=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));i=Promise.allSettled(n.map(_=>{if(_=Se(_),_ in _e)return;_e[_]=!0;const s=_.endsWith(".css"),m=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${_}"]${m}`))return;const d=document.createElement("link");if(d.rel=s?"stylesheet":xe,s||(d.as="script"),d.crossOrigin="",d.href=_,h&&d.setAttribute("nonce",h),document.head.appendChild(d),s)return new Promise((f,v)=>{d.addEventListener("load",f),d.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${_}`)))})}))}function o(r){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=r,window.dispatchEvent(h),!h.defaultPrevented)throw r}return i.then(r=>{for(const h of r||[])h.status==="rejected"&&o(h.reason);return e().catch(o)})};var fe=(t=>(t.EDIT_COMPANY_EVENT="edit-company",t))(fe||{});const Le={EDIT_COMPANY_EVENT:"edit-company"},Me=()=>(window.adobeDataLayer||(window.adobeDataLayer=[]),window.adobeDataLayer),Re=t=>{Me().push(n=>{const p=n.getState?n.getState():{};n.push({event:t,context:p})})},ke=(t,e)=>{if(!Le[t])return null;switch(t){case"edit-company":Re({type:"company",eventType:"edit",companyData:e});break;default:return null}},Fe=({handleSetInLineAlert:t})=>{const e=j({companySuccess:"Company.CompanyProfile.editCompanyProfile.companySuccess",companyError:"Company.CompanyProfile.editCompanyProfile.companyError",loadError:"Company.CompanyProfile.messages.loadError",updateError:"Company.CompanyProfile.messages.updateError"}),{companySuccess:n,companyError:p,loadError:i,updateError:o}=e,[r,h]=$(null),[_,s]=$(!0),[m,d]=$(!1),[f,v]=$(!1),[b,V]=$([]),[l,E]=$({}),[T,A]=$(""),k=te(t),z=te(!1),H=te(!1);q(()=>{k.current=t},[t]);const W=R(C=>{E(C)},[]),I=R((C,x)=>{t&&(C==="success"?t({type:"success",text:x??n}):C==="error"?t({type:"error",text:x??p}):t(),d(!1))},[t,n,p]),O=R(()=>{z.current||(z.current=!0,Ee(!0).then(C=>{C&&(h(C),A("")),s(!1)}).catch(C=>{console.error("Failed to load company:",C),s(!1),k.current&&k.current({type:"error",text:i})}).finally(()=>{z.current=!1}))},[i]);q(()=>{H.current||(H.current=!0,O())},[O]),q(()=>{ge().then(C=>{V(C.availableCountries)}).catch(C=>{console.error("Failed to load countries:",C)})},[]);const U=R(()=>{v(!0),I("success",""),E({})},[I]),Y=R(C=>{C==null||C(),v(!1),E({})},[]),G=R(async C=>{try{if(d(!0),!C){I("error","No data to update");return}const x=await be(C);r&&(x.canEdit=r.canEdit,x.customerRole=r.customerRole,x.customerStatus=r.customerStatus),h(x),v(!1),E({}),I("success"),ke(fe.EDIT_COMPANY_EVENT,{...C,companyId:r==null?void 0:r.id}),Ie(()=>import("../chunks/getCountries.js").then(B=>B.h),[]).then(B=>{var Z;return(Z=B.resetCompanyCache)==null?void 0:Z.call(B)}),O()}catch(x){console.error("Failed to update company:",x),I("error",x.message||o)}finally{d(!1)}},[r,I,O,o]);return{company:r,countries:b,createdAt:T,loading:_,submitLoading:m,showEditForm:f,inputChange:l,handleShowEditForm:U,handleHideEditForm:Y,handleUpdateCompany:G,handleInputChange:W,renderAlertMessage:I,saving:m}},De=t=>S.createElement("svg",{id:"Icon_Warning_Base",width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},S.createElement("g",{clipPath:"url(#clip0_841_1324)"},S.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.9949 2.30237L0.802734 21.6977H23.1977L11.9949 2.30237Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),S.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M12.4336 10.5504L12.3373 14.4766H11.6632L11.5669 10.5504V9.51273H12.4336V10.5504ZM11.5883 18.2636V17.2687H12.4229V18.2636H11.5883Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})),S.createElement("defs",null,S.createElement("clipPath",{id:"clip0_841_1324"},S.createElement("rect",{width:24,height:21,fill:"white",transform:"translate(0 1.5)"})))),Te=t=>S.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},S.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),S.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.75 12.762L10.2385 15.75L17.25 9",stroke:"currentColor"})),Be=t=>S.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},S.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),S.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.75 5.88423V4.75H12.25V5.88423L12.0485 13.0713H11.9515L11.75 5.88423ZM11.7994 18.25V16.9868H12.2253V18.25H11.7994Z",stroke:"currentColor"})),ze={success:a(Te,{}),warning:a(De,{}),error:a(Be,{})},He=()=>{const[t,e]=$({}),[n,p]=$(null),i=R(()=>{e({}),n&&(clearTimeout(n),p(null))},[n]),o=R(s=>{if(n&&(clearTimeout(n),p(null)),!(s!=null&&s.type)){e({});return}const m=ze[s.type];if(e({type:s.type,text:s.text,icon:m}),s.autoHide!==!1){const d=s.autoHideDelay||(s.type==="success"?3e3:5e3),f=setTimeout(()=>{e({}),p(null)},d);p(f)}},[n]),r=R((s,m=!0)=>{o({type:"success",text:s,autoHide:m})},[o]),h=R((s,m=!1)=>{o({type:"warning",text:s,autoHide:m})},[o]),_=R((s,m=!1)=>{o({type:"error",text:s,autoHide:m})},[o]);return q(()=>()=>{n&&clearTimeout(n)},[n]),{inLineAlertProps:t,handleSetInLineAlert:o,clearAlert:i,showSuccess:r,showWarning:h,showError:_}},Je=({className:t,withHeader:e=!0,slots:n})=>{const p=j({containerTitle:"Company.CompanyProfile.containerTitle"}),{inLineAlertProps:i,handleSetInLineAlert:o}=He(),{company:r,loading:h,saving:_,showEditForm:s,handleShowEditForm:m,handleHideEditForm:d,handleUpdateCompany:f}=Fe({handleSetInLineAlert:o});return h?a("div",{"data-testid":"companyProfileLoader",children:a($e,{withCard:!0})}):g("div",{className:re(["account-company-profile",t]),children:[e?a(he,{title:p.containerTitle,divider:!1,className:"company-profile__title"}):null,a(Ne,{company:r,slots:n,showEditForm:s,handleShowEditForm:m}),s?a(Ve,{inLineAlertProps:i,company:r,loading:_,onSubmit:f,onCancel:d}):null]})};export{Je as CompanyProfile,Je as default};
//# sourceMappingURL=CompanyProfile.js.map
