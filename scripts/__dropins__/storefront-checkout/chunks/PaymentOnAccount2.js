/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as x,jsx as n}from"@dropins/tools/preact-jsx-runtime.js";import{useState as f,useCallback as b,useEffect as k}from"@dropins/tools/preact-compat.js";import{W as E}from"./ConditionalWrapper.js";/* empty css                */import{Skeleton as V,SkeletonRow as A,Price as p,Field as q,Input as F,InLineAlert as S}from"@dropins/tools/components.js";import{getPriceFormatter as y,classes as H}from"@dropins/tools/lib.js";import{useText as j,Text as w}from"@dropins/tools/i18n.js";import{s as g}from"./fetch-graphql.js";import{events as I}from"@dropins/tools/event-bus.js";import{g as Q}from"./getCompanyCredit.js";const $=()=>x(V,{"data-testid":"payment-on-account-skeleton",children:[n(A,{fullWidth:!0,size:"medium"}),n(A,{fullWidth:!0,size:"medium"})]}),B=(c,r)=>{if(!(c!=null&&c.availableCredit)||!r)return null;const l=c.availableCredit.value,e=r.value-l;return e<=0?null:{value:e,currency:c.availableCredit.currency}},D=({className:c,referenceNumber:r="",onReferenceNumberChange:l,onReferenceNumberBlur:h,companyCredit:e=null,totalAmount:s=null,...v})=>{const u=B(e,s),m=e==null?void 0:e.availableCredit,d=y({currency:(s==null?void 0:s.currency)??""}),a=j({referenceNumberLabel:"Checkout.PaymentOnAccount.referenceNumberLabel",referenceNumberPlaceholder:"Checkout.PaymentOnAccount.referenceNumberPlaceholder",referenceNumberHint:"Checkout.PaymentOnAccount.referenceNumberHint",availableCreditLabel:"Checkout.PaymentOnAccount.availableCreditLabel",exceedLimitError:"Checkout.PaymentOnAccount.exceedLimitError",exceedLimitWarning:u?n(w,{fields:{creditLimit:d.format((m==null?void 0:m.value)??0),exceededAmount:d.format((u==null?void 0:u.value)??0)},id:"Checkout.PaymentOnAccount.exceedLimitWarning"}):""});return console.debug("Translations:",a),n("div",{className:"checkout-payment-on-account","data-testid":"checkout-payment-on-account",children:x("form",{...v,noValidate:!0,className:H(["checkout-payment-on-account__form",c]),"data-testid":"checkout-payment-on-account-form",name:"checkout-payment-on-account__form",children:[e&&e.availableCredit&&x("div",{className:"checkout-payment-on-account__credit","data-testid":"checkout-payment-on-account-credit",children:[n("span",{className:"checkout-payment-on-account__credit-label",children:a.availableCreditLabel}),n("span",{className:"checkout-payment-on-account__credit-amount",children:n(p,{amount:e==null?void 0:e.availableCredit.value,currency:e==null?void 0:e.availableCredit.currency})})]}),n(q,{hint:a.referenceNumberHint,children:n(F,{"aria-label":a.referenceNumberLabel,floatingLabel:a.referenceNumberLabel,id:"reference-number",name:"reference-number",placeholder:a.referenceNumberPlaceholder,type:"text",value:r,onBlur:h,onChange:l})}),u&&n("div",{className:"checkout-payment-on-account__exceed-message","data-testid":"checkout-payment-on-account-exceed-message",children:n(S,{heading:e!=null&&e.exceedLimit?a.exceedLimitWarning:a.exceedLimitError,type:e!=null&&e.exceedLimit?"warning":"error",variant:"primary"})})]})})},G=E(D,$),te=({initialReferenceNumber:c="",onReferenceNumberChange:r,onReferenceNumberBlur:l,...h})=>{const[e,s]=f(!1),[v,u]=f(null),[m,d]=f(null),[a,W]=f(c),L=g.authenticated,P=!!g.cartId,N=!!g.quoteId,_=b(t=>{var o;d(((o=t==null?void 0:t.total)==null?void 0:o.includingTax)||null)},[]),O=b(t=>{var o,i;d(((i=(o=t==null?void 0:t.quote)==null?void 0:o.prices)==null?void 0:i.grandTotal)||null)},[]),T=b(t=>{const i=t.target.value;W(i),r==null||r(i)},[r]),z=b(t=>{const i=t.target.value;l==null||l(i)},[l]);return k(()=>{if(!P)return;const t=I.on("cart/data",_,{eager:!0});return()=>{t==null||t.off()}},[P,_]),k(()=>{if(!N)return;const t=I.on("quote-management/quote-data",O,{eager:!0});return()=>{t==null||t.off()}},[N,O]),k(()=>{L&&Q().then(t=>{u(t)}).catch(t=>{console.error("Failed to fetch company credit:",t),u(null)}).finally(()=>{s(!0)})},[L]),n("div",{...h,children:n(G,{companyCredit:v,initialized:e,referenceNumber:a,totalAmount:m,onReferenceNumberBlur:z,onReferenceNumberChange:T})})};export{te as P};
//# sourceMappingURL=PaymentOnAccount2.js.map
