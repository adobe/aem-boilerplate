/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsx as t,jsxs as u,Fragment as M}from"@dropins/tools/preact-jsx-runtime.js";import{classes as T,Slot as I}from"@dropins/tools/lib.js";import{S as B,c as j,E as R,C as Q}from"../chunks/AddressValidation.js";import"@dropins/tools/preact-compat.js";import{Card as G,Icon as F,Image as J,Price as X,ContentGrid as Z,Header as rr,Picker as tr,Pagination as er}from"@dropins/tools/components.js";import{useText as E}from"@dropins/tools/i18n.js";import{useState as y,useEffect as P,useMemo as U,useCallback as K}from"@dropins/tools/preact-hooks.js";import{events as sr}from"@dropins/tools/event-bus.js";import{g as ar}from"../chunks/getOrderHistoryList.js";import{g as nr}from"../chunks/getStoreConfig.js";import"../chunks/removeCustomerAddress.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/preact.js";import"../chunks/initialize.js";import"../fragments.js";const V={size:"32",stroke:"2"},W=({minifiedView:n,orderNumber:c,orderToken:r,routeOrdersList:s,routeOrderDetails:h})=>{const a=n?"minifiedView":"fullSizeView",l=E({viewAllOrdersButton:`Account.${a}.OrdersList.viewAllOrdersButton`,ariaLabelLink:`Account.${a}.OrdersList.ariaLabelLink`});return s?t("a",{className:T(["account-orders-list-action",["account-orders-list-action--minifiedView",n]]),"data-testid":"ordersListActionButtonMinifiedView",href:s(),children:t(G,{"data-testid":"ordersListActionMinifiedView",variant:"secondary",children:u("div",{className:"account-orders-list-action__card-wrapper",children:[t("p",{children:l.viewAllOrdersButton}),t(F,{source:B,...V})]})})}):t("a",{"aria-label":`${l.ariaLabelLink} ${c??r}`,href:j(h)?h(c,r):"#",className:"account-orders-list-action","data-testid":"ordersListActionButton",children:t(F,{source:B,...V})})},cr=()=>{const[n,c]=y(window.innerWidth<768);return P(()=>{const r=()=>{c(window.innerWidth<768)};return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}},[]),n},or=({placeholderImage:n,minifiedView:c,item:r,withThumbnails:s,children:h,slots:a,routeTracking:l,routeOrderProduct:L,routeReturnDetails:O,...b})=>{var w,i,N,$,z,Y,f,D,C,m,v,x;const o=c?"minifiedView":"fullSizeView",g=E({orderNumber:`Account.${o}.OrdersList.OrdersListCard.orderNumber`,itemsAmount:`Account.${o}.OrdersList.OrdersListCard.itemsAmount`,carrier:`Account.${o}.OrdersList.OrdersListCard.carrier`,returnsText:`Account.${o}.OrdersList.OrdersListCard.returns`,deliveryDateText:`Account.${o}.OrdersList.OrdersListCard.orderDate`}),d=cr(),S=j(L),_=U(()=>((r==null?void 0:r.items)??[]).map((e,p)=>{var k,q;const A={title:(e==null?void 0:e.productName)??"",src:((q=(k=e==null?void 0:e.product)==null?void 0:k.smallImage)==null?void 0:q.url)||n,alt:(e==null?void 0:e.productName)??"",width:65,height:65,loading:"eager"};return t(I,{name:"OrderItemImage",slot:a==null?void 0:a.OrderItemImage,context:{data:e,defaultImageProps:A},children:S?t("a",{href:(L==null?void 0:L(e))??"",target:"_blank",rel:"noreferrer",children:t(J,{...A})}):t(J,{...A})},`${p}_${e.id}`)}),[S,r.items,n,L,a==null?void 0:a.OrderItemImage]);return u(G,{variant:"secondary",...b,className:T(["account-orders-list-card",["account-orders-list-card--full",((w=r==null?void 0:r.items)==null?void 0:w.length)>6]]),children:[t("div",{className:"account-orders-list-card__content",children:a!=null&&a.OrdersListCard?t(I,{"data-testid":`ordersListCard${r.id}`,name:"OrdersListCard",slot:a==null?void 0:a.OrdersListCard,context:{orderHistoryListItem:r}}):u(M,{children:[t("div",{children:r==null?void 0:r.status}),u("p",{children:[g.deliveryDateText," ",r==null?void 0:r.orderDate]}),u("p",{children:[g.orderNumber," ",r.number]}),(i=r==null?void 0:r.shipments)==null?void 0:i.map(e=>{var p;return(p=e==null?void 0:e.tracking)==null?void 0:p.map(A=>{const k=l==null?void 0:l(A);return u("p",{"data-testid":A.number,children:[t("span",{children:`${g.carrier} ${A.carrier.toLocaleUpperCase()} `}),k?t("a",{href:k,target:"_blank",className:"account-orders-list-card__content--track_number",rel:"noreferrer",children:A.number}):t("span",{className:"account-orders-list-card__content--track_number",children:A.number})]},e.id)})}),r!=null&&r.returns&&((N=r.returns)!=null&&N.length)?u("p",{"data-testid":r.number,children:[u("span",{children:[g.returnsText," "]}),($=r==null?void 0:r.returns)==null?void 0:$.map(e=>t("span",{"data-testid":e.number,children:u("a",{href:(O==null?void 0:O({orderNumber:r.number,orderToken:r.token,returnNumber:e.number}))??"#",className:"account-orders-list-card__content--return_number",children:[e.number," "]})},e.uid))]},r.id):null,t("p",{children:t(X,{amount:((Y=(z=r==null?void 0:r.total)==null?void 0:z.grandTotal)==null?void 0:Y.value)??0,currency:(D=(f=r==null?void 0:r.total)==null?void 0:f.grandTotal)==null?void 0:D.currency,weight:"normal",size:"medium"})}),u("p",{"data-testid":"itemsAmount",children:[(C=r==null?void 0:r.items)!=null&&C.length?(m=r==null?void 0:r.items)==null?void 0:m.reduce((e,p)=>{const A=(p==null?void 0:p.quantityOrdered)||0;return e+A},0):0," ",g.itemsAmount]}),(v=r==null?void 0:r.items)==null?void 0:v.map((e,p)=>{if(p>=0&&p<10)return u("p",{className:"account-orders-list-card__content--product-name",children:[u("span",{className:"account-orders-list-card__content--quantity",children:[(e==null?void 0:e.quantityOrdered)>1?e==null?void 0:e.quantityOrdered:null," "]}),e==null?void 0:e.productName.replaceAll("-"," ")]},`${p}_${e.id}`);if(p===11)return t("p",{children:"..."},"ellipsis")})]})}),s&&((x=r==null?void 0:r.items)!=null&&x.length)?t(Z,{maxColumns:d?3:9,emptyGridContent:t(M,{}),className:T(["account-orders-list-card__images",["account-orders-list-card__images-3",d]]),"data-testid":"ordersListCardImages",children:_}):null,t("div",{className:"account-orders-list-card__actions",children:h})]})},dr=({ordersInMinifiedView:n,minifiedView:c,pageSize:r,selectedDate:s,selectedPage:h,handleSetFirstOrderDate:a})=>{const[l,L]=y([]),[O,b]=y({totalPages:1,currentPage:1,pageSize:1}),[o,g]=y(!1),[d,S]=y(""),[_,w]=y(0);return P(()=>{nr().then(i=>{S(i.baseMediaUrl)})},[]),P(()=>{const i=sr.on("companyContext/changed",()=>{w(N=>N+1)});return()=>{i==null||i.off()}},[]),P(()=>{g(!0),ar(c?n:r,s,h).then(i=>{!i||!i.items||(b(i.pageInfo),L(i.items),a==null||a(i.dateOfFirstOrder))}).finally(()=>{g(!1)})},[a,c,n,r,s,h,_]),{loading:o,orderHistoryListItems:l,pageInfo:O,placeholderImage:d}},H=(n,c=1)=>{const r=new Date,s=new Date(r);switch(n){case"sixMonthsAgo":{s.setMonth(s.getMonth()-c);break}case"oneYearAgo":{s.setFullYear(s.getFullYear()-c);break}default:return""}return{from:s==null?void 0:s.toISOString().split("T")[0],to:`${r==null?void 0:r.toISOString().split("T")[0]} 23:59:59`}},ir=n=>{const c=[],r=new Date().getFullYear();for(let s=n;s<=r-1;s++)c.push({value:`{"from":"${s}-01-01","to":"${s+1}-01-01 23:59:59"}`,text:s.toString()});return c},lr=()=>{const n=E({pastSixMonths:"Account.fullSizeView.OrdersList.OrdersListSelectDate.pastSixMonths",currentYear:"Account.fullSizeView.OrdersList.OrdersListSelectDate.currentYear",viewAll:"Account.fullSizeView.OrdersList.OrdersListSelectDate.viewAll"}),[c,r]=y(),[s,h]=y(JSON.stringify(H("sixMonthsAgo",6))),[a,l]=y(1);P(()=>{window==null||window.scrollTo({top:100,behavior:"smooth"})},[a]);const L=U(()=>{const o=[{value:JSON.stringify(H("sixMonthsAgo",6)),text:n.pastSixMonths},{value:JSON.stringify(H("oneYearAgo",1)),text:n.currentYear},{value:"viewAll",text:n.viewAll}];if(c){const d=new Date(c).getFullYear();o==null||o.splice(2,0,...ir(d))}return o},[n,c]),O=K(o=>{r(o)},[]),b=K(o=>{const d=o.target.value;h(d),l(1)},[]);return{selectableDateList:L,selectedDate:s,selectedPage:a,handleSelectDate:b,setSelectedPage:l,handleSetFirstOrderDate:O}},ur=({className:n,withHeader:c=!0,minifiedView:r=!1,withThumbnails:s=!0,withFilter:h=!0,ordersInMinifiedView:a=1,pageSize:l=10,routeOrdersList:L,routeOrderDetails:O,routeReturnDetails:b,routeTracking:o,routeOrderProduct:g,slots:d})=>{const S=r?"minifiedView":"fullSizeView",_=E({containerTitle:`Account.${S}.OrdersList.containerTitle`,dateOrderPlaced:`Account.${S}.OrdersList.dateOrderPlaced`}),{selectableDateList:w,selectedDate:i,handleSelectDate:N,selectedPage:$,setSelectedPage:z,handleSetFirstOrderDate:Y}=lr(),{pageInfo:f,loading:D,orderHistoryListItems:C,placeholderImage:m}=dr({minifiedView:r,pageSize:l,ordersInMinifiedView:a,selectedDate:i,selectedPage:$,handleSetFirstOrderDate:Y});return u("div",{children:[c?t(rr,{"aria-label":_.containerTitle,role:"region",title:_.containerTitle,divider:!r,className:r?"account-orders-list-header":""}):null,u("div",{className:T(["account-orders-list",n]),children:[!r&&h?u("div",{className:"account-orders-list__date-select",children:[t("span",{children:_.dateOrderPlaced}),t(tr,{value:i,name:"orderDatePicker",options:w,handleSelect:N})]}):null,D?t(M,{children:Array.from(Array(f==null?void 0:f.pageSize).keys()).map(v=>t(Q,{testId:"orderSkeletonLoader",withCard:!1},v))}):t(M,{children:C.length?t(M,{children:C.map((v,x)=>t(or,{placeholderImage:m,routeTracking:o,routeOrderProduct:g,routeReturnDetails:b,minifiedView:r,item:v,withThumbnails:s,slots:d,children:d!=null&&d.OrdersListAction?t(I,{"data-testid":`ordersListActionSlot_${x}`,name:"OrdersListAction",slot:d==null?void 0:d.OrdersListAction,context:{orderHistoryListItem:v}}):t(W,{minifiedView:r,orderNumber:v.number,orderToken:v.token,routeOrderDetails:O})},x))}):t(R,{isEmpty:!C.length,typeList:"orders",minifiedView:r})}),!r&&(f==null?void 0:f.totalPages)>1?t(er,{totalPages:f==null?void 0:f.totalPages,currentPage:$,onChange:z}):null,r?t(W,{minifiedView:r,routeOrdersList:L}):null]})]})},$r=({className:n,withHeader:c,minifiedView:r,withThumbnails:s,withFilter:h,ordersInMinifiedView:a,pageSize:l,routeOrdersList:L,routeOrderDetails:O,routeReturnDetails:b,routeTracking:o,routeOrderProduct:g,slots:d})=>t("div",{className:T(["account-orders-list",n]),"data-testid":"ordersListId",children:t(ur,{className:n,withHeader:c,minifiedView:r,withThumbnails:s,withFilter:h,ordersInMinifiedView:a,pageSize:l,routeOrdersList:L,routeOrderDetails:O,routeReturnDetails:b,routeTracking:o,routeOrderProduct:g,slots:d})});export{$r as OrdersList,$r as default};
//# sourceMappingURL=OrdersList.js.map
