/*! Copyright 2024 Adobe
All Rights Reserved. */
import{jsx as i,jsxs as c,Fragment as S}from"@dropins/tools/preact-jsx-runtime.js";import{useState as G,useEffect as X,useCallback as A}from"@dropins/tools/preact-compat.js";import{classes as v,VComponent as b,Slot as H}from"@dropins/tools/lib.js";import{g as R}from"../chunks/persisted-data.js";import{events as j}from"@dropins/tools/event-bus.js";import{Price as C,Button as I}from"@dropins/tools/components.js";/* empty css                         */import{useText as k}from"@dropins/tools/i18n.js";import{s as d}from"../chunks/resetCart.js";import{p as w}from"../chunks/acdl.js";import{u as F}from"../chunks/updateProductsFromCart.js";import"../chunks/CartSummaryGrid.js";import{C as O}from"../chunks/CartSummaryList.js";import"../chunks/OrderSummary.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/refreshCart.js";import"../fragments.js";import"../chunks/EmptyCart.js";import"../chunks/ChevronDown.js";import"../chunks/getEstimatedTotals.js";import"../chunks/OrderSummaryLine.js";import"../chunks/Coupon.js";const B=({className:h,products:s,subtotal:u,subtotalExcludingTaxes:a,ctas:l,...m})=>{const o=k({subtotal:"Cart.MiniCart.subtotal",subtotalExcludingTaxes:"Cart.MiniCart.subtotalExcludingTaxes"});return i("div",{...m,className:v(["cart-mini-cart",h]),children:s&&c(S,{children:[i("div",{className:"cart-mini-cart__products","data-testid":"mini-cart-products-wrapper",children:s}),c("div",{className:"cart-mini-cart__footer","data-testid":"mini-cart-subtotals",children:[u&&c("div",{className:"cart-mini-cart__footer__estimated-total","data-testid":"mini-cart-subtotal",children:[o.subtotal,i(b,{node:u})]}),a&&c("div",{className:"cart-mini-cart__footer__estimated-total-excluding-taxes","data-testid":"mini-cart-subtotal-excluding-taxes",children:[o.subtotalExcludingTaxes,i(b,{node:a,className:v(["dropin-price-summary__price","dropin-price-summary__price--muted"])})]}),l&&i(b,{node:l,className:"cart-mini-cart__footer__ctas"})]})]})})},V=({children:h,initialData:s=null,hideFooter:u=!0,slots:a,routeProduct:l,routeCart:m,routeCheckout:o,routeEmptyCartCTA:L,showDiscount:N,showSavings:D,...M})=>{var f,_,g;const[t,Q]=G(s),e=(f=d.config)==null?void 0:f.shoppingCartDisplaySetting;X(()=>{const r=j.on("cart/data",p=>{Q(p)},{eager:!0});return()=>{r==null||r.off()}},[]);const x=k({cartLink:"Cart.MiniCart.cartLink",checkoutLink:"Cart.MiniCart.checkoutLink"}),y=(r,p)=>F([{uid:r,quantity:p}]),T=r=>y(r,0),n=t==null?void 0:t.hasOutOfStockItems,E=A(()=>{t&&!n&&w(t,d.locale)},[t,n]),P=i(H,{name:"ProductList",slot:a==null?void 0:a.ProductList,context:{itemQuantityUpdateHandler:y,itemRemoveHandler:T,totalQuantity:t==null?void 0:t.totalQuantity},children:i(O,{"data-testid":"default-cart-summary-list",routeProduct:l,routeEmptyCartCTA:L,initialData:t,maxItems:(_=d.config)==null?void 0:_.miniCartMaxItemsDisplay,showMaxItems:!!((g=d.config)!=null&&g.miniCartMaxItemsDisplay),hideHeading:!(t!=null&&t.totalQuantity),hideFooter:u,enableRemoveItem:!0,showDiscount:N,showSavings:D})}),U=()=>(e==null?void 0:e.subtotal)==="INCLUDING_TAX"||(e==null?void 0:e.subtotal)==="INCLUDING_EXCLUDING_TAX"?{amount:t==null?void 0:t.subtotal.includingTax.value,currency:t==null?void 0:t.subtotal.includingTax.currency,"data-testid":"subtotal-including-tax",style:{font:"inherit"}}:{amount:t==null?void 0:t.subtotal.excludingTax.value,currency:t==null?void 0:t.subtotal.excludingTax.currency,"data-testid":"subtotal-excluding-tax",style:{font:"inherit"}};return i(B,{...M,subtotal:t!=null&&t.totalQuantity?(t==null?void 0:t.subtotal)&&i(C,{...U()}):void 0,subtotalExcludingTaxes:t!=null&&t.totalQuantity?(t==null?void 0:t.subtotal)&&((e==null?void 0:e.subtotal)==="INCLUDING_EXCLUDING_TAX"?i(C,{amount:t==null?void 0:t.subtotal.excludingTax.value,currency:t==null?void 0:t.subtotal.excludingTax.currency,"data-testid":"subtotal-including-excluding-tax",style:{font:"inherit"}}):void 0):void 0,ctas:t!=null&&t.totalQuantity?c("div",{children:[o&&i(I,{"data-testid":"route-checkout-button",variant:"primary",href:n?void 0:o(),disabled:n,"aria-disabled":n,onClick:E,children:x.checkoutLink}),m&&i(I,{"data-testid":"route-cart-button",variant:"tertiary",href:m(),children:x.cartLink})]}):void 0,products:P})};V.getInitialData=async function(){return R()};export{V as MiniCart,V as default};
