/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as s,jsxs as M}from"@dropins/tools/preact-jsx-runtime.js";import{classes as T,Slot as B}from"@dropins/tools/lib.js";import{Button as S,InLineAlert as D,Card as N,Header as w,Skeleton as _,SkeletonRow as x}from"@dropins/tools/components.js";import{useState as p,useEffect as I,useCallback as m}from"@dropins/tools/preact-hooks.js";import{events as z}from"@dropins/tools/event-bus.js";import"../chunks/PurchaseOrderHistoryLogContent.js";import{a as J,r as V}from"../chunks/rejectPurchaseOrders.js";import{c as H,p as W}from"../chunks/placeOrderForPurchaseOrder.js";import{useText as R}from"@dropins/tools/i18n.js";import"@dropins/tools/preact.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/fetch-error.js";const $=()=>{const e=R({approvalSuccessMessage:"PurchaseOrders.purchaseOrderStatus.alertMessages.success.approval",rejectSuccessMessage:"PurchaseOrders.purchaseOrderStatus.alertMessages.success.reject",cancelSuccessMessage:"PurchaseOrders.purchaseOrderStatus.alertMessages.success.cancel",placeOrderSuccessMessage:"PurchaseOrders.purchaseOrderStatus.alertMessages.success.placeOrder",approvalErrorMessage:"PurchaseOrders.purchaseOrderStatus.alertMessages.errors.approval",rejectErrorMessage:"PurchaseOrders.purchaseOrderStatus.alertMessages.errors.reject",cancelErrorMessage:"PurchaseOrders.purchaseOrderStatus.alertMessages.errors.cancel",placeOrderErrorMessage:"PurchaseOrders.purchaseOrderStatus.alertMessages.errors.placeOrder"}),[a,t]=p([]),[c,d]=p(null),[i,O]=p("PENDING"),[g,l]=p("success"),[P,n]=p(""),[f,b]=p(!1),[v,E]=p(!0),A=()=>{E(!0)};I(()=>{const h=z.on("purchase-order/data",r=>{r!=null&&r.uid&&(d(r.uid),O(r.status),t(r.availableActions))},{eager:!0});return()=>{h==null||h.off()}},[]);const C=m((h,r)=>{let u="";if(h){switch(r){case"APPROVE":u=e.approvalSuccessMessage;break;case"REJECT":u=e.rejectSuccessMessage;break;case"CANCEL":u=e.cancelSuccessMessage;break;case"PLACE_ORDER":u=e.placeOrderSuccessMessage;break}l("success")}else{switch(r){case"APPROVE":u=e.approvalErrorMessage;break;case"REJECT":u=e.rejectErrorMessage;break;case"CANCEL":u=e.cancelErrorMessage;break;case"PLACE_ORDER":u=e.placeOrderErrorMessage;break}l("error")}n(u),E(!1)},[e]),o=m(async(h,r)=>{if(c){b(!0);try{await h(c),C(!0,r)}catch{C(!1,r)}finally{b(!1)}}},[c,C]),k=m(()=>o(J,"APPROVE"),[o]),y=m(()=>o(V,"REJECT"),[o]),j=m(()=>o(H,"CANCEL"),[o]),L=m(()=>o(W,"PLACE_ORDER"),[o]);return{poId:c,status:i,availableActions:a,alertType:g,loading:f,isDismissed:v,alertMessage:P,handleOnDismiss:A,handleApprove:k,handleReject:y,handleCancel:j,handlePlaceOrder:L}},F=({slots:e,t:a,loading:t,children:c,availableActions:d=[],handleApprove:i,handleReject:O,handleCancel:g,handlePlaceOrder:l})=>{const P=d.map(n=>{switch(n){case"APPROVE":return s(S,{variant:"secondary",disabled:t,type:"button",onClick:i,children:a.approveButtonText},n);case"PLACE_ORDER":return s(S,{variant:"secondary",disabled:t,type:"button",onClick:l,children:a.placeOrderButtonText},n);case"REJECT":return s(S,{variant:"secondary",disabled:t,type:"button",onClick:O,children:a.rejectButtonText},n);case"CANCEL":return s(S,{variant:"secondary",disabled:t,type:"button",onClick:g,children:a.cancelButtonText},n);default:return null}});return M("div",{className:T(["b2b-purchase-order-status-content"]),children:[s("div",{className:"b2b-purchase-order-status-content__message",children:a.statusMessageText}),c,s("div",{className:"b2b-purchase-order-status-content__actions",children:s(B,{"data-testid":"PurchaseOrderActions",name:"PurchaseOrderActions",slot:e==null?void 0:e.PurchaseOrderActions,context:{loading:t,availableActions:d,handleApprove:i,handleReject:O,handleCancel:g,handlePlaceOrder:l},children:P})})]})},ce=({className:e,slots:a})=>{const{poId:t,status:c,availableActions:d,alertType:i,loading:O,isDismissed:g,alertMessage:l,handleOnDismiss:P,handleApprove:n,handleReject:f,handleCancel:b,handlePlaceOrder:v}=$(),E=R({statusHeadingText:`PurchaseOrders.purchaseOrderStatus.status.${c.toLowerCase()}.title`,statusMessageText:`PurchaseOrders.purchaseOrderStatus.status.${c.toLowerCase()}.message`,approveButtonText:"PurchaseOrders.purchaseOrderStatus.buttons.approve",cancelButtonText:"PurchaseOrders.purchaseOrderStatus.buttons.cancel",rejectButtonText:"PurchaseOrders.purchaseOrderStatus.buttons.reject",placeOrderButtonText:"PurchaseOrders.purchaseOrderStatus.buttons.placeOrder"}),A=d.length>0;return t?M("div",{className:T(["purchase-order-status",e]),children:[!g&&l?s(D,{style:{marginBottom:"1rem",textTransform:"capitalize"},heading:i,onDismiss:P,description:l,type:i}):null,M(N,{variant:"secondary",children:[s(w,{title:E.statusHeadingText}),A?s(F,{t:E,loading:O,handleApprove:n,handleReject:f,handleCancel:b,handlePlaceOrder:v,availableActions:d,slots:a}):M(_,{"data-testid":"status-content-loader-skeleton-test-id",children:[s(x,{variant:"heading",size:"xlarge",fullWidth:!1,lines:1}),s(x,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1}),s(x,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1})]})]})]}):null};export{ce as PurchaseOrderStatus,ce as default};
//# sourceMappingURL=PurchaseOrderStatus.js.map
