/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as t,jsxs as Z,Fragment as $}from"@dropins/tools/preact-jsx-runtime.js";import{useState as I,useRef as D,useCallback as ee,useEffect as T}from"@dropins/tools/preact-compat.js";import{ContentGrid as te,Skeleton as ne,SkeletonRow as re,ProductItemCard as oe,Button as ie,PriceRange as ce,Price as ae,Image as de}from"@dropins/tools/components.js";import{classes as le,VComponent as se,Slot as h}from"@dropins/tools/lib.js";import{events as me}from"@dropins/tools/event-bus.js";import{p as ue,g as pe,a as fe,b as ge}from"../chunks/getRecommendations.js";import{useText as he}from"@dropins/tools/i18n.js";import"../fragments.js";import"../chunks/initialize.js";import"@dropins/tools/fetch-graphql.js";const Re=({className:m,children:f,heading:R,products:u=null,loading:g=!0,...v})=>t("section",{...v,role:"region","aria-label":"Product recommendations",className:le(["recommendations-product-list",m,["recommendations-product-list--empty",!u]]),children:g?t(ve,{}):Z($,{children:[R&&t(se,{node:R,className:"recommendations-product-list__heading"}),t(te,{className:"recommendations-product-list__content","data-testid":"recommendations-product-list__content",maxColumns:0,columnWidth:"minmax(240px, 1fr)",children:u})]})}),ve=()=>t(ne,{"data-testid":"recommendations-product-list-skeleton",className:"recommendations-product-list-skeleton",rowGap:"medium",children:[...Array(2)].map((m,f)=>t(re,{variant:"row",size:"large",fullWidth:!0,lines:2,multilineGap:"small"},f))}),Le=({recId:m,initialData:f=null,hideHeading:R,routeProduct:u,currentSku:g,cartSkus:v,userPurchaseHistory:C,userViewHistory:x,pagePlacement:j,slots:i,...V})=>{var B,O,L;const[W,P]=I(!f),[o,k]=I((B=f==null?void 0:f.recommendations)!=null&&B.results?f.recommendations.results.filter(e=>e.unitId===m):[]),p=D(null),b=he({addToCartText:"Recommendations.ProductList.addToCart",optionsText:"Recommendations.ProductList.selectOptions",viewProductText:"Recommendations.ProductList.viewProduct"}),y=ee(()=>!!m&&!!g,[m,g]);if(T(()=>{const e=me.on("recommendations/data",d=>{d&&d.length>0&&k(c=>{const n=c||[],a=d.filter(r=>{var l;return(r==null?void 0:r.unitId)===m&&((l=r==null?void 0:r.items)==null?void 0:l.length)&&!n.some(s=>s.unitId===r.unitId)});return a.forEach(r=>{var l,s;ue({recommendationUnit:r,pagePlacement:"product-list",yOffsetTop:((l=p.current)==null?void 0:l.getBoundingClientRect().top)??0,yOffsetBottom:((s=p.current)==null?void 0:s.getBoundingClientRect().bottom)??0,backupProducts:0,searchTime:0})}),[...n,...a]}),P(!1)});return()=>{e==null||e.off()}},[m]),T(()=>{if(!(o!=null&&o.length)||!p.current)return;const e={root:null,rootMargin:"0px",threshold:.5},d=n=>{n.forEach(a=>{a.intersectionRatio>.5&&o.forEach(r=>{var l,s;fe({recommendationUnit:r,pagePlacement:"product-list",yOffsetTop:((l=p.current)==null?void 0:l.getBoundingClientRect().top)??0,yOffsetBottom:((s=p.current)==null?void 0:s.getBoundingClientRect().bottom)??0})})})},c=new IntersectionObserver(d,e);return c.observe(p.current),()=>c.disconnect()},[o]),T(()=>{if(!y()){P(!1);return}P(!0),pe({currentSku:g,pageType:"Product",cartSkus:v,userPurchaseHistory:C,userViewHistory:x,recId:m}).catch(e=>{console.error("Recommendations error:",e),k([]),P(!1)})},[g,v,C,x,y,m]),!y())return m||console.warn("ProductList: recId is missing. Please provide a valid recId to display product recommendations."),g||console.warn("ProductList: currentSku is missing. Please provide a valid currentSku to display product recommendations."),null;const q=(e,d)=>{var a,r,l,s;const c={loading:d<4?"eager":"lazy",src:((r=(a=e.images)==null?void 0:a[0])==null?void 0:r.url)||"",alt:((s=(l=e.images)==null?void 0:l[0])==null?void 0:s.label)||"",width:"300",height:"300",params:{width:300}},n=t(de,{"data-testid":"product-list-item-image",...c,"aria-label":e.sku});return t(h,{name:"Thumbnail",slot:i==null?void 0:i.Thumbnail,context:{item:e,defaultImageProps:c},children:u?t("a",{href:u(e),children:n}):n})},M=t(h,{name:"Heading",slot:i==null?void 0:i.Heading,context:{},children:t("div",{"data-testid":"default-product-list-heading",children:((O=o==null?void 0:o[0])==null?void 0:O.title)||b.heading})}),H=(e,d)=>t(h,{name:"Footer",slot:i==null?void 0:i.Footer,context:{item:e,index:d},children:t("div",{"data-testid":"default-product-list-footer",children:u&&t("a",{href:u(e),children:t(ie,{"data-testid":"default-product-list-footer-button",children:b.viewProductText,"aria-label":b.viewProductText,variant:"primary"})})})}),J=e=>t(h,{name:"Title",slot:i==null?void 0:i.Title,context:{item:e,productUrl:u?u(e):""},children:u?t("a",{href:u(e),children:e.name}):t("span",{children:e.name})}),K=e=>t(h,{name:"Sku",slot:i==null?void 0:i.Sku,context:{item:e},children:t("span",{children:e.sku})}),Q=e=>{var d,c,n,a,r,l,s,_,N,U,E,S,F,z,A,G;return t(h,{name:"Price",slot:i==null?void 0:i.Price,context:{item:e},children:t("div",{"data-testid":"default-product-price",children:e.itemType==="ComplexProductView"?t(ce,{display:"from to",minimumAmount:(a=(n=(c=(d=e.priceRange)==null?void 0:d.minimum)==null?void 0:c.final)==null?void 0:n.amount)==null?void 0:a.value,maximumAmount:(_=(s=(l=(r=e.priceRange)==null?void 0:r.maximum)==null?void 0:l.final)==null?void 0:s.amount)==null?void 0:_.value,currency:(S=(E=(U=(N=e.priceRange)==null?void 0:N.minimum)==null?void 0:U.final)==null?void 0:E.amount)==null?void 0:S.currency}):t(ae,{amount:(z=(F=e.price.final)==null?void 0:F.amount)==null?void 0:z.value,currency:(G=(A=e.price.final)==null?void 0:A.amount)==null?void 0:G.currency})})})},X=(e,d)=>{var n,a;const c=o==null?void 0:o.find(r=>{var l;return(l=r.items)==null?void 0:l.some(s=>s.sku===e.sku)});c&&ge({recommendationUnit:c,pagePlacement:j||"",yOffsetTop:((n=p.current)==null?void 0:n.getBoundingClientRect().top)??0,yOffsetBottom:((a=p.current)==null?void 0:a.getBoundingClientRect().bottom)??0,productId:d})},Y=(L=o==null?void 0:o[0])!=null&&L.totalProducts?t($,{children:o==null?void 0:o.map(({items:e,totalProducts:d},c)=>d>0?e.map((n,a)=>{const{sku:r}=n;return t("span",{role:"group","aria-label":`Product ${c*e.length+a+1} of ${d}`,onClick:()=>X(n,c*e.length+a),children:t(oe,{"data-testid":"recommendations-product-item-card",initialized:!0,sku:K(n),image:q(n,c*e.length+a),titleNode:J(n),price:Q(n),actionButton:H(n,c*e.length+a)})},r)}):null)}):null,w=!o||o.length===0||o.every(e=>!e.items||e.items.length===0);return t("div",{ref:p,children:t(Re,{...V,className:w?"recommendations-product-list--empty":"",heading:R?void 0:M,loading:W,products:w?null:t("div",{className:"recommendations-carousel__content",children:Y})})})};export{Le as ProductList,Le as default};
//# sourceMappingURL=ProductList.js.map
